[{"title":"è¯»å®Œ type-challengesï¼Œæˆ‘æ€»ç»“äº†å¦‚ä¸‹å¸¸ç”¨çš„å†…å®¹","url":"/2022/07/30/type-challenges/","content":"\nè¿‘æœŸç”¨äº†ä¸€å®šæ—¶é—´é€šè¯»äº† [type-challenges](https://github.com/type-challenges/type-challenges)ï¼Œæ„Ÿæ…¨ Typescript ä¹Ÿå¯ä»¥å†™çš„å¦‚æ­¤å¤æ‚ä¹‹ä½™ï¼Œä¹Ÿå‡ºäºä»¥ä¸‹å‡ ä¸ªåŸå› ï¼Œå¯¹é¢˜ç›®åšäº†æ•´ç†ï¼Œå½¢æˆæœ¬æ–‡ï¼š\n\n* type-challenges æ•´ä½“é¢˜ç›®è¾ƒå¤šï¼Œè€Œä¸”å¾ˆå¤šæ—¶å€™æˆ‘ä»¬åªæ˜¯å­¦ä¹ ä¸ºä¸»ï¼Œå¹¶ä¸æ˜¯ä»¥â€œåšé¢˜â€ä¸ºç›®çš„ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨åˆ—è¡¨-é—®é¢˜-ç­”æ¡ˆåˆ—è¡¨-ç­”æ¡ˆè¯¦æƒ…ä¸­è·³æ¥è·³å»å¾ˆéº»çƒ¦ï¼Œä¹Ÿå¾ˆéš¾ç”„åˆ«ä¼˜è´¨è§£ç­”ã€‚\n* type-challenges ä»“åº“ä¸­æŸäº›é¢˜ç›®ï¼Œå®å±åé—¨ï¼Œå¯èƒ½å¯¹äºå¤§å¤šæ•°ä¸šåŠ¡å¼€å‘æ¥è¯´ï¼Œæ°¸è¿œä¹Ÿç”¨ä¸åˆ°ï¼ŒæŠ•å…¥æ—¶é—´åœ¨è¿™éƒ¨åˆ†ï¼ŒROI å°±ä¼šéå¸¸ä½ã€‚\n* type-challenges æœ‰äº›é¢˜ç›®æ¯”è¾ƒç±»ä¼¼ï¼Œä½†æ˜¯å´æ”¾åˆ°äº†ä¸åŒçš„åœ°æ–¹ï¼Œç”šè‡³éš¾åº¦ä¸åŒï¼Œç¬”è€…è®¤ä¸ºç»“åˆèµ·æ¥ä¸€èµ·çœ‹å¯èƒ½æ›´é«˜æ•ˆã€‚\n\nå› æ­¤ï¼Œæœ¬æ–‡å¯¹ç¬”è€…è®¤ä¸ºé‡è¦çš„ã€æœ‰ä¸šåŠ¡ä½¿ç”¨åœºæ™¯æˆ–è€…å¯ä»¥ç»™æˆ‘ä»¬ä»¥å¾ˆå¤§å¯å‘çš„é¢˜ç›®è¿›è¡Œç½—åˆ—å’Œè§£æï¼ŒåŒæ—¶è§„é¿äº†ä¸€äº›å¤æ‚åº¦å¾ˆé«˜ï¼Œä½†å®é™…å¤§å¤šæ•°äººç”¨ä¸åˆ°çš„é¢˜ç›®ï¼ˆæ¯”å¦‚ Typescript å®ç° JSON è§£æï¼‰ï¼Œå¯¹äºæ™®é€šçš„ Typescript å¼€å‘è€…è€Œè¨€ï¼Œçœ‹å®Œæœ¬æ–‡çš„é¢˜ç›®å°±åŸºæœ¬èƒ½å¤Ÿä»¥ä¸€ä¸ªæ¯”è¾ƒå°çš„ä»£ä»·æŒæ¡ type-challenges ä¸­è´´è¿‘æ—¥å¸¸å¼€å‘å’Œä¸šåŠ¡çš„éƒ¨åˆ†ã€‚\n\n> æ„Ÿè°¢ type-challenges ä»“åº“çš„è´¡çŒ®è€…ä»¬\n\n## Typescript å†…ç½®å·¥å…·å‡½æ•°\n\nå®é™…ä¸Šï¼ŒTypescript è‡ªèº«é™¤äº†å®šä¹‰ç±»å‹ä»¥å¤–ï¼Œè‡ªå·±å†…ç½®äº†å¾ˆå¤šéå¸¸æœ‰ç”¨çš„å·¥å…·å‡½æ•°ï¼Œè¿™éƒ¨åˆ†æ˜¯æˆ‘ä»¬æ—¥å¸¸ Typescript å¼€å‘åº”å½“å¿…é¡»æŒæ¡ï¼Œä¿¡æ‰‹æ‹ˆæ¥çš„ï¼Œæˆ‘å»ºè®®å¦‚æœå¯¹è¿™éƒ¨åˆ†ä¸ç†Ÿæ‚‰çš„è¯ï¼Œå…ˆå¤šè¯»å‡ éè¿™éƒ¨åˆ†ã€‚\n\nè¿™éƒ¨åˆ†å†…å®¹ï¼Œå¯ä»¥åœ¨[è¿™é‡Œ](https://www.typescriptlang.org/docs/handbook/utility-types.html) äº†è§£ï¼Œä¹Ÿå¯ä»¥åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­ï¼Œç‚¹è¿› `node_modules/typescript/lib/lib.es5.d.ts` ç›´æ¥äº†è§£ï¼Œæ³¨é‡Šæ¯”è¾ƒè¯¦å°½ã€‚\n\n> å®é™…ä¸Šï¼Œtype-challenges çš„ä¸€éƒ¨åˆ†ç®€å•å’Œä¸­ç­‰çš„é¢˜ç›®å°±æ˜¯å®ç°è¿™äº›å†…ç½®å·¥å…·å‡½æ•°çš„äºŒæ¬¡å®ç°ï¼Œè¿™éƒ¨åˆ†å†…å®¹æˆ‘åœ¨æœ¬æ–‡åŸºæœ¬æ²¡æœ‰é‡å¤ç½—åˆ—ï¼Œä½†æ˜¯å»ºè®®å¤§å®¶å»é˜…è¯»å®˜æ–¹å®ç°ï¼Œä¸€èˆ¬æ¥è¯´ä¹Ÿéƒ½æ¯”è¾ƒçŸ­å°ï¼Œå®¹æ˜“ç†è§£\n\n## type-challenges éƒ¨åˆ†é‡ç‚¹é¢˜ç›®\n\n### æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ \n\n[åŸæ–‡åœ°å€](https://github.com/type-challenges/type-challenges/blob/main/questions/00014-easy-first/README.md)\n\nä½¿ç”¨ï¼š\n```typescript\ntype arr1 = ['a', 'b', 'c']\ntype head1 = First<arr1> // expected to be 'a'\n```\n\nå®ç°ï¼š\n\n```typescript\nexport type First<T extends any[]> = T extends [infer first, ...any[]]\n  ? first\n  : never;\n```\n\né™¤äº†æœ¬é¢˜ç›®ï¼Œè¿˜æœ‰è®¸å¤šå…¶ä»–ç±»ä¼¼çš„å®ç°ï¼šï¼š\n\n```typescript\n// æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ :\nexport type Last<T extends any[]> = T extends [...any, infer L] ? L : never;\n\n// Popï¼š\n// type arr1 = ['a', 'b', 'c', 'd']\n// type re1 = Pop<arr1> // expected to be ['a', 'b', 'c']\nexport type Pop<T extends any> = T extends [...infer P, infer R] ? P : never;\n\n// Push:\n// type Result = Push<[1, 2], '3'> // [1, 2, '3']\nexport type Push<T extends any[], U> = [...T, U];\n\n// UnShift:\n// type Result = UnShift<[1, 2], 0> // [0, 1, 2,]\nexport type UnShift<T extends any[], U> = [U, ...T];\n\n// Shift:\n// type Result = Shift<[3, 2, 1]> // [2, 1]\nexport type Shift<T> = T extends [infer F,... infer R] ? R : undefined\n\n// Concatï¼š\n// type Result = Concat <[1], [2]> // expected to be [1, 2]\nexport type Concat <T extends any[], V extends any[]> = [...T, ...V];\n\n// Reverse:\n// type b = Reverse<['a', 'b', 'c']> // ['c', 'b', 'a']\nexport type Reverse<T> = T extends [infer Head, ...infer Rest] ? [...Reverse<Rest>, Head] : T\n\n// FilterOutï¼š\n// type Filtered = FilterOut<[1, 2, null, 3], null> // [1, 2, 3]\ntype Filtered = FilterOut<[1, 2, null, 3], null> // [1, 2, 3]\nexport type FilterOut<T extends any[], F> = \n  T extends [infer First, ...infer Rest] \n    ? First extends F \n      ? FilterOut<Rest, F> \n      : [First, ...FilterOut<Rest, F>] \n    : []\n```\n\næŠ€å·§æç¤ºï¼š\n\n* é€šè¿‡ extends åŠ ä¸‰ç›®è¿ç®—ç¬¦ï¼Œå®Œæˆæ¡ä»¶åˆ¤æ–­ã€‚\n* é€šè¿‡ç±»ä¼¼ `infer first, ...any[]` æˆ–è€… `[infer First, ...infer Rest]` è¿™ç§æ–¹å¼æ¥å±•å¼€æ•°ç»„ç±»å‹ã€‚\n* å¦å¤–æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ `[...T, U]` æ¥æ‰©å……æ•°ç»„çš„ç±»å‹å®šä¹‰ã€‚\n\n### Tuple to Union\n\n[åŸæ–‡åœ°å€](https://github.com/type-challenges/type-challenges/blob/main/questions/00010-medium-tuple-to-union/README.md)\n\nä½¿ç”¨ï¼š\n```typescript\ntype Arr = ['1', '2', '3']\ntype Test = TupleToUnion<Arr> // expected to be '1' | '2' | '3'\n```\n\nå®ç°æ¯”è¾ƒç®€å•ï¼š\n\n```typescript\nexport type TupleToUnion<T extends any[]> = T[number];\n```\n\næŠ€å·§æç¤ºï¼š\n\n* `T[number]` è¿™ç§è¯­æ³•å¯ä»¥æ¯”è¾ƒæ–¹ä¾¿åœ°å®ç° Tuple to Union\n\n\n### Deep Readonly\n\n[åŸæ–‡åœ°å€](https://github.com/type-challenges/type-challenges/blob/main/questions/00009-medium-deep-readonly/README.md#deep-readonly----)\n\nä½¿ç”¨ï¼š\n```typescript\ntype X = { \n  x: { \n    a: 1\n    b: 'hi'\n  }\n  y: 'hey'\n}\n\ntype Expected = { \n  readonly x: { \n    readonly a: 1\n    readonly b: 'hi'\n  }\n  readonly y: 'hey' \n}\n\ntype Todo = DeepReadonly<X> // should be same as `Expected`\n```\n\nå®ç°ï¼š\n\n```typescript\nexport type DeepReadonly<T> = {\n  readonly [P in keyof T]: keyof T[P] extends never ? T[P] : DeepReadonly<T[P]>;\n};\n```\n\næŠ€å·§æç¤ºï¼š\n\n* é€šè¿‡ `keyof T[P] extends never` è¿™ç§æ–¹å¼åˆ¤æ–­æ˜¯å¦æœ‰å­å±æ€§ï¼Œå¯ä»¥å®Œæˆæ·±åº¦éå†\n\n### Merge ä»¥åŠå…¶ä»– interface ç›¸å…³\n\n[åŸæ–‡åœ°å€](https://github.com/type-challenges/type-challenges/blob/main/questions/00599-medium-merge/README.md)\n\nä½¿ç”¨ï¼š\n```typescript\ntype foo = {\n  name: string;\n  age: string;\n}\ntype coo = {\n  age: number;\n  sex: string\n}\n\ntype Result = Merge<foo,coo>; // expected to be {name: string, age: number, sex: string}\n```\n\nMerge çš„åŠŸèƒ½å’Œ typescript æä¾›çš„å¾ˆå¤šå†…ç½®åŠŸèƒ½å‡½æ•°å¾ˆåƒï¼Œè¿™ä¸ªé¢˜ç›®å®ç°çš„æ–¹å¼å¾ˆå¤šï¼Œæˆ‘è¿™é‡Œç»™å‡ºä¸€ä¸ªæ¯”è¾ƒç®€æ´çš„æ–¹å¼ï¼š\n\n```typescript\nexport type Merge<T, U> = {\n  [P in Exclude<keyof T, keyof U>]: T[P];\n} & {\n  [G in keyof U]: U[G];\n};\n```\n\nç±»ä¼¼ Mergeï¼Œæˆ‘ä»¬åœ¨å†ç»™å‡ºä¸€äº›å…¶ä»–çš„ç®€å•çš„ç±»ä¼¼ type ç›¸å…³çš„æ“ä½œ\n\n```typescript\n// Diffï¼šé€‰å‡ºä¸¤ä¸ªç±»å‹ä¸­ä¸åŒå±æ€§ï¼š\nexport type Diff<T, U> = Omit<T & U, keyof T & keyof U>;\n\n// PickByTypeï¼šæŒ‰ç…§ç±»å‹é€‰æ‹©\n// type OnlyBoolean = PickByType<{\n//   name: string\n//   count: number\n//   isReadonly: boolean\n//   isEnable: boolean\n// }, boolean> // { isReadonly: boolean; isEnable: boolean; }\nexport type PickByType<T, U> = {\n  [K in keyof T as T[K] extends U ? K : never]: T[K];\n};\n\n// RequiredByKeysï¼šæŒ‰ç…§ key æ¥è®¾ç½®æˆ Require\n// interface User {\n//   name?: string\n//   age?: number\n//   address?: string\n// }\n// type UserRequiredName = RequiredByKeys<User, 'name'> // { name: string; age?: number; address?: string }\nexport type RequiredByKeys<T, K = keyof T> = SimpleMerge<\n  Partial<Pick<T, Exclude<keyof T, K>>>,\n  Required<Pick<T, Extract<keyof T, K>>>\n  // **å¯ä»¥çœ‹ä¸€ä¸‹ Required çš„å†™æ³•ï¼Œèƒ½å­¦åˆ°ä¸€ç‚¹æ–°çš„ä¸œè¥¿\n>;\n\n// Mutable\n// interface Todo {\n//   readonly title: string\n//   readonly description: string\n//   readonly completed: boolean\n// }\n// type MutableTodo = Mutable<Todo> // { title: string; description: string; completed: boolean; }\n// your answers\nexport type Mutable<T> = {\n  -readonly [K in keyof T]: T[K]\n}\n\n// Get Required\n// type I = GetRequired<{ foo: number, bar?: string }> // expected to be { foo: number }\nexport type GetRequired<T> = {\n  [P in keyof T as T[P] extends Required<T>[P] ? P : never]: T[P]\n}\nexport type RequiredKeys<T> = keyof GetRequired<T>\n\n// Get Optional\n// type I = GetOptional<{ foo: number, bar?: string }> // expected to be { bar?: string }\n// https://github.com/type-challenges/type-challenges/blob/main/questions/00059-hard-get-optional/README.md\nexport type GetOptional<T> = {\n  [P in keyof T as T[P] extends Required<T>[P] ? never : P]: T[P]\n}\nexport type OptionalKeys<T> = keyof GetOptional<T>\n```\n\nä¸€äº›æŠ€å·§æç¤ºï¼š\n\n* é€šè¿‡ç»„åˆ Typescript å†…ç½®çš„åŠŸèƒ½å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å®Œæˆå¾ˆå¤šå¤æ‚çš„ä¸šåŠ¡éœ€æ±‚ã€‚\n* é€šè¿‡ `-readonly` æ¥å‡å»ä¿®é¥°ç¬¦ã€‚\n* é€šè¿‡ `[P in keyof T]-?: T[P];` è¿™ç§æ–¹å¼æ¥å‡å»å¯é€‰ä¿®é¥°ç¬¦ï¼ˆTypescript å†…ç½®çš„ Required å°±æ˜¯è¿™ä¹ˆå®ç°çš„ï¼‰ã€‚\n* é€šè¿‡ `K in keyof T as T[K]` è·å–ä¸€ä¸ªå±æ€§çš„ç±»å‹ï¼Œç»“åˆ extends åšæ¡ä»¶åˆ¤æ–­ã€‚\n\n### TrimLeft ä»¥åŠå­—ç¬¦ä¸²ç›¸å…³\n\n[åŸæ–‡åœ°å€](https://github.com/type-challenges/type-challenges/blob/main/questions/00106-medium-trimleft/README.md)\n\nä½¿ç”¨ï¼š\n\n```typescript\ntype trimed = TrimLeft<'  Hello World  '> // expected to be 'Hello World  '\n```\n\nå®é™…ä¸Šå­—ç¬¦ä¸²æ“ä½œåœ¨ Typescript ä¸­åº”è¯¥ç”¨çš„å¹¶ä¸æ˜¯å¾ˆå¤šï¼Œè€Œè¿™ä¹Ÿæ˜¯ Typescript æ¯”è¾ƒåé¢ï¼ˆ4.0+ï¼‰æ‰é€æ¸å®Œå–„çš„åŠŸèƒ½ã€‚\nè¿™ä¸ªé¢˜ç›®çš„è§£ç­”ï¼š\n\n```typescript\ntype Space = \" \" | \"\\n\" | \"\\t\";\nexport type TrimLeft<S extends string> = S extends `${Space}${infer Rest}`\n  ? TrimLeft<Rest>\n  : S;\n```\n\nå®é™…ä¸Šï¼Œæˆ‘ä»¬å¦‚æœçŸ¥é“å¯ä»¥è¿™æ ·å†™ï¼Œè¿˜å¯ä»¥å®ç°å¾ˆå¤šçš„ç±»ä¼¼çš„æ–¹å¼ï¼Œæ¯”å¦‚å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®ç° `Trim` å’Œ `TrimRight` ï¼ˆç”±äºç›¸ä¼¼åº¦éå¸¸é«˜ï¼Œè¿™ä¸¤ä¸ªä¸å†ç½—åˆ—ç­”æ¡ˆï¼‰ï¼Œä»¥åŠ `Replace`ã€`ReplaceAll`ã€`DropChar` ç­‰ï¼Œç”šè‡³è¿˜å¯ä»¥æ¯”è¾ƒæ–¹ä¾¿åœ°å®ç°ç±»å‹è½¬æ¢ï¼Œå¦‚ `ParseInt`ã€‚\n\n```typescript\n// Replace\n// type replaced = Replace<'types are fun!', 'fun', 'awesome'> // expected to be 'types are awesome!'\n// https://github.com/type-challenges/type-challenges/blob/main/questions/00116-medium-replace/README.md\nexport type Replace<\n  S extends string,\n  From extends string,\n  To extends string\n> = From extends \"\"\n  ? S\n  : S extends `${infer Left}${From}${infer Right}`\n  ? `${Left}${To}${Right}`\n  : S;\n\n// è¿‘ä¼¼ Replaceï¼Œæ›¿æ¢å…¨éƒ¨\n// type replaced = ReplaceAll<'t y p e s', ' ', ''> // expected to be 'types'\n// https://github.com/type-challenges/type-challenges/blob/main/questions/00119-medium-replaceall/README.md\nexport type ReplaceAll<\n  S extends string,\n  From extends string,\n  To extends string\n> = From extends \"\"\n  ? S\n  : S extends `${infer Left}${From}${infer Right}`\n  ? `${Left}${To}${ReplaceAll<`${Right}`, From, To>}`\n  : S;\n\n// Drop Char\n// å’Œä¸Šé¢çš„æ¯”è¾ƒç±»ä¼¼\n// type Butterfly = DropChar<' b u t t e r f l y ! ', ' '> // 'butterfly!'\n// https://github.com/type-challenges/type-challenges/blob/main/questions/02070-medium-drop-char/README.md\nexport type DropChar<S, C> = S extends `${infer H}${infer R}`\n  ? H extends C\n    ? `${DropChar<R, C>}`\n    : `${H}${DropChar<R, C>}`\n  : \"\";\n\n// ParseIntï¼šå­—ç¬¦ä¸²è½¬æ•°å­—ï¼š\nexport type ParseInt<T extends string> = T extends `${infer Digit extends number}` ? Digit : never\n```\n\nå¦å¤–ï¼ŒåŸºäºæ“ä½œå­—ç¬¦ä¸²çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å®ç°æ›´å¤šï¼Œæ¯”å¦‚ï¼š\n\n* [StringToUnion](https://github.com/type-challenges/type-challenges/blob/main/questions/00531-medium-string-to-union/README.md) å­—ç¬¦ä¸²è½¬è”åˆç±»å‹ï¼Œ`123` -> `\"1\" | \"2\" | \"3\"`\n* [KebabCase](https://github.com/type-challenges/type-challenges/blob/main/questions/00612-medium-kebabcase/README.md) å­—ç¬¦ä¸²æ ¼å¼è½¬æ¢ï¼Œ`FooBarBaz -> foo-bar-baz`\n\nç­‰ç­‰ï¼Œè¿™äº›ç¬”è€…æ²¡æœ‰åˆ—ä¸¾å…·ä½“å®ç°ï¼Œæ˜¯å› ä¸ºè®¤ä¸ºå¤§éƒ¨åˆ†å¼€å‘ä¸­ç”¨çš„è¿˜æ˜¯ä¸å¤šçš„ï¼Œå¦‚æœä½ ç›´æ¥ä¸€çœ¼å°±èƒ½æƒ³å‡ºæ–¹æ¡ˆï¼Œå¯èƒ½ä¹Ÿä¸ç”¨å»çœ‹äº†ã€‚\n\n### Append Argument\n\n[åŸæ–‡åœ°å€](https://github.com/type-challenges/type-challenges/blob/main/questions/00191-medium-append-argument/README.md)\n\nä½¿ç”¨ï¼š\n\n```typescript\ntype Fn = (a: number, b: string) => number\n\ntype Result = AppendArgument<Fn, boolean> \n// expected be (a: number, b: string, x: boolean) => number\n```\n\nè¿™ä¸ªä¾‹å­å¯èƒ½ä¼šåœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ç”¨åˆ°ï¼Œè€Œä¸”å¯ä»¥è®©æˆ‘ä»¬å›é¡¾å¦‚ä½•æ“ä½œå‡½æ•°ç±»å‹ï¼š\n\n```typescript\nexport type AppendArgument<Fn extends (...args: any) => any, A> = Fn extends (\n  ...args: infer Args\n) => infer Res\n  ? (...arg: [...Args, A]) => Res\n  : never;\n```\n\n### Append to object\n\n[åŸæ–‡åœ°å€](https://github.com/type-challenges/type-challenges/blob/main/questions/00527-medium-append-to-object/README.md)\n\nä½¿ç”¨ï¼š\n\n```typescript\ntype Test = { id: '1' }\ntype Result = AppendToObject<Test, 'value', 4> // expected to be { id: '1', value:\n```\n\næ³¨æ„å’Œ `Merge` æœ‰æ‰€åŒºåˆ«ï¼Œè¿™é‡Œæ˜¯é’ˆå¯¹ `Object` æ¥æ“ä½œ\n\n```typescript\nexport type AppendToObject<T, U, V> = T extends Record<string, any>\n  ? U extends string\n    ? { [K in keyof T | U]: K extends U ? V : T[K] }\n    : T\n  : T;\n```\n\n## å…¶ä»–\n\nTypescript ç‰¹æ€§ç›¸å¯¹å®Œå¤‡ï¼ŒåŸºäºæ­¤å¯ä»¥å®Œæˆéå¸¸å¤æ‚çš„éœ€æ±‚ï¼Œç”šè‡³ä½¿ç”¨ [Typescript æ¥ç¼–å†™ä¸€ä¸ª Typescript Checker](https://github.com/ronami/HypeScript)ï¼Œä¸è¿‡ç¬”è€…è®¤ä¸ºï¼Œå¯¹äºæ—¶é—´ç²¾åŠ›æœ‰é™çš„ä¸€èˆ¬å·¥ä½œä¸­çš„å¼€å‘è€…æ¥è¯´ï¼ŒçŸ¥é“â€œå¯ä»¥è¿™æ ·åšâ€ï¼Œå¹¶ä¸”åœ¨é€‚å½“çš„æ—¶å€™å¯ä»¥é€šè¿‡ç®€å•çš„èµ„æ–™æŸ¥é˜…å®Œæˆéœ€æ±‚ï¼Œè¿™ä¸€ç‚¹å¯èƒ½æ›´é‡è¦ã€‚\n\nç»è¿‡æƒè¡¡ï¼Œæœ¬æ–‡ä¸­åªåˆ—ä¸¾äº†éƒ¨åˆ† [type--challenges](https://github.com/type-challenges/type-challenges) ä¸­çš„å†…å®¹ï¼Œå¦‚æœä½ è¿˜æƒ³äº†è§£æ›´å¤šï¼Œä¸å¦¨çœ‹çœ‹åŸ github ä»“åº“ã€‚","tags":["Typescript"]},{"title":"ä½¿ç”¨ Rust å¼€å‘ python æ¨¡å—","url":"/2022/06/04/pythonè°ƒç”¨Rust/","content":"\nå…³äº Rust çš„åŸºæœ¬ä»‹ç»ï¼Œæˆ‘åœ¨ä¹‹å‰çš„[æ–‡ç« ](http://niexiaotao.cn/2021/09/02/%E4%BA%86%E8%A7%A3%20StackOverFlow%20%E4%B8%8A%E9%9D%A2%E6%9C%80%E5%8F%97%E6%AC%A2%E8%BF%8E%E7%9A%84%E8%AF%AD%E8%A8%80%20Rust/)æœ‰åšè¿‡ä¸€äº›æ€»ç»“ã€‚\n\næœ¬ç¯‡æ–‡ç« æˆ‘ä»¬å…³æ³¨å¦‚ä½•åœ¨ python ä¸­è°ƒç”¨ Rust å¼€å‘çš„æ¨¡å—ã€‚\n\n## Rust FFI çš„ä¸€èˆ¬æ€è·¯\n\nRust å¯ä»¥ç¼–è¯‘å‡ºå…¼å®¹ C ABI çš„åŠ¨æ€åº“æˆ–è€…é™æ€åº“ï¼ŒRust è°ƒç”¨å…¶ä»–è¯­è¨€ï¼Œä»¥åŠ Rust è¢«å…¶ä»–è¯­è¨€è°ƒç”¨ï¼ŒåŸºæœ¬éƒ½æ˜¯é€šè¿‡ C ABI æ¥è¿›è¡Œ FFI è°ƒç”¨ã€‚\n\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå®é™…ä¸Š C++ è°ƒç”¨ Rust *å¹¶ä¸æ˜¯ç‰¹åˆ«æ–¹ä¾¿*ï¼Œéœ€è¦ä½¿ç”¨ Rust æä¾›çš„ C æ¥å£ï¼Œä¹Ÿå› æ­¤æ²¡æœ‰åŠæ³•ä½¿ç”¨ C++ æä¾›çš„ç±»å‹ï¼Œè€Œ Rust åœ¨å¯¼å‡ºæ¥å£çš„æ—¶å€™ï¼Œä¹Ÿæ²¡æœ‰åŠæ³•ä½¿ç”¨ Rust çš„ç±»å‹ç³»ç»Ÿï¼Œéœ€è¦è½¬æ¢æˆ C ç±»å‹ã€‚\n\nå¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬éƒ½ä¼šåœ¨è¿™ç§åœºæ™¯ä¸‹å†™ä¸€å±‚ wrapper å’Œ converterï¼Œç”¨æ¥è‡ªåŠ¨ç”Ÿæˆ FFI å±‚çš„ä¸€äº›èƒ¶æ°´ä»£ç ã€‚\n\nå¯¹äº Python è¿™ç±»é«˜çº§è¯­è¨€è°ƒç”¨ Rustï¼ŒåŸºæœ¬ä¹Ÿæ˜¯ç±»ä¼¼çš„æ€è·¯ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•æ€»ç»“ä¸ºä¸‹å›¾ï¼š\n\n![](/img/calling_rust_from_python_std_ffi_and_ctypes.png)\n\nå€¼å¾—åº†å¹¸çš„æ˜¯ï¼Œå¯¹äº Python è°ƒç”¨ Rustï¼Œç¤¾åŒºå·²ç»æœ‰éå¸¸å¤šç°æˆçš„æˆç†Ÿå·¥å…·å¯ä»¥ä½¿ç”¨ï¼ŒåŸºäºè¿™äº›å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥æ¯”è¾ƒæ–¹ä¾¿åœ°ä¸“æ³¨äº Rust å®ç°é€»è¾‘æœ¬èº«ï¼Œæ— éœ€å…³æ³¨å¤ªå¤š FFI å’Œè½¬æ¢ç»†èŠ‚ã€‚\n\n## å…¥é—¨\n\nä¸€ä¸ªæ¯”è¾ƒæ–¹ä¾¿çš„æ–¹æ³•æ˜¯ä½¿ç”¨ [PyO3](https://github.com/PyO3/pyo3)ï¼ŒPyO3 ä¸ä»…ä»…æä¾›äº† rust bindingï¼Œä¹Ÿæä¾›äº†åˆ›å»º python åŒ…çš„å¼€ç®±å³ç”¨çš„è„šæ‰‹æ¶å·¥å…· [maturin](https://github.com/PyO3/maturin)ï¼Œä½¿ç”¨ maturin æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åˆ›å»ºä¸€ä¸ªåŸºäº rust å¼€å‘çš„ python æ‰©å±•æ¨¡å—ã€‚\n\næˆ‘ä»¬è¿™é‡Œæ•´ç†ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ä¸­æä¾›çš„æœ€ç®€å•çš„æ–¹å¼ï¼Œè¯»è€…å¯ä»¥ç›´æ¥ä¾æ¬¡æ‰§è¡Œä¸‹é¢çš„ shell è„šæœ¬ï¼š\n\n```shell\n$ mkdir string_sum\n$ cd string_sum\n# åˆ›å»º venv çš„è¿™ä¸€æ­¥ä¸èƒ½çœç•¥ï¼Œå¦åˆ™åç»­è¿è¡Œçš„æ—¶å€™ä¼šæŠ¥é”™\n$ python -m venv .env\n$ source .env/bin/activate\n$ pip install maturin\n# ç›´æ¥ä½¿ç”¨ maturin åˆå§‹åŒ–é¡¹ç›®å³å¯ï¼Œé€‰æ‹© pyo3ï¼Œæˆ–è€…ç›´æ¥æ‰§è¡Œ maturin init --bindings pyo3\n$ maturin init\nâœ” ğŸ¤· What kind of bindings to use? Â· pyo3\n  âœ¨ Done! New project created string_sum\n```\n\nè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªç®€å•çš„ Rust é¡¹ç›®ï¼Œå¹¶ä¸”åŒ…å«äº†ä¸€ä¸ªç¤ºä¾‹è°ƒç”¨ï¼Œæˆ‘ä»¬æ— éœ€ä¿®æ”¹ä»»ä½•ä»£ç ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æµ‹è¯•ï¼š\n\n```shell\n# maturin develop ä¼šè‡ªåŠ¨æ‰“åŒ…å‡ºä¸€ä¸ª wheel åŒ…ï¼Œå¹¶ä¸”å®‰è£…åˆ°å½“å‰çš„ venv ä¸­ \n$ maturin develop\n$ python\n>>> import string_sum\n>>> string_sum.sum_as_string(5, 20)\n'25'\n```\n\n## è¿›é˜¶å·¥å…·\n\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä»‹ç»å‡ ä¸ªæ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨ Rust å¼€å‘ python åŒ…çš„è¿›é˜¶å·¥å…·æˆ–å¼•å¯¼ã€‚\n\n### setuptools-rust\n\n[setuptools-rust](https://github.com/PyO3/setuptools-rust) æ˜¯ä¸€ä¸ª setuptools çš„æ’ä»¶ï¼Œè®©æˆ‘ä»¬å¯ä»¥æ¯”è¾ƒæ–¹ä¾¿åœ°ç¼–å†™ä½¿ç”¨ pyo3 å¼€å‘çš„ rust python åŒ…ã€‚\n\næˆ‘ä»¬å¯ä»¥ clone å®ƒçš„æºä»£ç ï¼Œç›´æ¥ä½¿ç”¨å®ƒæä¾›çš„ç¤ºä¾‹ï¼Œå‚è€ƒå¦‚ä¸‹å‘½ä»¤æµ‹è¯•ï¼š\n\n```shell\n$ cd examples/rust_with_cffi\n$ python ./setup.py develop\n$ python\nPython 3.9.7 (default, Sep  3 2021, 12:37:55)\n[Clang 12.0.5 (clang-1205.0.22.9)] on darwin\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> from rust_with_cffi import rust\n>>> rust.rust_func()\n14\n```\n\n### dict-derive\n\nè¿™ä¸ª rust åº“æä¾›äº† FromPyObject å’Œ IntoPyObject ä¸¤ä¸ªå®ï¼Œä½¿ç”¨è¿™ä¸¤ä¸ªå®ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è¿›è¡Œ python dict ç»“æ„å’Œ Rust ç»“æ„ä½“çš„è½¬æ¢ã€‚\n\nä¾‹å¦‚æˆ‘ä»¬å£°æ˜è¿™æ ·ä¸€ä¸ªç»“æ„ä½“ï¼š\n\n```rust\n#[derive(FromPyObject, IntoPyObject)]\npub struct User {\n    pub name: String,\n    pub email: String,\n    pub age: u32,\n}\n```\n\næˆ‘ä»¬å°±ç›´æ¥å¯ä»¥åœ¨å¯¼å‡ºå‡½æ•°ä¸­è¿™æ ·ä½¿ç”¨äº†ï¼š\n\n```rust\n// Requires FromPyObject to receive a struct as an argument\n#[pyfunction]\nfn get_contact_info(user: User) -> PyResult<String> {\n    Ok(format!(\"{} - {}\", user.name, user.email))\n}\n\n// Requires IntoPyObject to return a struct\n#[pyfunction]\nfn get_default_user() -> PyResult<User> {\n    Ok(User {\n        name: \"Default\".to_owned(),\n        email: \"default@user.com\".to_owned(),\n        age: 27,\n    })\n}\n```\n\næˆ‘ä»¬é€šè¿‡å®å±•å¼€å¯ä»¥å‘ç°ï¼Œè¿™ä¸¤ä¸ªå®æ‰€åšçš„äº‹æƒ…å°±æ˜¯åˆ†åˆ«å°† `pyo3::types::PyDict` è½¬æ¢æˆ Rust ç»“æ„ä½“å’Œå°† Rust ç»“æ„ä½“è½¬æ¢æˆ `pyo3::types::PyDict`ã€‚\n\næ•´ä½“å®å±•å¼€çš„ä»£ç ä¸å¤šï¼Œè¿˜æ˜¯æ¯”è¾ƒæ–¹ä¾¿é˜…è¯»çš„ã€‚\n\n### rust-numpy\n\n[rust-numpy](https://github.com/PyO3/rust-numpy) æ˜¯ä¸€ä¸ª rust ç‰ˆæœ¬çš„ numpy C ABI å°è£…ï¼Œä½¿ç”¨è¿™ä¸ªåº“æˆ‘ä»¬å¯ä»¥åœ¨ Rust ä¸­è°ƒç”¨ numpy\n\næ¥ä¸‹æ¥æˆ‘ä»¬è¿è¡Œè¯¥åº“çš„ç¤ºä¾‹ä»£ç ã€‚\n\næˆ‘ä»¬éœ€è¦å…ˆå®‰è£… noxï¼Œnox æ˜¯ä¸€ä¸ª python è‡ªåŠ¨åŒ–ä»»åŠ¡å·¥å…·ã€‚\n\n```shell\n$ python3 -m pip install nox\n```\n\nä¹‹åæˆ‘ä»¬è¿›å…¥åˆ°å‘½ä»¤è¡Œç›´æ¥æ‰§è¡Œå³å¯ï¼š\n```\n$ cd examples/simple\n$ nox\n```\n\né¡ºåˆ©çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒä¼šè¾“å‡ºæµ‹è¯•æˆåŠŸï¼š\n```\ntests/test_ext.py .....                                                                                                                                       [100%]\n\n========================================================================= 5 passed in 0.32s =========================================================================\nnox > Session tests was successful.\n```\n\n### pandas\n\nåœ¨ Rust ä¸­å¹¶æ²¡æœ‰ç›´æ¥å’Œ python ä¸­çš„ pandas åŒ…å¯¹æ ‡çš„è¯¸å¦‚ pandas-rs åŒ…ã€‚\n\nä¸è¿‡ Rust æ ‡å‡†åº“æœ¬èº«ä¹Ÿæä¾›äº†éå¸¸å¤šçš„æ•°æ®å¤„ç†å‡½æ•°å¦‚ç­›é€‰ã€è¿‡æ»¤ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±æ‰‹å†™ä»£ç å®Œæˆå¤§éƒ¨åˆ† pandas çš„å·¥ä½œã€‚\n\nåœ¨[è¿™ç¯‡æ–‡ç« ](https://able.bio/haixuanTao/data-manipulation-pandas-vs-rust--1d70e7fc)ä¸­ï¼Œä½œè€…ä½¿ç”¨äº†å¤§çº¦ 160,000è¡Œ/ 130åˆ—ï¼Œæ€»å¤§å°ä¸º 150Mb çš„æ•°æ®ï¼Œ åˆ†åˆ«ä½¿ç”¨ Rust å’Œ Pandas å¤„ç†å¹¶æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æå‡è¿˜æ˜¯æ¯”è¾ƒæ˜¾è‘—çš„ï¼š\n\n| | Time(s) | Mem Usage(Gb) | \n| ----- | ----- | ----- |\n|Pandas | 3.0s | 2.5Gb |\n| Rust | 1.6s ğŸ”¥ -50% | 1.7Gb ğŸ”¥ -32% |\n\n\n## å…¶ä»–\n\npyo3 çš„ README é‡Œé¢è¿˜åˆ—ä¸¾äº†ä¸€äº›å…¶ä»–çš„å·¥å…·åº“ï¼Œä½¿ç”¨èµ·æ¥ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œå°±ä¸åšå•ç‹¬ä»‹ç»äº†ã€‚\n\n* [pyo3-log](https://github.com/vorner/pyo3-log)ï¼šåœ¨ Rust ä¸­ä½¿ç”¨ python çš„ logging åº“ã€‚\n* [pyo3-built](https://github.com/PyO3/pyo3-built)ï¼šå¯ä»¥åœ¨ç¼–è¯‘ rust çš„ python æ¨¡å—çš„æ—¶å€™å†™å…¥ä¸€äº›æ„å»ºä¿¡æ¯ï¼Œå¦‚ rust ç‰ˆæœ¬ç­‰ã€‚\n* [pyo3-asyncio](https://github.com/awestlake87/pyo3-asyncio)ï¼špython asyio çš„ Rust bindingï¼Œå¯ä»¥å°† python çš„ async è½¬æ¢æˆ Rust çš„ featuresã€‚\n* [rustimport](https://github.com/mityax/rustimport)ï¼šå¯ä»¥åœ¨ python ä¸­ç›´æ¥å¼•å…¥ rust ä»£ç ï¼Œä½†å› ä¸ºå¼•å…¥çš„æ—¶å€™éœ€è¦ç¼–è¯‘ï¼Œç¬”è€…ä¸æ˜¯å¾ˆå»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç›´æ¥ä½¿ç”¨ã€‚\n\n\n---\n\nè™½ç„¶ä¸Šé¢ä»‹ç»äº†è¿™ä¹ˆå¤šå·¥å…·ï¼Œä½†æ˜¯ç¬”è€…è®¤ä¸ºï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œè¿˜æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬åº”è¯¥è¿˜ä¼šç»“åˆä¸šåŠ¡ï¼Œå¯»æ‰¾å’Œé€ å‡ºæ›´å¤šè½®å­ï¼Œè¿™éƒ¨åˆ†å·¥ä½œå°±æœ‰å¾…æˆ‘ä»¬è¿›ä¸€æ­¥å¼€æ‹“äº†ã€‚","tags":["Rust"]},{"title":"åŸºäº Container æ¶æ„çš„å¤šæ¡†æ¶å‰ç«¯åº”ç”¨","url":"/2022/05/25/åŸºäºcontaineræ¶æ„çš„å‰ç«¯åº”ç”¨/","content":"\n## æ¦‚å¿µä»‹ç»\n\næœ¬æ–‡æä¾›ä¸€ç§ç”¨äºæ„å»ºå¤šæ¡†æ¶å‰ç«¯é¡¹ç›®çš„æ€è·¯ï¼Œç›®å‰è¿˜å°šæœªå®Œæ•´ç¼–å†™ä»£ç éªŒè¯å…¶å¯è¡Œæ€§ã€‚\n\nè¿™ç§æ€è·¯æœ‰äº›ç±»ä¼¼äº*å¾®å‰ç«¯*ï¼Œå®é™…ä¸Šå¯¹äºå¾®å‰ç«¯æ¥è®²çš„è¯ï¼Œç¤¾åŒºå·²ç»æœ‰äº† [single-spa](https://single-spa.js.org/) å’ŒåŸºäºå…¶æ„å»ºçš„ [qiankun](https://qiankun.umijs.org/zh/guide/tutorial) ç­‰è‹¥å¹²æ–¹æ¡ˆã€‚\n\nè¿™äº›æ¡†æ¶éƒ½å¾ˆä¼˜ç§€ï¼Œä¹Ÿç»è¿‡äº†ä¸å°‘ç”Ÿäº§é¡¹ç›®çš„éªŒè¯ï¼Œèƒ½å¤Ÿåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ»¡è¶³å¾®å‰ç«¯çš„éœ€æ±‚ã€‚\n\nä½†æˆ‘ä¸ªäººè§‰å¾—ï¼Œå¯¹äºä¸€ä¸ªå›¢é˜Ÿè§„æ¨¡ä¸æ˜¯å¾ˆå¤§ï¼Œä½†æ˜¯åˆå­˜åœ¨ä¸åŒæŠ€æœ¯æ ˆçš„å›¢é˜Ÿæ¥è¯´ï¼Œç›´æ¥ä½¿ç”¨è¿™ç±»å¾®å‰ç«¯æ¡†æ¶ï¼Œä¼šæœ‰ä¸€äº›è´Ÿæ‹…ï¼Œè¿™ä¸»è¦ä½“ç°åœ¨ï¼š\n\n1. å„ä¸ªå¾®å‰ç«¯åº”ç”¨è™½ç„¶å¯ä»¥äº’ç›¸è°ƒç”¨ï¼Œä½†æ˜¯è°ƒç”¨æ–¹å¼æœ‰é™ï¼Œå¯¹äºå¤æ‚çš„å†…å®¹æ¯”å¦‚é€šç”¨ UI æ¨¡å—çš„å…±äº«æ¯”è¾ƒå›°éš¾ã€‚\n2. é€šå¸¸æƒ…å†µä¸‹ï¼ŒåŸºåº§åº”ç”¨ä¸å¤Ÿå¼ºå¤§ï¼Œä¸€å®šç¨‹åº¦ä¸Šä¼šåŠ å‰§å¼€å‘çš„ç‹¬ç«‹æ€§ï¼Œä¸åˆ©äºä»£ç å¤ç”¨å’Œå…±äº«ã€‚\n3. åŸåˆ™ä¸Šï¼Œ**å¯¹äºå°å›¢é˜Ÿè€Œè¨€ï¼Œæˆ‘å¼ºçƒˆå»ºè®®ç»Ÿä¸€æˆæŠ€æœ¯æ ˆä¸º React æˆ–è€… Vueï¼Œæ²¡æœ‰ä»»ä½•é“ç†å¯ä»¥æ”¯æ’‘åŒæ—¶ç»´æŠ¤ä¸¤å¥—æŠ€æœ¯æ ˆï¼Œä½†æ˜¯å¦‚æœæƒ³å°è¯•ä¸€äº›æ–°æŠ€æœ¯æ ˆï¼Œå¯ä»¥åœ¨åˆæœŸé‡‡ç”¨ä¸‹è¿°æ–¹æ¡ˆ**ã€‚\n\næˆ‘æå‡ºä¸€ç§ Container æ¶æ„çš„å‰ç«¯åº”ç”¨ï¼Œå®ƒå¯èƒ½åº”ç”¨åœ¨ä»¥ä¸‹å‡ ä¸ªåœºæ™¯ä¸­ï¼š\n\n1. æ¯”å¦‚ä½ æƒ³ä½¿ç”¨æ–°çš„æ¡†æ¶å¼€å‘éƒ¨åˆ†æ¨¡å—ï¼Œä¾‹å¦‚ä½¿ç”¨ SolidJS å¼€å‘éƒ¨åˆ† React é¡¹ç›®ä¸­çš„ç»„ä»¶ï¼Œç”šè‡³ä½¿ç”¨ Rust å¼€å‘éƒ¨åˆ†æ¨¡å—ï¼Œç”¨æ¥åšé¡¹ç›®çš„å®éªŒæ€§å°è¯•ã€‚\n2. å‡ºäºå›¢é˜Ÿäººå‘˜æŠ€æœ¯æ ˆçš„åŸå› ï¼Œéœ€è¦ React å’Œ Vue æ··åˆå¼€å‘ã€‚\n3. æ–°çš„é¡¹ç›®ä½¿ç”¨äº† Reactï¼Œè€Œæ—§çš„é¡¹ç›®ä½¿ç”¨äº† Vueï¼Œå¹¶ä¸”éœ€è¦åœ¨çŸ­æ—¶é—´å†…æŠŠæ—§çš„é¡¹ç›®æ”¾åˆ°æ–°çš„é¡¹ç›®ä¸­å»ä½¿ç”¨ã€‚\n\nContainer æ¶æ„çš„ä¸»è¦ç›®çš„åœ¨äºï¼š\n\n1. å¢å¼ºåŸºåº§é¡¹ç›®çš„é‡è¦ç¨‹åº¦ï¼Œä»è€Œåšåˆ°å°½å¯èƒ½æ›´å¤šåœ°æœç”¨åŸºç¡€å»ºè®¾ã€‚\n2. ä¸ä»…æ¨¡å—æœ¬èº«å¯ä»¥ç”¨ä¸åŒçš„æ¡†æ¶ç¼–å†™ï¼ŒåŸºåº§æœ¬èº«ä¹Ÿå¯ä»¥è¢«æ›¿æ¢æˆä¸åŒçš„ç¯å¢ƒï¼Œä¾‹å¦‚ï¼šçº¯é¡µé¢ç¯å¢ƒã€å®šåˆ¶åŒ–çš„ jupyter ç¯å¢ƒã€electron ç¯å¢ƒã€‚\n3. å¯ä»¥è®©æˆ‘ä»¬æ¯”è¾ƒæ–¹ä¾¿åœ°è¿›è¡Œéƒ¨åˆ†æ¨¡å—å…ˆè¡Œå‡çº§ï¼Œéƒ¨åˆ†æ¨¡å—ä½¿ç”¨æ›´é«˜æ€§èƒ½çš„æŠ€æœ¯æ ˆå¼€å‘åŒæ—¶å°½å¯èƒ½å¤šçš„å¤ç”¨ç°æœ‰åŸºæ¶ã€‚\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œ*å¦‚æœæˆ‘ä»¬æƒ³æ¢ä¸ªè¯­è¨€å¼€å‘ï¼Œå°±æ–°åŠ ä¸€ä¸ªæ¨¡å—å°±è¡Œï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ¢ä¸ªåœ°æ–¹è¿è¡Œï¼Œå°±æ–°åŠ ä¸€ç§åŸºåº§å°±è¡Œ*ã€‚\n\nä»è€Œå®ç°äº†åŒå‘è‡ªç”±åº¦ã€‚\n\nåŒæ—¶ï¼Œå®ƒç‰ºç‰²äº†ä¸€äº›å†…å®¹ï¼š\n\n1. æ¨¡å—ç”±äºå¯¹åŸºåº§é¡¹ç›®çš„ä¾èµ–æ€§æ¯”è¾ƒå¤§ï¼Œé€šå¸¸éš¾ä»¥ç‹¬ç«‹éƒ¨ç½²ã€‚\n\n## æ ¸å¿ƒæ¶æ„å›¾\n\næ ¸å¿ƒå›´ç»•ä¸€å¥— Container Abstract API æ¥å±•å¼€ã€‚\n\n![](/img/absapp.png)\n\n```plantuml\n@startuml\n\nnode WebApp\nnode JupyterApp\nnode ElectronApp\nnode BaseApp\nartifact ContainerAbstractAPI\nnode ReactModule1\nnode ReactModule2\nnode VueModule\nnode SolidModule\nWebApp .. BaseApp : ç»§æ‰¿\nJupyterApp .. BaseApp : ç»§æ‰¿\nElectronApp .. BaseApp : ç»§æ‰¿\nBaseApp .. ContainerAbstractAPI: æä¾›\nContainerAbstractAPI .. ReactModule1 : ä¾èµ–\nContainerAbstractAPI .. ReactModule2 : ä¾èµ–\nContainerAbstractAPI .. VueModule : ä¾èµ–\nContainerAbstractAPI .. SolidModule : ä¾èµ–\n\n@enduml\n```\n\n\nçœŸæ­£åº”ç”¨éƒ¨ç½²çš„æ—¶å€™ï¼Œé€‰å–ä¸€ä¸ª Appï¼Œä»¥åŠå‡ ä¸ªå¯¹åº”çš„ Moduleï¼Œå°±å¯ä»¥ç»„åˆå‡ºæˆ‘ä»¬çš„ä¸€å¥—éœ€è¦çš„é¡¹ç›®ã€‚\n\né’ˆå¯¹è¿™ä¸€å¥—æ¶æ„ï¼Œå¯¹äºé€šç”¨çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°½å¯èƒ½åœ°å®ç°åœ¨ BaseApp é‡Œé¢ã€‚\n\nBaseApp åº”è¯¥æ˜¯æ¯”è¾ƒå°‘é‡çš„ï¼Œä¸€ä¸ªå›¢é˜Ÿä¸­ç”šè‡³åªæœ‰ä¸€ä¸ªï¼Œå®ƒå¯èƒ½ä¼šç”¨åˆ°ä¸€äº›ç»„ä»¶åº“æˆ–è€…æ¡†æ¶ï¼Œè¿™äº›éƒ½å¯ä»¥çš„ã€‚\n\n## ä»£ç å®ç°\n\nå¯¹äºè¿™å¥—æ¶æ„çš„ä¸€ä¸ªç¤ºä¾‹ä»£ç å®ç°ï¼Œæˆ‘ä¼šåœ¨åç»­æ–‡ç« ä¸­ç»™å‡ºã€‚","tags":["å‰ç«¯ç»¼åˆ"]},{"title":"æˆ‘ä»¬åº”è¯¥å¦‚ä½•è¿›è¡Œ Code Review ?","url":"/2022/04/25/ä¸€äº›ä»£ç æäº¤MRçš„é‡ç‚¹å…³æ³¨å†…å®¹æ•´ç†/","content":"\nç¬”è€…åœ¨æ—¥å¸¸å·¥ä½œä¸­ä¼šå‘ç°ï¼Œæ—¶å¸¸ä¼šå­˜åœ¨ä¸€äº›æ¯”è¾ƒæ˜¾è€Œæ˜“è§æˆ–è€…å·²çŸ¥çš„ä¸€ç±»é—®é¢˜ï¼Œåœ¨å¼€å‘è€…æäº¤ä»£ç ä»¥åŠç›¸å…³åŒå­¦ Review ä¸­å‡æœªè¢«å‘ç°ã€‚\n\nè¿™é‡Œçš„ä¸€ä¸ªåŸå› åœ¨äºï¼Œä»£ç å¼€å‘è€…åœ¨æŸäº›æ—¶å€™ä¼šæäº¤è¾ƒå¤šä»£ç ï¼Œè€Œæ­¤æ—¶ Reviewer é¢å¯¹è¾ƒå¤šä»£ç çš„ Review çš„æ—¶å€™ï¼Œå¾ˆå¯èƒ½ä¼šæ¼æ‰ä¸€äº› Review çš„è¦ç‚¹ï¼Œç”šè‡³å¯èƒ½ä¼šæ„Ÿåˆ°æ— æ‰€é€‚ä»ã€‚æœ¬æ–‡å¸Œæœ›ï¼Œé’ˆå¯¹ä¸€äº›éåœºæ™¯åŒ–çš„å†…å®¹ï¼Œæ•´ç†å‡ºä¸€äº›è¾ƒä¸ºæ™®é€‚çš„ä¸€äº›åŸåˆ™ï¼Œä»è€Œå¸®åŠ© Reviewerï¼ˆä»¥åŠå¼€å‘è€…æœ¬èº«ï¼‰è§£å†³ä¸€äº›é€šç”¨çš„é—®é¢˜ã€‚\n\n## æ ¼å¼ä¸è§„èŒƒ\n\nåŸåˆ™ä¸Šï¼Œè¿™éƒ¨åˆ†å†…å®¹ä¸åº”è¯¥åœ¨ Review çš„æ—¶å€™å»å¤„ç†ï¼Œæˆ‘ä»¬åº”è¯¥é…ç½®ä»£ç æ ¼å¼è§„èŒƒå·¥å…·ï¼Œåœ¨æäº¤ä»£ç å‰æˆ–è€… MR çš„ CI æµæ°´çº¿ä¸­åšè¿™ä¸ªäº‹æƒ…ã€‚\n\nè¿™é‡Œå¯¹äºä¸åŒç±»å‹çš„è¯­è¨€ï¼Œå¤§å¤šç¤¾åŒºéƒ½æœ‰ç°æˆçš„æ–¹æ¡ˆï¼Œä¸è¿‡å¤šèµ˜è¿°ï¼Œå¦‚æœä½ åœ¨ä»£ç  Review çš„æ—¶å€™è¿˜åœ¨çº ç»“äºæ ¼å¼å’Œè§„èŒƒï¼Œé‚£ä¹ˆç°åœ¨å°±å»é…ç½®å¥½å¯¹åº”çš„å·¥å…·ã€‚\n\n## ç¨³å®šæ€§\n\nè¿™é‡Œçš„ç¨³å®šæ€§ï¼ŒæŒ‡çš„æ˜¯æˆ‘ä»¬ç¨‹åºåœ¨è¿è¡Œé˜¶æ®µçš„ç¨³å®šæ€§ï¼Œä»¥åŠå½“å‡ºç°é”™è¯¯ï¼Œæˆ‘ä»¬èƒ½å¤Ÿç¬¬ä¸€æ—¶é—´å‘ç°ã€‚\n### é”™è¯¯å¤„ç†\n\nå…³äºè¿™é‡Œï¼Œæœ€å¸¸è§çš„ä¸€ç§ä»£ç æ˜¯ï¼š\n\n```\nif (some_error_case) {\n    return;\n}\n```\n\nå¯¹äºè¿™ç§ç±»ä¼¼çš„ä»£ç ï¼Œè™½ç„¶çœ‹ä¼¼å…œåº•å…œä½äº†é”™è¯¯ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ—¥å¿—è¾“å‡ºï¼Œä¹Ÿæ²¡æœ‰æ›´å¤šçš„æç¤ºï¼Œé•¿ä¹…ä¹‹åå¾ˆå¯èƒ½ä¼šå½¢æˆæš—å‘ã€‚\n\nå¯¹äºè¿™ç§ä»£ç æˆ‘ä»¬åº”è¯¥æ€è€ƒï¼š\n\n* æ˜¯å¦åº”è¯¥æ‰“ä¸€ä¸ªé”™è¯¯æ—¥å¿—ï¼Œæä¾›ä¸€äº›ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚\n* æ˜¯å¦åº”è¯¥å¢åŠ å¼‚å¸¸ä¸ŠæŠ¥ï¼Œè®©æˆ‘ä»¬ä¼˜åŒ–è¿™ç§é—®é¢˜ã€‚\n* æ˜¯å¦éœ€è¦å°†è¿™ä¸ªé”™è¯¯ä¿¡æ¯è¿”å›ç»™è°ƒç”¨æ–¹æˆ–è€…è°ƒç”¨ç«¯ã€‚\n* ç”¨æˆ·å±‚é¢æ˜¯å¦éœ€è¦æ„ŸçŸ¥æ­¤ä¿¡æ¯ï¼Œå¦‚æœéœ€è¦ï¼Œæ–¹æ³•æ˜¯ä»€ä¹ˆã€‚\n\nå¦å¤–è¿˜æœ‰ä¸€ç§æ¯”è¾ƒå¸¸è§çš„æ˜¯å¼‚å¸¸ï¼ŒåŒ…æ‹¬ä»£ç è¿è¡ŒæŠ›å‡ºçš„å¼‚å¸¸å’Œæˆ‘ä»¬è‡ªå·±æ•è·/æŠ›å‡ºçš„å¼‚å¸¸ï¼š\n\n```\nif (some_error_case) {\n    throw new Error('some error');\n}\n\ntry {\n    error_call()\n} catch(e) {\n    log(e)\n}\n```\n\nè¿™ç±»å¼‚å¸¸çš„å¤„ç†é€»è¾‘ï¼Œå’Œä¸Šé¢çš„å¼‚å¸¸æ¡ä»¶é€»è¾‘æ¯”è¾ƒç±»ä¼¼ï¼Œæˆ‘ä»¬åº”è¯¥åŒæ ·æ€è€ƒä¸Šè¿°å››ç‚¹ã€‚\n\n## ä¿æŠ¤ç”¨æˆ·éšç§\n\néšç§é€šå¸¸æ¶‰åŠåˆ°æ³•å¾‹åˆè§„ï¼Œå› æ­¤å¯èƒ½æ˜¯æœ€é‡è¦çš„ä¸€ç¯ã€‚\n\n### ç”¨æˆ·çš„éšç§ä¸å¯æ³„æ¼\n\n* æ¯”å¦‚åœ¨å¼€å‘åŠŸèƒ½æ‰“æ—¥å¿—çš„æ—¶å€™ï¼Œæˆ‘ä»¬åº”è¯¥ä¸èƒ½æ³„æ¼ç”¨æˆ·çš„éšç§ï¼Œä¾‹å¦‚ç”¨æˆ·çš„è‡ªå®šä¹‰ä¿¡æ¯ã€èŠå¤©ä¿¡æ¯ç­‰ã€‚\n\nè¿™ä¸€éƒ¨åˆ†å»ºè®®åœ¨å›¢é˜Ÿå†…éƒ¨å½¢æˆä¸€ä¸ªç»Ÿä¸€çš„è§„èŒƒæ–‡æ¡£ï¼Œåœ¨å¼€å‘å’Œ Review çš„è¿‡ç¨‹ä¸­ï¼Œå¤§å®¶éƒ½å¯ä»¥ä»¥æ­¤ä¸ºä¾æ®ã€‚\n\n### è‡ªå·±çš„éšç§ä¸å¯æ³„æ¼\n\nå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬è™½ç„¶æ³¨æ„åˆ°äº†ç”¨æˆ·çš„éšç§ï¼Œä½†æ˜¯**è‡ªå·±çš„éšç§**å´æ²¡æœ‰æ³¨æ„ï¼Œè¿™é‡Œä¸»è¦æ˜¯æˆ‘ä»¬çš„ä¸€äº› appKeyã€å¯†é’¥ç­‰å†…å®¹ã€‚æ— è®ºæ˜¯åœ¨ä»¥ä¸‹å“ªäº›åœºæ™¯ï¼Œæˆ‘ä»¬éƒ½éœ€è¦æ ¼å¤–æ³¨æ„ï¼š\n\n* å¯¹äº§ç‰©è¿›è¡ŒäºŒæ¬¡åˆ†å‘ï¼Œä¾‹å¦‚åˆ†å‘åˆ°å†…éƒ¨æˆ–å¤–éƒ¨ npmã€github ä»¥åŠå…¶ä»–å›¢é˜Ÿï¼Œç‰¹åˆ«æ˜¯å¤–ç½‘å¯è®¿é—®çš„æƒ…å†µæ›´éœ€è¦æ³¨æ„ã€‚\n* ç›´æ¥ç»™åˆ°ç”¨æˆ·ä½¿ç”¨ï¼Œä¾‹å¦‚åœ¨ Web ç¯å¢ƒä½¿ç”¨ï¼Œæˆ–è€…æ‰“åŒ…åˆ°æ¡Œé¢ç«¯åº”ç”¨ï¼Œå°½é‡é¿å…ç”¨æˆ·ç›´æ¥æ¥è§¦åˆ°è¿™äº›å†…å®¹ã€‚\n\n## å¯è¯»æ€§/ç»´æŠ¤æ€§\n\n### å‘½å\n\nä»£ç ä¸­å‡½æ•°å’Œå˜é‡çš„å‘½åï¼Œæ˜¯å¯è¯»æ€§ä¸­æ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªå…³æ³¨ç‚¹ã€‚\n\nå…³äºå¦‚ä½•å‘½åï¼Œå®é™…ä¸Šå¾ˆå¤šæ¶æ„ä¹¦ç±ä¹Ÿéƒ½ä¼šé¢å¤–åˆ—å‡ºä¸€ç« æ¥è®²ï¼Œåœ¨è¿™é‡Œæˆ‘ä¸æƒ³è¿‡å¤šè¿›è¡Œèµ˜è¿°ã€‚ä¸è¿‡ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬çš„å‘½ååº”å½“æ¸…æ™°æ˜“æ‡‚ï¼Œé¿å…å‡ºç°æ²¡æœ‰å®é™…æ„ä¹‰çš„å«ç³Šçš„å˜é‡åã€‚\n\n### ä»£ç æäº¤çš„æ³¨é‡Š\n\n* å¯¹äº bug fixï¼šå¾ˆå¤šæ—¶å€™æˆ‘ä»¬æ˜¯åœ¨å¤„ç†ä¸€ä¸ªè¾¹ç•Œé—®é¢˜ï¼Œæˆ–è€…æŸç§å…œåº•ï¼Œè¿™ä¸ªæ—¶å€™ fix çš„ä»£ç å¯èƒ½æ¯”è¾ƒéš¾ä»¥ç†è§£ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬æœ€å¥½æ˜¯å†™æ˜æ³¨é‡Šï¼Œå¦‚æœæœ‰ç›¸å…³çš„æ–‡æ¡£å’Œ bug å•ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸€å¹¶è´´åˆ°æ³¨é‡Šä¸­ã€‚å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬çš„ bug fix æ˜¯ä¸€ä¸ªä¸´æ—¶æ–¹æ¡ˆï¼Œè¯·åœ¨ä»£ç ä¸­å†™æ˜ **TODO**ï¼Œæ¥æé†’è‡ªå·±å’Œåˆ«äººè¿™ä¸ªåœ°æ–¹åç»­è¿˜ä¼šç»§ç»­æ›´æ”¹ã€‚\n\n* å¯¹äºæ–°åŠŸèƒ½æ·»åŠ ï¼šä¸€èˆ¬æˆ‘ä»¬éœ€è¦åœ¨å…³é”®å…¥å£å¤„å†™æ˜åŠŸèƒ½çš„è¯´æ˜æ–‡æ¡£é“¾æ¥ã€å®Œå–„ç›¸å…³å…³é”®è·¯å¾„çš„æ³¨é‡Šï¼ŒåŒæ—¶åˆ é™¤åŠŸèƒ½å¼€å‘ä¸­çš„å†—ä½™ä»£ç ï¼šä¾‹å¦‚æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­æµ‹è¯•ç”¨åˆ°ä½†æ˜¯æœ€ç»ˆå´æ²¡æœ‰ç”¨åˆ°çš„å¤§æ®µæ³¨é‡Šæ‰çš„ä»£ç ï¼Œä»¥åŠå¤§æ®µçš„æ³¨é‡Šå’Œ TODOï¼Œæˆ‘ä»¬éƒ½éœ€è¦åœ¨æœ€ç»ˆæäº¤çš„æ—¶å€™**åˆ é™¤æ‰**ï¼Œå¦‚æœéœ€è¦æ‰¾å›å»ºè®®ä½¿ç”¨ git çš„èƒ½åŠ›ï¼Œå¯ä»¥é€‚å½“è¿›è¡Œæ³¨é‡Šå¤‡æ³¨ã€‚\n\n* å¦å¤–ï¼Œå¯¹äºæ³¨é‡Šæ¥è¯´ï¼Œ**ç¦æ­¢å‡ºç°**æ¨¡ç³Šçš„è¯æ±‡ï¼Œä¾‹å¦‚ **`æ„Ÿè§‰`ï¼Œ`å¥½åƒ`ï¼Œ`å¤§æ¦‚`** ç­‰è¿™ç§æ¨¡ç³Šçš„è¯æ±‡ï¼Œè€Œæ˜¯è¦åŸ¹å…»è‡ªå·±ä¸¥è°¨çš„æ„è¯†ï¼Œå·²ç»æäº¤çš„ä»£ç å¿…é¡»æœ‰ä¸¥æ ¼çš„ä½è¯ã€‚\n\n### æ—¥å¿—å¯è¯»æ€§\n\nå¤§å¤šæ•°é¡¹ç›®çš„é—®é¢˜å®šä½éå¸¸ä¾èµ–æ—¥å¿—ã€‚\n\nå¯¹äºæ—¥å¿—ï¼Œæˆ‘ä»¬åº”è¯¥æœ‰å¦‚ä¸‹å‡ ä¸ªçº¦æŸï¼š\n\n* é¿å…å¤ªå¤šå¤ªé•¿çš„å†…å®¹ï¼Œæ— è®ºæ—¥å¿—æ˜¯ä»¥ä½•ç§æ–¹å¼å­˜å‚¨ï¼Œè§„æ¨¡ä¸Šå»ä¹‹åçš„æ¶ˆè€—éƒ½éå¸¸å¯è§‚ã€‚\n* é€‚å½“ä½¿ç”¨ç®€å†™ï¼Œä½†æ˜¯é¿å…å®Œå…¨ä¸çŸ¥æ‰€äº‘ï¼Œåº”è¯¥ç¬¦åˆæ™®éçº¦å®šã€‚\n\n### ä»£ç çš„é€šç”¨æ€§\n\nå½“æˆ‘ä»¬æäº¤ä¸€ä¸ªåŠŸèƒ½ï¼Œæˆ–è€…ä¿®å¤ä¸€ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬åªæ˜¯ä»è¿™ä¸ªé—®é¢˜çš„è§’åº¦æŠ¤å‘ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ä»å…¨å±€çš„è§’åº¦å‡ºå‘ï¼Œä¾‹å¦‚ï¼š\n\n* å½“æˆ‘ä»¬æ–°å¢ä¸€ä¸ªä¸ŠæŠ¥çš„æ—¶å€™ï¼Œæœ‰æ²¡æœ‰è€ƒè™‘æŠŠæ•´ä¸ªä¸ŠæŠ¥èšåˆåˆ°ä¸€èµ·ï¼Œæˆ–è€…æ¶æ„ä¸Šæ”¯æŒæ›´æ–¹ä¾¿çš„ä¸ŠæŠ¥èƒ½åŠ›ï¼Ÿ\n* å½“æˆ‘ä»¬æ–°å¢ä¸€ä¸ªé€šç”¨èƒ½åŠ›çš„æ—¶å€™ï¼Œæœ‰æ²¡æœ‰è€ƒè™‘åˆ°å…¶ä»–æ¨¡å—æˆ–é¡¹ç›®ä¹Ÿå¯èƒ½æœ‰ç±»ä¼¼éœ€æ±‚ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥å°†å…¶å•ç‹¬æŠ½ç¦»æˆä¸€ä¸ªç‹¬ç«‹çš„åŒ…è¿›è¡Œåˆ†å‘ï¼Ÿ\n* å½“æˆ‘ä»¬é‡åˆ°ä¸€ä¸ªé—®é¢˜æœ‰å¤šç§ä¿®å¤æ–¹æ¡ˆçš„æ—¶å€™ï¼Œæœ‰æ²¡æœ‰ç»¼åˆè€ƒè™‘ï¼Œå“ªä¸€ç§æ–¹æ¡ˆå¯¹åç»­ç»´æŠ¤çš„åŒå­¦æ›´åŠ å‹å¥½ï¼ˆæ¯”å¦‚ï¼Œæœ€å¥½æ˜¯é«˜å†…èšã€ä½è€¦åˆçš„è®¾è®¡ï¼‰ï¼Ÿ\n\nè¿™é‡Œçš„å¤§ä½“åŸåˆ™ï¼Œå°±æ˜¯æˆ‘ä»¬éœ€è¦ä»æ•´ä½“æ€§çš„è§’åº¦å‡ºå‘ï¼Œä¸æ–­åœ°è¿­ä»£è®©æ•´ä¸ªæ¶æ„æ›´åŠ å¤¯å®ï¼Œè€Œä¸æ˜¯å‡ºä¸ªé—®é¢˜è´´ä¸€ä¸ªåˆ›å¯è´´ï¼Œæ–°å¢åŠŸèƒ½åˆè´´ä¸€ä¸ªåˆ›å¯è´´ã€‚\n\n### é…ç½®åŒ–\n\nè¿™é‡Œçš„é…ç½®åŒ–ï¼Œæ¯”è¾ƒå…¸å‹çš„æ¯”å¦‚æ˜¯ï¼šå¤šè¯­è¨€æ–‡æ¡ˆã€é¡¹ç›® Settings é…ç½®ç­‰ã€‚\n\n* ä¸€èˆ¬æ¥è¯´ï¼Œé…ç½®åŒ–çš„å†…å®¹æœ€å¥½æ˜¯èµ°äº‘ç«¯ä¸‹å‘ã€‚\n* å¦‚æœä¸å…·å¤‡äº‘ç«¯ä¸‹å‘çš„ç¯å¢ƒï¼Œæˆ–è€…æˆ‘ä»¬çš„é…ç½®**æ¯”è¾ƒæ•æ„Ÿä¸é€‚åˆç›´æ¥ä¸‹å‘**ï¼Œå¯ä»¥è€ƒè™‘åœ¨ä»£ç ä¸­åˆ›å»ºé…ç½®æ–‡ä»¶çš„æ–¹å¼ã€‚\n\nå¦‚æœæˆ‘ä»¬åœ¨ Review ä¸­å‘ç°æœ‰å¯ä»¥é…ç½®åŒ–çš„å†…å®¹ä½†æ˜¯å´ç›´æ¥å†™æ­»åœ¨ä»£ç é‡Œé¢äº†ï¼Œåº”å½“éœ€è¦æå‡ºè´¨ç–‘ã€‚\n\n### ä»£ç ç²¾ç®€\n\nä»£ç ç²¾ç®€å¯¹åæœŸçš„å¯ç»´æŠ¤æ€§æ˜¯éå¸¸é‡è¦çš„ï¼Œä»£ç ç²¾ç®€çš„ä¸€ä¸ªæ¯”ä»·æœ‰æ•ˆçš„åŠæ³•å°±æ˜¯å……åˆ†ç†è§£ä¸šåŠ¡ï¼Œå†™å‡ºç²¾ç®€ä¸å¤šä½™çš„ä»£ç ï¼Œä¸è¿‡è¿™ä¸€ç‚¹åœ¨ MR ä¸­å¯èƒ½ä¼šæ¯”è¾ƒéš¾è¿›è¡Œ Reviewï¼Œå› ä¸ºä¸€èˆ¬æ¥è¯´æäº¤ä»£ç çš„åŒå­¦æœ¬èº«å·²ç»æ˜¯å¯¹è¿™éƒ¨åˆ†ä¸šåŠ¡æ˜¯ç†è§£çš„æœ€é€å½»çš„ã€‚\n\nä½†æ˜¯æœ‰ä¸€ç‚¹ä»£ç çš„ Reviewer ä¼šæ¯”è¾ƒå®¹æ˜“åˆ¤æ–­ï¼Œå¦‚æœæˆ‘ä»¬æäº¤çš„ä»£ç é‡Œé¢æœ‰**ä¸¤å¤„ä»¥ä¸Šè¶…è¿‡ä¸‰è¡Œçš„æå…¶ç›¸ä¼¼çš„ä»£ç **ï¼Œæˆ‘ä»¬å°±åº”å½“é‡æ–°å®¡è§†æ˜¯å¦å¯ä»¥è¿›è¡Œä¸€å®šç¨‹åº¦çš„æŠ½ç¦»ï¼Œå»ºè®®ä¸è¦ç”±äºä¸€æ—¶çš„æ•ˆç‡å…è®¸ä¸ç¬¦åˆè§„èŒƒçš„ä»£ç åˆå…¥ï¼Œè¿™äº›åœ¨åæœŸéƒ½å¯èƒ½æ¼”åŒ–æˆä»£ç å±å±±ã€‚\n\nä¾‹å¦‚ï¼Œç¬”è€…å¯¹äº Rust ä»£ç ç²¾ç®€çš„ä¸€äº›å»ºè®®ï¼š\n\n* é¿å…ä»»ä½•ä¸€æ¬¡å¤šä½™çš„ Cloneã€‚\n* æ–‡ä»¶å¤´éƒ¨å¼•ç”¨ä¸­å»é™¤æ²¡æœ‰å¿…è¦çš„å¼•ç”¨ã€‚\n* é¿å…å¤šä½™çš„æ—¥å¿—ï¼ŒåŒæ—¶é¿å…åœ¨æ—¥å¿—é‡Œé¢åŠ å¤ªé•¿çš„å‰ç¼€å†…å®¹ï¼ˆæœ‰çš„æ—¶å€™ä¸€è¡Œæ—¥å¿—é‡Œé¢æœ‰å¤šåŠéƒ½æ˜¯å…ƒä¿¡æ¯ï¼Œè€Œä¸”è¿™äº›å…ƒä¿¡æ¯è¿˜æ˜¯æœ‰æ‰€é‡å¤çš„ï¼‰ã€‚\n* é¿å…å¤šä½™çš„ pubï¼Œåº”è¯¥æœ‰ä¸€ä¸ªç†å¿µå°±æ˜¯é»˜è®¤çš„å†…å®¹ä¸è¦ pub å‡ºå»ï¼Œå°±åƒ c++ çš„æˆå‘˜æ–¹æ³•é»˜è®¤æ˜¯ private ä¸€æ ·ã€‚\n* é‡å¤ä»£ç ä½¿ç”¨å®æ¥æ›¿ä»£ã€‚\n\n## é‡è§†æ€§èƒ½\n\n### é˜²æ­¢æ³„æ¼\n\nåœ¨è€ƒå¯Ÿæ€§èƒ½ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯è‡ªå·±çš„ä»£ç æ²¡æœ‰æ³„æ¼ï¼Œå› ä¸ºæ³„æ¼é€ æˆçš„æ¶åŠ£æ€§é€šå¸¸æ¯”æ€§èƒ½å·®æ›´ä¸¥é‡ï¼Œè€Œä¸”é€šå¸¸éœ€è¦æ›´é•¿çš„æ—¶é—´æ¥æ’æŸ¥ã€‚\n\nè¿™é‡Œä¸»è¦çš„æ£€æŸ¥ç‚¹å¯ä»¥æ˜¯ï¼š\n\n* addListener ä¹‹åæ˜¯å¦åŠæ—¶é‡Šæ”¾äº†ã€‚\n* setInterval/setTimeout ç­‰å®šæ—¶å™¨è°ƒç”¨æ˜¯å¦å­˜åœ¨å¤šæ¬¡è°ƒç”¨çš„å¯èƒ½æ€§ï¼Œä»¥åŠæ˜¯å¦å¯èƒ½æ— æ³•é‡Šæ”¾ã€‚\n* åˆ†é…åœ¨å †ä¸Šçš„å†…å­˜æ˜¯å¦é‡Šæ”¾äº†ã€‚\n* æ˜¯å¦æœ‰ detach dom æ³„æ¼ã€‚\n\n### é˜²æ­¢æ­»é”\n\nè¿™ä¸€ç‚¹å¦‚æœæ˜¯å‰ç«¯å¼€å‘ï¼Œä¸€èˆ¬æ²¡æœ‰æœºä¼šé‡åˆ°ï¼Œä½†å¦‚æœä½ ç”¨ rustã€c++ ç­‰è¯­è¨€ï¼Œéƒ½å¾ˆæœ‰å¯èƒ½å‡ºç°æ­»é”çš„é£é™©ï¼ˆä¸¥æ ¼æ¥è¯´ï¼Œæ­»é”å¹¶ä¸èƒ½ç›´æ¥å½’ç±»åˆ°æ€§èƒ½ï¼‰ã€‚\n\nå¯¹äºæ­»é”çš„é˜²æ­¢ï¼Œæˆ‘å»ºè®®å›¢é˜Ÿå†…çš„åŸºç¡€è®¾æ–½éƒ¨åˆ†å…ˆé…ç½®å¥½æ­»é”æ£€æµ‹å’Œä¸ŠæŠ¥æœºåˆ¶ï¼ˆä¾‹å¦‚ parking_lot æä¾›äº†æ­»é”æ£€æŸ¥çš„èƒ½åŠ›ï¼‰ã€‚\n\nä¸€äº›æ­»é”ç›¸å…³çš„ Review å»ºè®®ï¼š\n\n* ç”¨åˆ°é”çš„åœ°æ–¹ï¼Œå°½å¯èƒ½é€šè¿‡å·¥å…·å‡½æ•°è¿›è¡Œå°è£…ï¼Œç±»ä¼¼ getter å’Œ setterï¼Œå¢åŠ åŸå­æ€§ï¼Œå‡å°‘è°ƒç”¨ä»£ç ç›´æ¥è§£é”çš„åœºæ™¯ã€‚\n* é”çš„ç²’åº¦ä¸åº”è¯¥å¤ªå¤§ï¼Œ**æˆ‘ä»¬åº”è¯¥æ˜¯å¯¹æ•°æ®è¿›è¡ŒåŠ é”ï¼Œè€Œä¸æ˜¯å¯¹è¿‡ç¨‹è¿›è¡ŒåŠ é”**ï¼Œé”ç²’åº¦è¿‡å¤§å¾ˆå®¹æ˜“å‡ºç°æ­»é”çš„é£é™©ã€‚\n* åœ¨å‡½æ•°è„±ç¦»æ§åˆ¶æƒä¹‹å‰ï¼Œä¾‹å¦‚å‡†å¤‡å¼€å§‹è°ƒç”¨åˆ°å…¶ä»–å¤–éƒ¨å‡½æ•°äº†ï¼Œè¿™ä¸ªæ—¶å€™æœ€å¥½æŠŠæŒæœ‰çš„é”éƒ½é‡Šæ”¾æ‰ï¼Œé˜²æ­¢å¤–éƒ¨å‡½æ•°å†æ¬¡ç”¨åˆ°é€ æˆé”é‡å…¥ã€‚\n\n### æ€§èƒ½æŠ¥å‘Š\n\nå…³äºè¿™ä¸€éƒ¨åˆ†ï¼Œä¹Ÿå»ºè®®å›¢é˜ŸåŸºå»ºå…ˆè¡Œï¼Œæœ‰ä¸€ä¸ªæ¯”è¾ƒæ ‡å‡†çš„æ€§èƒ½æµ‹è¯•æ–¹æ³•ï¼Œè¿™æ ·å¤§å®¶åœ¨åšæ€§èƒ½æµ‹è¯•çš„æ—¶å€™ï¼Œä¸ä¼šé‚£ä¹ˆæœ‰å‹åŠ›ã€‚æ¯”è¾ƒåå¯¹çš„ä¸€ç§æ–¹å¼å°±æ˜¯å›¢é˜Ÿå†…éƒ¨ä¸åŒæˆå‘˜éƒ½æœ‰è‡ªå·±çš„ä¸€å¥—æ€§èƒ½æµ‹è¯•æ–¹æ³•ï¼Œè¿™æ ·æœ‰äº›æ–°åŒå­¦ç¼ºä¹å¿…è¦çš„ä¸Šä¸‹æ–‡ï¼Œè‡ªç„¶ä¸äº†è§£å¦‚ä½•å»åšæ€§èƒ½æµ‹è¯•ã€‚\n\nä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬æ¶‰åŠåˆ°æ¯”è¾ƒå¤§çš„åŠŸèƒ½éƒ½è¦è¿›è¡Œä¸€äº›æ€§èƒ½æŠ¥å‘Šï¼Œç›¸å…³çš„æŒ‡æ ‡å¯ä»¥æ˜¯ï¼š\n\n* æ•´ä½“åŒ…ä½“ç§¯çš„å¢åŠ å¹…åº¦ã€‚\n* åˆå§‹åŒ–å“åº”é€Ÿåº¦çš„å˜åŒ–ã€‚\n* è¿è¡Œè¯¥åŠŸèƒ½ä¸€æ®µæ—¶é—´çš„ CPU æ¶ˆè€—ã€‚\n* è¿è¡Œè¯¥åŠŸèƒ½ä¸€æ®µæ—¶é—´çš„ å†…å­˜ æ¶ˆè€—ã€‚\n* è¿è¡Œè¯¥åŠŸèƒ½è¾ƒé•¿æ—¶é—´çš„ CPU/å†…å­˜ æ¶ˆè€—ã€‚\n\nä¸è¿‡ï¼Œå…·ä½“è¿™ä¸€éƒ¨åˆ†è¿˜æ˜¯å»ºè®®å›¢é˜Ÿå†…éƒ¨æ ¹æ®é¡¹ç›®çš„å®é™…æƒ…å†µæœ‰ä¸€ä¸ªç»Ÿä¸€çš„æ ‡å‡†ï¼Œå¹¶ä¸”å°†æ€§èƒ½æµ‹è¯•æ–¹æ³•æ ‡å‡†åŒ–ï¼Œè€Œä¸è¦æˆä¸ºä¸€ä¸ªè´Ÿæ‹…ã€‚\n\n## å…¼å®¹æ€§\n\nåœ¨å…¼å®¹æ€§è¿™æ–¹é¢ï¼Œæ— è®ºæ˜¯ web å¼€å‘è¿˜æ˜¯æ¡Œé¢å®¢æˆ·ç«¯å¼€å‘ï¼Œéƒ½éœ€è¦é‡ç‚¹å…³æ³¨ï¼Œè¿™é‡Œå…¶å®ç»†åˆ†ä¸ºä¸¤ä¸ªç»´åº¦ï¼š\n\n* ç‰ˆæœ¬æ”¯æŒï¼Œä¾‹å¦‚æˆ‘ä»¬å¯èƒ½ä¼šå®ç°çº¦å®šå¥½æ”¯æŒåˆ° Chrome çš„å“ªä¸ªç‰ˆæœ¬ï¼ˆé’ˆå¯¹ webï¼‰æˆ–è€… macOS çš„å“ªä¸ªç‰ˆæœ¬ï¼ˆé’ˆå¯¹ macOS æ¡Œé¢ç«¯ï¼‰ï¼Œå¹¶ä¸”å¦‚æœæäº¤æ¶‰åŠåˆ°å…¼å®¹æ€§æ”¹åŠ¨éœ€è¦é‡ç‚¹æµ‹è¯•æ‰€æ”¯æŒçš„æœ€ä½ç‰ˆæœ¬ã€‚\n* å¼‚å¸¸æƒ…å†µæ”¯æŒï¼Œè¿™ä¸€ç‚¹å¯èƒ½å¤§å¤šæ•°æ—¶å€™éƒ½ä¼šè¢«å¤§å®¶å¿½ç•¥ï¼Œè¿™é‡Œä¸¾ä¸€ä¸ªä¾‹å­å°±æ˜¯ webgl çš„æ”¯æŒï¼Œå®é™…ä¸Šï¼Œè™½ç„¶å¤§å¤šæ•°æ—¶å€™æµè§ˆå™¨å·²ç»æ”¯æŒåˆ°äº† webglï¼Œä½†æ˜¯ä»ç„¶æœ‰ä¸å°‘åœºæ™¯ï¼Œwebgl ä¼šåˆå§‹åŒ–å¤±è´¥ï¼Œè¿™ä¸ªåŸå› å¯èƒ½å’Œç”¨æˆ·çš„ç¡¬ä»¶æ¯”å¦‚ç³»ç»Ÿæ˜¾å¡æœ‰å…³ï¼Œå¦‚æœæˆ‘ä»¬çš„é¡¹ç›®åªæœ‰ webgl å®ç°ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘æ˜¯å¦æ”¾å¼ƒ webgl åˆå§‹åŒ–å¤±è´¥çš„åœºæ™¯ï¼ˆä»å•†ä¸šåŒ–çš„è§’åº¦ï¼Œä¸€èˆ¬æ¥è¯´éƒ½æ˜¯å¸Œæœ›ä¸è¦æ”¾å¼ƒï¼‰ï¼Œæˆ–è€…è¯´ä¸ºæ­¤å¢åŠ è½¯æ¸²æŸ“é™çº§ã€‚\n\næ‰€ä»¥ï¼Œåœ¨ Code Review ç¯èŠ‚ï¼Œé’ˆå¯¹å¯èƒ½å‡ºç°å…¼å®¹æ€§é£é™©çš„åœ°æ–¹ï¼Œæˆ‘ä»¬éœ€è¦ç¡®è®¤æ˜¯å¦å·²ç»è¿›è¡Œäº†å…¼å®¹æ€§æµ‹è¯•ã€‚","tags":["ç¼–ç¨‹ç»¼åˆ"]},{"title":"ã€Šä»£ç æ•´æ´ä¹‹é“-Clean Codeã€‹è¯»ä¹¦ç¬”è®°","url":"/2022/02/27/ä»£ç æ•´æ´ä¹‹é“/","content":"\n## æ•´æ´ä»£ç \n\nã€Šä¿®æ”¹ä»£ç çš„è‰ºæœ¯ã€‹ä¸€ä¹¦ä½œè€…å¯¹æ•´æ´ä»£ç çš„æè¿°ï¼šæˆ‘å¯ä»¥åˆ—å‡ºæˆ‘ç•™æ„åˆ°çš„æ•´æ´ä»£ç çš„æ‰€æœ‰ç‰¹ç‚¹ï¼Œä½†å…¶ä¸­æœ‰ä¸€æ¡æ˜¯æ ¹æœ¬æ€§çš„ï¼Œæ•´æ´çš„ä»£ç æ€»æ˜¯çœ‹èµ·æ¥åƒæŸç§ç‰¹åˆ«åœ¨æ„ä»–çš„äººå†™çš„ï¼Œå‡ ä¹æ²¡æœ‰æ”¹è¿›çš„ä½™åœ°ï¼Œä»£ç çš„ä½œè€…ä»€ä¹ˆéƒ½æƒ³åˆ°äº†ï¼Œå¦‚æœä½ ä¼å›¾æ”¹è¿›å®ƒï¼Œæ€»ä¼šå›åˆ°åŸç‚¹ï¼Œèµå¹æŸäººç•™ç»™çš„ä»£ç â€”â€”å…¨å¿ƒæŠ•å…¥æŸäººç•™ç»™ä½ çš„ä»£ç ã€‚\n\n## å‡½æ•°\n\nè¿™æœ¬ä¹¦å…³äºå‡½æ•°çš„ä»‹ç»å’Œå…¶ä»–æ¶æ„ä¹¦å·®ä¸å¤šï¼Œä¸»è¦å°±æ˜¯ä¸¤ä¸ªç‚¹ï¼š1. çŸ­å°ï¼Œ2. æŠ½è±¡å±‚æ¬¡ä¸€è‡´æ€§ã€‚\n\n## æ³¨é‡Š\n\næ¯«æ— ç–‘é—®ï¼Œæ³¨é‡Šæ˜¯ä»£ç ä¸­çš„åå‘³é“ã€‚\n\nå¯¹äºä¸€éƒ¨åˆ†æ³¨é‡Šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç±»ä¼¼ 4.4.8 è¿™ç§å˜é‡çš„æ–¹å¼ï¼Œé€šè¿‡æ–°å¢ä¸¤ä¸ªå˜é‡ï¼Œæ¥è§£é‡Šæˆ‘ä»¬çš„å†…å®¹ã€‚\né‚£ç§ç”Ÿæˆçš„æ³¨é‡Šå’Œæˆ‘ä»¬æ³¨é‡Šæ‰çš„ä»£ç ï¼Œæˆ‘çš„å»ºè®®æ˜¯ï¼šä¸è¦ç•™ã€‚\n\n## æ ¼å¼\n\nç›¸å…³å‡½æ•°ï¼šæŒ‰ç…§æœ¬ä¹¦çš„è¯´æ˜ï¼Œè‹¥æŸä¸ªå‡½æ•°è°ƒç”¨äº†å¦å¤–ä¸€ä¸ªï¼Œå°±åº”è¯¥æŠŠå®ƒä»¬æ”¾åˆ°ä¸€èµ·ï¼Œè€Œä¸”è°ƒç”¨è€…åº”è¯¥å°½å¯èƒ½æ”¾åœ¨è¢«è°ƒç”¨è€…ä¸Šé¢ã€‚æˆ‘è‡ªå·±ä¹‹å‰çš„ä¹ æƒ¯æ˜¯è°ƒç”¨è€…åœ¨è¢«è°ƒç”¨è€…çš„ä¸‹é¢ï¼Œç›®å‰åˆæ€è€ƒäº†ä¸€ä¸‹ï¼Œåƒä½œè€…è¿™æ ·ç»„ç»‡ï¼Œå¯èƒ½å¯è¯»æ€§åè€Œæ›´é«˜ã€‚\n\n> å› ä¸ºè¿™æ ·è®¾è®¡å¯ä»¥åƒæŠ¥çº¸ä¸€æ ·ï¼Œæœ€é‡è¦çš„æ¦‚å¿µå…ˆå‡ºç°ï¼Œå¹¶ä¸”å¸Œæœ›ä»¥åŒ…æ‹¬æœ€å°çš„ç»†èŠ‚è¡¨è¿°ä»–ä»¬ï¼ŒæœŸæœ›åº•å±‚çš„ç»†èŠ‚åå‡ºç°ã€‚\n\n## é”™è¯¯å¤„ç†\n\n**ä½¿ç”¨å¼‚å¸¸è€Œéè¿”å›ç **ï¼š åœ¨ ã€Šä»£ç ç²¾è¿›ä¹‹è·¯ã€‹çš„è¯»ä¹¦ç¬”è®°ä¸­ï¼Œä¹ŸæåŠäº†ç±»ä¼¼çš„æ€è·¯ï¼Œè¿™ä¸ªä¹¦é‡Œé¢åˆæåˆ°äº†ä½¿ç”¨å¼‚å¸¸è€Œéè¿”å›ç è¿™ä¸€ç‚¹ï¼Œå¹¶ä¸”ç»™å‡ºäº†ä¸€ä¸ªæ–°çš„ç†ç”±ï¼Œè¿”å›ç æ„å‘³ç€æˆ‘ä»¬éœ€è¦ç«‹å³å¤„ç†ï¼Œè¿™ä¸ªæ­¥éª¤å¯èƒ½å¾ˆå®¹æ˜“è¢«é—å¿˜ï¼Œè€Œä¸”ä¼šè®©æˆ‘ä»¬çš„ä»£ç å˜å¾—æ¯”è¾ƒä¹±ã€‚\n\nå…³äºè¿”å› null å€¼ï¼šæœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨æ•°æ®å¤„ç†ä¸­å‡ºç°é—®é¢˜ï¼Œå¯èƒ½ä¼šè¿”å›ä¸€ä¸ª null æˆ–è€… undefinedã€‚ä½†æ˜¯æˆ‘å»ºè®®ç›¸å¯¹äºæ­¤ï¼Œæˆ‘ä»¬æ›´åº”è¯¥ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œè¿”å› null å€¼æ„å‘³ç€ä¾èµ–è°ƒç”¨è€…æ¥åšç©ºæ£€æŸ¥ï¼Œè€Œä¸”ä½ ä¸çŸ¥é“è¿™ä¸ª null ç©¶ç«Ÿä»€ä¹ˆæ—¶å€™æ‰ä¼šå¼•å‘é”™è¯¯ï¼Œè¿™æ ·ä¼šæœ‰è¾ƒé«˜çš„ä¸ç¨³å®šæ€§ã€‚\n\n## ç±»çš„ç»„ç»‡\n\nå¯¹äºç±»çš„ç»„ç»‡ä¸­ï¼Œå±æ€§é¡ºåºçš„ä¸€ä¸ªå»ºè®®ï¼šä¾æ¬¡æ˜¯å…¬å…±é™æ€å¸¸é‡ã€ç§æœ‰é™æ€å˜é‡ã€å…¬å…±å‡½æ•°ã€ç§æœ‰å‡½æ•°ã€‚\n\n**ç±»çš„æƒè´£**ï¼šå¯¹äºä¸€ä¸ªç±»æ¥è¯´ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›å®ƒè¢«å®šä¹‰çš„å¤ªé•¿ï¼Œå½“ç„¶è¿™ä¸ªä¸èƒ½å•çº¯åœ°ä½¿ç”¨ä»£ç è¡Œæ•°æ¥åˆ¤æ–­ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ç±»çš„æƒè´£æ¥åˆ¤æ–­ï¼Œå½“ä¸€ä¸ªç±»çš„åç§°è¶Šå«ç³Šï¼Œè¯¥ç±»è¶Šæœ‰å¯èƒ½æ‹¥æœ‰æ›´å¤šæƒè´£ï¼Œæ¯”å¦‚å®ƒçš„åç§°åŒ…å«äº†è¯¸å¦‚ Processorã€Manager æˆ– Superï¼Œé‚£ä¹ˆè¿™ç§ç°è±¡å¾€å¾€è¯´æ˜æœ‰ä¸æ°å½“çš„æƒè´£èšé›†çš„æƒ…å†µå‡ºç°ã€‚\n\n**å¦‚ä½•æŠŠç±»æ‹†çš„çŸ­å°**ï¼šæˆ‘ç»™å‡ºä¸€ä¸ªåˆ‡å®å¯è¡Œçš„åŠæ³•ï¼Œå¯ä»¥å…ˆä»ç±»çš„å¤æ‚å‡½æ•°å…¥æ‰‹ï¼Œæˆ‘ä»¬åœ¨æŠŠå‡½æ•°æ‹†åˆ†çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°æŸäº›éƒ¨åˆ†æ‹†åˆ†æˆå‡½æ•°ä¹‹åä¼šä¼ é€’å¤§é‡çš„å‚æ•°ç»™å®ƒï¼Œå¦åˆ™å¾ˆéš¾æ‹†åˆ†ï¼Œé‚£ä¹ˆä¼ é€’ç»™å®ƒè¿™ä¸ªå‡½æ•°çš„å‚æ•°å°±å¯ä»¥è¢«æ•´åˆè¿›æ–°çš„å°ç±»çš„å®ä½“å˜é‡ï¼Œè¿™æ ·æˆ‘ä»¬å°±æ— éœ€ä¼ é€’å‚æ•°ï¼ŒåŒæ—¶ä¹Ÿå®Œæˆäº†æ‹†åˆ†ã€‚\n\n","tags":["è¯»ä¹¦ç¬”è®°"]},{"title":"ä½¿ç”¨ fst-json è‡ªåŠ¨ç”Ÿæˆæ›´å¿«çš„ json åºåˆ—åŒ–æ–¹æ³•","url":"/2022/02/11/fst-json/","content":"\n> fst-json çš„å…¨ç§°æ˜¯ \"fast-safe-typescript json\"ï¼Œå®ƒçš„æœ¬è´¨å°±æ˜¯ç›´æ¥ä½¿ç”¨ä½ å®šä¹‰å¥½çš„ Typescript æ–‡ä»¶ï¼Œæ¥ç”Ÿæˆæ›´åŠ é«˜æ•ˆçš„åºåˆ—åŒ–æ–¹æ³•ã€‚\n> å…¶ç›®çš„æ˜¯åˆ©ç”¨ç°æœ‰çš„èµ„æºï¼ˆå¼€å‘è¿‡ç¨‹ç¼–å†™çš„ Typescript æ–‡ä»¶ï¼‰ï¼Œåœ¨ç¼–è¯‘å’Œå¼€å‘é˜¶æ®µå°½å¯èƒ½æé«˜è¿è¡Œæ—¶æ€§èƒ½ï¼ŒåŒæ—¶è¿™ä¸ªè¿‡ç¨‹å¹¶æ²¡æœ‰é¢å¤–çš„å¼€å‘è´Ÿæ‹…ã€‚\n\ngithub: https://github.com/aircloud/fst-json/blob/master/README.zh-cn.md\n\nçŸ¥ä¹ï¼šhttps://zhuanlan.zhihu.com/p/466572196\n\n## èƒŒæ™¯\n\nç”±äº JSON schema è¿™ä¸ªæ¦‚å¿µæ˜¯ç”± fastify å¼•å…¥ï¼Œæˆ‘ä»¬å…ˆå¯¹æ­¤è¿›è¡Œä»‹ç»ã€‚\n\n[fastify](https://github.com/fastify/fastify) æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ Node.JS æœåŠ¡ç«¯æ¡†æ¶ï¼Œå…¶ç‰¹ç‚¹å°±æ˜¯é«˜æ€§èƒ½ï¼Œè€Œä¹‹æ‰€ä»¥é«˜æ€§èƒ½ä¸»è¦çš„åŸå› å°±æ˜¯å®ƒå¼•å…¥äº† JSON schemaï¼Œé€šè¿‡å¯¹å‚æ•°å¢åŠ çº¦æŸï¼Œæ¥è·å¾—æ›´å¿«çš„åºåˆ—åŒ–é€Ÿåº¦ã€‚\n\nåŒæ—¶ï¼Œfastify ä¹Ÿå¼€æºäº†ä¸€ä¸ªç‹¬ç«‹çš„ json åºåˆ—åŒ–åº“ [fast-json-stringify](https://github.com/fastify/fast-json-stringify)ï¼Œå¯ä»¥åœ¨**é fastify çš„é¡¹ç›®ä¸­ä½¿ç”¨**ã€‚\n\nåœ¨ fastify ä¸­ï¼ŒJSON schema çš„å¤§è‡´å†™æ³•å¦‚ä¸‹ï¼š\n\n```\nconst schema = {\n  schema: {\n    response: {\n      200: {\n        type: 'object',\n        properties: {\n          hello: {\n            type: 'string'\n          }\n        }\n      }\n    }\n  }\n}\nfastify\n  .get('/', schema, function (req, reply) {\n    reply\n      .send({ hello: 'world' })\n  })\n```\n\næˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸€å¥—å†™æ³•ä¸ä»…ä¼šå¸¦æ¥é¢å¤–çš„å­¦ä¹ æˆæœ¬ï¼Œè€Œä¸”ç”±äºç›®å‰å¤§å¤šæ•°é¡¹ç›®å¼€å‘éƒ½æ˜¯é‡‡ç”¨ Typescriptï¼Œè¿™å¥—å®šä¹‰ä¹Ÿä¼šå’Œæˆ‘ä»¬çš„ Typescript å®šä¹‰æœ‰æ‰€é‡å¤ã€‚\n\näº‹å®ä¸Šï¼Œè™½ç„¶ä¸Šé¢çš„ç¤ºä¾‹ä»£ç æ¯”è¾ƒçŸ­å°ï¼Œä½†æ˜¯åœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼Œæ¥å£æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œè¿™äº›ä»£ç çš„å¼€å‘é‡å’Œé¢å¤–çš„å­¦ä¹ /ç»´æŠ¤æˆæœ¬è¿˜æ˜¯ä¸å®¹å°è§†çš„ã€‚\n\né‚£ä¹ˆæœ‰æ²¡æœ‰å¯èƒ½ç›´æ¥ä½¿ç”¨ Typescriptï¼Œè€Œä¸ç”¨é‡æ–°å®šä¹‰ JSON schema å‘¢ï¼Ÿ\n\nç­”æ¡ˆæ˜¯æœ‰çš„ã€‚\n\n[fst-json](https://github.com/aircloud/fst-json/blob/master/README.zh-cn.md) å°±æ˜¯è¿™æ ·ä¸€ä¸ªå·¥å…·ï¼Œå®ƒå¯ä»¥é€šè¿‡å¤ç”¨æˆ‘ä»¬åœ¨ Typescript ä¸­å®šä¹‰çš„ schemaï¼Œé€šè¿‡å·¥å…·è‡ªåŠ¨ç”Ÿæˆ fastify éœ€è¦çš„ schemaï¼Œè¿™æ ·æˆ‘ä»¬å°±æ— éœ€é¢å¤–ç»´æŠ¤ schema å®šä¹‰äº†ã€‚\n\n## ä½¿ç”¨æ–¹å¼\n\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç®€å•ä»‹ç» fst-json çš„ä½¿ç”¨æ–¹å¼ï¼Œé¦–å…ˆå®‰è£…ï¼ˆå…¨å±€æˆ–è€…å®‰è£…åˆ°é¡¹ç›®ä¸­ï¼‰ï¼š\n\n```\nnpm i fst-json -g\n```\n\nå‡è®¾æˆ‘ä»¬é¡¹ç›®é‡‡ç”¨äº† Typescriptï¼Œäº‹å…ˆå·²ç»æœ‰äº† schema æ–‡ä»¶ï¼š\n\n```\nexport interface HellWorld {\n  attr1: string;\n  attr2: string;\n  attr3?: string;\n}\n```\n\næˆ‘ä»¬åœ¨é¡¹ç›®ç›®å½•ä¸‹æ–°å»º .fstconfig.jsï¼Œç”¨äºå£°æ˜é…ç½®ï¼Œé…ç½®å¦‚ä¸‹ï¼š\n\n```\nmodule.exports = {\n  sourceFiles: [\n    './src/schema/*.ts'\n  ],\n  distFile: \"./src/schema-dist.ts\",\n  format: 'fastify'\n}\n```\n\nä¹‹åæˆ‘ä»¬è¿è¡Œï¼š\n\n```\nfst-json gen\n```\n\nç„¶åæ­¤æ—¶ä¼šç”Ÿæˆä¸€ä¸ª `src/schema-dist.ts`ï¼Œè¿™é‡Œä¼šæœ‰è‡ªåŠ¨ç”Ÿæˆçš„ JSON schema å®šä¹‰ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å¯ä»¥åŒæ—¶ä½¿ç”¨ JSON schema å®šä¹‰å’Œæˆ‘ä»¬ä¹‹å‰å®šä¹‰å¥½çš„ Typescript ç±»å‹ï¼š\n\n```\nimport * as schemas from './schema-dist';\nimport type { HellWorld  } from \"./schema\";\n\nconst schema = {\n  schema: {\n    response: {\n      200: schemas.HellWorldSchema\n    }\n  }\n}\n\nserver\n  .get('/', schema, function (req, reply) {\n    let res: HellWorld = {\n      attr1: 'hello', \n      attr2: 'world', \n      attr3: 'optional'\n    }\n\n    reply\n      .send(res);\n  })\n```\n\nå½“ç„¶ï¼Œfst-json ä¸ä»…ä»…å¯ä»¥åœ¨ fastify ä¸­ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨ä»»ä½•å…¶ä»–éœ€è¦ JSON åŠ é€Ÿçš„åœ°æ–¹ä½¿ç”¨ï¼Œç”¨æ³•ä¹Ÿéƒ½å¾ˆç®€å•ï¼Œå¯ä»¥å‚è€ƒè¿™ä¸ª [HelloWorld](https://github.com/aircloud/fst-json/tree/master/examples/helloworld)\n\n## åŸç†å’Œä¼˜åŠ¿\n\nfst-jsonï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡å¯¹ Typescript è¿›è¡Œè¯­æ³•æ ‘è§£æï¼Œé’ˆå¯¹ export å¯¼å‡ºçš„å„ç§ç±»å‹ç”Ÿæˆå¯¹åº”çš„ fast-json-stringify çš„ JSON schemaï¼Œæ‰€ä»¥è¿è¡Œé€Ÿåº¦å’Œæ‰‹å†™æ˜¯æ²¡æœ‰åŒºåˆ«çš„ã€‚å› æ­¤ï¼Œå®ƒä¸ä»…ä»…èƒ½å®Œå…¨ä½¿ç”¨ fast-json-stringify çš„æ•ˆç‡ä¼˜åŠ¿ï¼Œé™¤äº†å‡å°‘é‡å¤å¼€å‘é‡ä»¥å¤–è¿˜æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š\n\n* **æ ¹æ® schema è¿›è¡Œå­—æ®µæ ¡éªŒï¼š** é¦–å…ˆä¼šè¿›è¡Œ Tyepscript è¯­æ³•æ ¡éªŒï¼Œå¦å¤–å½“ç¼ºå¤±å¿…é¡»çš„å±æ€§ï¼ˆä¾‹å¦‚ï¼Œå½“å®šä¹‰ interface æ—¶æ²¡æœ‰è¢« `?` ä¿®é¥°ç¬¦ä¿®é¥°çš„å±æ€§ç¼ºå¤±ï¼‰çš„æ—¶å€™ä¹Ÿä¼šç›´æ¥æŠ¥é”™ã€‚\n* **è¿‡æ»¤ä¸éœ€è¦çš„ schema å­—æ®µï¼š** ä¾‹å¦‚å½“æŠŠ Node.JS å½“ä½œ BFF å±‚çš„æ—¶å€™ï¼Œå¯ä»¥ä¸¥æ ¼æŒ‰ç…§ Typescript çš„å®šä¹‰æ¥è¿”å›å­—æ®µï¼Œé¿å…è¿”å›ä¸éœ€è¦çš„å­—æ®µï¼Œä»è€Œé¿å…ä¸Šæ¸¸æœåŠ¡çš„æ•æ„Ÿå­—æ®µè¢«ç›´æ¥é€ä¼ å‡ºå»ï¼Œä¹Ÿæ„å‘³ç€ä»æ¥å£å±‚é¢å¼€å§‹ï¼ŒçœŸæ­£åšåˆ° Fully Typedã€‚\n* **æ›´å¿«çš„åºåˆ—åŒ–é€Ÿåº¦ï¼š** æ ¹æ® [fast-json-stringify](https://github.com/fastify/fast-json-stringify/issues) çš„æµ‹è¯•ï¼Œèƒ½è¾¾åˆ°æ¥è¿‘ 2 å€çš„ JSON åºåˆ—åŒ–é€Ÿåº¦ã€‚\n\nç›®å‰ï¼Œfst-json å¯¹å¸¸ç”¨çš„å„ç±» interfaceã€classã€type ç­‰ç±»å‹å®šä¹‰éƒ½è¿›è¡Œäº†æ”¯æŒï¼Œå¹¶ä¸”å¢åŠ äº†å„ç±» examples å’Œ 90% çš„è¦†ç›–ç‡æµ‹è¯•ã€‚\n\nå½“ç„¶ï¼Œç”±äº Typescript çš„å†™æ³•æ¯”è¾ƒçµæ´»ã€‚å‡ºäº JSON schema æœ¬èº«çš„å±€é™æ€§ï¼Œæˆ‘ä»¬æ— æ³•è¦†ç›–æ‰€æœ‰åœºæ™¯ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥å‚è€ƒè¿™é‡Œçš„[æ³¨æ„äº‹é¡¹](https://github.com/aircloud/fst-json/blob/master/README.zh-cn.md#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9)ï¼Œæœ‰é’ˆå¯¹æ€§çš„å¯¹æ¯”è¾ƒå®¹æ˜“å‡ºé—®é¢˜çš„å†™æ³•è¿›è¡Œè§„é¿ã€‚\n\n### å±€é™æ€§\n\nfst-json åªæ˜¯è¯­æ³•è§£æå’Œç”Ÿæˆå·¥å…·ï¼Œå…·ä½“çš„è¿è¡Œæ—¶ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨ä½¿ç”¨ fast-json-stringifyï¼Œä¹Ÿå› æ­¤é¡¹ç›®ä¸­éœ€è¦å®‰è£… fast-json-stringify ä¾èµ–ã€‚\n\nå¦å¤–ï¼Œé’ˆå¯¹ fast-json-stringify çš„æµ‹è¯•ï¼Œåœ¨æ¯”è¾ƒå°çš„ payload çš„æƒ…å†µä¸‹ï¼Œå®ƒçš„é€Ÿåº¦æ˜¯æœ‰ä¼˜åŠ¿çš„ï¼Œå½“ payload è¿‡å¤§çš„æ—¶å€™ï¼Œå®ƒçš„ä¼˜åŠ¿ä¸å†æ˜æ˜¾ï¼Œç”šè‡³è¿˜ä¸å¦‚ JSON.stringifyã€‚å®˜æ–¹çš„æè¿°æ˜¯ï¼š\n\n> fast-json-stringify is significantly faster than JSON.stringify() for small payloads.\n> Its performance advantage shrinks as your payload grows.\n\nä¸è¿‡äº‹å®ä¸Šï¼Œè¿™ä¸ªæ—¶å€™ä½ ä»ç„¶å¯ä»¥ä½¿ç”¨ fst-json åšä¸€äº›äº‹æƒ…ï¼Œä¾‹å¦‚ç¬”è€…ä½¿ç”¨ fst-json æ¥åš bff å±‚å¯¹ä¸‹æ¸¸æœåŠ¡æ¥å£çš„æŒç»­é›†æˆå…¼å®¹æµ‹è¯•ï¼Œåœ¨ Typescript å·²ç»æå‰å®šä¹‰å¥½äº†çš„æƒ…å†µä¸‹ï¼Œæ¯æ¬¡æµ‹è¯•çš„æ—¶å€™åªéœ€è¦è¯·æ±‚ä¾èµ–æœåŠ¡å¹¶ä¸”æŠŠå“åº”å­—æ®µåºåˆ—åŒ–ï¼Œå¦‚æœæ²¡æœ‰æŠ¥é”™å¹¶ä¸”å­—æ®µåºåˆ—åŒ–ä¹‹åä¹Ÿæ²¡æœ‰å˜æˆ nullï¼ˆåœ¨æ¯”è¾ƒå¤æ‚çš„æ¥å£å®šä¹‰ä¸­ï¼Œå¦‚æœä¸ªåˆ«å±æ€§å®šä¹‰ç±»å‹å’Œè¿”å›ç±»å‹ä¸ä¸€è‡´ï¼Œfast-json-stringify æ˜¯ä¼šç›´æ¥è½¬æ¢æˆ nullï¼‰ï¼Œå°±è¯´æ˜æ¥å£æ˜¯æ²¡æœ‰å˜åŒ–çš„ã€‚å¯ä»¥æœ‰æ•ˆé¿å…ä¾èµ–æœåŠ¡æ¥å£å˜åŒ–ï¼Œå´åˆæ²¡æœ‰åŠæ—¶åŒæ­¥åˆ°ä½é€ æˆæš—å‘çš„æƒ…å†µã€‚\n\n\nå¦å¤–ï¼Œå…¶å®ç›®å‰ fast-json-stringify ç”Ÿæˆåºåˆ—åŒ–ä»£ç è¿˜æ˜¯åœ¨è¿è¡Œæ—¶åšçš„ï¼Œè¿™é‡Œçš„é—®é¢˜å¯èƒ½åœ¨äºä»£ç ä¸é€æ˜ï¼Œä»¥åŠè¿è¡Œæ—¶å¼€é”€å’Œé£é™©ï¼Œç¬”è€…æ˜¯å¸Œæœ›å°†å®ƒçš„ç”Ÿæˆä»£ç å˜æˆç¼–è¯‘æ—¶å»åšï¼Œä¸è¿‡è¿™æ ·çš„è¯å®é™…ä¸Šæœ‰ä¸€ç‚¹é‡å¤é€ è½®å­çš„é”™è§‰ï¼Œæ‰€ä»¥ç›®å‰è¿˜æ²¡æœ‰åšè¿™ä¸ªäº‹æƒ…ã€‚\n\n---\n\næœ€å [fst-json](https://github.com/aircloud/fst-json/) ä½œä¸ºä¸€ä¸ªå¼€æºä¸ä¹…çš„å°é¡¹ç›®ï¼Œè‚¯å®šè¿˜æœ‰äº›éœ€è¦ä¼˜åŒ–å’Œå®Œå–„çš„åœ°æ–¹ï¼Œæ¬¢è¿ star æ”¯æŒå’Œæå‡ºå»ºè®®ã€‚\n\n","tags":["å‰ç«¯ç»¼åˆ"]},{"title":"ã€Šä»£ç ç²¾è¿›ä¹‹è·¯ã€‹ä¸ã€Šä»£ç æ•´æ´ä¹‹é“ã€‹-è¯»ä¹¦ç¬”è®°","url":"/2022/01/30/ã€Šä»£ç ç²¾è¿›ä¹‹è·¯ã€‹ä¸ã€Šä»£ç æ•´æ´ä¹‹é“ã€‹è¯»ä¹¦ç¬”è®°/","content":"\næœ¬æ–‡é€šè¿‡å¯¹éƒ¨åˆ†é‡ç‚¹å†…å®¹ç½—åˆ—çš„æ–¹å¼å¯¹æ­¤ä¸¤æœ¬ä¹¦çš„è¯»ä¹¦ç¬”è®°è¿›è¡Œè®°å½•ã€‚\n\n> ã€Šä»£ç æ•´æ´ä¹‹é“-ç¨‹åºå‘˜çš„èŒä¸šç´ å…»ã€‹\n\n## è½¯ä»¶å¼€å‘åŸåˆ™\n\næ‰€æœ‰è½¯ä»¶é¡¹ç›®çš„æ ¹æœ¬æŒ‡å¯¼åŸåˆ™æ˜¯ï¼Œè½¯ä»¶è¦**æ˜“äºä¿®æ”¹**ã€‚å¦‚æœè¿èƒŒè¿™æ¡åŸåˆ™æ­å»ºåƒµåŒ–çš„ç»“æ„ï¼Œå°±ç ´åäº†æ„å»ºæ•´ä¸ªè¡Œä¸šçš„ç»æµæ¨¡å‹ã€‚\n\n## å¿…å¤‡æŠ€èƒ½\n\nè½¯ä»¶å¼€å‘äººå‘˜å¿…é¡»ç²¾é€šçš„äº‹é¡¹ï¼š\n\n* è®¾è®¡æ¨¡å¼ï¼šå¿…é¡»èƒ½æè¿° GOF ä¹¦ä¸­çš„å…¨éƒ¨ 24 ç§æ¨¡å¼å’Œï¼ŒåŒæ—¶è¿˜è¦æœ‰ POSA ä¹¦ä¸­çš„å¤šæ•°æ¨¡å‹çš„å®è·µç»éªŒã€‚\n* è®¾è®¡åŸåˆ™ï¼šå¿…é¡»äº†è§£ SOLID åŸåˆ™ï¼Œè€Œä¸”è¦æ·±åˆ»ç†è§£ç»„ä»¶è®¾è®¡åŸåˆ™ã€‚\n* æ–¹æ³•ï¼šå¿…é¡»ç†è§£ XPã€Scrumã€ç²¾ç›Šã€çœ‹æ¿ã€ç€‘å¸ƒã€ç»“æ„åŒ–å’Œåˆ†æä»¥åŠç»“æ„åŒ–ç¼–ç¨‹ã€‚\n* å®è·µï¼šå¿…é¡»æŒæ¡æµ‹è¯•é©±åŠ¨å¼€å‘ï¼Œé¢å‘å¯¹è±¡è®¾è®¡ï¼Œç»“æ„åŒ–ç¼–ç¨‹ï¼ŒæŒç»­é›†æˆå’Œç»“å¯¹ç¼–ç¨‹ã€‚\n* å·¥ä½œï¼šå¿…é¡»äº†è§£å¦‚ä½•ä½¿ç”¨ UML å›¾ï¼ŒDFD å›¾ï¼Œç»“æ„å›¾ï¼ŒPetri ç½‘ç»œå›¾ï¼ŒçŠ¶æ€è¿ç§»å›¾è¡¨ï¼Œæµç¨‹å›¾å’Œå†³ç­–è¡¨ã€‚\n\n## ä¸è¦è¯´â€œæˆ‘è¯•è¯•â€\n\n* è¿™ç§ç±»å‹çš„æè¿°å¹¶ä¸æ˜¯æ‰¿è¯ºï¼Œå®é™…ä¸Šå¹¶æ²¡æœ‰å®é™…æ„ä¹‰ã€‚\n* è€Œä¸”è¿™é€šå¸¸æ„å‘³ç€ä½ ä¹‹å‰è¯„ä¼°å‘¨æœŸçš„æ—¶å€™**å¹¶æ²¡æœ‰ç«­å°½å…¨åŠ›**ï¼Œå¦åˆ™ä¸ºä»€ä¹ˆåœ¨å‹ç¼©å‘¨æœŸçš„è®¨è®ºä¸­è¿˜è¦å†è¯´â€œæˆ‘è¯•è¯•â€å‘¢ã€‚\n\n## é‡æ–°å®šä¹‰â€œå®Œæˆâ€\n\n* æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬è‡ªæ¬ºæ¬ºäººçš„è®¤ä¸ºä»»åŠ¡å·²ç»å®Œæˆçš„è¶³å¤Ÿå¥½äº†ï¼Œç„¶åè½¬å…¥ä¸‹ä¸€é¡¹ä»»åŠ¡ã€‚æˆ‘ä»¬ä¼šç»™è‡ªå·±æ‰¾å€Ÿå£è¯´ï¼Œå…¶ä»–è¿˜æ²¡æ¥å¾—åŠå®Œæˆçš„å·¥ä½œå¯ä»¥ç­‰åˆ°æ—¶é—´æ›´å……è£•çš„æ—¶å€™æ¥å¤„ç†ã€‚ç”šè‡³æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šæŠŠä»£ç æäº¤å®šä¹‰ä¸ºâ€ä»»åŠ¡å®Œæˆâ€œã€‚è¿™æ ·æ˜¾ç„¶æ˜¯é”™è¯¯çš„ã€‚\n* çœŸæ­£çš„ä»»åŠ¡å®Œæˆï¼Œæ˜¯å·²ç»é€šè¿‡äº†æµ‹è¯•ï¼Œå¹¶ä¸”ä¸Šçº¿å®Œæˆç­‰ã€‚\n\n## å¯»æ±‚å¸®åŠ©\n\n* ç¼–ç¨‹å¹¶éæ˜“äº‹ã€‚è¶Šå¹´è½»çš„ç¨‹åºå‘˜å¯èƒ½è¶Šæ²¡æœ‰æ„Ÿè§‰ï¼Œæ¯•ç«Ÿä»£ç åªä¸è¿‡æ˜¯ä¸€å † if å’Œ while è¯­å¥è€Œå·²ã€‚ä½†æ˜¯éšç€ç»éªŒå¢é•¿ï¼Œä½ ä¼šå¼€å§‹æ„è¯†åˆ°æŠŠè¿™äº› if å’Œ while è¯­å¥ç»„è£…åœ¨ä¸€èµ·å¹¶éæ˜“äº‹ã€‚ä¸èƒ½æœŸæœ›å°†ä»–ä»¬ç®€å•çš„ç»„è£…åˆ°ä¸€èµ·å°±èƒ½å¾—åˆ°æœ€å¥½çš„ä»£ç ã€‚ç›¸åï¼Œå¿…é¡»å°å¿ƒè°¨æ…åœ°å°†ç³»ç»Ÿåˆ†è§£ä¸ºæ˜“äºç†è§£çš„å•å…ƒï¼ŒåŒæ—¶ä½¿å¾—è¿™äº›å•å…ƒä¹‹é—´çš„è”ç³»è¶Šå°‘è¶Šå¥½ã€‚\n* å› æ­¤ï¼Œä»…å‡­ä¸€å·±ä¹‹åŠ›å¾ˆéš¾å†™å‡ºè¶³å¤Ÿä¼˜ç§€çš„ä»£ç ï¼Œå³ä½¿ä½ çš„æŠ€è‰ºè¶³å¤Ÿé«˜è¶…ã€‚**ä¹Ÿä¸€å®šèƒ½ä»å¦å¤–ä¸€åç¨‹åºå‘˜çš„æ€è€ƒå’Œæƒ³æ³•ä¸­è·ç›Šã€‚**\n\n## é‡æ–°è®¤è¯†äº‰è®º\n\n* å‡¡æ˜¯ä¸èƒ½åœ¨ 5 åˆ†é’Ÿå†…è§£å†³çš„äº‰è®ºï¼Œéƒ½ä¸èƒ½é€šè¿‡è¾©è®ºæ¥è§£å†³ã€‚äº‰è®ºä¹‹æ‰€ä»¥è¦èŠ±è´¹è¿™ä¹ˆé•¿æ—¶é—´ï¼Œæ˜¯å› ä¸ºäº‰è®ºåŒæ–¹éƒ½æ‹¿ä¸å‡ºè¶³å¤Ÿæœ‰åŠ›çš„è¯æ®ï¼Œè¿™ä¸ªæ—¶å€™äº‰è®ºä¾æ®çš„ä¸æ˜¯äº‹å®ï¼Œè€Œæ˜¯ä¿¡å¿µã€‚\n\n## å›¢é˜Ÿ\n\n* æˆå‘˜éœ€è¦å…‹æœä¸ªä½“å·®å¼‚æ€§ï¼Œé»˜å¥‘é…åˆï¼Œå½¼æ­¤ä¿¡ä»»ï¼Œå½¢æˆçœŸæ­£æœ‰å‡èšåŠ›çš„å›¢é˜Ÿï¼Œæ˜¯éœ€è¦ä¸€äº›æ—¶é—´çš„ã€‚å¯èƒ½éœ€è¦ 6 ä¸ªæœˆï¼Œç”šè‡³ä¸€å¹´ï¼Œä½†æ˜¯ï¼Œå‡èšåŠ›ä¸€æ—¦å½¢æˆï¼Œå°±ä¼šäº§ç”Ÿä¸€ç§ç¥å¥‡çš„é­”åŠ›ã€‚å›¢é˜Ÿæˆå‘˜ä¼šä¸€èµ·åšè®¡åˆ’ï¼Œä¸€èµ·è§£å†³é—®é¢˜ï¼Œä¸€èµ·é¢å¯¹é—®é¢˜ï¼Œ**ä¸€èµ·è§£å†³ä¸€åˆ‡**ã€‚\n\n> ã€Šä»£ç ç²¾è¿›ä¹‹è·¯ã€‹\n\n## å‘½å\n\nä¸€èˆ¬æ¥è¯´æˆ‘ä»¬éƒ½çŸ¥é“å‘½ååº”è¯¥æœ‰å¯è¯»æ€§ï¼Œä½†æ˜¯åƒè¿™é‡Œä»‹ç»è¿™ä¹ˆè¯¦ç»†çš„å¹¶ä¸å¤šã€‚\n\nä¾‹å¦‚æˆ‘ä»¬é’ˆå¯¹å‘½åå¯ä»¥é€šè¿‡å›ºå®šåˆ†æ®µé™å®šè¯çš„æ–¹å¼è¿›è¡Œç»Ÿä¸€ï¼š\n\n* `[åŠ¨ä½œ][å¯¹è±¡][èŒƒç•´]`ï¼Œæ¥ç»Ÿä¸€æˆ‘ä»¬çš„å‘½åï¼Œä¾‹å¦‚ `getRevenueTotal(è·å–æ€»æ”¶å…¥)`ã€‚\n\n## æ³¨é‡Š\n\n* æ³¨é‡Šå¦‚æœæ˜¯å¯¹æ‰§è¡Œè¿‡ç¨‹çš„ç®€å•å¤è¿°ï¼Œé‚£ä¹ˆè¿™æ ·çš„æ³¨é‡Šä¸åº”è¯¥å­˜åœ¨ã€‚\n* æˆ‘ä»¬å¯ä»¥é€šè¿‡å‡½æ•°å’Œä¸­é—´å˜é‡çš„å°è£…ï¼Œæ¥å‡å°‘å¯ä»¥é¿å…çš„æ³¨é‡Šã€‚\n\n## é”™è¯¯å’Œé”™è¯¯ç \n\næˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼å¤„ç†é”™è¯¯ï¼ˆä¸­åå°ç³»ç»Ÿæ¯”è¾ƒåˆé€‚ï¼‰ï¼š\n\n1. ç¨‹åºè¿è¡ŒæœŸé—´çš„é”™è¯¯ï¼Œä¸€èˆ¬æˆ‘ä»¬å¯ä»¥é€šè¿‡ Error æ‰“å°åˆ°æ—¥å¿—ä¸­ï¼Œè€Œä¸”è¿™ç±»é”™è¯¯ï¼Œæœ€å¥½å’ŒæŠ¥è­¦ç³»ç»Ÿè¿›è¡Œå¯¹æ¥ï¼Œç›´æ¥è¾“å‡ºåˆ°æŠ¥è­¦ç³»ç»Ÿä¸­ã€‚\n2. API/æœåŠ¡è°ƒç”¨é”™è¯¯ï¼Œè¿™ç§é”™è¯¯ä¸€èˆ¬é€šè¿‡é”™è¯¯ç è¿”å›ç»™è°ƒç”¨ç«¯çš„åŒæ—¶ï¼Œä¹Ÿéœ€è¦åœ¨æ—¥å¿—åšå¥½è®°å½•ã€‚\n\n> å…³äºé”™è¯¯ç ï¼šé”™è¯¯ç æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ•°å­—æˆ–è€…æ˜¾ç¤ºåŒ–é”™è¯¯ç ï¼Œæ•°å­—çš„åå¤„å³æˆ‘ä»¬éœ€è¦é¢å¤–ç»´æŠ¤é”™è¯¯ç è¡¨ï¼Œè°ƒç”¨è€…å¯èƒ½å¹¶éæˆ‘ä»¬å›¢é˜Ÿï¼Œæœ‰å¯èƒ½é€ æˆæ²Ÿé€šéšœç¢ã€‚\n> å› æ­¤ï¼Œæ›´å»ºè®®ä½¿ç”¨**æ˜¾ç¤ºåŒ–é”™è¯¯ç **ï¼Œå¹¶ä¸”å¯ä»¥åšä¸€ä¸ªçº¦å®šï¼šP ä»£è¡¨å‚æ•°å¼‚å¸¸ï¼ŒB ä»£è¡¨ä¸šåŠ¡å¼‚å¸¸ï¼ŒS ä»£è¡¨ç³»ç»Ÿå¼‚å¸¸ï¼Œä¾‹å¦‚ï¼šP_Customer_NameIsNull å®¢æˆ·å§“åä¸èƒ½ä¸ºç©º\n\n## ä»£ç ä¸­çš„ç ´çª—æ•ˆåº”\n\nç ´çª—æ•ˆåº”åœ¨ä»£ç ä¸­å¾ˆå¸¸è§ï¼Œé€šå¸¸åœ¨æˆ‘ä»¬å®Œæˆä¸€ä¸ªåŠŸèƒ½çš„æ—¶å€™ï¼Œéƒ½æ˜¯åŸºäºç°æœ‰ä»£ç çš„æ”¹åŠ¨ï¼Œå¦‚æœä½ å¯ä»¥åŸºäºä¸€ä¸ªç°æœ‰ä»£ç çš„ä¸è‰¯è®¾è®¡å®ŒæˆåŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼Œåœ¨å·²ç»å¾ˆæ··ä¹±çš„äº‹ä»¶è®¢é˜…ç±»å¢åŠ ä¸€ä¸ª Enumã€åœ¨å·²ç»å¾ˆå†—é•¿çš„ Http è¯·æ±‚åˆ—è¡¨å¤åˆ¶ä¸€ä¸ªæ–°çš„å‡ºæ¥ï¼‰ï¼Œé‚£ä¹ˆå¤§æ¦‚ç‡ä½ ä¼šè¿™æ ·åšè€Œä¸æ˜¯é‡æ„ï¼Œ**ç‰¹åˆ«æ˜¯å½“è¿™ä¸ªä¸è‰¯è®¾è®¡ä¸æ˜¯ä½ æœ€åˆå†™çš„æ—¶å€™ï¼Œå°±æ›´åŠ å¯ä»¥å¿ƒå®‰ç†å¾—çš„æ”¹ä»£ç è€Œæ²¡æœ‰ä»»ä½•è´Ÿç½ªæ„Ÿï¼Œç”šè‡³åœ¨ Code Review çš„æ—¶å€™éƒ½å¯ä»¥æœ‰å……è¶³çš„ç†ç”±ï¼šå®ƒå·²ç»æ˜¯è¿™æ ·äº†ï¼Œè¿™æ¬¡å…ˆä¸Šï¼Œå°†æ¥æ‰¾ä¸ªæ—¶é—´æ•´ä½“é‡æ„æ‰è¡Œã€‚**\n\n## SLAP\n\nSLAPï¼šSingle Level of Abstraction Principleï¼ŒæŠ½è±¡å±‚æ¬¡ä¸€è‡´æ€§\n\nSLAP è¦æ±‚å‡½æ•°ä½“ä¸­çš„å†…å®¹å¿…é¡»åœ¨åŒä¸€ä¸ªæŠ½è±¡å±‚æ¬¡ä¸Šï¼Œå¦‚æœé«˜å±‚æ¬¡æŠ½è±¡å’Œä½å±‚æ¬¡ç»†èŠ‚æ‚ç³…åœ¨ä¸€èµ·ï¼Œå°±ä¼šæ˜¾å¾—å‡Œä¹±ï¼Œéš¾ä»¥ç†è§£ã€‚\n\n## å¦‚ä½•è¿°èŒ\n\n* æ–¹æ³•1: **æå‡ºé—®é¢˜ï¼Œå®šä¹‰é—®é¢˜ï¼Œåˆ†æé—®é¢˜ï¼Œè§£å†³é—®é¢˜ï¼Œæœ€åå±•æœ›æœªæ¥**ã€‚è¿™ä¸ªä¹Ÿæ˜¯éº¦è‚¯é”¡å¸¸ç”¨çš„æ–¹æ³•ã€‚\n* æ–¹æ³•2: æˆ‘ä»¬è¯´äº‹æƒ…çš„æ—¶å€™ï¼Œåº”è¯¥åƒç”µå½±é•œå¤´ä¸€æ ·ï¼Œå…ˆç”±è¿œæ‹‰è¿‘ï¼Œå†ç”±è¿‘æ‹‰è¿œã€‚ä»å®è§‚èƒŒæ™¯ï¼Œåˆ°æ€ä¹ˆåšçš„ï¼Œåˆ°ç»“æœå’Œæ€è€ƒã€‚\n\n\n","tags":["è¯»ä¹¦ç¬”è®°"]},{"title":"ã€Šé‡æ„ã€‹-è¯»ä¹¦ç¬”è®°","url":"/2022/01/02/é‡æ„-è¯»ä¹¦ç¬”è®°/","content":"\n## å¼€å§‹é‡æ„\n\nå¦‚æœä½ è¦ç»™ç¨‹åºæ·»åŠ ä¸€ä¸ªç‰¹æ€§ï¼Œä½†å‘ç°ä»£ç å› ç¼ºä¹è‰¯å¥½çš„ç»“æ„è€Œä¸æ˜“äºè¿›è¡Œæ›´æ”¹ï¼Œé‚£å°±å…ˆé‡æ„é‚£ä¸ªç¨‹åºï¼Œä½¿å…¶æ¯”è¾ƒå®¹æ˜“æ·»åŠ è¯¥ç‰¹æ€§ï¼Œç„¶åå†æ·»åŠ è¯¥ç‰¹æ€§ã€‚\né‡æ„å‰ï¼Œå…ˆæ£€æŸ¥è‡ªå·±æ˜¯å¦æœ‰ä¸€å¥—å¯é çš„æµ‹è¯•é›†ï¼Œè¿™äº›æµ‹è¯•å¿…é¡»æœ‰è‡ªæˆ‘æ£€è§†çš„èƒ½åŠ›ã€‚\n\n> äº‹å®ä¸Šå¾ˆå¤šæ—¶å€™ï¼Œæµ‹è¯•é›†éƒ½æ˜¯è¢«æˆ‘ä»¬å¿½ç•¥çš„\n\nè¥åœ°æ³•åˆ™ï¼šä¿è¯ä½ ç¦»å¼€çš„æ—¶å€™ä»£ç åº“ä¸€å®šæ¯”åŸæ¥çš„æ›´åŠ å¥å£®ã€‚\n\nä»€ä¹ˆæ˜¯é‡æ„ï¼Ÿæ ¹æ®é‡æ„è¿™æœ¬ä¹¦çš„å®šä¹‰ï¼Œå¦‚æœæœ‰äººè¯´ä»–ä»¬çš„ä»£ç åœ¨é‡æ„è¿‡ç¨‹ä¸­æœ‰ä¸€ä¸¤å¤©çš„æ—¶é—´æ˜¯ä¸å¯ç”¨çš„ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç¡®å®šï¼Œä»–ä»¬åœ¨åšçš„äº‹æƒ…ä¸æ˜¯é‡æ„ã€‚\n\n## ä½•æ—¶é‡æ„\n\näº‹ä¸è¿‡ä¸‰æ³•åˆ™ï¼ˆRule of Threeï¼‰ï¼šç¬¬ä¸€æ¬¡åšæŸä»¶äº‹æƒ…çš„æ—¶å€™åªç®¡å»åšï¼Œç¬¬äºŒæ¬¡åšæŸä»¶äº‹æƒ…çš„æ—¶å€™ä¼šäº§ç”Ÿåæ„Ÿï¼Œä½†æ— è®ºå¦‚ä½•è¿˜æ˜¯å¯ä»¥å»åšï¼Œç¬¬ä¸‰æ¬¡å†åšç±»ä¼¼çš„äº‹æƒ…ï¼Œä½ å°±åº”è¯¥é‡æ„ã€‚\n\n> åœ¨ã€Šä»£ç ç²¾è¿›ä¹‹è·¯ã€‹è¿™æœ¬ä¹¦ä¸­ï¼Œä¹Ÿæåˆ°äº†è¿™ä¸ªåŸåˆ™ã€‚\n\nå¦å¤–çš„ä¸€ä¸ªæ—¶æœºæ˜¯ï¼Œæ¯æ¬¡è¦ä¿®æ”¹æ—¶ï¼Œé¦–å…ˆä»¤ä¿®æ”¹å¾ˆå®¹æ˜“ï¼ˆè­¦å‘Šï¼šè¿™ä»¶äº‹æœ‰æ—¶å€™ä¼šå¾ˆéš¾ï¼‰ï¼Œç„¶åå†è¿›è¡Œè¿™æ¬¡çš„ä¿®æ”¹ã€‚\n\n> æ¯”å¦‚ï¼Œç¬”è€…æœ€è¿‘åœ¨åšä¸€ä¸ªé•¿é“¾æ¥å®¢æˆ·ç«¯ SDKï¼Œæœ€åˆè¿™ä¸ª SDK åŠŸèƒ½å¾ˆç®€å•ï¼Œæˆ‘ç›´æ¥åŠ åŠŸèƒ½å³å¯ï¼Œåé¢æœ‰ä¸€æ¬¡å½“æˆ‘è¦ä¿®æ”¹çš„æ—¶å€™ï¼Œæˆ‘å‘ç°è¿™ä¸ª SDK çš„ä¿®æ”¹å·²ç»å˜å¾—å¼‚å¸¸å¤æ‚äº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘çŸ¥é“æˆ‘åº”è¯¥é‡æ„äº†ã€‚\n\n## é‡æ„æ³•åˆ™\n\nè¿™é‡Œå¯¹ä¸€äº›æˆ‘ä»¬å®é™…åœºæ™¯ä¸­é‡åˆ°ï¼Œä½†æ˜¯é€šå¸¸ä¼šè¢«æˆ‘ä»¬å¿½è§†çš„ä¸€äº›æ³•åˆ™è¿›è¡Œåˆ—ä¸¾ã€‚\n\n### éœ°å¼¹å¼ä¿®æ”¹ \n\nå¦‚æœæˆ‘ä»¬ä»£ç ä¸­çš„æ¨¡å—ç‰¹åˆ«å¤šï¼Œå¦‚æœæˆ‘ä»¬æ¯æ¬¡é‡åˆ°ä¸€ä¸ªå˜åŒ–éƒ½éœ€è¦åœ¨ä¸åŒçš„å°æ¨¡å—ä¸­åšè®¸å¤šå°ä¿®æ”¹ï¼Œæˆ‘ä»¬æ‰€é¢ä¸´çš„åå‘³é“å°±æ˜¯éœ°å¼¹å¼ä¿®æ”¹ã€‚\nè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦æ€è€ƒé‡æ„ï¼Œæœ€å¥½æˆ‘ä»¬ä¸åŒçš„æ¨¡å—éƒ½æ˜¯æ­£äº¤çš„ã€‚\n\n### æ…é‡æ³¨é‡Š\n\næœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬å†™æ³¨é‡Šæ˜¯å› ä¸ºè¿™æ®µå¯¹åº”çš„ä»£ç é€»è¾‘å¾ˆç³Ÿç³•ã€‚\nå› æ­¤å½“ä½ æ„Ÿè§‰éœ€è¦æ’°å†™æ³¨é‡Šçš„æ—¶å€™ï¼Œè¯·å…ˆå°è¯•é‡æ„ï¼Œè¯•ç€å°†æ‰€æœ‰çš„æ³¨é‡Šå˜æˆå¤šä½™ã€‚\n\n### æç‚¼å˜é‡\n\nå¯¹äºå¤æ‚è¯­å¥ï¼Œæç‚¼å˜é‡å¯ä»¥å¢åŠ å¯è¯»æ€§ã€‚\n\n","tags":["è¯»ä¹¦ç¬”è®°"]},{"title":"ã€Šæ¶æ„æ•´æ´ä¹‹é“ã€‹-è¯»ä¹¦ç¬”è®°","url":"/2021/12/26/æ¶æ„æ•´æ´ä¹‹é“-è¯»ä¹¦ç¬”è®°/","content":"\nè¿™æœ¬ä¹¦ä¹‹å‰åˆšå·¥ä½œçš„æ—¶å€™ç•¥æœ‰è€³é—»ï¼Œä¸è¿‡å½“æ—¶ç®€å•ç¿»é˜…äº†ä¸‹ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆå…±é¸£ï¼Œå¯èƒ½æ˜¯ç¼–ç¨‹ç»éªŒå¤ªå°‘å¯¼è‡´ï¼Œä½†æœ€è¿‘æˆ‘å†é‡è¯»è¿™æœ¬ä¹¦çš„æ—¶å€™ï¼Œæ„Ÿè§‰ä¹‹å‰è‡ªå·±æˆ–æ‰€åœ¨å›¢é˜Ÿç¡®å®è¸©äº†ä¸å°‘ç±»ä¼¼çš„å‘ï¼Œä¹Ÿæ¸æ¸äº†è§£åˆ°ï¼Œå¾ˆå¤šå¤æ‚çš„é¡¹ç›®å’Œå·¥ç¨‹èƒŒåï¼Œå…¶å®å¾€å¾€æ˜¯ä¸€äº›æœ€æœ´ç´ çš„é“ç†ï¼Œè½¯ä»¶å·¥ç¨‹çš„å‘å±•ä¹Ÿå¹¶æ²¡æœ‰ä¸Šå±‚æ¡†æ¶çš„å‘å±•é‚£ä¹ˆå¿«ã€‚\n\nä¹Ÿå› æ­¤ï¼Œæœ¬ç¯‡åšå®¢ä½œä¸ºä¸€ä¸ªè¯»ä¹¦ç¬”è®°æ€§è´¨ï¼Œå¯èƒ½æœ‰äº›åœ°æ–¹ä¹Ÿå¹¶éè¶³å¤Ÿè¿è´¯ã€‚\n\n## å¦‚ä½•çœ‹å¾…è½¯ä»¶æ¶æ„è®¾è®¡\n\nè½¯ä»¶æ¶æ„è®¾è®¡çš„ç»ˆæç›®æ ‡ï¼šç”¨æœ€å°çš„äººåŠ›æˆæœ¬æ¥æ»¡è¶³æ„å»ºå’Œç»´æŠ¤è¯¥ç³»ç»Ÿçš„éœ€æ±‚ã€‚\n\nå¾ˆå¤šæ—¶å€™ï¼Œå¯¹äºä¸€ä¸ªç³»ç»Ÿï¼Œä¸€å¼€å§‹æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡æ¥è¿‘ 100%ï¼Œç„¶è€Œä¼´éšäº§å“çš„æ¯æ¬¡å‘å¸ƒï¼Œç”Ÿäº§åŠ›ç›´çº¿ä¸‹é™ã€‚å·¥ç¨‹å¸ˆçš„å¤§éƒ¨åˆ†æ—¶é—´éƒ½æ˜¯æ¶ˆè€—åœ¨å¯¹ç°æœ‰ç³»ç»Ÿçš„ä¿®ä¿®è¡¥è¡¥ä¸Šé¢ï¼Œè€Œä¸æ˜¯çœŸæ­£å®Œæˆå®é™…çš„åŠŸèƒ½ã€‚æ‹†ä¸œå¢™è¡¥è¥¿å¢™ï¼Œå‘¨è€Œå¾€å¤ã€‚å…¬å¸éœ€è¦çš„äººåŠ›æˆæœ¬ä¹Ÿå› æ­¤å˜å¤šäº†ï¼Œä½†æ˜¯æ•ˆç›Šå´æ²¡æœ‰æå‡ã€‚\n\nåˆçº§å·¥ç¨‹å¸ˆæ€»æ˜¯ä¼šçŠ¯çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šæŒç»­ä½ä¼°è‰¯å¥½çš„è®¾è®¡ï¼Œæ•´æ´çš„ä»£ç çš„é‡è¦æ€§ï¼Œå¹¶ä¸”æ™®éé‡‡ç”¨ä¸€ç§è¯æœ¯æ¥æ¬ºéª—è‡ªå·±ï¼šæˆ‘ä»¬å¯ä»¥æœªæ¥åœ¨é‡æ„ä»£ç ï¼Œäº§å“ä¸Šçº¿æœ€é‡è¦ã€‚è€Œå®é™…ä¸Šï¼Œäº§å“ä¸Šçº¿ä¹‹åç–²äºåº”ä»˜æ–°éœ€æ±‚å·²ç»å¾ˆç´¯äº†ï¼Œå°±å¾ˆéš¾æœ‰é‡æ„çš„æ—¶æœºã€‚\n\nå®é™…ä¸Šï¼Œä¸€èˆ¬è½¯ä»¶å¼€å‘éƒ½ä¼šè¢«è®¾è®¡æˆå¦‚ä¸‹ä¸‰ä¸ªé˜¶æ®µï¼Œè¿™å¯èƒ½å¹¶æ²¡æœ‰é”™ï¼š\n\n1. å…ˆè®©ä»£ç å·¥ä½œèµ·æ¥\n2. è¯•å›¾è®©å®ƒå˜å¥½ï¼šé€šè¿‡ä¼˜åŒ–å’Œé‡æ„ï¼Œè®©äººæ›´å¥½åœ°ç†è§£ä»£ç ï¼Œå¹¶ä¸”é€‚åº”æ–°éœ€æ±‚ã€‚\n3. è¯•ç€è®©å®ƒè¿è¡Œçš„æ›´å¿«\n\næ‰€ä»¥ï¼Œæˆ‘ä»¬ç¡®å®éœ€è¦ç†è§£æ•´æ´æ¶æ„çš„é‡è¦æ€§ï¼Œé¿å…æˆ‘ä»¬åœ¨ 1 å’Œ 2 å¾ªç¯å¾€å¤ã€‚\n\nè½¯ä»¶è®¾è®¡çš„ç¬¬ä¸€æ¡åŸåˆ™ï¼šä¸ç®¡æ˜¯ä¸ºäº†å¯æµ‹è¯•æ€§è¿˜æ˜¯å…¶ä»–ä»€ä¹ˆä¸œè¥¿â€”â€”**æ˜¯ä¸å˜çš„ï¼Œå°±ä¸è¦ä¾èµ–äºå¤šå˜çš„ä¸œè¥¿ã€‚**\n\n## è½¯ä»¶ç³»ç»Ÿ\n\nè½¯ä»¶ç³»ç»Ÿçš„ä»·å€¼ç»´åº¦ï¼šè¡Œä¸ºå’Œæ¶æ„ã€‚\n\n**å˜æ›´çš„å®æ–½éš¾åº¦åº”è¯¥å’Œå˜æ›´çš„èŒƒç•´æˆç­‰æ¯”å…³ç³»ï¼Œè€Œä¸å˜æ›´çš„å…·ä½“è¡Œä¸ºæ— å…³**ã€‚\n> æœ‰çš„æ—¶å€™ï¼Œäº§å“ç»ç†ä¼šè¡¨ç¤ºï¼Œæˆ‘å°±æ”¹ä¸€ä¸ªå°ç‚¹ï¼Œä¸ºä»€ä¹ˆéœ€è¦å‡ å¤©æ—¶é—´ï¼Ÿå¼€å‘äººå‘˜ä¼šæ‰¾ä¸€å¤§å †ç†ç”±ï¼Œé€šå¸¸ä¸ä¼šæåŠæ¶æ„çš„ä¸åˆç†æ€§ã€‚å®é™…ä¸Šè¿™ç§ç°è±¡åœ¨æˆ‘æ¯•ä¸šå…¥èŒçš„ç¬¬ä¸€å®¶å…¬å¸æ—¶æœ‰å‘ç”Ÿã€‚\n\n## ç¼–ç¨‹èŒƒå¼\n\nç›®å‰ï¼Œæˆ‘ä»¬ä¸»è¦æœ‰ä¸‰ä¸ªç¼–ç¨‹èŒƒå¼ï¼šç»“æ„åŒ–ç¼–ç¨‹ï¼Œé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œå‡½æ•°å¼ç¼–ç¨‹ã€‚è¿™äº›ç¼–ç¨‹èŒƒå¼éƒ½æ˜¯åœ¨ 20 ä¸–çºªè¢«æå‡ºæ¥çš„ï¼Œè€Œä¸”åœ¨æœ‰é™çš„æ—¶é—´ä¸­ä¼°è®¡ä¹Ÿä¸ä¼šæ–°å¢ç¼–ç¨‹èŒƒå¼äº†ã€‚\n\n* ç»“æ„åŒ–ç¼–ç¨‹ï¼šif/then/else å’Œ do/while/util\n* é¢å‘å¯¹è±¡ç¼–ç¨‹\n* å‡½æ•°å¼ç¼–ç¨‹ï¼šå€¼ä¸å¯å˜ï¼Œå¯¹èµ‹å€¼è¿›è¡Œäº†é™åˆ¶å’Œè§„èŒƒ\n\nä¸‰ä¸ªç¼–ç¨‹èŒƒå¼ï¼Œåˆ†åˆ«é™åˆ¶äº† goto è¯­å¥ã€å‡½æ•°æŒ‡é’ˆå’Œèµ‹å€¼è¯­å¥çš„ä½¿ç”¨ã€‚\n\n### ç»“æ„åŒ–ç¼–ç¨‹\n\nç¨‹åºå‘˜å¯ä»¥ç”¨ä»£ç å°†ä¸€äº›å·²ç»è¯æ˜å¯ç”¨çš„ç»“æ„ä¸²è”èµ·æ¥ï¼Œåªè¦è‡ªè¡Œè¯æ˜è¿™äº›é¢å¤–ä»£ç æ˜¯æ­£ç¡®çš„ï¼Œå°±å¯ä»¥æ¨å¯¼å‡ºæ•´ä¸ªç¨‹åºçš„æ­£ç¡®æ€§ã€‚\n\ngoto è¯­å¥ï¼Œè®©æˆ‘ä»¬çš„ç¨‹åºå¾ˆéš¾è¢«åˆ†æˆè¿™ç§å°å—ã€‚\n\nå…³äºéªŒè¯ï¼šç§‘å­¦ç†è®ºå’Œç§‘å­¦å®šå¾‹çš„ç‰¹ç‚¹ï¼šä»–ä»¬å¯ä»¥è¢«è¯ä¼ªï¼Œä½†æ˜¯æ²¡æœ‰åŠæ³•è¢«è¯æ˜ï¼Œå®é™…ä¸Šç°æœ‰çš„ç¼–ç¨‹å¤§éƒ¨åˆ†ä¹Ÿé‡‡ç”¨äº†è¿™ç§ç†å¿µï¼Œæˆ‘ä»¬æ²¡ç”¨ä½¿ç”¨å®Œæ•´çš„å½¢å¼åŒ–è¯æ˜ï¼Œè€Œæ˜¯ä½¿ç”¨æµ‹è¯•ç”¨ä¾‹ï¼Œæµ‹è¯•æ²¡æœ‰é—®é¢˜åï¼Œå³å‘å¸ƒåˆ°çº¿ä¸Šã€‚\n\n### é¢å‘å¯¹è±¡\n\n* å°è£…ã€ç»§æ‰¿ã€å¤šæ€éƒ½ä¸æ˜¯é¢å‘å¯¹è±¡åˆ›é€ å‡ºæ¥çš„ï¼Œä½†æ˜¯ç¡®å®ä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿äº†ã€‚\n* ä¾èµ–åè½¬ä¹Ÿé€šå¸¸æ˜¯é¢å‘å¯¹è±¡çš„ç‰¹ç‚¹ã€‚\n* ç‹¬ç«‹éƒ¨ç½²ï¼šå½“æŸä¸ªç»„ä»¶çš„æºä»£ç éœ€è¦ä¿®æ”¹ï¼Œä»…ä»…éœ€è¦é‡æ–°éƒ¨ç½²è¯¥ç»„ä»¶å³å¯ï¼Œä¸éœ€è¦ä¿®æ”¹å…¶ä»–ç»„ä»¶ã€‚\n\n**é¢å‘å¯¹è±¡ç¼–ç¨‹å°±æ˜¯ä»¥å¤šæ€ä¸ºæ‰‹æ®µæ¥å¯¹æºä»£ç ä¸­çš„ä¾èµ–å…³ç³»è¿›è¡Œæ§åˆ¶çš„èƒ½åŠ›ï¼Œè¿™ç§èƒ½åŠ›è®©è½¯ä»¶æ¶æ„å¸ˆèƒ½å¤Ÿæ„å»ºå‡ºæŸç§æ’ä»¶ç»“æ„ï¼Œè®©é«˜å±‚ç­–ç•¥æ€§çš„ç»„ä»¶å’Œåº•å±‚å®ç°çš„ç»„ä»¶ç›¸åˆ†ç¦»ï¼Œåº•å±‚ç»„ä»¶å¯ä»¥è¢«ç¼–è¯‘æˆæ’ä»¶ï¼Œå®ç°ç‹¬ç«‹äºé«˜å±‚ç»„ä»¶çš„å¼€å‘å’Œéƒ¨ç½²ã€‚**\n\n### å‡½æ•°å¼ç¼–ç¨‹\n\n* æ‰€æœ‰çš„ç«äº‰é—®é¢˜ã€æ­»é”é—®é¢˜ã€å¹¶å‘æ›´æ–°é—®é¢˜éƒ½æ˜¯ç”±å¯å˜å˜é‡å¯¼è‡´çš„ï¼Œå¦‚æœå˜é‡æ°¸è¿œä¸èƒ½è¢«ç¯¡æ”¹ï¼Œé‚£å°±ä¸å¯èƒ½äº§ç”Ÿç«äº‰æˆ–å¹¶å‘æ›´æ–°çš„é—®é¢˜ã€‚å¦‚æœé”çš„çŠ¶æ€æ˜¯ä¸å¯å˜çš„ï¼Œé‚£å°±æ°¸è¿œä¸ä¼šäº§ç”Ÿæ­»é”é—®é¢˜ã€‚\n* ä¸€ä¸ªä¸ªæ¶æ„è®¾è®¡è‰¯å¥½çš„åº”ç”¨ç¨‹åºåº”è¯¥å°†çŠ¶æ€ä¿®æ”¹çš„éƒ¨åˆ†å’Œä¸éœ€è¦ä¿®æ”¹çŠ¶æ€çš„éƒ¨åˆ†éš”ç¦»æ‰¿æ‹…åº¦çš„ç»„ä»¶ï¼Œç„¶åé€šè¿‡åˆé€‚çš„æœºåˆ¶ä¿æŠ¤å¯å˜é‡ã€‚\n* è½¯ä»¶æ¶æ„å¸ˆåº”è¯¥ç€åŠ›äºå°†å¤§éƒ¨åˆ†å¤„ç†é€»è¾‘éƒ½å½’äºä¸å¯å˜ç»„ä»¶ä¸­ï¼Œå¯å˜çŠ¶æ€ç»„ä»¶çš„é€»è¾‘è¶Šå°‘è¶Šå¥½ã€‚\n\nä¸€ç§å‡½æ•°å¼ç¼–ç¨‹ç†å¿µçš„å¼€å‘æ–¹å¼ï¼š\näº‹ä»¶æº¯æºï¼šæˆ‘ä»¬åªå­˜å‚¨äº‹åŠ¡è®°å½•ï¼Œä¸å­˜å‚¨å…·ä½“çŠ¶æ€ï¼Œå½“éœ€è¦è®¡ç®—å…·ä½“çŠ¶æ€çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦é‡å¤´å¼€å§‹è®¡ç®—æ‰€æœ‰çš„äº‹åŠ¡å³å¯ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹ŸæŠŠ CURD å˜æˆäº† CRã€‚\n\n\n## SOLID åŸåˆ™\n\næˆ‘ä»¬ä¸ºè½¯ä»¶æ„å»ºä¸­å±‚ç»“æ„çš„ä¸»è¦ç›®æ ‡ï¼š\n\n1. ä½¿è½¯ä»¶å¯å®¹å¿è¢«æ”¹åŠ¨ã€‚\n2. ä½¿è½¯ä»¶æ›´å®¹æ˜“è¢«ç†è§£ã€‚\n3. æ„å»ºå¯åœ¨å¤šä¸ªè½¯ä»¶ç³»ç»Ÿä¸­å¤ç”¨çš„ç»„ä»¶ã€‚\n\nSOLID åŸåˆ™ åˆ†ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š\n\n* SRPï¼šå•ä¸€èŒè´£åŸåˆ™ï¼Œä»»ä½•ä¸€ä¸ªè½¯ä»¶æ¨¡å—éƒ½åº”è¯¥æœ‰ä¸”åªæœ‰ä¸€ä¸ªè¢«ä¿®æ”¹çš„åŸå› ã€‚é¿å…å¤šäººä¸ºäº†ä¸åŒçš„ç›®çš„ä¿®æ”¹åŒä¸€ä»½åŸä»£ç æ–‡ä»¶ã€‚\n* OCPï¼šå¼€æ”¾å°é—­åŸåˆ™ï¼Œé€šè¿‡æ–°å¢ä»£ç æ¥ä¿®æ”¹åŸæœ‰çš„è¡Œä¸ºï¼Œè€Œéåªé ä¿®æ”¹æºä»£ç ã€‚\n* LSPï¼šé‡Œæ°æ›¿æ¢åŸåˆ™ï¼Œç»„ä»¶æ–¹ä¾¿è¢«æ›¿æ¢ï¼Œæ¯ä¸€å¤„ä½¿ç”¨çˆ¶ç±»å¯¹è±¡çš„åœ°æ–¹ï¼Œå¯ä»¥ä½¿ç”¨å…¶å­ç±»å¯¹è±¡è¿›è¡Œæ›¿æ¢ï¼Œè€Œä¿æŒå…¶è¡Œä¸ºä¸å˜ã€‚\n* ISPï¼šæ¥å£éš”ç¦»åŸåˆ™ï¼Œé¿å…ä¸å¿…è¦çš„ä¾èµ–ã€‚\n* DIPï¼šä¾èµ–åè½¬åŸåˆ™ï¼Œé«˜å±‚ä»£ç ä¸åº”è¯¥ä¾èµ–åº•å±‚ç»†èŠ‚ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦è®¾è®¡ä¸€ä¸ªçµæ´»çš„ç³»ç»Ÿï¼Œåœ¨æºä»£ç å±‚æ¬¡çš„ä¾èµ–å…³ç³»ä¸­å°±åº”è¯¥å¤šå¼•ç”¨æŠ½è±¡ç±»å‹ï¼Œè€Œéå…·ä½“å®ç°ã€‚\n  * ä¼˜ç§€çš„è½¯ä»¶æ¶æ„å¸ˆä¼šèŠ±è´¹å¾ˆå¤§åŠ›æ°”æ¥è®¾è®¡æ¥å£ï¼Œä»¥å‡å°‘æœªæ¥å¯¹å…¶è¿›è¡Œçš„æ”¹åŠ¨ã€‚æ¯•ç«Ÿåœ¨ä¸ä¿®æ”¹å€Ÿå£çš„æƒ…å†µä¸‹ä¸ºè½¯ä»¶å¢åŠ æ–°çš„åŠŸèƒ½æ˜¯è½¯ä»¶è®¾è®¡çš„åŸºç¡€å¸¸è¯†ã€‚\n\n> å®é™…ä¸Šæˆ‘ä»¬åœ¨å®ç° TS åº“ä»£ç çš„æ—¶å€™ç»å¸¸ç”¨åˆ° DIPï¼Œæ¯”å¦‚æˆ‘ä»¬åº•å±‚ä»£ç éœ€è¦ç”¨åˆ°ä¸Šå±‚çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬é€šå¸¸å®šä¹‰ä¸€ä¸ªæŠ½è±¡ç±»æˆ–è€…æŠ½è±¡å‡½æ•°ï¼Œç„¶åç”±ä¸Šå±‚æ¥å®ç°ï¼Œè¿™ç§åœºæ™¯å³æ˜¯ DIPã€‚\n> ä¾‹å¦‚ï¼Œåœ¨æˆ‘ä»¬å†™ä¸€ä¸ªåº“çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šå®šä¹‰ä¸€ä¸ªæŠ½è±¡ï¼Œç„¶åç”±å¤–å±‚ä¼ å…¥å®ç°è¿™ä¸ª logï¼Œè€Œä¸æ˜¯åœ¨åº“ä»£ç ä¸­ç›´æ¥ä¾èµ–æŸç§ log å®ç°ï¼ˆå¯ä»¥æœ‰ä¸€ä¸ªé»˜è®¤çš„å®ç°ï¼‰ï¼Œè¿™ä¸ªå³æ˜¯ DIP çš„ä¸€ä¸ªè¿ç”¨ã€‚\n\n## ç»„ä»¶æ„å»ºåŸåˆ™\n\nç»„ä»¶æ˜¯è½¯ä»¶çš„éƒ¨ç½²å•å…ƒã€‚\n\n* REPï¼šå¤ç”¨/å‘å¸ƒåŸåˆ™ï¼šè½¯ä»¶å¤ç”¨çš„æœ€å°ç²’åº¦åº”ç­‰åŒäºå…¶å‘å¸ƒçš„æœ€å°ç²’åº¦ã€‚\n* CCPï¼šå…±åŒé—­åŒ…åŸåˆ™ï¼šæˆ‘ä»¬åº”è¯¥å°†é‚£äº›ä¼šåŒæ—¶ä¿®æ”¹ï¼Œå¹¶ä¸”ä¸ºç›¸åŒç›®çš„è€Œä¿®æ”¹çš„ç±»æ”¾åˆ°åŒä¸€ä¸ªç»„ä»¶ä¸­ï¼Œè€Œå°†ä¸ä¼šåŒæ—¶ä¿®æ”¹ï¼Œå¹¶ä¸”ä¸ä¼šä¸ºäº†ç›¸åŒç›®çš„è€Œä¿®æ”¹çš„é‚£äº›ç±»æ”¾åˆ°ä¸åŒçš„ç»„ä»¶ä¸­ã€‚\n  * **å¯¹äºå¤§éƒ¨åˆ†é¡¹ç›®æ¥è¯´ï¼Œå¯ç»´æŠ¤æ€§çš„é‡è¦æ€§è¿œè¿œå¤§äºå¤ç”¨æ€§**ï¼ˆç²¾é«“æ‰€åœ¨ï¼Œä»¥å‰ä¸€ç›´è§‰å¾—å¤ç”¨é‡è¦ï¼Œä½†å›å¤´æƒ³æƒ³ï¼Œå¯¹äºä¸€ä¸ªé¡¹ç›®è€Œè¨€ï¼Œç»´æŠ¤æˆæœ¬æ‰æ˜¯æœ€ç›´è§‚çš„æŒ‡æ ‡ï¼Œè¿™é‡Œè®¾è®¡ä¿®æ”¹æ‰€éœ€è¦çš„äººåŠ›æˆæœ¬ï¼Œæœ€ç»ˆè¿˜æ˜¯åˆ©ç›Šå¦‚ä½•æœ€å¤§åŒ–çš„é—®é¢˜ï¼‰\n* CRPï¼šå…±åŒå¤ç”¨åŸåˆ™ï¼šå®é™…ä¸Šæ˜¯ LSP åŸåˆ™çš„ä¸€ä¸ªæ™®é€‚ç‰ˆï¼ŒLSP åŸåˆ™æ˜¯å»ºè®®æˆ‘ä»¬ä¸è¦ä¾èµ–å¸¦æœ‰ä¸éœ€è¦å‡½æ•°çš„ç±»ï¼ŒCRP åŸåˆ™åˆ™æ˜¯å»ºè®®æˆ‘ä»¬ä¸è¦ä¾èµ–å¸¦æœ‰ä¸éœ€è¦çš„ç±»çš„ç»„ä»¶ã€‚\n\nREP å’Œ CCP æ˜¯ç²˜åˆæ€§åŸåˆ™ï¼Œä»–ä»¬ä¼šè®©ç»„ä»¶å˜å¾—æ›´å¤§ï¼Œè€Œ CRP æ˜¯æ’é™¤æ€§åŸåˆ™ï¼Œå®ƒä¼šå°½é‡è®©ç»„ä»¶æ›´å°ã€‚\n\nç»„ä»¶è€¦åˆåŸåˆ™ï¼š\n\n* æ— ä¾èµ–ç¯åŸåˆ™ï¼šæ•´ä½“ä¾èµ–åº”è¯¥æ˜¯ä¸€ä¸ªæœ‰å‘æ— ç¯å›¾ã€‚\n* ç¨³å®šä¾èµ–åŸåˆ™ï¼š**ä¾èµ–å…³ç³»å¿…é¡»è¦æŒ‡å‘æ›´ç¨³å®šçš„æ–¹å‘ã€‚**æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»„ä»¶çš„ä¾èµ–å’Œè¢«ä¾èµ–çš„å…³ç³»è®¡ç®—å®ƒçš„ä½ç½®ç¨³å®šæ€§ã€‚\n* ç¨³å®šæŠ½è±¡åŸåˆ™ï¼šä¸€ä¸ªç»„ä»¶çš„æŠ½è±¡åŒ–ç¨‹åº¦åº”è¯¥ä¸å…¶ç¨³å®šæ€§ä¿æŒä¸€è‡´ã€‚ç¨³å®šçš„ç»„ä»¶åº”è¯¥æ˜¯æŠ½è±¡çš„ï¼Œé‚£ä¹ˆå®ƒçš„ç¨³å®šæ€§å°±ä¸ä¼šå½±å“åˆ°æ‰©å±•æ€§ã€‚\n\n## è½¯ä»¶æ¶æ„æµç¨‹\n\næ•´ä½“åŒ…æ‹¬ï¼šè¿è¡Œã€ç»´æŠ¤ã€å¼€å‘ã€éƒ¨ç½²\n\nä»€ä¹ˆæ˜¯è½¯ä»¶æ¶æ„å¸ˆï¼Ÿè½¯ä»¶æ¶æ„å¸ˆå®é™…ä¸Šåº”è¯¥æ˜¯èƒ½åŠ›æœ€å¼ºçš„ä¸€ç¾¤ç¨‹åºå‘˜ï¼Œä»–ä»¬é€šå¸¸ä¼šåœ¨è‡ªèº«æ‰¿æ¥ç¼–ç¨‹ä»»åŠ¡çš„åŒæ—¶ï¼Œé€æ¸å¼•å¯¼æ•´ä¸ªå›¢é˜Ÿå‘ä¸€ä¸ªèƒ½å¤Ÿæœ€å¤§åŒ–ç”Ÿäº§åŠ›çš„ç³»ç»Ÿè®¾è®¡æ–¹å‘æ¼”è¿›ã€‚æ‰€ä»¥æˆ‘ä»¬æœ‰æ—¶å€™è¯¯ä»¥ä¸ºæ¶æ„å¸ˆå°±ä¸å†™ä»£ç äº†ï¼Œè¿™å½“ç„¶æ˜¯é”™çš„ã€‚\n\nè½¯ä»¶æ¶æ„è®¾è®¡çš„ä¸‰ä¸ªå·¥ä½œï¼šç»„ä»¶çš„åˆ‡åˆ†ï¼Œç»„ä»¶çš„ç»„åˆï¼Œä»¥åŠç»„ä»¶çš„ç›¸äº’é€šä¿¡ã€‚\n\nè½¯ä»¶æ¶æ„è®¾è®¡çš„ç»ˆæç›®æ ‡ï¼šæœ€å¤§åŒ–ç¨‹åºå‘˜çš„ç”Ÿäº§åŠ›ï¼Œæœ€å°åŒ–ç³»ç»Ÿçš„æ€»è¿è¥æˆæœ¬ã€‚\n\nå…³äºéƒ¨ç½²ï¼šä¸€èˆ¬ä¸€ä¸ªç³»ç»Ÿçš„éƒ¨ç½²æˆæœ¬è¶Šé«˜ï¼Œå®ƒçš„å¯ç”¨æ€§å°±è¶Šä½\n\n> ä¾‹å¦‚åœ¨ç³»ç»Ÿæ—©æœŸå¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå†³å®šé‡‡ç”¨æŸç§å¾®æœåŠ¡æ¶æ„ï¼Œä½†å½“æˆ‘ä»¬å®é™…éƒ¨ç½²è¿™ä¸ªç³»ç»Ÿçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¼šå‘ç°å¾®æœåŠ¡çš„æ•°é‡å·²ç»åºå¤§åˆ°ä»¤äººç”Ÿç•ï¼Œè¿™ä¹Ÿå°±æ˜¯ç¬”è€…ä¹‹å‰æ‰€åœ¨å…¬å¸é‡åˆ°çš„é—®é¢˜ï¼šä¸€å¼€å§‹é€šè¿‡ golang å¾®æœåŠ¡å®ç°æ•´ä¸ªç³»ç»Ÿï¼Œåé¢å†³å®šç§æœ‰åŒ–éƒ¨ç½²åï¼Œè¿ç§»æˆæœ¬å·¨å¤§ï¼Œä¸å¾—ä¸è¿›è¡Œäº†å¾®æœåŠ¡çš„åˆå¹¶ã€‚\n\nè¿è¡Œï¼š**å¯¹äºä¸€ä¸ªå› æ¶æ„è®¾è®¡ç³Ÿç³•è€Œæ•ˆç‡ä½ä¸‹çš„ç³»ç»Ÿï¼Œæˆ‘ä»¬é€šå¸¸åªéœ€è¦å¢åŠ æ›´å¤šçš„å­˜å‚¨å™¨ä¸æœåŠ¡å™¨ï¼Œå°±èƒ½å¤Ÿè®©å®ƒåœ†æ»¡çš„å®Œæˆä»»åŠ¡ã€‚å¦å¤–ï¼Œç¡¬ä»¶ä¹Ÿè¿œè¿œæ¯”äººåŠ›ä¾¿å®œï¼Œè¿™ä¹Ÿæ˜¯è½¯ä»¶æ¶æ„å¯¹ç³»ç»Ÿè¿è¡Œçš„å½±å“è¿œè¿œæ²¡æœ‰å®ƒå¯¹å¼€å‘ã€éƒ¨ç½²ã€ç»´æŠ¤çš„å½±å“é‚£ä¹ˆæ·±åˆ»çš„åŸå› **\nç¬”è€…ç°åœ¨ç¡®å®åº”è¯¥æ„è¯†åˆ°è¿™ä¸ªé—®é¢˜ã€‚\n\nåŸºäºä»¥ä¸Šè®¾è®¡çš„æ¶æ„ï¼šUI ç•Œé¢ - ç³»ç»Ÿç‹¬æœ‰çš„ä¸šåŠ¡èƒ½åŠ› - é¢†åŸŸæ™®é€‚çš„ä¸šåŠ¡èƒ½åŠ› - æ•°æ®åº“\n\né‡å¤ï¼š*æ¶æ„å¸ˆç»å¸¸ä¼šé’»è¿›ä¸€ä¸ªç‰›è§’å°–ï¼šå®³æ€•é‡å¤*ã€‚è™½ç„¶è½¯ä»¶ä»£ç ç¼–å†™çš„åŸåˆ™æ˜¯ `don't repeat yourself`ï¼Œä½†æ˜¯æœ‰çš„æ—¶å€™ï¼Œå¯¹äºä¸¤ä¸ªåæœŸå‘å±•åå·®å¾ˆå¤§çš„ç»„ä»¶ï¼Œå¦‚æœåªæ˜¯å­˜åœ¨ä¸€äº›æš‚æ—¶çš„é‡å¤ï¼Œæ˜¯æˆ‘ä»¬å®Œå…¨å¯ä»¥å®¹å¿çš„ã€‚æˆ‘ä»¬åº”è¯¥æ ¹æ®å®é™…æƒ…å†µæ¥å†³å®šæ˜¯å¦è¦é‡å¤ã€‚\n\n## åˆ’åˆ†è¾¹ç•Œ\n\nè½¯ä»¶å¼€å‘æŠ€æœ¯å‘å±•å²ï¼Œå°±æ˜¯ä¸€ä¸ªå¦‚ä½•æƒ³æ³•è®¾æ³•æ–¹ä¾¿å¢åŠ æ’ä»¶ï¼Œä»è€Œæ„å»ºä¸€ä¸ªå¯æ‰©å±•ï¼Œå¯ç»´æŠ¤çš„ç³»ç»Ÿæ¶æ„çš„æ•…äº‹ï¼Œç³»ç»Ÿçš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å¿…é¡»å’Œå…¶ä»–ç»„ä»¶éš”ç¦»ï¼Œä¿æŒç‹¬ç«‹ï¼Œè€Œè¿™äº›å…¶ä»–ç»„ä»¶è¦ä¹ˆæ˜¯å¯ä»¥å»æ‰çš„ï¼Œè¦ä¹ˆæ˜¯æœ‰å¤šé‡å®ç°çš„ã€‚\nåŒæ—¶ï¼Œæ’ä»¶éƒ¨åˆ†çš„å˜æ›´å®é™…ä¸Šä¸åº”è¯¥å½±å“ç³»ç»Ÿæ ¸å¿ƒé€»è¾‘çš„å˜æ›´ã€‚\n\n> è¿™é‡Œä¸¾ä¾‹ï¼šæ¯”å¦‚è¯´å½“æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªå¤šèŠ‚ç‚¹ serverï¼Œå®ƒä¾èµ–ä¸€ä¸ªåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼Œæˆ‘ä»¬ä¸åº”è¯¥åœ¨ server ä¸­æŠŠè¿™ä¸ªåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿé»˜è®¤ä¸º redis, è€Œåº”è¯¥å®šä¹‰æ¥å£èƒ½åŠ›å³å¯ã€‚\n\nå¦‚ä½•åˆ†å±‚ï¼šæœ¬è´¨ä¸Šï¼Œæ‰€æœ‰çš„è½¯ä»¶ç³»ç»Ÿéƒ½æ˜¯ä¸€ç»„ç­–ç•¥è¯­å¥çš„é›†åˆã€‚æˆ‘ä»¬éœ€è¦å°†è¿™äº›ç­–ç•¥å½¼æ­¤åˆ†ç¦»ï¼Œå¹¶ä¸”å°†å®ƒä»¬æŒ‰ç…§å˜æ›´çš„æ–¹å¼è¿›è¡Œé‡æ–°åˆ†ç»„ã€‚å…¶ä¸­å˜æ›´çš„åŸå› ï¼Œæ—¶é—´å’Œå±‚æ¬¡ç›¸åŒçš„ç­–ç•¥åº”è¯¥åˆ†åˆ°ä¸€ä¸ªç»„ä»¶ä¸­ã€‚åä¹‹ï¼Œå˜æ›´åŸå› ã€æ—¶é—´å’Œå±‚æ¬¡ä¸åŒçš„ç­–ç•¥åº”è¯¥åˆ†å±ä¸åŒçš„ç»„ä»¶ã€‚æœ€ç»ˆå®ƒä»¬æ˜¯ä¸€ä¸ªæœ‰å‘æ— ç¯å›¾ã€‚\n\n## æ•´æ´æ¶æ„\n\n* å…­è¾¹å½¢æ¶æ„\n* DCI æ¶æ„\n* BCE æ¶æ„\n\nè¿™äº›æ¶æ„é€šå¸¸æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\n1. ç‹¬ç«‹äºæ¡†æ¶\n2. å¯è¢«æµ‹è¯•ï¼šè¿™äº›ç³»ç»Ÿçš„ä¸šåŠ¡é€»è¾‘å¯ä»¥è„±ç¦» UIã€æ•°æ®åº“ã€WebæœåŠ¡ä»¥åŠå…¶ä»–å¤–éƒ¨å…ƒç´ æ¥è¿›è¡Œæµ‹è¯•ã€‚\n3. ç‹¬ç«‹äº UIï¼Œå¹¶ä¸”æ¯”è¾ƒæ–¹ä¾¿åœ°åœ¨ä¸æ”¹åŠ¨ä¸šåŠ¡é€»è¾‘çš„æƒ…å†µä¸‹æ”¹åŠ¨ UI\n4. ç‹¬ç«‹äºæ•°æ®åº“ï¼Œä»¥åŠç‹¬ç«‹äºå…¶ä»–å¤–éƒ¨æœºæ„\n\nè°¦å‘å¯¹è±¡æ¨¡å¼ï¼š\n\nè°¦å‘å¯¹è±¡çš„è§£è¯»ï¼šæˆ‘ä»¬å¯ä»¥å°†è½¯ä»¶æ¨¡å—åˆ†ä¸ºä¸¤ç»„ï¼Œä¸€ç»„æ˜¯è°¦å‘ç»„ï¼Œå¦å¤–ä¸€ç»„ä¸æ˜¯ã€‚è°¦å‘ç»„çš„æ¨¡å—é€šå¸¸æ¯”è¾ƒéš¾å†™ä»£ç è¿›è¡Œæµ‹è¯•ï¼Œæ¯”å¦‚ GUIï¼Œè¿™éƒ¨åˆ†ä»£ç åº”è¯¥è¶Šç®€å•è¶Šå¥½ã€‚\n\né—¨æˆ·æ¨¡å¼ï¼šFacade Pattern\nå¤–éƒ¨åªèƒ½çœ‹åˆ° Facadeï¼Œç„¶å Facade å†…éƒ¨çš„ implement å¯ä»¥æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªã€‚\n> è¿™ç§æ¨¡å¼åœ¨æˆ‘ä»¬é‡æ„é¡¹ç›®çš„æ—¶å€™æŒºæœ‰ç”¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ª Facade ç±»ï¼Œç„¶åé»˜é»˜æŠŠé‡Œé¢çš„å®ç°ç°åº¦æˆ–è€…ç›´æ¥æ¢æ‰ã€‚\n\n## æœåŠ¡å’Œæ¶æ„\n\nå®é™…ä¸Šï¼ŒæœåŠ¡æœ¬èº«åªæ˜¯ä¸€ç§æ¯”å‡½æ•°è°ƒç”¨æˆæœ¬ç¨å¾®é«˜çš„ï¼Œåˆ†å‰²åº”ç”¨ç¨‹åºçš„ä¸€ç§å½¢å¼ï¼Œä¸æ•°æ®åº“æ— å…³ã€‚\n\n**æœåŠ¡çœŸçš„è§£è€¦äº†ä¹ˆï¼Ÿå› ä¸ºé€šå¸¸æœåŠ¡ä¸èƒ½å½¼æ­¤è®¿é—®å˜é‡ï¼Œæˆ‘ä»¬ä¼šè®¤ä¸ºè¿™ç§è®¾è®¡è‡ªç„¶å°±è§£è€¦äº†ã€‚ä½†å®é™…ä¸Šï¼Œä»»ä½•å½¢å¼çš„å…±äº«æ•°æ®éƒ½ä¼šå¯¼è‡´å¼ºè€¦åˆï¼Œæ¯”å¦‚å®ƒä»¬ä¾èµ–åŒä¸€ç§æ•°æ®ç»“æ„ã€åŒä¸€ä¸ª schemaã€‚è€Œä¸”åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä»¬çš„ dev ops ä¹Ÿå¹¶ä¸æ˜¯ç‹¬ç«‹çš„ã€‚**\n\n---\n\n<å®Œ>\n","tags":["è¯»ä¹¦ç¬”è®°","æ¶æ„"]},{"title":"React Conf 2021 å†…å®¹æ¦‚è¦","url":"/2021/12/08/ReactConf2021/","content":"\nåŸæ–‡ï¼šhttps://zhuanlan.zhihu.com/p/447103166","tags":["React"]},{"title":"PC å¼€å‘æŠ€æœ¯é€‰å‹ï¼šElectron ä¸æ˜¯é“¶å¼¹","url":"/2021/09/16/electronå¯èƒ½ä¸æ˜¯ä½ çš„è§£è¯/","content":"\n[Electron](https://www.electronjs.org/docs) (ç±»ä¼¼çš„è¿˜æœ‰ nw.jsï¼‰æ˜¯ä¸€ä¸ªä½¿ç”¨ JavaScriptã€HTML å’Œ CSS æ„å»ºæ¡Œé¢åº”ç”¨ç¨‹åºçš„æ¡†æ¶ã€‚ åµŒå…¥äº† Chromium å’Œ Node.jsã€‚\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å‡ ä¹å¯ä»¥ä½¿ç”¨çº¯ web æŠ€æœ¯ï¼Œæ¥åˆ›å»ºè·¨å¹³å°çš„ windows å’Œ macOS çš„åŸç”Ÿåº”ç”¨ï¼Œå¹¶é€šè¿‡ Node.js addon èƒ½åŠ›æ¥å…¥ native æ¨¡å—ã€‚ç›®å‰å¸‚é¢ä¸Šï¼Œä¹Ÿæœ‰ä¸€å¤§æ‰¹çŸ¥åçš„åº”ç”¨æ˜¯ä½¿ç”¨ Electron å¼€å‘çš„ï¼Œæ¯”å¦‚ï¼šVS Codeã€Atomã€Microsoft Teams ç­‰ï¼ˆ*åœ¨ macOS ä¸Šé¢ä¸€ä¸ªç®€å•çš„åˆ¤æ–­åº”ç”¨æ˜¯å¦ä½¿ç”¨äº† Electron çš„åŠæ³•ï¼šåœ¨åº”ç”¨çš„ Contents/Frameworks é‡Œé¢æœç´¢æ˜¯å¦æœ‰ Electron Framework.framework*ï¼‰ã€‚\n\nä½†å®é™…ä¸Šï¼Œè¿™ç¯‡æ–‡ç« æ˜¯å¸Œæœ›ä½ åœ¨é€‰ç”¨ Electron æ¡†æ¶å‰ï¼Œéœ€è¦è¿›è¡Œæ…é‡çš„è€ƒè™‘å’Œè¯„ä¼°ã€‚å›½å†…æœ‰å¾ˆå¤šå…¬å¸ï¼ŒåŒ…æ‹¬ä¸€äº›ä¸€çº¿äº’è”ç½‘å…¬å¸çš„é¡¹ç›®æ˜¯ä¸€å¼€å§‹ä¸ºäº†å¿«é€Ÿè¿­ä»£é€‰æ‹©äº† Electronï¼Œåç»­å®åœ¨æ— æ³•è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œå…¨éƒ¨æ¨åˆ°é‡æ¥ï¼Œè¿™å®é™…ä¸Šåè€Œä¸åˆ©äºæ•´ä½“çš„é¡¹ç›®è¿­ä»£ã€‚\n\n# æ¶æ„é€‰å‹\n\nä¸€èˆ¬æ¥è¯´ï¼Œç¬”è€…è®¤ä¸ºæœ‰ä»¥ä¸‹å‡ ä¸ªåœºæ™¯ï¼Œä¸é€‚åˆä½¿ç”¨ Electron è¿›è¡Œå¼€å‘ï¼š\n\n## 1. æ— é¡µé¢æˆ–è€…å°‘é‡é¡µé¢çš„åº”ç”¨\n\nè¿™ä¸€ç‚¹å¾ˆå¥½ç†è§£ï¼ŒElectron çš„ä¾¿åˆ©æ€§ä¸»è¦ä½“ç°åœ¨é¡µé¢ç›¸å…³çš„å¼€å‘ï¼Œå¦‚æœä½ çš„åº”ç”¨å‡ ä¹æ²¡æœ‰é¡µé¢ï¼Œæ¯”å¦‚åªåœ¨é¡¶éƒ¨çŠ¶æ€æ åŒºåŸŸæœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œæ˜¾ç„¶å°±æ²¡æœ‰å¿…è¦ä½¿ç”¨ Electronï¼Œç›´æ¥ä½¿ç”¨åŸç”Ÿçš„æŠ€æœ¯æ ˆå³å¯ã€‚\n\n## 2. å¯¹å®‰è£…åŒ…ä½“ç§¯é™åˆ¶è¾ƒä¸ºä¸¥æ ¼çš„åº”ç”¨\n\nElectron ç”±äºè‡ªèº«æºå¸¦çš„åŸºç¡€è®¾æ–½ï¼Œå¯¼è‡´å³ä½¿ä½ çš„ä¸šåŠ¡ä»£ç ä¸å¤šï¼Œåˆå§‹å®‰è£…åŒ…ä¹Ÿä¼šæ¯”è¾ƒå¤§ï¼ˆæ¯•ç«Ÿæ¥è¿‘ä¸€ä¸ªæµè§ˆå™¨çš„å¤§å°ï¼‰ï¼Œåœ¨æ²¡æœ‰ä½ çš„ä¸šåŠ¡ä»£ç çš„æƒ…å†µä¸‹ï¼Œæœªç»ä¼˜åŒ–çš„å®‰è£…åŒ…è¾¾åˆ°äº† 60MB å·¦å³ï¼Œè€Œä¸”é€šå¸¸ä½ éœ€è¦æŠŠ node_modules ä¸€èµ·æ‰“è¿›å»ï¼Œæ‰€ä»¥å³ä½¿ä½ çš„ä¸šåŠ¡å¹¶ä¸å¤æ‚ï¼Œä¹Ÿå¾ˆå®¹æ˜“äº§ç”Ÿä¸€ä¸ªæ¥è¿‘ 100MB çš„å®‰è£…åŒ…ã€‚\n\nå› æ­¤ï¼Œå¦‚æœä½ çš„ä¸šåŠ¡éœ€è¦æ¯”è¾ƒæè‡´çš„åŒ…ä½“ç§¯ä¼˜åŒ–ï¼Œé‚£ä¹ˆ Electron å¯èƒ½å¹¶ä¸æ˜¯ä¸€ä¸ªåˆé€‚çš„é€‰æ‹©ã€‚\n\n## 3. å¤šçª—å£åº”ç”¨\n\nElectron çš„è¿›ç¨‹æ¨¡å‹ä¸ºä¸€ä¸ªä¸»è¿›ç¨‹ + è‹¥å¹²æ¸²æŸ“è¿›ç¨‹ï¼Œæ¯ä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ç”¨äºå±•ç¤ºä¸€ä¸ªé¡µé¢ï¼Œ**å³ä½¿ä½ çš„é¡µé¢æ˜¯ Hello Worldï¼Œå†…å­˜å ç”¨ä¹Ÿè¾¾åˆ° 50 MB å·¦å³**ã€‚\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ çš„åº”ç”¨éœ€è¦åŒæ—¶å±•ç¤ºå¤šä¸ªçª—å£ï¼Œé‚£ä¹ˆå°±éœ€è¦å¤šä¸ªæ¸²æŸ“è¿›ç¨‹ï¼Œè¿™æ ·æ•´ä½“çš„å†…å­˜å ç”¨å°±ä¼šä¸Šæ¶¨å¾ˆå¤šï¼Œè€Œå®é™…ä¸Šæˆ‘ä»¬ä½¿ç”¨åŸç”Ÿæˆ–è€…å…¶ä»–çš„ç±» cef çš„æ–¹æ¡ˆï¼Œæ˜¯å¯ä»¥åšåˆ°ä¸€ä¸ªè¿›ç¨‹å¯¹åº”å¤šä¸ªçª—å£çš„ã€‚\n\n## 4. æ€§èƒ½æ¶ˆè€—è¾ƒé«˜å¹¶ä¸”éœ€è¦é«˜åº¦å®šåˆ¶ä¼˜åŒ–çš„åº”ç”¨ï¼šæ¯”å¦‚è§†é¢‘ç±»åº”ç”¨\n\nElectron åŸºäº web æ¶æ„ï¼Œæ‰€ä»¥ä½¿ç”¨ Electron å¼€å‘çš„åº”ç”¨æ€§èƒ½ä¸€èˆ¬æ¥è¯´å’Œ web æ¯”è¾ƒæ¥è¿‘ï¼Œå½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Node.js addon åŠ æŒçš„æ–¹å¼è®©éƒ¨åˆ†åœºæ™¯ä¸‹æ€§èƒ½æ›´é«˜ï¼ˆæ¯”å¦‚ç›´æ¥ä½¿ç”¨ c++ å®ç°ä¸€äº›è®¡ç®—å¯†é›†å‹çš„æ¨¡å—ï¼Œæˆ–è€…ç‹¬ç«‹å‡ºä¸€ä¸ªé UI è¿›ç¨‹ï¼Œæ¥å¤„ç†é UI é€»è¾‘ï¼‰ï¼Œä¸è¿‡é¡µé¢ UI ç›¸å…³çš„è¿˜æ˜¯ä¼šå—é™åˆ¶äº web çš„å¤©èŠ±æ¿ã€‚\n\næ‰€ä»¥ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä»¥ä¸‹ä¸¤ç§æƒ…å†µå¯èƒ½ä¸é€‚ç”¨äº Electronï¼š\n\n1. åœ¨ web åœºæ™¯ä¸‹ï¼ŒUI å…ƒç´ æ“ä½œæ¯”è¾ƒå¡é¡¿ï¼Œè¾¾åˆ°ç“¶é¢ˆï¼Œå¿…é¡»é‡‡ç”¨æ€§èƒ½æ›´é«˜çš„åŸç”Ÿ UIã€‚ä¸è¿‡æˆ‘å»ºè®®**ä¸è¦è½»æ˜“ä¸‹è¿™ä¸ªç»“è®º**ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™ç§æ€§èƒ½é—®é¢˜éƒ½æ˜¯å†™çš„ä»£ç ä¸å¤Ÿæè‡´ï¼Œå»ºè®®å…ˆä» web çš„è§’åº¦è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼ˆæ¯”å¦‚ï¼Œé•¿åˆ—è¡¨åœºæ™¯æˆ‘ä»¬å¯ä»¥[é€šè¿‡å‹ç¼©åˆæˆå±‚ä¼˜åŒ–æ€§èƒ½](http://niexiaotao.cn/2021/09/04/%E9%80%9A%E8%BF%87%E5%8E%8B%E7%BC%A9%E5%90%88%E6%88%90%E5%B1%82%E4%BC%98%E5%8C%96%E6%80%A7%E8%83%BD/)æ¥æ•°åå€åœ°æé«˜æ€§èƒ½ï¼‰ã€‚\n\n2. å¯¹æŸä¸€é¡¹æŠ€æœ¯æœ‰æ·±åº¦ä¾èµ–ï¼Œè€Œè¿™é¡¹æŠ€æœ¯åœ¨ web æ–¹é¢å­˜åœ¨æ€§èƒ½ä¸Šçš„å¤©èŠ±æ¿ã€‚äº‹å®ä¸Šè¿™ç§æƒ…å†µä¹Ÿå¹¶ä¸å¤šè§ï¼Œå…¶ä¸­ä¸€ä¸ªåˆç†çš„åœºæ™¯æ˜¯è§†é¢‘ç›¸å…³çš„åº”ç”¨ï¼Œæ¯”å¦‚è§†é¢‘ä¼šè®®ï¼Œæˆ–è€…è§†é¢‘æ’­æ”¾å™¨ï¼Œè¿™ç±»ç”±äº Chrome æœ¬èº«çš„æ¸²æŸ“æµæ°´çº¿çš„é™åˆ¶ï¼Œä½¿ç”¨ video æ ‡ç­¾æˆ–è€…ä½¿ç”¨ WebGL éƒ½ä¼šå­˜åœ¨ä¸€äº›æ€§èƒ½é—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦æ›´æ·±å…¥çš„å»è¿›è¡Œç›¸å…³èƒ½åŠ›çš„å®šåˆ¶ï¼Œå°±éœ€è¦ä» Electron çš„æ¡†æ¶ä¸­è·³è„±å‡ºæ¥ï¼Œæˆ–è€…é’ˆå¯¹ Electron è¿›è¡ŒäºŒæ¬¡å¼€å‘ã€‚\n\n> å…³äº WebGL: å®é™…ä¸Šå¾ˆå¤š web å¼€å‘è€…ä¼šæŠŠ WebGL å½“ä½œéƒ¨åˆ†åœºæ™¯ä¸‹æ€§èƒ½ä¼˜åŒ–çš„é“¶å¼¹ï¼Œä½†å®é™…ä¸Š WebGL ç›®å‰å­˜åœ¨è¯¸å¤šå›°å¢ƒï¼šWebGL 1.0 è™½ç„¶å·²ç»æ™®åŠï¼Œä½†æ˜¯å…¶ä½œä¸º OpenGL ES 2.0 çš„å­é›†ï¼Œæ€§èƒ½ä¸Šå·²ç»å¹¶ä¸ç‰¹åˆ«é€‚ç”¨ç°ä»£ç¡¬ä»¶æ¶æ„ï¼›è€Œ WebGL 2.0 ç›®å‰ä»ç„¶åœ¨æ™®åŠä¸­å¹¶ä¸”å„å®¶å‚å•†æ„è§æ— æ³•ä¸€è‡´ï¼›Web GPU å¯èƒ½æ˜¯ä¸€ä¸ªæ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œåº•å±‚ç›´æ¥å¯¹æ¥ D3D12ã€metalã€vulkan ç­‰æ›´åº•å±‚æ›´å…ˆè¿›çš„å›¾å½¢æ¡†æ¶ï¼Œä½†ç›®å‰æˆç†Ÿåº¦ä¸é«˜ã€‚\n\nå¦‚æœä½ çš„åº”ç”¨åœ¨ç»è¿‡ä»¥ä¸Šåˆ†æä¹‹åï¼Œè®¤ä¸ºä»ç„¶å¯ä»¥ä½¿ç”¨ Electron è¿›è¡Œå¼€å‘ï¼Œé‚£ä¹ˆæ­å–œä½ æ‹¥æœ‰äº†ä¸€ä¸ªå¦‚æ­¤é«˜æ•ˆç‡çš„å¼€å‘æ–¹æ¡ˆï¼ˆå¦‚æœä¸è¡Œï¼Œå»ºè®®ä½ å¯ä»¥é€‰æ‹©å…¶ä»–çš„è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚ [QT](https://www.qt.io/)ï¼‰ã€‚\n\nå½“ç„¶åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦è¿›è¡Œå……è¶³çš„æ€§èƒ½ä¼˜åŒ–å’Œç¨³å¥çš„æ¶æ„è®¾è®¡ï¼Œæ¥è®©æˆ‘ä»¬åº”ç”¨çš„å¯é æ€§å˜å¾—æ›´é«˜ã€‚\n\n# æ€§èƒ½ä¼˜åŒ–\n\nå’Œ web ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬çš„ native åº”ç”¨éœ€è¦æ›´åŠ å…³æ³¨å¦‚ä¸‹ä¸‰ä¸ªæŒ‡æ ‡ï¼š\n\n## 1. cpu\n\ncpu å ç”¨ç›¸å…³çš„é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨ web æŠ€æœ¯æ ˆä¸­ä¸€èˆ¬ä¹Ÿä¼šå…³æ³¨ï¼Œä¸è¿‡æ›´å¤šçš„æ˜¯å…³æ³¨å‡½æ•°çš„è°ƒç”¨è€—æ—¶ï¼Œæ˜¯å¦å­˜åœ¨åŒæ­¥è°ƒç”¨çš„è€—æ—¶è¿‡é•¿å¯¼è‡´å¡é¡¿ç­‰é—®é¢˜ã€‚\n\nè€Œåœ¨æ¡Œé¢åº”ç”¨ç¨‹åºçš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä»æ•´ä¸ªåº”ç”¨çš„ç»´åº¦å…³æ³¨ cpu æ¶ˆè€—ï¼Œå¹¶ä¸”éœ€è¦æ›´åŠ é‡è§†ã€‚\n\nå¦å¤–ä¸€ä¸ªåŸå› æ˜¯ï¼Œåœ¨ç½‘é¡µåœºæ™¯ä¸­ï¼Œé¡µé¢çš„ cpu å ç”¨é€šå¸¸ä¸ä¼šç‰¹åˆ«ç›´è§‚åœ°è¢«ç”¨æˆ·å‘ç°ï¼ˆå› ä¸ºç³»ç»Ÿå±‚é¢é€šå¸¸åªä¼šä½“ç°åœ¨æµè§ˆå™¨å ç”¨ cpu è¾ƒå¤šï¼‰ï¼Œè€Œåœ¨ç°åœ¨çš„åŸç”Ÿåœºæ™¯ï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥åœ¨ä»»åŠ¡ç®¡ç†å™¨ä¸­çœ‹åˆ°æˆ‘ä»¬çš„åº”ç”¨ï¼Œå¦‚æœæˆ‘ä»¬çš„åº”ç”¨æŒç»­æœ‰ä¸€ä¸ªè¾ƒé«˜çš„ cpu å ç”¨ï¼Œå°±ä¼šæ¯”è¾ƒå®¹æ˜“è¢«ç”¨æˆ·å‘ç°ï¼Œç”šè‡³è§¦å‘ç³»ç»Ÿå‘Šè­¦æç¤ºå¼ºæ€åº”ç”¨ï¼Œè¿™å¯¹æˆ‘ä»¬åº”ç”¨çš„å£ç¢‘ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒè´Ÿé¢çš„å½±å“ã€‚\n\n## 2. å†…å­˜\n\nåœ¨æ¡Œé¢åº”ç”¨ç¨‹åºä¸­ï¼Œå†…å­˜çš„ä½¿ç”¨æ–¹å¼æœ‰äº†ä¸€ä¸ªæ˜æ˜¾çš„å˜åŒ–ï¼š\n\nåŸæœ‰çš„ web é¡µé¢ï¼Œé€šå¸¸æ˜¯ç”¨å®Œå³èµ°ï¼Œè€Œå¯¹äº native åº”ç”¨ç”¨æˆ·ä¸€èˆ¬ä¼šæ‰“å¼€å¾ˆä¹…ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬å¦‚æœä¸€æ—¦äº§ç”Ÿå†…å­˜æ³„æ¼æˆ–è€…å†…å­˜å ç”¨æ¯”è¾ƒé«˜çš„æƒ…å†µï¼Œå¯¹ç”¨æˆ·çš„å½±å“æ˜¯æŒç»­å¹¶ä¸”è¢«ä¸æ–­æ”¾å¤§çš„ã€‚\n\nå¯¹äº cpu å’Œå†…å­˜çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ï¼š\n\n1. å¼€å‘é˜¶æ®µé€šè¿‡ visual studio æˆ– instruments æ¥è¯¦ç»†åˆ†ææˆ‘ä»¬å¼€å‘çš„åŠŸèƒ½çš„ cpu å’Œå†…å­˜åˆ†é…æƒ…å†µï¼Œå‘ç°é—®é¢˜ã€‚\n2. æµ‹è¯•å‘å¸ƒé˜¶æ®µé€šè¿‡ç¬¬ä¸‰æ–¹å†…å­˜åˆ†æå·¥å…·ï¼Œæµç¨‹åŒ–çš„åˆ†æ cpu å’Œå†…å­˜å ç”¨å¹¶äº§å‡ºæŠ¥å‘Šã€‚\n3. çº¿ä¸Šé˜¶æ®µæŒç»­ç›‘æ§ cpu å’Œå†…å­˜æ¶ˆè€—æƒ…å†µï¼Œå¹¶ä¸”ä¸ŠæŠ¥æ•°æ®è¿›è¡Œç»Ÿè®¡å’Œç›‘æ§å‘Šè­¦ã€‚\n\n## 3. crash ç‡\n\nå®é™…ä¸Šåœ¨å‰ç«¯é¢†åŸŸåŸºæœ¬ä¸Šæ²¡æœ‰ \"crash\" è¿™ä¸ªè¯´æ³•ï¼Œä¸è¿‡å¯¹äº native åº”ç”¨æ¥è¯´ï¼Œå³ä½¿æˆ‘ä»¬çš„åº”ç”¨æ˜¯å®Œå…¨é‡‡ç”¨å‰ç«¯æŠ€æœ¯æ ˆï¼Œä¹Ÿå¯èƒ½å­˜åœ¨ crash (crash åœ¨ Electron çš„ä»£ç ï¼‰ï¼Œä¸€èˆ¬è¿™ä¸ªæ—¶å€™ç”¨æˆ·çš„ä½“éªŒæ˜¯é—ªé€€ï¼Œç›¸å¯¹æ¥è¯´ç®—æ˜¯ä¸¥é‡å½±å“ç”¨æˆ·ä½“éªŒçš„é—®é¢˜ï¼Œå› æ­¤å€¼å¾—æˆ‘ä»¬è¶³å¤Ÿçš„é‡è§†ã€‚\n\nå¯¹äº crash é—®é¢˜æˆ‘ä»¬åº”è¯¥åšå¥½ä»¥ä¸‹ä¸‰ç‚¹ï¼š\n\n1. è¿è¡Œæ—¶ crash ç›‘å¬æœºåˆ¶ï¼Œä¸€èˆ¬æ˜¯ sentry æˆ–è€…ç›´æ¥ä½¿ç”¨å…¶ä¾èµ–çš„ crash_padã€‚\n2. ç¬¦å·ç®¡ç†æœºåˆ¶ï¼Œç®¡ç†æˆ‘ä»¬åŸç”Ÿæ¨¡å—ï¼Œå’Œæˆ‘ä»¬ç”¨åˆ°çš„ Electron å¯¹åº”ç‰ˆæœ¬çš„ç¬¦å·ã€‚\n3. è¿è¡Œæ—¶ crash ä¸ŠæŠ¥å‘Šè­¦æœºåˆ¶ã€‚\n\n# æ¶æ„ä¼˜åŒ–\n\né™¤äº†ä¸Šè¿°æ€§èƒ½æŒ‡æ ‡å’Œç›‘æ§æ‰‹æ®µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€å®šçš„æ¶æ„ä¼˜åŒ–ï¼Œæ¥å¢å¼ºç³»ç»Ÿçš„å¯é æ€§ã€‚\n\n## é€šè¿‡ Node.js addon æˆ–è€…ç‹¬ç«‹è¿›ç¨‹çš„æ–¹å¼åŸç”Ÿå®ç°é UI å†…å®¹\n\nè¿™é‡Œçš„ä½œç”¨ä¸»è¦æ˜¯å¸Œæœ›èƒ½å¤Ÿå€ŸåŠ©åŸç”Ÿæ¨¡å—çš„é«˜æ€§èƒ½ä¼˜åŒ– cpu çš„å ç”¨ã€‚\n\nElectron è®©æˆ‘ä»¬å¼€å‘ ui ç›¸å…³çš„é¡µé¢å˜å¾—éå¸¸é«˜æ•ˆï¼Œä½†æ˜¯ä¸€äº›é€»è¾‘éƒ¨åˆ†ï¼Œæˆ–è€…å’Œæ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦åŸç”Ÿå¼€å‘çš„æ‰‹æ®µï¼Œæ¯•ç«Ÿå³ä½¿ä½¿ç”¨äº† Node.jsï¼Œä¹Ÿæ— æ³•ç›´æ¥è¿›è¡Œç³»ç»Ÿè°ƒç”¨ã€‚\n\nè¿™é‡Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ Node.js addon çš„æ–¹å¼æˆ–è€…ç‹¬ç«‹è¿›ç¨‹+è¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼ï¼Œä¸¤è€…çš„å¥½å¤„åˆ†åˆ«æ˜¯ï¼š\n\naddonï¼š\n\n1. æ–¹ä¾¿è¿›è¡Œå†…å­˜å…±äº«ã€‚\n\nç‹¬ç«‹è¿›ç¨‹ï¼š\n\n1. é€šå¸¸ä¼šå¢åŠ å¯é æ€§ï¼Œç‹¬ç«‹è¿›ç¨‹æŒ‚æ‰åå¯ä»¥å•ç‹¬é‡å¯ï¼Œä¸å½±å“ç”¨æˆ·ç•Œé¢ã€‚\n2. éœ€è¦é˜²æ­¢å¤§å—çš„å†…å­˜é‡å¤å ç”¨ï¼Œå¯ä»¥é€šè¿‡å…±äº«å†…å­˜ç­‰æ–¹å¼æ¥è¿›è¡Œä¼˜åŒ–ã€‚\n\n## å‡å°‘æˆ–è€…ç¦æ­¢åœ¨æ¸²æŸ“è¿›ç¨‹ä½¿ç”¨ remote\n\næœ‰çš„æ—¶å€™ï¼Œå³ä½¿ electron çš„æŠ€æœ¯é€‰å‹é€‚åˆä½ çš„é¡¹ç›®ï¼Œä½†å¦‚æœæ»¥ç”¨ remote ä¹Ÿä¼šé€ æˆæ•´ä¸ªåº”ç”¨çš„å¤§é‡ä¸ç¨³å®šä¸å¡é¡¿ã€‚\n\nå®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é˜…è¯» electron çš„æºä»£ç å‘ç°ï¼Œremote æ¨¡å—åªæ˜¯å¯¹ IPC æ¶ˆæ¯çš„åŒæ­¥å°è£…ï¼Œæ–¹ä¾¿æ¸²æŸ“è¿›ç¨‹è°ƒç”¨ä¸»è¿›ç¨‹çš„å¯¹è±¡å’Œæ–¹æ³•ï¼Œè€Œä¸å¿…æ˜¾å¼å‘é€æ¶ˆæ¯è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ã€‚æ‰€ä»¥ï¼Œç”±äºå…¶å±è”½äº†å†…éƒ¨çš„è¿›ç¨‹é—´é€šä¿¡ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™åŸºæœ¬æ— æ„Ÿä¸»è¿›ç¨‹çš„å­˜åœ¨å’Œ IPC çš„é£é™©ï¼Œä½†äº‹å®ä¸Šè¿™å´æœ‰å¡é¡¿ç”šè‡³å¡æ­»æ¸²æŸ“è¿›ç¨‹çš„é£é™©ã€‚\n\nå¦å¤–ï¼Œå»æ‰ remote è¿˜æœ‰å¦å¤–ä¸€ä¸ªå¥½å¤„ï¼Œå°±æ˜¯æ–¹ä¾¿æˆ‘ä»¬é¡¹ç›®çš„ PC ç‰ˆæœ¬å’Œ web ç‰ˆæœ¬è¿›è¡ŒåŒæ„ï¼Œå…·æœ‰æ›´é«˜çš„å¯ç»´æŠ¤æ€§ã€‚\n\næ‰€ä»¥é’ˆå¯¹ä¸€èˆ¬çš„é¡¹ç›®ï¼Œç¬”è€…å»ºè®®èƒ½ç¦ç”¨å°±ç¦ç”¨ remoteï¼Œè§„é¿æ­¤éšæ‚£ã€‚\n\n## å…¶ä»–ä¼˜åŒ–\n\næˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ç¼–å†™å’Œæ‰“åŒ…çš„è¿‡ç¨‹ä¸­ï¼Œåšä¸€äº›å…¶ä»–çš„ä¼˜åŒ–ï¼Œåœ¨è¿™é‡Œï¼Œå¤§éƒ¨åˆ†å‰ç«¯çš„ä¼˜åŒ–æ¯”å¦‚åŠ¨æ€åŠ è½½ã€ä»£ç åˆ†å‰²ã€å›¾ç‰‡ç¼“å­˜ç­‰å¤§å¤šä¹Ÿéƒ½é€‚ç”¨ electron çš„æƒ…å†µï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›ä¼˜åŒ–åˆ™æ˜¯ï¼š\n\n1. é¿å…é‡å¤æ‰“åŒ…ï¼š\n   * **é¿å… node_modules å’Œ webpack é‡å¤çš„æ‰“åŒ…å’Œå¼•å…¥**ï¼Œå¯¹äº webpack æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ webpack-bundle-analyzer æ¥åˆ†ææ‰“åŒ…ä½“ç§¯è¿›è¡Œä¼˜åŒ–\n   * å‡å°‘æ— å…³æ–‡ä»¶çš„æ‰“åŒ…ï¼Œå¯ä»¥é€šè¿‡é…ç½®é’ˆå¯¹ electron-builder çš„ config å»é™¤æ— å…³å†…å®¹æ‰“åŒ…ï¼ŒåŒæ—¶å¯ä»¥ä½¿ç”¨ [node-prune](https://github.com/tj/node-prune) æ¥å»é™¤æ— ç”¨çš„ node_modules å°æ–‡ä»¶ã€‚\n\n2. **v8-code-cache**: \n   * å¯ä»¥ä½¿ç”¨ [v8-compile-cache](https://github.com/zertosh/v8-compile-cache) æ¥è¿›è¡Œä¸€å®šçš„ç¼–è¯‘ä¼˜åŒ–\n\n3. æ›´å¤šå¯ä»¥å‚è€ƒ VSCode çš„ç›¸å…³åˆ†äº«ï¼šhttps://www.youtube.com/watch?v=r0OeHRUCCb4","tags":["å‰ç«¯ç»¼åˆ"]},{"title":"web é¡µé¢å†…å­˜åˆ†æä¸ç”Ÿäº§ç¯å¢ƒç¦ç”¨ console","url":"/2021/09/04/ç”Ÿäº§ç¯å¢ƒç¦ç”¨consoleçš„æ„ä¹‰/","content":"\n## èƒŒæ™¯\n\næˆ‘ä»¬åœ¨å¼€å‘å‰ç«¯é¡µé¢ä¸­ï¼Œå»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å°†æ‰€æœ‰çš„ console ç¦ç”¨ï¼Œå¹¶é€šè¿‡è‡ªå®šä¹‰çš„æ—¥å¿—å‡½æ•°è¿›è¡Œæ—¥å¿—è¾“å‡ºï¼Œå³ä½¿æ— æ³•ç¦ç”¨ï¼Œä¹Ÿéœ€è¦è‡ªå®šä¹‰æ–‡æœ¬è¿‡æ»¤å‡½æ•°ï¼Œä¸¥æ ¼æ§åˆ¶ console çš„è¾“å‡ºã€‚\n\nä½†å®é™…ä¸Šï¼Œç¬”è€…ç»å†çš„é¡¹ç›®ä¸­å¾ˆå¤šéƒ½æ²¡æœ‰åŠæ³•åšåˆ°è¿™ä¸€ç‚¹ï¼Œè™½ç„¶æˆ‘ä»¬çŸ¥é“ï¼Œç¦ç”¨ console çš„ä¸»è¦åŸå› é™¤äº†ä¿¡æ¯æ³„æ¼çš„é£é™©å¤–ï¼Œè¿˜æœ‰å°±æ˜¯ console æ‰“å°çš„å†…å®¹æ— æ³•è¢«å†…å­˜å›æ”¶ã€‚ä½†ä»ç„¶æ€»æ˜¯ä¼šæœ‰ä¸€äº›åŒå­¦å¯¹ç¦ç”¨ console çš„å¿…è¦æ€§è¡¨ç¤ºè´¨ç–‘ï¼Œåœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæœ¬æ–‡é€šè¿‡ä¸¤ä¸ªå®é™…é‡åˆ°çš„æ¯”è¾ƒä¸¥é‡çš„ä¾‹å­ï¼Œæ¥è§£é‡Šç¦ç”¨ console çš„å¿…è¦æ€§ã€‚\n\n> å‡ºäºä¿å¯†æ€§è€ƒè™‘ï¼Œä¾‹å­æœ¬èº«å·²ç»è„±æ•ï¼Œæœ¬æ–‡ä½¿ç”¨ç¤ºä¾‹ä»£ç æ¨¡æ‹ŸåŸå§‹åœºæ™¯ã€‚\n\n## é¡µé¢å†…å­˜\n\nåœ¨å…·ä½“ä¾‹å­è®²è§£ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¯¹é¡µé¢å†…å­˜æœ‰ä¸€ä¸ªè®¤çŸ¥ï¼Œåœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œæˆ‘ä»¬è™½ç„¶å¼€å‘çš„åªæ˜¯åœ¨ Chrome ç­‰æµè§ˆå™¨ä¸­æµè§ˆçš„é¡µé¢ï¼Œä½†æ˜¯å¯¹é¡µé¢çš„ cpu å’Œ å†…å­˜å ç”¨ä¹Ÿéœ€è¦æ—¶åˆ»ä¿æŒå…³æ³¨ã€‚\n\ncpu å’Œ å†…å­˜ä¸€èˆ¬æ˜¯é’ˆå¯¹è¿›ç¨‹çº§åˆ«ï¼Œchrome çš„è¿›ç¨‹æ¨¡å‹æ¯”è¾ƒå¤æ‚ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºåŒåŸŸçš„é¡µé¢æœ‰æ¯”è¾ƒå¤§çš„æ¦‚ç‡è¿›è¡Œè¿›ç¨‹å¤ç”¨ã€‚\n\nChrome æä¾›äº†ä¸€äº›æ‰‹æ®µï¼Œè®©æˆ‘ä»¬å¯ä»¥ç›‘æ§é¡µé¢çš„ cpu å’Œå†…å­˜ï¼Œä¾‹å¦‚ï¼š\n\nPerformance Monitor å¯ä»¥è®©æˆ‘ä»¬ç›´è§‚åœ°ç›‘æµ‹é¡µé¢çš„ cpuã€js heap çš„åˆ†é…æƒ…å†µç­‰ï¼š\n\n![chrome_monitor](/img/chrome_monitor.png)\n\nChrome è‡ªèº«æä¾›äº†ä¸€ä¸ªä»»åŠ¡ç®¡ç†å™¨ï¼ˆMore Tools -> Task Managerï¼‰ï¼Œå¯ä»¥è®©æˆ‘ä»¬å…³æ³¨å„ä¸ªé¡µé¢çš„æ€§èƒ½æƒ…å†µï¼š\n\n![chrome_task_manager](/img/chrome_task_manager.png)\n\né™¤äº†å®æ—¶ç›‘æ§ä»¥å¤–ï¼ŒChrome DevTools çš„ Memory ç­‰ tab ä¹Ÿå¯ä»¥è®©æˆ‘ä»¬å¯¹å†…å­˜å ç”¨è¿›è¡Œå–æ ·åˆ†æï¼Œä»¥åŠå†…å­˜æ³„æ¼åˆ†æï¼š\n\n* ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹ä¸¤æ¬¡ heap snapshotï¼Œç„¶åæœç´¢å…³é”®å˜é‡çš„æ•°ç›®ä¸å¼•ç”¨å…³ç³»æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œæ¥è¯æ˜æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼ã€‚\n* é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬ä½¿ç”¨ WeakMap æ¥è·Ÿè¸ªæˆ‘ä»¬çš„å®ä¾‹ï¼Œä¹Ÿå¯ä»¥è¾…åŠ©è¿›è¡Œä¸€å®šçš„å†…å­˜æ³„æ¼åˆ†æã€‚\n\n\n## ä½¿ç”¨ console.log æ‰“å° dom å…ƒç´ é€ æˆæ­»å¾ªç¯ OOM \n\nä¹‹å‰ç¬”è€…è´Ÿè´£çš„ä¸€ä¸ªé¡µé¢ï¼Œåœ¨æŸä¸ªç‰ˆæœ¬å‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼šæ‰“å¼€é¡µé¢åä¸ä¹…ï¼Œåœ¨ä»€ä¹ˆæ“ä½œä¹Ÿæ²¡æœ‰åšçš„æƒ…å†µä¸‹ç›´æ¥å¡æ­»æ— å“åº”ã€‚\n\nä¸€èˆ¬æ¥è¯´ï¼Œjs å¯¼è‡´ç½‘é¡µæ— å“åº”çš„å¯èƒ½æ€§å¹¶ä¸å¤šï¼Œæˆ‘ä»¬é¦–å…ˆæ€€ç–‘æ˜¯å› ä¸ºæ­»å¾ªç¯å¯¼è‡´çš„ã€‚\n\nä¸è¿‡æˆ‘ä»¬é€šè¿‡å¯¹æ¯”ä¸Šæ¬¡å’Œè¿™ä¸€æ¬¡çš„ä»£ç ï¼Œå‘ç°å˜åŠ¨æå°ï¼ˆå®é™…ä¸Šï¼Œæˆ‘ä»¬ä¸€å¼€å§‹éƒ½å¿½ç•¥äº† console.logï¼‰ï¼Œæˆ‘ä»¬é€šè¿‡åœ¨ Chrome çš„ devTools é‡Œé¢æ‰“æ–­ç‚¹ï¼Œæœ€ç»ˆå®šä½å‘ç°æ˜¯å¡æ­»åœ¨ç¬¬ä¸‰æ–¹åº“ sentry çš„ console.log ä¸­ã€‚\n\næœ€ç»ˆæˆ‘ä»¬å®šä½å‡ºçœŸæ­£çš„åŸå› ï¼šå…¶ä¸­ä¸€å¤„ try catch åœ¨ catch åˆ°é”™è¯¯ä¹‹åï¼Œä¼š console.log æ‰“å°åŒ…æ‹¬ dom åœ¨å†…çš„ä¸€äº›å†…å®¹ï¼Œè€Œæˆ‘ä»¬ä½¿ç”¨çš„ console.log è¢« sentry è¿›è¡Œäº†è¦†ç›–ï¼Œå®ƒçš„è¦†ç›–æ–¹æ³•å¤§è‡´å¦‚ä¸‹ï¼ˆè¿™ä¸ªç¡®å®æœ‰ç‚¹å‘ï¼Œä»¥è‡³äºæˆ‘ä»¬ç›´æ¥æŸ¥çœ‹ console.log ä»ç„¶æ˜¯ [native code]ï¼Œ ä¸è¿‡æœ€æ–°ç‰ˆæœ¬çš„ Chrome è¿™ä¸ªä»£ç å·²ç»ä¸èƒ½å®Œå…¨ workï¼‰ï¼š\n\n```\nlet __native_console = console.log;\nconsole.log = function() {\n  // é€’å½’éå†å„ä¸ªå±æ€§\n  __native_console(...arguments);\n}\nconsole.log.prototype.__native_console = __native_console;\nconsole.log.prototype.toString = function() { \n  if (this.__native_console) return this.__native_console.toString();\n  return this.toString();\n}\n// TODO: 2021.09 @niexiaotao è¡¥å……ä¸€ä¸‹æœ€æ–°çš„å®ç°\n```\n\n**è¿™é‡Œä¹‹æ‰€ä»¥æ­»å¾ªç¯ï¼Œæ˜¯å› ä¸º React ä¸­ FiberNode æ˜¯ Dom çš„å…¶ä¸­ä¸€ä¸ªå±æ€§ï¼Œconsole.log é€’å½’éå†åˆ°äº† FiberNodeï¼Œå…¶æœ¬è´¨æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œæœ€ç»ˆé€ æˆæ— é™é€’å½’æ­»å¾ªç¯**ã€‚\n\næˆ‘ä»¬å¯ä»¥æ¯”è¾ƒæ–¹ä¾¿çš„éšä¾¿æ‰¾ä¸ª React é¡¹ç›®éªŒè¯è¿™ä¸€ç‚¹ï¼š\n\n![React Fiber](/img/chrome_fiber.png)\n\n## detached dom è¿‡å¤šå¯¼è‡´é¡µé¢å†…å­˜æŒç»­ä¸Šæ¶¨\n\nå¦å¤–ç¬”è€…æ¥è§¦åˆ°çš„ä¸€ä¸ªæ¯”è¾ƒä¸¥é‡çš„é—®é¢˜ï¼Œæ˜¯ä¹‹å‰æŸé¡¹ç›®çš„ä¸€ä¸ªé¡µé¢ï¼Œéšç€ä½¿ç”¨æ—¶é—´å¢åŠ ï¼Œé¡µé¢çš„å†…å­˜ä½¿ç”¨é‡å¿«é€ŸæŒç»­å¢åŠ ï¼Œæœ€ç»ˆå¯¼è‡´å¡é¡¿å’Œå´©æºƒã€‚\n\nè¿™ä¸ªé—®é¢˜çš„å®šä½è¿‡ç¨‹ä¹Ÿæ¯”è¾ƒè‰°è¾›ï¼Œæœ€ç»ˆå‘ç°å…¶ä¸­çš„ä¸€ä¸ªä¸»è¦åŸå› æ˜¯ **console.log æ‰“å°äº† dom èŠ‚ç‚¹ï¼Œå¯¼è‡´ detached dom æŒç»­å¢å¤šå¹¶ä¸”æ— æ³•è¢«å›æ”¶ï¼Œæœ€ç»ˆå¯¼è‡´ä¸¥é‡é—®é¢˜**ã€‚\n\nå…³äº detached dom çš„é—®é¢˜æˆ‘ä»¬å¯ä»¥ä½¿ç”¨[é€šè¿‡å‹ç¼©åˆæˆå±‚ä¼˜åŒ–æ€§èƒ½](http://niexiaotao.cn/2021/09/04/%E9%80%9A%E8%BF%87%E5%8E%8B%E7%BC%A9%E5%90%88%E6%88%90%E5%B1%82%E4%BC%98%E5%8C%96%E6%80%A7%E8%83%BD/) è¿™é‡Œçš„ demoï¼Œç®€å•ä¿®æ”¹ï¼š\n\nå°†åŸæœ¬éœ€è¦æŒ‚è½½åˆ° dom çš„èŠ‚ç‚¹ç›´æ¥è¿›è¡Œæ‰“å°ï¼š\n\n```\nfor(let i = 0; i < totalListCount; i += 1) {\n  let fragment = document.createElement(\"div\");\n  fragment.classList.add(\"li\");\n  fragment.innerHTML = `<p>this is the ${i} element</p>`;\n  console.log(fragment);\n  // list.appendChild(fragment);\n}\n```\n\næˆ‘ä»¬å¾ˆå®¹æ˜“çœ‹åˆ°è¿™æ ·å°±äº§ç”Ÿäº† 500 ä¸ª detach èŠ‚ç‚¹ï¼Œå¹¶ä¸”åœ¨é¡µé¢çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œæ— æ³•è¿›è¡Œé‡Šæ”¾ï¼š\n\n![detach console](/img/chrome_detach_console.png)\n\n## æ€»ç»“\n\nå®é™…ä¸Šï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ console.log é€ æˆçš„é—®é¢˜è¿œä¸æ­¢ä¸Šé¢çš„ä¸¤ä¾‹ï¼Œè€Œä¸”è¿™ç±»é—®é¢˜é€šå¸¸æ’æŸ¥èµ·æ¥éƒ½ä¼šæ¯”è¾ƒè‰°éš¾ï¼Œå› æ­¤ï¼Œå»ºè®®å¤§å®¶è½å®åœ¨ç”Ÿäº§ç¯å¢ƒç¦ç”¨ consoleã€‚\n\n\n","tags":["javascript","æ€§èƒ½ä¼˜åŒ–"]},{"title":"é€šè¿‡ä¼˜åŒ–åˆæˆå±‚ä¼˜åŒ–æ€§èƒ½","url":"/2021/09/04/é€šè¿‡å‹ç¼©åˆæˆå±‚ä¼˜åŒ–æ€§èƒ½/","content":"\n## èƒŒæ™¯\n\nWeb æ€§èƒ½ä¼˜åŒ–ç‰¹åˆ«æ˜¯é•¿åˆ—è¡¨æ»šåŠ¨ä¼˜åŒ–æ˜¯ä¸€ä¸ªè€ç”Ÿå¸¸è°ˆçš„é—®é¢˜ï¼Œä¸€èˆ¬æˆ‘ä»¬çš„æ€è·¯æ˜¯é€šè¿‡è™šæ‹Ÿæ»šåŠ¨ã€GPU åŠ é€Ÿã€fragment å¤ç”¨ç­‰æ–¹å¼ä¼˜åŒ–æ€§èƒ½ã€‚\n\nåœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œä¸»è¦ä»‹ç»ä¸€ä¸ªå‹ç¼©åˆæˆå±‚çš„æ€è·¯æ¥è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Œå…³äºåˆæˆå±‚çš„æ–‡ç« ç½‘ä¸Šä¹Ÿæœ‰ä¸€äº›ï¼ˆé™„å½•éƒ¨åˆ†æœ‰åˆ—å‡ºï¼‰ï¼Œä¸è¿‡å¤§éƒ¨åˆ†æ–‡ç« ä¼šå¯¹åˆæˆå±‚åˆ›å»ºçš„åŸå› è¿›è¡Œå†—é•¿çš„ä»‹ç»ï¼Œæœ¬æ–‡ä¼šè·³è¿‡è¿™äº›éƒ¨åˆ†ã€‚åŸå› æ˜¯æˆ‘ä»¬é€šè¿‡ devTools å¯ä»¥æ¯”è¾ƒæ–¹ä¾¿çš„é’ˆå¯¹å…·ä½“æƒ…å†µåˆ†æåˆ›å»ºåˆæˆå±‚çš„åŸå› ï¼Œå¦å¤–ä¸€ä¸ªåŸå› æ˜¯ blink å·²ç»æŠŠåˆ›å»ºåˆæˆå±‚çš„åŸå› å†™åˆ°äº†ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼ˆ[ä¼ é€é—¨](https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/platform/graphics/compositing_reasons.cc)ï¼‰ï¼Œæˆ‘ä»¬ç›´æ¥å‚è€ƒå°±è¡Œï¼Œä¹Ÿæ²¡æœ‰å¿…è¦å»å…¨éƒ½è®°ä½ã€‚\n\n\n## åˆæˆå±‚æ˜¯ä»€ä¹ˆ\n\nå¯¹äº blink æ¸²æŸ“å¼•æ“çš„æ¸²æŸ“æµç¨‹ï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š\n\n```\nDom Tree -> Layout Object -> Paint Layer -> Graphics Layers Tree -> Paint\n```\n\næˆ‘ä»¬å¯¹ä»¥ä¸Šè¿‡ç¨‹è¿›è¡Œä¸€ä¸ªç®€è¿°ï¼š\n\n* Dom Tree åˆ° Render Tree è¿™ä¸ªè¿‡ç¨‹ï¼ŒåŸºæœ¬æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œé™¤äº†ä¸€äº› display:none çš„å…ƒç´ ã€‚\n* Layout Object ä¼šæŒ‰ç…§ä¸€å®šæ¡ä»¶åˆ›å»º Paint Layerã€‚\n* Paint Layer åœ¨åˆ° Graphics Layer çš„è¿‡ç¨‹ä¸­ï¼Œä¼šåˆ›å»ºåˆæˆå±‚ï¼ˆComposite Layerï¼‰ï¼Œä¼šå¯¹åº”ç‹¬ç«‹çš„ Graphics Layerã€‚\n* Graphics Layer ä¼šæŠŠç»“æœæ¸²æŸ“åˆ°çº¹ç†ï¼Œæœ€ç»ˆé€šè¿‡ Chrome çš„æ¸²æŸ“å±‚ä»¥åŠç³»ç»Ÿè¿›è¡Œä¸Šå±ã€‚\n\nå®é™…ä¸Šæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåˆæˆå±‚çš„å¤šå°‘ä¼šæ¯”è¾ƒå½±å“æˆ‘ä»¬çš„æ¸²æŸ“æ€§èƒ½ï¼Œåˆæˆå±‚æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬å¯¹é¡µé¢è¿›è¡Œäº¤äº’ï¼ˆæ¯”å¦‚æ»šåŠ¨ï¼‰ï¼Œè§¦å‘é‡æ–°æ¸²æŸ“ï¼Œå°±ä¼šæœ‰å¡é¡¿çš„é£é™©ã€‚\n\n## åˆ†æåˆæˆå±‚\n\nChrome çš„ DevTools å·¥å…·å¯ä»¥è®©æˆ‘ä»¬æ¯”è¾ƒæ–¹ä¾¿åœ°è¿›è¡Œåˆæˆå±‚åˆ†æï¼Œä¾‹å¦‚æˆ‘ä»¬é€šè¿‡ä¸€ä¸ª demo æ¥è¿›è¡Œåˆ†æï¼š\n\n![åˆæˆå±‚ç¤ºä¾‹](/img/composite_reason.png)\n\nåœ¨ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬ä¼šå‘ç°è¿™ä¸ª demo çš„åˆæˆå±‚æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬ç‚¹è¿›å»å¯ä»¥æŸ¥çœ‹åˆ°æ˜¯å› ä¸º overflow å¯¼è‡´åˆ›å»ºäº†æ–°çš„åˆæˆå±‚ã€‚\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹è¯¥ demo è€Œè¨€æˆ‘ä»¬å¯ä»¥å°è¯•åœ¨è¿™äº› Demo ä¸­å»æ‰æˆ–è€…ä¿®æ”¹ overflow çš„ç›¸å…³è®¾ç½®ï¼Œä»è€Œè¿›è¡Œåˆæˆå±‚ä¼˜åŒ–ã€‚\n\n## ä¼˜åŒ–åˆæˆå±‚\n\næˆ‘ä»¬å°è¯•å»æ‰ `overflow: scroll;`ã€‚ï¼ˆ Demo æºä»£ç ä¼šåœ¨æœ¬æ–‡æœ€åç»™å‡ºï¼‰\n\nç„¶åæˆ‘ä»¬è®¾ç½®é¡µé¢çš„åˆ—è¡¨å…ƒç´ ä¸º 500 ä¸ªï¼Œé€šè¿‡æ¨¡æ‹Ÿé¡µé¢æŒç»­æ»šåŠ¨ï¼Œæ¥æ£€æŸ¥å»æ‰å‰åçš„æ€§èƒ½ã€‚\n\nå»æ‰å‰ï¼Œcpu ä¿æŒåœ¨ 50%+ï¼Œè¿™å®é™…ä¸Šå·²ç»æ˜¯ä¸€ä¸ªæ¯”è¾ƒé«˜çš„æ•°å€¼äº†ï¼š\n\n![åˆæˆå±‚cpu](/img/composite_cpu_1.png)\n\nå»æ‰åï¼Œcpu ä¿æŒåœ¨ 2% å·¦å³ï¼š\n\n![å»é™¤åˆæˆå±‚cpu](/img/composite_cpu_2.png)\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¼˜åŒ–åæœ‰å·¨å¤§çš„æ€§èƒ½æå‡ï¼Œè¿™ç§é‡çº§çš„æ€§èƒ½æå‡ï¼Œä¼šè¿œè¶…è™šæ‹Ÿæ»šåŠ¨ç­‰æ–¹æ¡ˆï¼ˆå…¶å®æˆ‘ä¸ªäººæ˜¯ä¸å»ºè®®é‡‡ç”¨è™šæ‹Ÿæ»šåŠ¨çš„ï¼Œéå¸¸éš¾ç»´æŠ¤ï¼Œè€Œä¸”ä½ å¾ˆéš¾åšåˆ°æµè§ˆå™¨åŸç”Ÿæ»šåŠ¨çš„ä¸æ»‘æ°´å‡†ï¼‰ã€‚\n\n## é™„å½•\n\nç¤ºä¾‹ä»£ç ï¼š\n\n```\n<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0,minimal-ui:ios\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n  <title>Document</title>\n  <style >\n    .container {\n      width: 100vw;\n      height: 100vh;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n    .list {\n      width: 500px;\n      height: 90vh;\n      overflow: scroll;\n    }\n    .li {\n      width: 100%;\n      height: 50px;\n      border-bottom: 2px;\n      border-style: solid;\n      border-color: grey;\n      /* overflow: scroll; */\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"list\">\n    </div>\n  </div>\n</body>\n<script>\n  const totalListCount = 500;\n  const list = document.querySelector(\".list\");\n\n  for(let i = 0; i < totalListCount; i += 1) {\n    let fragment = document.createElement(\"div\");\n    fragment.classList.add(\"li\");\n    fragment.innerHTML = `<p>this is the ${i} element</p>`;\n    list.appendChild(fragment);\n  }\n  let curr = 0;\n  const renderScroll = function () {\n    curr += 5;\n    if (curr >= totalListCount) curr = 0;\n    list.children[curr].scrollIntoView();\n    window.requestAnimationFrame(renderScroll)\n  };\n  renderScroll();\n</script>\n</html>\n```\n\nå‚è€ƒï¼š\n\n- Compositing Layers: https://zhuanlan.zhihu.com/p/88288584\n- å‰ç«¯æ€§èƒ½ä¼˜åŒ–ä¹‹ Composite: https://segmentfault.com/a/1190000015917498","tags":["æ€§èƒ½ä¼˜åŒ–"]},{"title":"äº†è§£ StackOverFlow ä¸Šé¢æœ€å—æ¬¢è¿çš„è¯­è¨€ Rust","url":"/2021/09/02/äº†è§£ StackOverFlow ä¸Šé¢æœ€å—æ¬¢è¿çš„è¯­è¨€ Rust/","content":"\næœ¬æ–‡å¸Œæœ›ä»å®è§‚è§’åº¦ï¼Œæ¥ä»‹ç»å’Œåˆ†æ Rust è¯­è¨€ã€‚\n\nRust æ˜¯ä¸€é—¨**ä¸“æ³¨å®‰å…¨**çš„ç°ä»£ç³»ç»Ÿç¼–ç¨‹è¯­è¨€ï¼Œå‘å¸ƒäº 2015 å¹´ã€‚\n\nè‡ªä» 2015 å¹´å‘å¸ƒèµ·ï¼ŒRust å°±ä¸€ç›´æ˜¯ StackOverFlow ä¸Šé¢æœ€å—æ¬¢è¿çš„è¯­è¨€ï¼Œè€Œä¸”å’Œç¬¬äºŒåè¿˜èƒ½æ‹‰å¼€ä¸å°çš„å·®è·ï¼Œä¾‹å¦‚æœ€è¿‘ä¸¤å¹´çš„ç»Ÿè®¡æ•°æ®ï¼š\n\n[2020](https://insights.stackoverflow.com/survey/2020#most-loved-dreaded-and-wanted):\n![2020_rust](/img/rust_2020.png)\n\n[2021](https://insights.stackoverflow.com/survey/2021#most-loved-dreaded-and-wanted-language-love-dread):\n![2021_rust](/img/rust_2021.png)\n\næ¥ä¸‹æ¥ç¬”è€…é€šè¿‡æ€§èƒ½ã€å¯é æ€§ã€ç”Ÿäº§åŠ›ã€é¢å‘å‰ç«¯å‹å¥½ç­‰å‡ ä¸ªç»´åº¦æ¥ä»‹ç» Rustï¼Œä¹‹åä¼šå¯¹ Rust çš„éƒ¨åˆ†é‡ç‚¹è¯­è¨€ç‰¹æ€§è¿›è¡Œä»‹ç»ã€‚\n\n## æ€§èƒ½\n\né¦–å…ˆä½œä¸ºä¸€ç§ç¼–è¯‘å‹è¯­è¨€ï¼Œå¯ä»¥ç›´æ¥å°†ç¼–è¯‘äº§ç‰©ä½œä¸ºäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶éƒ¨ç½²ï¼Œæ— éœ€éšç¨‹åºä¸€èµ·åˆ†å‘è§£é‡Šå™¨å’Œå¤§é‡çš„ä¾èµ–é¡¹ï¼Œå› æ­¤ç›¸å¯¹äº Pythonã€Ruby ä»¥åŠ Javascript ç­‰è§£é‡Šå‹è¯­è¨€ï¼Œä¼šæ•ˆç‡æ›´é«˜ã€‚\n\nåŒæ—¶ï¼ŒRust æä¾›äº†å¤§é‡çš„é›¶æˆæœ¬æŠ½è±¡ï¼ˆå¦‚æ³›å‹ã€async/awaitã€è¿­ä»£å’Œé—­åŒ…ç­‰ï¼‰ï¼Œåœ¨ä¿è¯å¼€å‘æ•ˆç‡çš„åŒæ—¶é¿å…äº†è¿è¡Œæ—¶å¼€é”€ã€‚\n\nä¸€èˆ¬æ¥è¯´ï¼ŒRust çš„æ€§èƒ½å’Œ C/C++ ç›¸ä¼¼ï¼Œæ— è™šæ‹Ÿæœºï¼Œæ—  GCï¼Œè¿è¡Œæ—¶ä»…ä¾èµ– libcï¼Œ**åœ¨éœ€è¦é«˜æ€§èƒ½åœºæ™¯ä¸­ä½¿ç”¨å·²ç»è¶³å¤Ÿ**ã€‚\n\n## å¯é æ€§\n\nåœ¨ä¸€ä¸ª c++ é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°å„ç±» crashï¼Œå¤„ç†è¿™äº› crash é€šå¸¸ä¼šèŠ±è´¹å¤§é‡çš„äººåŠ›ã€‚\n\nè€Œåœ¨ä¸€ä¸ª Rust é¡¹ç›®ä¸­ï¼Œå¦‚æœè§„èŒƒä½¿ç”¨åŸºæœ¬ä¸Šåœ¨ç¼–è¯‘é˜¶æ®µå°±å¯ä»¥é¿å…å‡ ä¹æ‰€æœ‰çš„ crashï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ**ä½¿ç”¨ Rust çš„é¡¹ç›®åªè¦ç¼–è¯‘é€šè¿‡ï¼Œå°±åªæœ‰é€»è¾‘é”™è¯¯ï¼Œä¸ä¼šå†æœ‰ crash**ï¼ˆè‡ªèº«ä½¿ç”¨äº† unsafe é™¤å¤–ï¼‰ã€‚\n\nRust ä¹‹æ‰€ä»¥èƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼Œå¾—ç›Šäºå…¶è®¾è®¡çš„æ‰€æœ‰æƒã€ç”Ÿå‘½å‘¨æœŸã€Option æœºåˆ¶ä»¥åŠæ™ºèƒ½æŒ‡é’ˆç­‰ï¼Œè¿™ä¸€ç‚¹æˆ‘ä»¬åœ¨ä¸‹æ–‡çš„è¯­è¨€ç‰¹æ€§ä¸­ä¹Ÿä¼šæ›´è¯¦ç»†åœ°åˆ†å¼€ä»‹ç»ã€‚\n\n> å®é™…ä¸Šï¼Œç¬”è€…ç°åœ¨è´Ÿè´£çš„é¡¹ç›®ä¸­ Rust å’Œ C++ å¤§çº¦å„æœ‰ä¸€åŠçš„ä»£ç ï¼Œåœ¨è¿™å…¶ä¸­ Rust å‡ ä¹æ²¡æœ‰å‡ºç°è¿‡ crashï¼Œè€Œ c++ åŸºæœ¬ä¸Šæ¯åŒå‘¨ï¼ˆä¸€ä¸ªè¿­ä»£ï¼‰éƒ½ä¼šæ–°å¢ä¸€äº›ç§ç±»çš„ crashã€‚\n\n## ç”Ÿäº§åŠ›\n\n### ä»£ç å¼€å‘æ•ˆç‡\n\nå¾—ç›Šäº Rust çš„å¤§é‡é›¶æˆæœ¬æŠ½è±¡ï¼Œä»¥åŠ Rust æä¾›çš„é«˜åº¦çµæ´»çš„å®æœºåˆ¶ï¼Œæˆ‘ä»¬çš„ä»£ç å¼€å‘æ•ˆç‡è¿˜æ˜¯æ¯”è¾ƒé«˜çš„ã€‚å°±ç¬”è€…çš„ä½“éªŒè€Œè¨€ï¼Œä½¿ç”¨ Rust å®ŒæˆåŠŸèƒ½çš„å¼€å‘æ•ˆç‡ç•¥ä½äº Typescriptï¼Œä½†æ˜¯è¿œé«˜äº c++ï¼ˆå’Œ Typescript ç›¸æ¯”ï¼ŒRust é€šå¸¸ä¼šéœ€è¦èŠ±è´¹é¢å¤–çš„ä¸€äº›æ—¶é—´æ¥è§£å†³ç¼–è¯‘é—®é¢˜ï¼Œä½†æ˜¯æ¢æ¥çš„æ˜¯é«˜æ€§èƒ½å’Œç¨³å®šæ€§ï¼Œæˆ‘è®¤ä¸ºè¿™æ˜¯å€¼å¾—çš„ï¼‰ã€‚\n\nå¦å¤–éšç€ Rust è¯­è¨€çš„é€æ¸æˆç†Ÿï¼Œé…å¥—çš„ IDE å’Œç¼–è¾‘å™¨ï¼ˆClionã€VSCodeï¼‰ä¹Ÿé€æ¸æˆç†Ÿï¼Œæ—¥å¸¸ä»£ç å¼€å‘æç¤ºã€ä»¥åŠä»£ç è°ƒè¯•ç­‰éƒ½éå¸¸æ–¹ä¾¿ã€‚\n\n### åŒ…ç®¡ç†ç³»ç»Ÿ\n\nå¦å¤–å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒRust çš„åŒ…ç®¡ç†ç³»ç»Ÿéå¸¸å¼ºå¤§ï¼Œè¿™ä¸€ç‚¹æˆ‘è®¤ä¸º Rust ä¹Ÿå‚è€ƒäº† npmï¼ŒåŒ…ç®¡ç†ç³»ç»Ÿçš„ä½¿ç”¨ä½“éªŒä¹Ÿå’Œ npm æ¯”è¾ƒæ¥è¿‘ï¼Œæ–°å¢ä¸€ä¸ªä¾èµ–ï¼Œåªéœ€è¦åœ¨ Cargo.toml é…ç½®æ–‡ä»¶ä¸­æ–°å¢ä¸€è¡Œé…ç½®å³å¯ã€‚æ–¹ä¾¿çš„åŒ…ç®¡ç†ç³»ç»Ÿï¼Œè®©æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°å¤ç”¨[ç¤¾åŒºå„ç±»ä¼˜ç§€çš„èµ„æº](https://crates.io/)ã€‚\n\nç›¸å¯¹æ¥è¯´ï¼Œc++ è¿™ç±»è€ç‰Œè¯­è¨€çš„åŒ…åˆ†å‘å’Œç®¡ç†å°±ä¼šéº»çƒ¦å¾ˆå¤šï¼Œç”šè‡³åœ¨ä¸€ä¸ªé¡¹ç›®å†…ä¹Ÿä¼šæ¯”è¾ƒéº»çƒ¦ã€‚\n\n### ç°æœ‰èµ„æºçš„å¤ç”¨\n\nè¿™ä¸€ç‚¹ä¸»è¦æ˜¯ Rust å’Œ C/C++ çš„äº’ç›¸è°ƒç”¨ï¼ŒRust æ”¯æŒè°ƒç”¨ C æ¥å£å’Œå°è£…æˆ C æ¥å£è¢«å…¶ä»–è¯­è¨€æ‰€è°ƒç”¨ï¼Œå› æ­¤å¯¹äºç°æœ‰çš„é¡¹ç›®ï¼Œå¦‚æœå¯ä»¥æä¾›ä¸€å±‚ C æ¥å£çš„å°è£…ï¼Œå°±ä¼šæ¯”è¾ƒæ–¹ä¾¿åœ°è¢« Rust ç›´æ¥è°ƒç”¨ã€‚\n\n## é¢å‘å‰ç«¯å‹å¥½\n\næˆ‘è®¤ä¸º Rust é¢å‘å‰ç«¯å‹å¥½ä¸»è¦ä½“ç°åœ¨ä¸¤ä¸ªæ–¹é¢ï¼š\n\n### è™½ç„¶å­¦ä¹ è·¯çº¿é™¡å³­ï¼Œä½†å’Œ Typescript ç›¸è¿‘ç‚¹è¾ƒå¤š\n\nå¾ˆå¤šäººåŠé€€ Rust ç†ç”±ä¹‹ä¸€æ˜¯å…¶å­¦ä¹ æ›²çº¿é™¡å³­ï¼Œä½†æ˜¯å®é™…ä¸Šå‰ç«¯åŒå­¦å­¦ä¹  Rust ä¼šæ¯”å­¦ä¹  C++ å®¹æ˜“çš„å¤šï¼Œä¸€æ–¹é¢ï¼ŒRust çš„å¾ˆå¤šæœºåˆ¶ï¼ˆasync/awaitã€ç±»çš„è®¾è®¡ã€åŒ…ç®¡ç†ï¼‰ç­‰éƒ½å’Œ Typescript æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œå¦å¤–ä¸€æ–¹é¢å†™ Rust åªè¦ç¼–è¯‘èƒ½å¤Ÿé€šè¿‡åŸºæœ¬ä¸Šèƒ½å¤Ÿä¿è¯ä½ ä»£ç è´¨é‡çš„ä¸‹é™ï¼Œä¹Ÿå°±æ˜¯è¯´åŸºæœ¬ä¸Šå¯ä»¥ä¸Šçº¿ç”Ÿäº§ç¯å¢ƒã€‚è€Œ C++ æ–°æ‰‹å†™å‡ºæ¥çš„ä»£ç é€šå¸¸ä¼šæœ‰å„ç§ crash éšæ‚£ï¼Œè€Œä¸”æ’æŸ¥é€šå¸¸è¾ƒä¸ºå›°éš¾ï¼Œå¯¼è‡´å®¹æ˜“èƒŒé”…ï¼Œè¿™ä¸€ç‚¹æ¥è¯´å¯¹æ–°æ‰‹éå¸¸ä¸å‹å¥½ã€‚\n\n### é¢å‘ WASM å‹å¥½\n\nå¯¹äº WebAssemblyï¼Œç¬”è€…å¹¶ä¸æ¨è AssemblyScriptï¼Œå› ä¸ºå…¶è™½ç„¶æ˜¯ â€œTypescriptâ€ï¼Œä½†æ˜¯ä½¿ç”¨èµ·æ¥å’Œ Typescript ç›¸å·®å¤ªå¤šï¼Œè€Œä¸”æ— æ³•å®Œå…¨ç›´æ¥ä½¿ç”¨ JavaScript çš„ç¬¬ä¸‰æ–¹åº“ï¼Œè°ƒè¯•ç­‰ä¹Ÿå¹¶ä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚\n\nè€Œå‰©ä½™çš„å‡ ç±»è¯­è¨€ä¸­ï¼ˆRustã€C++ã€Kotinã€Golangï¼‰ï¼Œç›¸å¯¹æ¥è¯´ Rust å’Œ C++ çš„ wasm ç¼–è¯‘éƒ½è¾ƒä¸ºæˆç†Ÿï¼ŒRust æ›´æ˜¯åœ¨è®¾è®¡ä¹‹åˆå³è€ƒè™‘æ”¯æŒ WebAssembly å¹¶ä¸”å°†å…¶ä½œä¸ºä¸€ä¸ªä¸»è¦äº®ç‚¹ï¼Œè¢« Rust å®˜æ–¹å›¢é˜Ÿç›´æ¥ç»´æŠ¤ï¼ˆåŒ…å«äº†å‹¤åŠ³çš„ Alex Crichtonï¼Œå…¶ä¹Ÿæ˜¯ tokio çš„ä½œè€…ï¼‰ã€‚å› æ­¤æˆ‘ä»¬ä½¿ç”¨ Rust ç¼–è¯‘ WebAssembly éå¸¸æ–¹ä¾¿ï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥ä½¿ç”¨å¤§å¤šæ•°ç¬¬ä¸‰æ–¹ Rust åº“ï¼Œä½¿ç”¨ä½“éªŒå’Œ Rust Native å¼€å‘åŸºæœ¬ä¸Šæ²¡æœ‰å·®å¼‚ã€‚\n\nç›®å‰ç¬”è€…çš„é¡¹ç›®ä¸­ï¼Œæœ‰ä¸€éƒ¨åˆ†æ¨¡å—å³ä½¿ç”¨äº† Rust + WebAssemblyï¼ŒåŒæ—¶æ”¯æŒäº† Windows/Mac/iOS/Android/Web äº”ç§å¹³å°ï¼Œå¹¶ä¸”å‡ ä¹éƒ½åšåˆ°äº†æœ€é«˜æ€§èƒ½ã€‚\n\n> å½“ç„¶ä¸å¾—ä¸æ‰¿è®¤ï¼ŒRust ç¼–è¯‘ WebAssembly åœ¨ä½¿ç”¨åˆ° C++ çš„èµ„æºæ—¶ä¹Ÿå¹¶ä¸æ˜¯ååˆ†æ–¹ä¾¿ï¼ŒRust çš„ WASM ç¼–è¯‘å™¨å’Œ Emscripten ä¹Ÿæœ‰è¯¸å¤šå·®å¼‚ï¼Œé€‚é…èµ·æ¥ä¼šæ¯”è¾ƒå¤´ç–¼ï¼Œå¦‚æœç°æœ‰é¡¹ç›®ä¸»è¦æ˜¯ C++ï¼Œè¿˜æ˜¯å»ºè®®ç›´æ¥ä½¿ç”¨ Emscriptenã€‚\n\n## é‡ç‚¹è¯­è¨€ç‰¹æ€§\n\nRust æ‹¥æœ‰å¤§å¤šç°ä»£è¯­è¨€å…·å¤‡çš„ç‰¹æ€§ï¼Œæ¯”å¦‚ RAIIã€åŠ¨æ€æ•°æ®ç±»å‹ç­‰ï¼Œå¦å¤–è¿˜æœ‰ä¸å°‘è®¾è®¡æ˜¯ Rust ä¸­ç‹¬æœ‰çš„ï¼Œä¸‹é¢æˆ‘ä»¬å¯¹ä¸€äº› Rust ä¸­æ¯”è¾ƒç‹¬ç‰¹çš„è¯­è¨€ç‰¹æ€§è¿›è¡Œä¸€äº›ä»‹ç»ã€‚\n\n### æ‰€æœ‰æƒ\n\nRust çš„æ‰€æœ‰æƒæœºåˆ¶ï¼Œå³ä¸€ä¸ªå€¼åŒä¸€ä¸ªæ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªå˜é‡æ‰€å¼•ç”¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š\n\n```\nlet a = \"hello\".to_string();\nlet b = a;\nprintln!(\"a: {:?}\", a); // æç¤ºæŠ¥é”™ï¼švalue borrowed here after move\n```\n\nå› ä¸ºæˆ‘ä»¬æŠŠ a å¯¹åº”çš„æ•°æ®çš„æ‰€æœ‰æƒç»™åˆ°äº† bï¼Œä¹Ÿå°±æ˜¯è¯´ a ä¸å†æ‹¥æœ‰å¯¹åº”çš„æ•°æ®çš„æ‰€æœ‰æƒï¼Œå› æ­¤ä¹Ÿæ— æ³•è®¿é—®ï¼Œ**è¿™ç§æœºåˆ¶ä¿è¯äº†æ•°æ®å®‰å…¨ï¼Œèƒ½å¤Ÿæœ‰æ•ˆé¿å…æ‚¬å‚æŒ‡é’ˆçš„å‘ç”Ÿ**ã€‚\n\nå½“ç„¶ï¼Œå¯¹äºå®ç°äº† Copyï¼ˆä¸€èˆ¬æ¥è¯´ï¼Œéƒ½æ˜¯å­˜å‚¨åœ¨æ ˆä¸Šé¢çš„ç®€å•æ•°æ®ç±»å‹ï¼‰ï¼Œåœ¨èµ‹å€¼é˜¶æ®µä¼šè‡ªåŠ¨æ‹·è´ï¼Œæˆ–è€…å¯¹äºæ²¡æœ‰å®ç° Copyï¼Œä½†æ˜¯å®ç°äº† Cloneï¼ˆéœ€è¦ä¸»åŠ¨è°ƒç”¨ï¼‰çš„ç±»å‹æˆ‘ä»¬æ˜¾å¼è°ƒç”¨ Cloneï¼Œéƒ½å¯ä»¥ç¼–è¯‘é€šè¿‡ï¼Œè¿™äº›è®¾è®¡ç»™æˆ‘ä»¬çš„æ—¥å¸¸å¼€å‘ä¸­å¸¦æ¥äº†æå¤§çš„ä¾¿åˆ©ï¼š\n\n```\nlet a: i32 = 1024;\nlet b = a;\nprintln!(\"a: {:?}\", a); // pass\n\nlet a = \"hello\".to_string();\nlet b = a.clone();\nprintln!(\"a: {:?}\", a); // pass\n```\n### æ™ºèƒ½æŒ‡é’ˆ\n\nåœ¨ Rust ä¸­ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å¹¶æ²¡æœ‰ç©ºæŒ‡é’ˆçš„æ¦‚å¿µï¼Œå¹¶ä¸åƒ c++ æœ‰ nullptrã€java æœ‰ nullï¼ŒRust ä¸­å¦‚æœè¡¨ç¤ºä¸€ä¸ªå¯ç©ºçš„å†…å®¹åªèƒ½ä½¿ç”¨ Optionï¼ˆæœ‰ç‚¹ç±»ä¼¼ C++ çš„ std::optionalï¼‰ã€‚\n\né™¤äº† Optionï¼ŒRust è¿˜å°è£…äº†è‹¥å¹²ç§é«˜çº§æŒ‡é’ˆï¼Œå¹¶å¯¹ä¸åŒç±»å‹çš„æŒ‡é’ˆçš„è¡Œä¸ºè¿›è¡Œé™åˆ¶ï¼Œä»¥æé«˜å…¶å®‰å…¨æ€§ï¼š\n\n* Boxï¼šç”¨äºåœ¨å †ä¸Šå­˜å‚¨æ•°æ®ï¼Œ**å•ä¸€æ‰€æœ‰æƒ**ï¼ˆå³ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šå­˜åœ¨ä¸€ä¸ªæŒ‡é’ˆä¹±é£çš„æƒ…å†µï¼‰ï¼Œå¯ä»¥ç”¨äºå°è£…åœ¨ç¼–è¯‘æ—¶æœªçŸ¥å¤§å°çš„ç±»å‹ã€‚\n* Rcï¼šå¼•ç”¨è®¡æ•°æŒ‡é’ˆï¼Œä¸æ”¯æŒå¤šçº¿ç¨‹\n* Arcï¼šå¤šçº¿ç¨‹ç‰ˆæœ¬çš„å¼•ç”¨è®¡æ•°æŒ‡é’ˆ\n* RefCellï¼šä¿æŒå†…éƒ¨å¯å˜æ€§çš„æŒ‡é’ˆï¼Œå³æˆ‘ä»¬å¦‚æœå¸Œæœ›å¤šä¸ªæ‰€æœ‰è€…å…±åŒæ‹¥æœ‰å¹¶ä¸”éƒ½å¯ä»¥ä¿®æ”¹çš„æŒ‡é’ˆï¼Œéœ€è¦ç»“åˆ Rc æˆ– Arc åŠ  RefCell ä¸€èµ·ä½¿ç”¨ã€‚â€˜\n\nRust è¿˜æä¾›äº†ä¸€äº›å…¶ä»–ç±»å‹çš„æ™ºèƒ½æŒ‡é’ˆï¼Œåœ¨è¿™é‡Œä¸å†è¿‡å¤šä»‹ç»ï¼Œè™½ç„¶è¿™é‡Œçš„å¤§éƒ¨åˆ†æ¦‚å¿µ c++ ä¹Ÿå­˜åœ¨ï¼Œä½†æ˜¯ Rust åŸºæœ¬åªèƒ½æ˜¯å¼ºåˆ¶ä½ ä½¿ç”¨è¿™äº›å†…å®¹ï¼Œè€Œæ— æ³•ä½¿ç”¨ä¸å®‰å…¨çš„è£¸æŒ‡é’ˆã€‚\n\n### å¤šæ€\n\nRust ä¸­çš„å¤šæ€æœ‰åŸºäºæ³›å‹çš„é™æ€æ´¾å‘å’ŒåŸºäº trait çš„åŠ¨æ€æ´¾å‘ã€‚\n\n* é™æ€æ´¾å‘ï¼šæ˜¯ä¸€ç§é›¶æˆæœ¬æŠ½è±¡ï¼Œåœ¨ C++ ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„æ¦‚å¿µï¼Œé™æ€æ´¾å‘æ˜¯é€šè¿‡å¯¹ä¸åŒç±»å‹çš„è°ƒç”¨åœ¨ç¼–è¯‘æœŸé—´ç”Ÿæˆä¸åŒç‰ˆæœ¬çš„ä»£ç æ¥å®ç°çš„ï¼Œä¸ä¼šå¼•å…¥è¿è¡Œæ—¶å¼€é”€ï¼ˆä½†è¯·æ³¨æ„å¯èƒ½ä¼šé€ æˆä»£ç ä½“ç§¯è†¨èƒ€ï¼‰ã€‚\n* åŠ¨æ€æ´¾å‘ï¼šæœ‰äº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•åœ¨ç¼–è¯‘æœŸé—´ç¡®å®šå˜é‡çš„å®é™…ç±»å‹ï¼Œè¿›è€Œæ— æ³•ç¡®å®šå…¶å ç”¨å†…å­˜å¤§å°ï¼ŒRust ä¹Ÿæä¾›äº† trait æœºåˆ¶æ¥å®ç°åŠ¨æ€æ´¾å‘ï¼ŒåŒæ—¶ Rust å°†æ­¤ç±» trait ä½¿ç”¨ dyn è¿›è¡Œæ˜¾å¼æŒ‡å®šï¼š\n\n```\n// åŠ¨æ€æ´¾å‘ï¼š\ntrait Speak {\n    fn hello(&self);\n}\nstruct Human;\nimpl Speak for Human {\n    fn hello(&self) {\n        println!(\"hello, I am a Human\");\n    }\n}\nfn test_hello(someone: Box<dyn Speak>) {\n    someone.hello();\n}\nfn main() {\n    let human = Human {};\n    test_hello(Box::new(human));\n}\n```\n\n### å®\n\nRust ä¸­çš„å®çš„èƒ½åŠ›éå¸¸å¼ºå¤§ï¼Œå…¶ä¸åŒäº C/C++ ä¸­çš„å®ç®€å•åœ°æŒ‰å­—ç¬¦ä¸²æ›¿æ¢ä»£ç ï¼Œè€Œæ˜¯åŸºäºè¯­æ³•æ ‘è¿›è¡Œæ“ä½œï¼Œåœ¨ç¼–è¯‘é˜¶æ®µè¢«å±•å¼€æˆæºä»£ç è¿›è¡ŒåµŒå…¥ã€‚\n\nå…·ä½“ Rust ä¸­çš„å®ä¹Ÿåˆ†ä¸ºå£°æ˜å®å’Œè¿‡ç¨‹å®ï¼Œèƒ½å¤Ÿå®ç°çš„éœ€æ±‚éå¸¸å¤šæ ·ï¼Œåœ¨ä¸€ä¸ªå¤§å‹é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®çš„ä½¿ç”¨è§£æ”¾ç”Ÿäº§åŠ›ï¼Œå¹¶ä¸”ä½¿ä»£ç æ›´æ¸…æ™°ã€‚ä¸è¿‡ï¼Œå®è¿™ä¸€éƒ¨åˆ†çš„å…·ä½“å­¦ä¹ ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼Œåœ¨è¿™é‡Œä¾¿ä¸å†è¿›è¡Œä¸¾ä¾‹ã€‚\n\n---\n\nç»¼åˆæ¥è¯´ï¼ŒRust ä½œä¸ºä¸€ä¸ªæ¯”è¾ƒå…ˆè¿›çš„è¯­è¨€ï¼Œæ²¡æœ‰å¤ªå¤šçš„å†å²åŒ…è¢±ï¼Œä»å„ä¸ªè¯­è¨€ä¸­å¸æ”¶äº†ä¸å°‘çš„ä¼˜è´¨ç‰¹æ€§ï¼Œæ¯”è¾ƒé€‚åˆæˆ‘ä»¬åœ¨æ–°é¡¹ç›®çš„æŠ€æœ¯é€‰å‹ä¸­ä½œä¸ºä¸€ä¸ªè€ƒè™‘å› ç´ ã€‚\n\n## å¦‚ä½•å¼€å§‹å­¦ä¹  rust\n\n### èµ·æ­¥\n\nrust æœ¬èº«çš„æ–‡æ¡£å’Œå­¦ä¹ èµ„æ–™å®˜æ–¹æä¾›çš„æ¯”è¾ƒå…¨é¢ï¼Œä¸€ä¸ªå¿…è¯»çš„å†…å®¹æ˜¯[â€œThe Rust Programming Languageâ€](https://doc.rust-lang.org/book/)ã€‚\n\nä¸è¿‡ï¼Œrust çš„å®˜æ–¹æ–‡æ¡£è¯»èµ·æ¥å¯èƒ½ç•¥æœ‰æ¯ç‡¥ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘å»ºè®®å¯ä»¥å…ˆå¼€å§‹è¯»*å¼ æ±‰ä¸œ*çš„ã€ŠRust ç¼–ç¨‹ä¹‹é“ã€‹ï¼Œç›¸å¯¹æ¥è¯´æ›´åŠ æ·±å…¥æµ…å‡ºï¼Œä¸è¿‡è¿˜æ˜¯åç»­è¿˜æ˜¯å»ºè®®è¯»ä¸€éæ–‡æ¡£ã€‚\n\n### é¡¹ç›®åº”ç”¨\n\nåœ¨æˆ‘ä»¬å°†ä¸Šè¿°å†…å®¹è¯»å®Œä¹‹åï¼ˆå¦‚æœæ¯å¤©ä¸¤ä¸ªå°æ—¶çš„è¯ï¼Œå¤§çº¦éœ€è¦ä¸€ä¸ªæœˆçš„æ—¶é—´ï¼‰ï¼Œå…·å¤‡äº†ä¸€å®šçš„ Rust è¯­è¨€åŸºç¡€ï¼Œå¯èƒ½éœ€è¦æ€è€ƒä¸‹å¦‚ä½•åœ¨ç°æœ‰é¡¹ç›®ä¸­è½åœ°ï¼Œæˆ‘ä¸ªäººçš„ä¸€ä¸ªå»ºè®®æ˜¯ï¼š\n\n* å¦‚æœç°æœ‰é¡¹ç›®æ˜¯å web çš„ï¼Œå¯ä»¥å…ˆè€ƒè™‘é€šè¿‡ wasm æ¥è½åœ°ï¼Œç›¸å¯¹æ¥è¯´ä¸Šæ‰‹æˆæœ¬å¾ˆä½ï¼Œæˆ‘ä¹‹å‰ä¹Ÿå¯¹[å…¥é—¨ Rust å¼€å‘ WebAssembly](https://zhuanlan.zhihu.com/p/104299612)æœ‰æ‰€æ€»ç»“ã€‚\n* å¦‚æœç°æœ‰é¡¹ç›®æ˜¯å native çš„ï¼Œå¯ä»¥è€ƒè™‘å°†éƒ¨åˆ†æ–°æ¨¡å—ã€æˆ–è€… crash å‘Šè­¦æ¯”è¾ƒå¤šçš„é€»è¾‘éƒ¨åˆ†ï¼Œä½¿ç”¨ rust å®ç°å¹¶ä¸”é€šè¿‡ C FFI å’Œç°æœ‰æ¨¡å—è¿›è¡Œäº¤äº’ï¼Œæ¸è¿›å¼å¼•å…¥ Rust æŠ€æœ¯æ ˆã€‚\n\n","tags":["Rust"]},{"title":"ä¸€äº›æ€§èƒ½ç›¸å…³çš„ JavaScript ä»£ç ç¼–å†™å»ºè®®è§„èŒƒ","url":"/2021/08/29/ä¸€äº›æ€§èƒ½ç›¸å…³çš„ JavaScript ä»£ç ç¼–å†™å»ºè®®è§„èŒƒ/","content":"\næœ¬æ–‡å¯¹ä¸€äº›æ—¥å¸¸ç¼–å†™ JavaScript çš„è¿‡ç¨‹ä¸­ï¼Œä¸€äº›æœ‰åŠ©äºæé«˜ä»£ç æ€§èƒ½çš„è§„èŒƒè¿›è¡Œç½—åˆ—ã€‚\n\n> æœ¬æ–‡æ¯”è¾ƒé›¶ç¢ï¼Œä¸ä½œä¸ºè§„èŒƒæè®®ï¼Œä»…ä½œä¸ºäº¤æµå‚è€ƒã€‚\n\n### 1. ä½¿ç”¨è§£æ„èµ‹å€¼ï¼Œå‡å°‘ä¸­é—´å˜é‡ã€‚\n\nå¯¹äºä¸€äº›æ¯”å¦‚å˜é‡æ›¿æ¢çš„åœºæ™¯ï¼Œæˆ‘ä»¬ä½¿ç”¨è§£æ„èµ‹å€¼ï¼Œå¯ä»¥çœç•¥ä¸­é—´å˜é‡ï¼Œæ•´ä½“ä»£ç ä¹Ÿä¼šæ›´åŠ æ¸…æ™°ã€‚\n\n```\nlet a = 3;\nlet b = 4;\n[b, a] = [a, b];\n```\n\n### 2. é€šè¿‡æ¡ä»¶åˆ¤æ–­æå‰è¿”å›\n\nè¿™é‡Œä¸»è¦æ˜¯æé†’å¤§å®¶å¦‚ä½•å†™å¥½ if è¯­å¥ã€‚\n\nå®é™…ä¸Šï¼Œ åœ¨ç¼–å†™å¤æ‚çš„ if è¯­å¥ä¹‹å‰ï¼Œæˆ‘ä»¬åº”è¯¥è€ƒè™‘æ˜¯å¦å¯ä»¥**é€»è¾‘å¤–åŒ–**ï¼š\n\nå³å°½å¯èƒ½çš„å°†ä»£ç çš„å¤æ‚é€»è¾‘å‘å¤–æ¨ï¼Œä¾‹å¦‚æŠ½ç¦»æˆå¤šä¸ªå‡½æ•°ï¼Œè€Œä¸æ˜¯åœ¨ç¨‹åºé‡Œé¢è¿›è¡Œè¿‡å¤šåˆ¤æ–­ã€‚æœ‰ä¸€ç§æ¯”è¾ƒå…¸å‹çš„ä¸åˆç†çš„é‡ç”¨æ˜¯æŠŠå¤§é‡çš„é€»è¾‘éƒ½å †å åˆ°ä¸€ä¸ªå‡½æ•°é‡Œé¢ï¼Œç„¶åæä¾›ä¸€ä¸ªå¾ˆå¤æ‚çš„åŠŸèƒ½ã€‚æˆ‘è®¤ä¸ºæ›´å¥½çš„åšæ³•åº”å½“æ˜¯åˆ†ç¦»æˆæ›´å¤šçš„æ¨¡å—ã€‚\n\nç»è¿‡ä»¥ä¸Šæ€è€ƒä¹‹åï¼Œæˆ‘ä»¬å¯èƒ½è¿˜æœ‰ä¸€äº› if è¯­å¥ï¼Œä¸€èˆ¬çš„åŸåˆ™æ˜¯ï¼š\n\n* if è¯­å¥å…ˆç®€å•ï¼Œåå¤æ‚ã€‚\n* if è¯­å¥ï¼Œå¯ä»¥æå‰è¿”å›å³æå‰è¿”å›ï¼Œå‡å°‘å¤æ‚çš„åµŒå¥—ã€‚\n\n```\n// nice:\nif (condition1) {\n  // do something\n  return;\n}\n\nif (condition2) {\n  // do something\n  return;\n}\n\nother_function();\n\n// bad:\nif (condition1) {\n  // do something\n} else {\n  if (condition2) {\n    // do something\n  } else {\n    other_function();\n  }\n}\n```\n\n### 3. å°½é‡é¿å…åœ¨å¾ªç¯ä½“å†…åŒ…è£¹å‡½æ•°è¡¨è¾¾å¼\n\nå‡½æ•°è¡¨è¾¾å¼ä¼šç”Ÿæˆå¯¹åº”çš„å‡½æ•°å¯¹è±¡ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å¾ªç¯ä½“å†…å»åšè¿™ä¸ªäº‹æƒ…ï¼Œå¾ˆå¯èƒ½ä¼šé€ æˆé¢å¤–çš„æµªè´¹ã€‚\n\n```\n// nice:\nfunction callback() {\n}\n\nconst len = nodelist.length;\nfor(let i = 0; i < len; i += 1) {\n  addListener(nodelist[i], callback);\n}\n\n// bad:\nfor(let i = 0; i < nodelist.length; i += 1) {\n  addListener(nodelist[i], function() {});\n}\n```\n\n### 4. å¯¹å¾ªç¯ä½“å†…çš„ä¸å˜å€¼ï¼Œåœ¨å¾ªç¯ä½“å¤–ä½¿ç”¨ç¼“å­˜\n\nè¿™ä¸€æ¡å…¶å®æ˜¯å¯¹ä¸Šä¸€æ¡çš„è¡¥å……ï¼Œå®é™…ä¸Šæ˜¯åŒæ ·çš„åŸç†ï¼Œå³å¸Œæœ›æˆ‘ä»¬åœ¨å¾ªç¯ä½“å†…å°½é‡ä¿æŒé€»è¾‘çš„ç®€å•ï¼Œå‡å°‘é‡å¤çš„ cpu æ—¶é—´å’Œå†…å­˜çš„æ¶ˆè€—ã€‚\n\n### 5. æ¸…ç©ºæ•°ç»„ä½¿ç”¨ .length = 0\n\nè¿™æ ·å†™å¯ä»¥æ–¹ä¾¿æˆ‘ä»¬æ¸…ç©ºä¸€ä¸ª const æ•°ç»„ã€‚\n\n```\nconst a = [1,2,3,4];\n// å¦‚æœä½¿ç”¨ a = [] ä¼šæŠ¥é”™\na.length = 0;\n```\n\n### 6. ä¸å¾—ä¸ºäº†ç¼–å†™æ–¹ä¾¿ï¼Œå°†å¹¶è¡Œçš„ io ä¸²è¡ŒåŒ–\n\nè™½ç„¶ç°åœ¨ JavaScript æœ‰äº† async/awaitï¼Œä½†æ˜¯æˆ‘å‘ç°å¾ˆå¤šåŒå­¦ä¼šå¯¹æ­¤æ»¥ç”¨ï¼Œä¸€ä¸ªå¾ˆå¸¸è§çš„æ¸…ç©ºå°±æ˜¯å°†å¯ä»¥å¹¶è¡Œçš„æ“ä½œä¸²è¡ŒåŒ–äº†:\n\n```\nlet res1 = await process1();\nlet res2 = await process2();\nnext(res1, res2);\n```\n\nè¿™ä¸ªæ—¶å€™ï¼Œè™½ç„¶å†™ä»£ç æ–¹ä¾¿ï¼Œä½†æ˜¯è¿™æ ·å†™æ˜¯ä¸å¯å–çš„ï¼ŒPromise æä¾›äº†è‹¥å¹²çš„æ–¹ä¾¿æˆ‘ä»¬å¤„ç†å¹¶è¡Œä»»åŠ¡çš„[æ–¹æ³•](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise#)ï¼Œæˆ‘è®¤ä¸ºè¿™äº›éƒ½æ˜¯å¿…é¡»è¦äº†è§£çš„ã€‚\n\n\n### 7. ç¦æ­¢ç›´æ¥ä½¿ç”¨ eval\n\neval çš„å®‰å…¨æ€§éå¸¸å·®ï¼Œäº‹å®ä¸Šæœ‰å¾ˆå¤šå·²çŸ¥çš„ xss ç­‰æ¼æ´éƒ½å’Œ eval æœ‰å…³ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å®é™…åœºæ™¯ä¸­é¿å…ä½¿ç”¨ evalã€‚\n\nå¦‚ä¸‹ä¸ºä¸€ä¸ªä¾‹å­ï¼Œä½¿ç”¨äº† eval å‡½æ•°ï¼Œç”±äºå…¶æ‰§è¡Œä»£ç çš„ä½œç”¨åŸŸä¸ºæœ¬åœ°ä½œç”¨åŸŸï¼Œæ‰€ä»¥å¯¹æˆ‘ä»¬çš„æœ¬åœ°å˜é‡è¿›è¡Œäº†ä¿®æ”¹å¹¶ä¸”å¯ä»¥ç”Ÿæ•ˆï¼š\n\n```\nlet tip = \"è¯·é‡æ–°ç™»å½•\"\nlet otherCode = `tip = \"è¯·å‰å¾€ xxx.com é‡æ–°ç™»å½•\"`\neval(otherCode);\n```\n\nä¸€äº›å–ä»£æ–¹å¼ï¼š\n\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `new Function` çš„æ–¹å¼æ¥ä»£æ›¿ evalï¼Œè¿™æ ·è‡³å°‘å¯ä»¥è¿›è¡Œä½œç”¨åŸŸçš„éš”ç¦»ï¼Œç›¸å¯¹ä¼šå®‰å…¨ä¸€äº›ï¼ˆä½†æ˜¯è¯·æ³¨æ„å…¶ä»ç„¶ä¼šå¯èƒ½å½±å“åˆ°å…¨å±€å˜é‡ï¼‰ã€‚\n\n### 8. æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œå°½é‡é¿å…ä½¿ç”¨ document.allã€document.querySelectorAll\n\nç±»ä¼¼çš„ all ç›¸å…³æ“ä½œéƒ½è¦é¿å…ä½¿ç”¨ï¼Œç”±äºæˆ‘ä»¬å¾ˆéš¾æ§åˆ¶éšç€é¡¹ç›®å‘å±•å†…å®¹ä¼šæœ‰å¤šå°‘ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€å¥½ä¸€å¼€å§‹å°±ä¸è¦ç•™ä¸‹éšç€é¡¹ç›®å†…å®¹å¢åŠ æ€§èƒ½è¶Šæ¥è¶Šå·®çš„éšæ‚£ã€‚\n\n### 9. è·å–å…ƒç´ çš„æ ·å¼ï¼Œå°½é‡ä½¿ç”¨ getComputedStyle æˆ– currentStyle\n\né€šè¿‡ style åªèƒ½è·å¾—å†…è”å®šä¹‰æˆ–é€šè¿‡ JavaScript ç›´æ¥å®šä¹‰çš„æ ·å¼ï¼Œé€šè¿‡ CSS class è®¾ç½®çš„æ ·å¼æ— æ³•ç›´æ¥è·å–ã€‚\n\n### 10. å°½å¯èƒ½é€šè¿‡ä¸ºå…ƒç´ æ·»åŠ é¢„å®šä¹‰çš„ ClassName æ¥æ”¹å˜å…ƒç´ æ ·å¼ï¼Œé¿å…ç›´æ¥æ“ä½œ style è¿›è¡Œè®¾ç½®ã€‚\n\nç›´æ¥æ“ä½œ styleï¼Œä¼šæ¯”è¾ƒæ··ä¹±ï¼Œè€Œä¸”æœ‰çš„æ—¶å€™è¿˜ä¼šå¿˜è®°å†™å•ä½ï¼Œå¯¼è‡´å®é™…ä¸Šä¸ç®¡ç”¨ã€‚\n\n","tags":["javascript"]},{"title":"å¦‚ä½•è®©ä½ çš„ç²¾åŠ›æ›´å¤šçš„ç”¨äºæé«˜æŠ€æœ¯æ·±åº¦","url":"/2021/07/26/å¦‚ä½•è®©ä½ çš„ç²¾åŠ›æ›´å¤šçš„ç”¨äºæé«˜æŠ€æœ¯æ·±åº¦/","content":"\n[çŸ¥ä¹ç‰ˆæœ¬](https://zhuanlan.zhihu.com/p/395177123)\n\né¢˜ç›®æ‰€è¿°ï¼Œå°±æ˜¯æˆ‘æœ€è¿‘å¾ˆä¹…ä¸€æ®µæ—¶é—´éƒ½åœ¨ç”¨æ¥æ€è€ƒçš„é—®é¢˜ã€‚\n\nå…ˆè¯´ä¸‹ä¸ªäººçš„èƒŒæ™¯ï¼Œç›®å‰å·²ç»æ¯•ä¸šä¸‰å¹´ï¼Œç¬¬ä¸€å¹´ä¸»è¦åšå‰ç«¯å¼€å‘ï¼Œå¤§çº¦åœ¨ä¸¤å¹´å‰ï¼Œæˆ‘çš„ä¸»è¦ç²¾åŠ›ä»å‰ç«¯è½¬å‘äº† Rustï¼Œè€Œååˆå¼€å§‹åœ¨å…¬å¸å‚ä¸å¼€å‘ c++ã€‚\n\nåœ¨è¿™ä¸‰å¹´é‡Œé¢ï¼Œè‡ªå·±æŒç»­é¢ä¸´ç€ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜å°±æ˜¯ï¼Œå¦‚ä½•ä»ä¸€ä¸ªç¹å¿™è€Œé‡å¤çš„å·¥ä½œä¸­ï¼ŒæŒç»­æå‡è‡ªå·±çš„æŠ€æœ¯æ·±åº¦ã€‚\n\nå› ä¸ºæˆ‘å‘ç°ï¼Œå½“åœ¨ä¸€ä¸ªå…¬å¸ä¹…äº†ä»¥åï¼Œéšç€å‚ä¸çš„ä¸šåŠ¡å¢å¤šï¼Œé—®é¢˜å’Œ OnCall ä¹Ÿéšä¹‹å¢å¤šï¼Œå¦å¤–éšç€ä½ å¯¹ä¸šåŠ¡çš„ç†Ÿæ‚‰ï¼Œä¼šæœ‰è¶Šæ¥è¶Šå¤šçš„æ–°åŒå­¦å‘ä½ é—®é—®é¢˜ã€‚å¤„ç†è¿™äº›é—®é¢˜ä¼šå æ®è¶Šæ¥è¶Šå¤šçš„ç²¾åŠ›ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ¯”è¾ƒâ€œå¹¸è¿â€ä¸­é€”ä¸šåŠ¡é»„æ‰æˆ–æ¶æ„å½»åº•å˜åŒ–äº†ï¼Œä½ å»å‚ä¸æ–°çš„é¡¹ç›®ï¼Œæœ‰å¯èƒ½èƒ½è·å¾—ä¸€æ¬¡æ¥è¿‘é‡æ–°å¼€å§‹çš„æœºä¼šï¼Œä½†å¤§å¤šæ•°æ—¶å€™ï¼Œä½ å¯èƒ½éƒ½æ²¡æœ‰è¿™ä¹ˆå¹¸è¿ã€‚\n\nå½“è¿™äº›é—®é¢˜å¤„ç†çš„ä¹…äº†ä»¥åï¼Œä½ ä¼šå‘ç°ç”šè‡³è¿å®Œæˆå·¥ä½œéƒ½éœ€è¦åŠ ç­æ¥è§£å†³ï¼Œå°±æ›´æ²¡æœ‰æ—¶é—´æ¥è¿›è¡ŒæŠ€æœ¯çš„æå‡äº†ï¼Œé•¿æ­¤ä»¥å¾€ï¼Œç„¦è™‘æ„Ÿä¾¿å€å¢ã€‚\n\nä¸è¿‡ï¼Œæœ€è¿‘æˆ‘åœ¨æ€è€ƒè¿™äº›é—®é¢˜çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿæ¸æ¸æ€»ç»“äº†ä¸€äº›ç¼“è§£çš„åŠæ³•ï¼Œæ¥ä¸‹æ¥ä¾¿å’Œå¤§å®¶è¿›è¡Œåˆ†äº«ã€‚\n\n**è¿™é‡Œçš„æ ¸å¿ƒç‚¹åœ¨äºï¼Œå‡å°‘çŠ¯é”™è¯¯çš„æœºä¼šï¼Œæé«˜å¤„ç†é—®é¢˜çš„æ•ˆç‡ï¼Œé‡Šæ”¾å‡ºè‡ªå·±çš„æ›´å¤šæ—¶é—´**\n\n## 1. æé«˜å¯¹ä»£ç çš„è¦æ±‚ï¼Œå†™æ›´å¥½çš„ä»£ç \n\næˆ‘æœ€è¿‘å¤„ç†çš„ä¼—å¤šé—®é¢˜ï¼Œç²—ç•¥ä¼°ç®—ï¼Œæœ‰å¤§çº¦ 1/3 éƒ½æ˜¯ç”±äºå¼€å‘è€…ä»£ç æ°´å¹³ä¸è¶³å¸¦æ¥çš„æŠ€æœ¯å€ºåŠ¡ï¼ˆå³ä»£ç é€»è¾‘é”™è¯¯ã€è¾¹ç•Œæƒ…å†µæœªè€ƒè™‘ã€æ€§èƒ½ä¸ç¨³å®šæ€§ä¸è¶³ç­‰ï¼‰ã€‚\n\næˆ‘è¿™é‡Œä¸»è¦é’ˆå¯¹çš„æ˜¯ PC å®¢æˆ·ç«¯ï¼Œè¿˜æœ‰å¾ˆå¤šé—®é¢˜å’Œç‰¹æ®Šæœºå™¨ã€å…¶ä»–æ¨¡å—å¹²æ‰°é¡¹ã€ç¡¬ä»¶é©±åŠ¨ç­‰å…³ç³»å¯†åˆ‡ï¼Œå¦‚æœæ˜¯çº¯å‰ç«¯é¡¹ç›®ï¼Œè¿™ä¸ªæ¯”ä¾‹åªä¼šæ›´é«˜ã€‚\n\nå› ä¸ºå†™ä»£ç çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰é‡‡ç”¨æœ€åˆç†çš„æ–¹å¼ï¼Œå¯¼è‡´æœ‰å‡ºç°é—®é¢˜çš„éšæ‚£ï¼Œå¦‚æœä½ çš„é—®é¢˜å‡ºç°çš„æ¦‚ç‡æ¯”è¾ƒé«˜ï¼Œå¤§æ¦‚ç‡ä¼šæ¯”è¾ƒå¹¸è¿åœ°è¾ƒæ—©å‘ç°ï¼Œä½†å¦‚æœå‡ºç°çš„æ¦‚ç‡ä½ï¼Œç”šè‡³ç°åº¦é˜¶æ®µéƒ½æ²¡æœ‰æš´éœ²ï¼Œé‚£ä¹ˆå½“åˆå‡ è¡Œä»£ç çš„é—®é¢˜ï¼Œä¼šè®©è‡ªå·±ä¹‹åèŠ±åŠ å€çš„æ—¶é—´æ¥å»å¤„ç†ï¼Œç”šè‡³è¿˜å¯èƒ½é¢ä¸´æ›´å¤šåæœã€‚\n\né‚£ä¹ˆï¼Œå¦‚ä½•è®©è‡ªå·±å†™å‡ºæ›´å¥½çš„ä»£ç å‘¢ï¼Œæˆ‘è®¤ä¸ºå¯ä»¥åšåˆ°ä»¥ä¸‹å‡ ç‚¹ï¼š\n\n* **è¯·ç†Ÿè¯»æ–‡æ¡£**ï¼Œæ¯”å¦‚å¦‚æœæ˜¯åœ¨å¼€å‘ Vue é¡¹ç›®ï¼Œé‚£ä¹ˆè¯·è‡³å°‘æŠŠ Vue çš„æ–‡æ¡£çœ‹ä¸€éï¼ŒReact åŒç†ï¼Œè¿™æ ·ä½ ä¼šæ›´åŠ æ¸…æ¥šï¼Œæ¡†æ¶åˆ°åº•æä¾›äº†é‚£äº›èƒ½åŠ›ï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ›´åˆé€‚çš„ API æ¥å®Œæˆä¸€ä¸ªç›®æ ‡ã€‚\n* æ³¨é‡æ³¨é‡Šï¼Œå¯¹äºä¸€äº›ç‰¹æ®Šå¤„ç†çš„æƒ…å†µï¼Œæ³¨é‡Šæ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œæœ€å¥½é™„ä¸Šæ–‡æ¡£ï¼Œå¦åˆ™å¯èƒ½æ—¶é—´ä¹…äº†ï¼Œè‡ªå·±éƒ½ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¿™æ ·å»å¤„ç†ï¼Œä¼šè®©ä¿®å¤é—®é¢˜èŠ±è´¹æ›´å¤šçš„æ—¶é—´ã€‚\n* é™¤éè¿«ä¸å¾—å·²ï¼Œä¸è¦æäº¤å¸¦æœ‰å·²çŸ¥ä¼˜åŒ–é¡¹çš„ä»£ç ï¼Œä¾‹å¦‚é‡å¤ä»£ç å¹¶æ²¡æœ‰å®Œå…¨å¤„ç†ã€ä»£ç åœ¨æŸäº›æƒ…å†µè¿˜å¯èƒ½é€ æˆé—®é¢˜ã€‚æ—¶é—´å…è®¸çš„æƒ…å†µä¸‹ï¼Œä¸€æ­¥åˆ°ä½ï¼Œé€šå¸¸æ¯”åˆ†ä¸¤æ¬¡åˆ°ä½èƒ½èŠ‚çº¦æ›´å¤šçš„æ—¶é—´ï¼Œè‡³å°‘èƒ½èŠ‚çº¦ä¸€æ¬¡æµ‹è¯•çš„æ—¶é—´ï¼Œå¦å¤–å¤§è„‘çš„ä¸Šä¸‹æ–‡åˆ‡æ¢è¿˜æœ‰å¼€é”€ã€‚\n* CI/CD çš„å»ºè®¾ï¼Œä¿è¯åˆå¹¶çš„ä»£ç æ˜¯èƒ½å¤Ÿç¼–è¯‘çš„ã€‚\n* å¯¹äºå‰ç«¯æ¥è¯´ï¼Œå…¨éƒ¨é‡‡ç”¨ Typescriptï¼Œä½¿ç”¨ ESLint çº¦æŸä»£ç ï¼Œ**ç¦æ­¢**ç›´æ¥ä½¿ç”¨ JavaScriptã€‚\n* å›¢é˜Ÿéœ€è¦å»ºç«‹ Review æœºåˆ¶ï¼Œå¹¶ä¸”å¯¹ Review è¿‡ç¨‹è´Ÿè´£ã€‚å¯¹äºåˆ«äººæäº¤ Review çš„ä»£ç è‡³å°‘éœ€è¦é€šè¯»ä¸€éï¼Œé¿å…åŸºæœ¬çš„é”™è¯¯ã€‚\n\n## 2. æ—¥å¿—æ˜¯è¯­è¨€çš„å¦ä¸€é¢ï¼Œä¹Ÿå¾ˆèƒ½ä½“ç°ä»£ç æ°´å¹³\n\nè¿™é‡Œçš„æ—¥å¿—ï¼ŒæŒ‡çš„æ˜¯åœ¨ç”¨æˆ·ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå®æ—¶ä¸Šä¼ çš„çš„æˆ–è€…ç¦»çº¿çš„æ—¥å¿—ã€‚\n\nè¿™é‡Œå•ç‹¬æä¸€ç‚¹æ—¥å¿—ï¼Œæ˜¯å› ä¸ºåœ¨å®é™…ä¸­ï¼Œæˆ‘ä»¬å¤§çº¦æœ‰ä¸€åŠæ—¶é—´åœ¨å†™ä»£ç ï¼Œè€Œå¦å¤–ä¸€åŠæ—¶é—´åœ¨æŸ¥é—®é¢˜ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆå°±ä¸èƒ½å¥½å¥½å†™æ—¥å¿—å‘¢ï¼Ÿ\n\nâ€œæ—¥å¿—ä¸è¶³/æ²¡æ‰“æ—¥å¿—ï¼Œéœ€è¦åŠ æ—¥å¿—è¿›ä¸€æ­¥å®šä½â€ã€‚\n\nä¸çŸ¥é“ä½ åœ¨ OnCall çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯å¦é‡åˆ°è¿‡æ­¤ç±»å›å¤ï¼Œå½“ç„¶å¹¶ä¸èƒ½è¯´æ¯æ¬¡è¿™æ ·çš„é—®é¢˜éƒ½æ˜¯å¼€å‘è€…æ°´å¹³ä¸è¶³å¯¼è‡´æ—¥å¿—ä¸å…¨ï¼Œä½†çš„ç¡®æœ‰å¾ˆå¤šæƒ…å†µæ˜¯æˆ‘ä»¬å¯ä»¥æå‰è§„é¿çš„ã€‚\n\né‚£ä¹ˆä¸€ä¸ªå¥½çš„æ—¥å¿—åº”è¯¥æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ\n\n1. å‰æï¼šåºŸè¯ä¸è¦å¤šï¼Œèƒ½ç®€å†™å°±ç®€å†™ï¼Œè¿™æ˜¯å› ä¸ºä¸€èˆ¬æ—¥å¿—éƒ½æ˜¯å­˜åœ¨ç”¨æˆ·æœ¬åœ°çš„ï¼Œæ—¥å¿—é‡æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹ä¼šå½±å“ç”¨æˆ·çš„ç¡¬ç›˜å ç”¨ï¼Œå½“ç„¶æ—¥å¿—æœ¬èº«çš„æ‰“å°ä¹Ÿæ˜¯æ¶ˆè€— CPU çš„ã€‚\n2. å…³é”®è·¯å¾„çš„æ—¥å¿—è¦æœ‰ï¼Œå¯èƒ½å‡ºé—®é¢˜çš„åœ°æ–¹ä¸è¦å­˜åœ¨ä¾¥å¹¸å¿ƒç†ï¼ŒæŠŠæ—¥å¿—æ‰“å…¨ï¼Œç‰¹åˆ«æ˜¯**ä¸åŒè´Ÿè´£æ¨¡å—ä¹‹é—´è¡”æ¥çš„æ—¥å¿—ï¼Œä¸€å®šæ‰“å…¨**ï¼Œè¿™æ ·ä¹‹åç”©é”…çš„æ—¶å€™æœ‰å®é”¤ä¹Ÿä¼šæ–¹ä¾¿ä¸€ç‚¹ã€‚\n3. å…³é”®æ—¥å¿—éœ€è¦æœ‰å…³é”®å­—ï¼Œæ–¹ä¾¿åé¢è‡ªåŠ¨åŒ–åˆ†æï¼Œæ¯•ç«Ÿï¼Œå¯¹äºä¸€ä¸ªæ¯”è¾ƒå®Œå–„çš„é¡¹ç›®è€Œè¨€ï¼Œæœºå™¨äººåˆ†ææ—¥å¿—ç”šè‡³æ¯”äººåˆ†ææ›´ä¸ºé è°±ã€‚\n4. æ—¥å¿—ä¹Ÿéœ€è¦**å‘å‰å…¼å®¹**ï¼Œæœ€å¥½ä¸è¦å¯¹ä»¥å‰çš„æ—¥å¿—è¿›è¡Œæ”¹åŠ¨ï¼Œè¿™ç‚¹æˆ‘ä»¬å¯èƒ½é€šå¸¸ä¼šå¿½ç•¥ï¼Œå¦‚æœæ²¡æœ‰å¿…è¦ï¼Œå»ºè®®ä¸è¦å¯¹æ—¥å¿—è¿›è¡Œå¤§çš„å˜åŠ¨ï¼Œé˜²æ­¢è‡ªåŠ¨åŒ–å·¥å…·å’Œå…¶ä»–åˆ†ææ—¥å¿—çš„åŒå­¦ä¸çŸ¥æƒ…ã€‚\n\nä»€ä¹ˆï¼Ÿä½ è¯´ä½ ä»¬å›¢é˜Ÿè¿˜æ²¡æœ‰æ—¥å¿—ç³»ç»Ÿï¼Ÿ\n\né‚£ä¹ˆç¬¬ä¸€ä»¶äº‹ï¼Œå°±æ˜¯è¦æœ‰ä¸€ä¸ªå®Œå–„çš„ç¦»çº¿æ—¥å¿—å›æç³»ç»Ÿæˆ–åœ¨çº¿æ—¥å¿—ç³»ç»Ÿã€‚\n\n## 3. æ‰“ç ´è¾¹ç•Œæœ‰åŠ©äºå¼€é˜”è§†é‡ï¼Œä½†æ˜¯æ˜¯å¦æ·±å…¥éœ€è¦æ…é‡å†³å®š\n\nè™½ç„¶æœ‰çš„æ—¶å€™ï¼Œå‘˜å·¥æ‰“ç ´è¾¹ç•Œå¯¹äºå…¬å¸æ¥ä¹¦å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½äº‹æƒ…ï¼Œä½†å¤§å¤šæ•°æƒ…å†µæ¥è¯´ï¼Œå¯¹ä¸ªäººè¿˜æ˜¯ä¼šæœ‰æ‰€å¸®åŠ©çš„ã€‚\n\n> ä¸ºä»€ä¹ˆè¯´ä¸æ˜¯ä¸€ä¸ªå¥½äº‹æƒ…å‘¢ï¼Œæ¯”å¦‚ä¸€ä¸ªå®¢æˆ·ç«¯çš„åŒå­¦ï¼Œå»åš c++ äº†ï¼Œè¿™ä¸ªæ—¶å€™åº”è¯¥é¼“åŠ±è¿˜æ˜¯åå¯¹å‘¢ã€‚å®é™…ä¸Šè¿™ä¸ªæ—¶å€™ï¼Œä»–é™¤äº†ä»…å­˜çš„ä¸šåŠ¡ç†Ÿæ‚‰åº¦å’Œä¸€äº›é€šç”¨çš„ç¼–ç¨‹èƒ½åŠ›ï¼Œc++ çš„èƒ½åŠ›ä¹Ÿè®¸å°±åªæœ‰åº”å±Šç”Ÿçš„æ°´å¹³ï¼Œå¦‚æœä»æ–°æ‹›è˜å¯èƒ½è¿åˆè¯•éƒ½è¿‡ä¸äº†ã€‚å…¬å¸å°±å¿…é¡»è¦æ‰¿æ‹…å› ä¸ºä»–çš„ç¼–ç¨‹èƒ½åŠ›ä¸ç†Ÿç»ƒå¸¦æ¥çš„æ•ˆç‡æŸå¤±ï¼Œç”šè‡³å› ä¸ºæ›´å®¹æ˜“å¼•å‘é—®é¢˜é€ æˆæ›´å¤§çš„æŸå¤±ã€‚\n\nä¸ºä»€ä¹ˆè¯´ï¼Œå¯¹äºä¸ªäººæ¥è¯´æ˜¯ä¸€ä¸ªå¥½äº‹æƒ…å‘¢ï¼Œè¿™ä¸ªä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\n\n* åœ¨å…¬å¸ä¸­å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯å¤šä¸ªè¯­è¨€çš„å¼€å‘è€…ç›¸äº’é…åˆçš„ï¼Œè€Œå½“ä½ åŒæ—¶å‚ä¸äº†ä½ ä¸Šæ¸¸æˆ–è€…ä¸‹æ¸¸çš„å·¥ä½œï¼Œä½ ä¼šå‘ç°æ²Ÿé€šä¼šæ›´åŠ é¡ºç•…äº†ï¼Œç”šè‡³è‡ªå·±ä¹Ÿæ‹¥æœ‰äº†ç®€å•çš„å¤„ç†éœ€æ±‚å’Œé—®é¢˜çš„èƒ½åŠ›ï¼Œåº•æ°”ä¼šé«˜å¾ˆå¤šã€‚\n* åœ¨ä½ å­¦ä¹ å¤šä¸ªè¯­è¨€çš„è¿‡ç¨‹ä¸­ä½ ä¼šå‘ç°ä¸€äº›ç²¾åçš„éƒ¨åˆ†ï¼Œæ¯”å¦‚é€šç”¨çš„æ¡†æ¶è®¾è®¡æ–¹æ³•ã€æ¨¡å—ç»„ç»‡æ–¹æ³•ç­‰å„ä¸ªè¯­è¨€éƒ½æ˜¯é€šç”¨çš„ï¼Œç”šè‡³æœ‰äº›ä»£ç ä½ ç›´æ¥ç¿»è¯‘è¿‡æ¥å°±å¯ä»¥ç›´æ¥ç”¨äº†ï¼Œè¿™ä¹Ÿå¯ä»¥è®©ä½ æ›´æ·±åˆ»åœ°äº†è§£åˆ°å“ªäº›æ˜¯ç¼–ç¨‹çš„ç²¾é«“ã€‚\n\nå½“ç„¶ï¼Œæœ‰çš„æ—¶å€™å¦‚æœä½ è·¨ç•Œå‚ä¸çš„å¤ªå¤šï¼Œä¾‹å¦‚æœ¬èº«æ˜¯ä¸€ä¸ªèµ„æ·±çš„å‰ç«¯å¼€å‘è€…ï¼Œå½“ä½ è·¨ç•Œå‚ä¸äº† c++ å¼€å‘ï¼Œä½ ä¼šå‘ç°çŸ­æ—¶é—´å†…ä½ çš„å‰ç«¯æ°´å¹³æ˜¯åœ¨ä¸‹é™çš„ï¼Œè€Œ c++ æ°´å¹³ä¹Ÿæ²¡æœ‰è¾¾åˆ°ç‹¬ç«‹æ‰¿æ‹…å·¥ä½œçš„ç¨‹åº¦ï¼Œè¿™çŸ­æ—¶é—´å†…ä½ çš„å¸‚åœºä»·å€¼å…¶å®æ˜¯æœ‰æ‰€ä¸‹é™çš„ï¼Œè¿™ä¹Ÿæ˜¯ä½ éœ€è¦æ…é‡è€ƒè™‘åˆ°åº•è¦å‚ä¸å¤šå°‘çš„åŸå› ä¹‹ä¸€ã€‚\n\n\n## 4. å¤æ‚ç³»ç»Ÿçš„åˆå§‹æ¶æ„è®¾è®¡ï¼Œå¯ä»¥ä½œä¸ºä¸€ä¸ªæœ€åå…œåº•\n\nå®é™…ä¸Šï¼Œå¤æ‚çš„ç³»ç»Ÿå¤§å¤šä¸€å¼€å§‹éƒ½ä¸å¤æ‚ï¼Œä½†æ˜¯å¦‚ä½•æ­£ç¡®åœ°é¢„åˆ¤ç³»ç»Ÿçš„èµ°å‘ï¼Œè®¾è®¡å‡ºå¯ä»¥æ²¿ç”¨å¾ˆä¹…çš„åŸºç¡€éª¨æ¶ã€çº¦æŸæ€§å¼ºå´æ‰©å±•å‹è¶³å¤Ÿçš„ç»„ä»¶ç³»ç»Ÿï¼ˆå³ä½¿åæ¥æ¥çš„äººæ°´å¹³å·®ä¹Ÿä¸è‡³äºå†™å‡ºå¤ªéš¾ç»´æŠ¤çš„ä»£ç ï¼‰ï¼Œä»¥åŠå’Œå¤–ç•Œå…¶ä»–ç³»ç»Ÿè¿›è¡Œçµæ´»çš„é…åˆï¼Œæ˜¯å¯¹æ°´å¹³æœ‰ä¸€å®šçš„è€ƒéªŒçš„ã€‚\n\nè¿™é‡Œæˆ‘ä»¥æŸè§†é¢‘ä¼šè®® App ä¸¾ä¾‹ï¼Œå…¶æœ€å¼€å§‹åªæœ‰è§†é¢‘+éŸ³é¢‘çš„ç®€å•èƒ½åŠ›ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šï¼Œå›¢é˜Ÿè´Ÿè´£äººè®¾è®¡å¹¶ç¼–å†™äº†åŸºäº Typescript çš„æ ¸å¿ƒçŠ¶æ€æœºã€æŒ‰ç…§ minor repo åˆ’åˆ†äº†ä¸»è¦æ¨¡å—ï¼Œè®¾è®¡äº† Store çŠ¶æ€å­˜å‚¨ï¼Œè®¾è®¡äº†ä¸€å¥— API æ³¨å…¥æ–¹å¼å¯ä»¥æ³¨å…¥ç³»ç»Ÿå¤–çš„ API ç­‰ç­‰ã€‚\n\nè¿™å¥—æ¶æ„æ²¿ç”¨äº†ä¸‰å¹´ï¼Œæ ¸å¿ƒä»£ç åŸºæœ¬æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼ŒåŠŸèƒ½ä¸Šå´æ–°å¢äº†å…±äº«å±å¹•ã€å…±äº«ç½‘é¡µã€èŠå¤©/è¡¨æƒ…ã€æ ‡æ³¨/ç™½æ¿ã€è¿œç¨‹æ§åˆ¶ã€å­—å¹•/å½•åˆ¶/ç¿»è¯‘ã€æ—¥ç¨‹ä¼šè®®ã€é¢è¯•ç­‰è‹¥å¹²é‡è¦çš„æ¨¡å—ã€‚\n\nè™½ç„¶å®é™…ä¸Šï¼Œéšç€åé¢çš„åŒå­¦çš„å¢å¤šï¼Œä»¥åŠæœ€åˆæ ¸å¿ƒå¼€å‘è€…çš„ç¦»èŒï¼Œå¼€å‘äººå‘˜å·²ç»å‡ ä¹æ¢äº†ä¸€æ‰¹ï¼Œä½†æ˜¯è¿™å¥—ä»£ç å’Œæ¶æ„åŸºæœ¬ä¸Šæ²¡å‘ç”Ÿå¤ªå¤šå˜åŒ–ï¼Œä¹Ÿä¸€ç›´æ”¯æ’‘ç€è‹¥å¹²é¡¹ç›®ã€‚\n\nï¼ˆp.s. æ®è¯´æœ€å¼€å§‹å‚ä¸è®¾è®¡çš„åŒå­¦åæ§½åé¢çš„ç»´æŠ¤æœ‰ç‚¹æ¸æ¸è·‘é¢˜ï¼Œä½†æ˜¯æ•´ä½“è¿˜æ˜¯å¯ç”¨æ€§æ¯”è¾ƒé«˜çš„ï¼‰ã€‚\n\nå¦‚æœæ²¡æœ‰ä¸€å®šæ°´å¹³ï¼Œæƒ³å¿…ä¸šåŠ¡æ¡†æ¶æ—©å°±éšç€ä¸šåŠ¡çš„å˜æ›´é‡æ„è¿‡å¤šæ¬¡äº†ï¼Œè‚¯å®šä¼šå¸¦æ¥å·¨å¤§çš„äººåŠ›æµªè´¹ã€‚\n\n## 5. æŒç»­ç»ƒä¹ ï¼ŒæŒç»­å…³æ³¨è¡Œä¸šåŠ¨æ€\n\næœ€åä¸€ç‚¹ï¼ŒæŒç»­å­¦ä¹ ï¼Œå¤§æ¦‚æ˜¯ç¨‹åºå‘˜çš„å®¿å‘½å§ã€‚\n\nè¿™é‡Œå…¶å®ä¸ç”¨å¤šè¯´äº†ï¼Œä½†æ˜¯æƒ³æä¸€ç‚¹ï¼Œå…¶å®æœ‰çš„æ—¶å€™å¦‚æœä½ å‘ç°ä¸»åŠ¨çš„æŒç»­å­¦ä¹ ä¼šæ¯”è¾ƒéš¾çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€‰æ‹©ä¸€ç§åŠè¢«åŠ¨çš„æ–¹å¼ã€‚\n\næ¯”å¦‚ï¼Œæ¯å‘¨ç»™è‡ªå·±å®šæ—¥ç¨‹å‚ä¸ leetcode å‘¨èµ›ï¼Œä½ æŠŠå®ƒå½“ä½œè‡ªå·±å·¥ä½œçš„æ— å¯æ¨è„±çš„ä¸€éƒ¨åˆ†ï¼Œè¿™æ ·æŒç»­å‡ æ¬¡ï¼Œä½ å°±ä¼šæ…¢æ…¢ä¹ æƒ¯è¿™ä¸ªè¿‡ç¨‹ã€‚\n\n---\n\nä»¥ä¸Šå…±å‹‰ã€‚\n\n\n\n","tags":["å‰ç«¯ç»¼åˆ"]},{"title":"Deno æ˜¯å¦‚ä½•è¿è¡Œ TypeScript çš„ï¼Ÿ","url":"/2021/01/31/Deno æ˜¯å¦‚ä½•è¿è¡Œ TypeScript çš„/","content":"\n> Denoï¼Œä¸€ä¸ª JavaScript/TypeScript è¿è¡Œæ—¶ã€‚æœ¬æ–‡å¹¶ä¸ä¼šä» JavaScript çš„è§’åº¦æ¥å»ä»‹ç»å¦‚ä½•ä½¿ç”¨ Denoï¼Œè€Œæ˜¯è¯•å›¾ä»æ¡†æ¶å®ç°çš„è§’åº¦ï¼Œæ¥æ•´ä½“å¯¹ Deno é¡¹ç›®æœ¬èº«çš„å¼€å‘å®ç°è¿›è¡Œè§£è¯»ï¼Œå¹¶ä¸”é€šè¿‡åˆ†æå…¶è¿è¡Œ TypeScript çš„åŸç†ï¼Œæ¥å¯¹å…¶è¿›è¡Œä¸€ä¸ªå…¥é—¨çš„å‰–æã€‚\n\n[åŸæ–‡é“¾æ¥å·²ç»è½¬ç§»è‡³è¿™é‡Œ](https://zhuanlan.zhihu.com/p/348379605)","tags":["å‰ç«¯æ¡†æ¶"]},{"title":"ä½¿ç”¨ Rust WebAssembly 0æ‹·è´è¿›è¡Œè®¡ç®—åŠ é€Ÿ","url":"/2020/06/26/ä½¿ç”¨RustWebAssembly0æ‹·è´è¿›è¡Œè®¡ç®—åŠ é€Ÿ/","content":"\ndemo: https://github.com/aircloud/rust-wasm-demo  \n\nå…¶ä»–èµ„æ–™ï¼š[å…¥é—¨ Rust å¼€å‘ WebAssembly](https://zhuanlan.zhihu.com/p/104299612)\n\nä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨ WebAssembly èƒ½å¤Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜æ€§èƒ½ï¼Œä¸è¿‡æœ‰çš„æ—¶å€™æˆ‘ä»¬ä¹Ÿè®¸ä¼šå‘ç°ï¼Œä½¿ç”¨ WebAssembly ä¹‹åï¼Œæœ‰çš„æ—¶å€™æˆ‘ä»¬ä¸ä»…å‘ç°æ€§èƒ½æ²¡æœ‰æå‡ï¼Œåè€Œä¸‹é™äº†è®¸å¤šç”šè‡³æ•°å€ï¼Œå®é™…ä¸Šè¿™æ˜¯å› ä¸ºï¼Œä½¿ç”¨ WebAssembly éœ€è¦éå¸¸è°¨æ…ï¼Œæœ‰å¾ˆå¤šç»†èŠ‚éƒ½ä¼šå¤§å¹…åº¦å½±å“æ€§èƒ½ï¼Œæ¯”å¦‚ï¼š\n\n* æˆ‘ä»¬ç¼–è¯‘é‡‡ç”¨çš„æ˜¯ debug è¿˜æ˜¯ release æ–¹å¼ã€‚\n* æœ€åç¼–è¯‘çš„ç»“æœæ˜¯å¦é‡‡ç”¨äº†ä¸åŒçº§åˆ«çš„ä¼˜åŒ–ï¼Œå¦‚æœä½¿ç”¨äº† `opt-level = 's'` é‚£ä¹ˆé€šå¸¸é€Ÿåº¦ä¹Ÿä¼šä¸‹é™å¾ˆå¤šã€‚\n* æ˜¯å¦åœ¨ JS å’Œ rust ä¹‹é—´å­˜åœ¨å¤§é‡çš„æ•°æ®æ‹·è´ï¼Œå› ä¸ºå¾ˆå¤šä»£ç æ˜¯å·¥å…·é“¾ç”Ÿæˆçš„ï¼Œä¹Ÿè®¸æœ‰çš„æ—¶å€™æˆ‘ä»¬ä¼šå¿½è§†è¿™ä¸€ç‚¹ã€‚\n\næœ¬æ–‡é’ˆå¯¹ä»¥ä¸Šç­‰ä¸€äº›é—®é¢˜ç‰¹åˆ«æ˜¯ç¬¬ä¸‰ç‚¹ï¼Œç»™å‡ºä¸€ä¸ª wasm ä¼˜åŒ–çš„å‚è€ƒæ–¹æ¡ˆï¼Œå¹¶ç»™å‡ºç¤ºä¾‹ä»£ç ã€‚\n\n### ç¼–è¯‘ä¼˜åŒ–\n\næˆ‘ä»¬åœ¨ä¼˜åŒ–æ•°æ®æ‹·è´ä¹‹å‰ï¼Œå¯¹äºç¼–è¯‘æˆ‘ä»¬å¯ä»¥åšä¸€äº›å‰ç½®çš„ç®€å•çš„å·¥ä½œã€‚\n\n* æ£€æŸ¥ Cargo.toml è„šæœ¬ä¸­ `[profile.release]` ä¸­çš„ `opt-level` é€‰é¡¹ï¼Œç¡®è®¤æˆ‘ä»¬æ‰€ä½¿ç”¨çš„å€¼ï¼š\n\n```\nThis flag controls the optimization level.\n\n0: no optimizations, also turns on cfg(debug_assertions) (the default).\n1: basic optimizations.\n2: some optimizations.\n3: all optimizations.\ns: optimize for binary size.\nz: optimize for binary size, but also turn off loop vectorization.\nNote: The -O flag is an alias for -C opt-level=2.\n\nThe default is 0.\n```\n\nå¦‚æœæˆ‘ä»¬ä½¿ç”¨äº† â€˜sâ€™ æˆ–è€… 'z'ï¼Œé‚£ä¹ˆé€šå¸¸ä¼šç‰ºç‰²ä¸€éƒ¨åˆ†æ€§èƒ½ï¼ˆå¯¹äº demo è€Œè¨€ï¼Œä½¿ç”¨ 'z'ï¼Œ wasm çš„æ€§èƒ½ä¹Ÿåªæœ‰ js çš„ 20%ï¼‰ï¼Œå› ä¸ºå…¶ä¸»è¦æ˜¯å¯¹ä½“ç§¯è¿›è¡Œä¸€å®šçš„ä¼˜åŒ–ï¼Œæ‰€ä»¥å¦‚æœä¼˜åŒ–å‰çš„ä½“ç§¯æˆ‘ä»¬å¯ä»¥æ¥å—çš„è¯ï¼Œé€šå¸¸ä¸éœ€è¦è¿™æ ·çš„ä¼˜åŒ–ã€‚\n\nåœ¨ä»¥ä¸Šçš„å‰æä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ `--release` çš„æ–¹å¼ç¼–è¯‘ï¼Œé€šå¸¸å°±å¯ä»¥äº†ã€‚\n\n### å‡å°‘æ‹·è´\n\nåœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªè®¤çŸ¥ï¼š\n\n**é€šè¿‡ rust å·¥å…·é“¾ç¼–è¯‘çš„ wasm ä»£ç ï¼Œæ‰€æœ‰å‚æ•°ä¼ å…¥éƒ½æ˜¯éœ€è¦æ‹·è´ä¸€æ¬¡çš„ï¼ŒåŒ…æ‹¬æˆ‘ä»¬ä¼ å…¥ ArrayBuffer ç­‰ Buffer ç±»å‹çš„å‚æ•°ã€‚**è¿™æ˜¯ç”±äº wasm åªèƒ½è®¿é—®è‡ªå·±çš„çº¿æ€§å†…å­˜ï¼Œè€Œè¿™ä¸ªæ‹·è´ï¼Œé€šå¸¸æ˜¯æˆ‘ä»¬åœ¨å¤„ç†å¤§è§„æ¨¡è®¡ç®—çš„ä¸€ä¸ªåï¼Œæœ‰çš„æ—¶å€™è™½ç„¶ wasm è®¡ç®—å¿«ä¸€ç‚¹ï¼Œä½†æ˜¯æ‹·è´çš„æ¶ˆè€—è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼ŒåŠ ä¹‹ js æœ‰è‹¥å¹² v8 ä¼˜åŒ–çš„åŠ æŒï¼Œå¯èƒ½å’Œ wasm ä¹Ÿç›¸å·®ä¸å¤šã€‚\n\næ‰€ä»¥æˆ‘ä»¬è¦æŠŠè®¡ç®—ç§»æ¤åˆ° wasm ä¸­çš„è¯ï¼Œé¦–å…ˆè¦è§£å†³çš„å°±æ˜¯å¤§è§„æ¨¡æ•°æ®æ‹·è´çš„é—®é¢˜ã€‚\n\nè¿™é‡Œçš„ä¸€èˆ¬æ€è·¯ä¸ºï¼š\n\n1. wasm åˆ†é…å†…å­˜ï¼šè°ƒç”¨ wasm çš„æ–¹æ³•ï¼Œåœ¨ wasm å†…å­˜ä¸­åˆ†é…ç©ºé—´ï¼Œè¿”å›æŒ‡é’ˆä½ç½®\n2. js å†™å…¥æ•°æ®ï¼šjs ç«¯åœ¨ wasm çš„ memory arraybuffer ä¸Šï¼ŒæŒ‰æŒ‡é’ˆä½ç½®å’Œæ•°æ®é‡å»ºç«‹ viewï¼ŒæŠŠæ•°æ®å†™å…¥\n3. wasm è®¡ç®—ï¼šè°ƒç”¨ wasm æ–¹æ³•å®Œæˆè®¡ç®—ï¼Œ è¿”å›è®¡ç®—å¥½çš„æ‰¹é‡ç»“æœçš„æŒ‡é’ˆä½ç½®å’Œå¤§å°\n4. js è¯»å–æ•°æ®ï¼šjs ç«¯åœ¨ wasm çš„ memory arraybufferä¸Šï¼ŒæŒ‰æŒ‡é’ˆä½ç½®å’Œæ•°æ®é‡å»ºç«‹ viewï¼ŒæŠŠæ•°æ®è¯»å‡º\n\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ª demo æ¥å®Œæˆä»¥ä¸Šå‡ ç‚¹ï¼Œdemo çš„ä¸»è¦åŠŸèƒ½ä¸ºï¼š\n\n* åˆå§‹åŒ–ä¸€ä¸ª ImageDataï¼Œå†…å®¹éšæœºã€‚\n* åˆ†åˆ«ä½¿ç”¨ js å’Œ WebAssembly è¿›è¡Œé«˜æ–¯æ¨¡ç³Šè®¡ç®—ï¼Œå¹¶è®¡ç®—äºŒè€…çš„æ—¶é—´ï¼Œè¿›è¡Œå¯¹æ¯”ã€‚\n\nè¿™é‡Œçš„ demo åªæ˜¯è¾…åŠ©è¿›è¡ŒéªŒè¯æ”¹æ–¹æ¡ˆçš„å¯è¡Œæ€§å¹¶ä¸”ç»™å‡ºä¸€ä¸ªç¤ºä¾‹ï¼Œå¹¶ä¸ä½œä¸ºä¸€ä¸ªæ ‡å‡†çš„ benchmark å»å¯¹æ¯” js å’Œ WebAssembly çš„æ€§èƒ½ï¼ŒåŒæ—¶ï¼Œä¹Ÿå¹¶æ²¡æœ‰ UI å±•ç¤ºï¼Œè®¡ç®—ç»“æœè¾“å‡ºåœ¨æ§åˆ¶å°ä¸­ã€‚\n\næœ€ç»ˆç¬”è€…è¿è¡Œçš„ç»“æœä¸ºï¼Œjs æ¯” WebAssembly æ…¢ 30% å·¦å³ã€‚\n\n#### 1. wasm åˆ†é…å†…å­˜\n\nè¿™éƒ¨åˆ†çš„é€šç”¨åšæ³•ï¼Œå³æˆ‘ä»¬åœ¨ wasm çš„ rust ä¸­åˆ†é…ä¸€ä¸ªæ•°ç»„ï¼ˆVecï¼‰ï¼Œç„¶åæŠŠå…¶æŒ‡é’ˆä¼ é€’ç»™ jsï¼š\n\n```\n// rustï¼š\n#[wasm_bindgen]\npub fn new_buffer(key: String, len: usize) -> *const u8 {\n  // GlobalBufferStorage æ˜¯ä¸€ä¸ª lazy_static\n  let mut global_buffer_storage = GlobalBufferStorage.lock().unwrap();\n  let mut buffer = vec![255; len];\n  let ptr = buffer.as_ptr();\n  global_buffer_storage.buffer_map.insert(key, buffer);\n  ptr\n}\n```\n\nä¸ºäº†åç»­æ–¹ä¾¿å¯»æ‰¾åˆ°è¿™æ®µæ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ª key å°†è¿™ä¸ª Vec è”ç³»èµ·æ¥ï¼Œå¹¶ä¸”åœ¨ Rust ä¸­æ”¾å…¥å…¨å±€ï¼ˆå¯ä»¥ä½¿ç”¨ lazy_static!ï¼Œå› ä¸ºè¿™ç§ç±»å‹çš„æ•°æ®æ²¡æœ‰åŠæ³•ç›´æ¥å®šä¹‰åœ¨å…¨å±€ï¼‰ï¼Œä¹‹åé€šè¿‡ key æ¥æŸ¥æ‰¾æ•°æ®ã€‚\n\nåœ¨ js ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥å»ºç«‹å„ç§ TypedArray å¯¹å…¶è¿›è¡Œæ“ä½œï¼š\n\n```\nconst ptr = this.wasm!.new_buffer(key, len);\nconst u8Arr = new Uint8ClampedArray(this.wasm!.get_wasm_buffer(), ptr, len);\n```\n\n**è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬åœ¨ js æˆ– rust ä»»ä½•ä¸€ä¾§æ”¹äº†è¿™ä¸ªæ•°æ®ä¹‹åï¼Œéƒ½å¯ä»¥åœ¨å¦å¤–ä¸€ä¾§è®¿é—®åˆ°ã€‚**\n\nå®é™…ä¸Šï¼Œåœ¨ js ä¾§çš„æ¯”å¦‚ [ImageData](https://developer.mozilla.org/en-US/docs/Web/API/ImageData/ImageData) ç­‰ä¸€äº›å¯¹è±¡ä¸­ï¼Œä¹Ÿæ”¯æŒæˆ‘ä»¬ä¼ é€’ä¸€ä¸ª TypedArray è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™è®©æˆ‘ä»¬åœ¨æ¯”å¦‚ canvas ç­‰åº”ç”¨åœºæ™¯ä¸‹ï¼Œä½¿ç”¨ wasm åˆ†é…çš„å†…å­˜æ›´ä¸ºæ–¹ä¾¿ã€‚\n\n```\nconst imageData = new ImageData(u8Arr, width, height);\n```\n\n#### 2. js å†™å…¥æ•°æ®\n\nå¦‚æœæˆ‘ä»¬éœ€è¦åœ¨ js ä¾§å†™å…¥æ•°æ®ï¼Œå®é™…ä¸Šè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¾—åˆ°çš„ TypedArray å·²ç»å’Œç›´æ¥ä½¿ç”¨ js new çš„ TypedArray åœ¨ä½¿ç”¨ä¸Šæ²¡æœ‰å·®åˆ«ï¼Œå¯ä»¥æ­£å¸¸æŒ‰ç…§æ•°ç»„çš„æ–¹å¼è¿›è¡Œæ•°æ®å†™å…¥ã€‚\n\nä¸è¿‡ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œjs å†™å…¥é€šè¿‡ wasm åˆ†é…å†…å­˜å»ºç«‹çš„ TypedArrayï¼Œæœ‰äº›åœºæ™¯ä¸‹åœ¨ä¸€å®šç¨‹åº¦ä¸Šé€Ÿåº¦è¦æ…¢äºç›´æ¥ä½¿ç”¨ js new çš„ TypedArrayï¼ˆä¸è¿‡åœ¨ç¬”è€…çš„æµ‹è¯•æ•°æ®ä¸­ï¼Œwasm åˆ†é…çš„æ–¹å¼åè€Œæ˜¯æ›´å¿«çš„ï¼‰ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æ˜¯ä¸€ä¸ªé«˜é¢‘çš„æ•°æ®å†™å…¥çš„åœºæ™¯ï¼Œæ¯”å¦‚å¸§æ•°æ®ç­‰ï¼Œè¿™ä¸ªæ—¶å€™æœ€å¥½è¿›è¡Œä¸€æ¬¡å¯¹æ¯”æµ‹è¯•ã€‚\n\n\n#### 3. wasm è®¡ç®—\n\nå½“æˆ‘ä»¬çœŸæ­£éœ€è¦è¿›è¡Œè®¡ç®—çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ wasm çš„è®¡ç®—å‡½æ•°ï¼Œå¹¶ä¸”ä¼ å…¥ä¸Šæ–‡ä¸­å®šä¹‰çš„ keyï¼Œè¿™æ · wasm çš„ rust å‡½æ•°å¯ä»¥ç›´æ¥æ‰¾åˆ°è¿™æ®µæ•°æ®ï¼Œè¿™é‡Œæˆ‘ä»¬çš„ demo ä¸ºä¸€æ®µè®¡ç®—å·ç§¯çš„å‡½æ•°ï¼š\n\n```\n#[wasm_bindgen]\npub fn convolution(key: String, width: usize, height: usize, kernel: Vec<i32>) {\n  let mut global_buffer_storage = GlobalBufferStorage.lock().unwrap();\n  let kernel_length = kernel.iter().sum::<i32>() as i32;\n  if let Some(buffer) = global_buffer_storage.buffer_map.get_mut(&key) {\n    for i in 1..width-1 {\n      for j in 1..height-1 {\n        let mut newR: i32 = 0;\n        let mut newG: i32 = 0;\n        let mut newB: i32 = 0;\n        for x in 0..3 { // å–å‰åå·¦å³å…±9ä¸ªæ ¼å­\n          for y in 0..3 {\n            newR += buffer[width * (j + y - 1) * 4 + (i + x - 1) * 4 + 0] as i32 * kernel[y * 3 + x] / kernel_length;\n            newG += buffer[width * (j + y - 1) * 4 + (i + x - 1) * 4 + 1] as i32 * kernel[y * 3 + x] / kernel_length;\n            newB += buffer[width * (j + y - 1) * 4 + (i + x - 1) * 4 + 2] as i32 * kernel[y * 3 + x] / kernel_length;\n          }\n        }\n        buffer[width * j * 4 + i * 4 + 0] = newR as u8;\n        buffer[width * j * 4 + i * 4 + 1] = newG as u8;\n        buffer[width * j * 4 + i * 4 + 2] = newB as u8;\n      }\n    }\n  } else {\n    return ();\n  }\n}\n```\n\nå› ä¸ºè¿™æ®µå‡½æ•°å¯¹åº”æ“ä½œçš„å†…å­˜æ•°æ®å®é™…ä¸Šå·²ç»åœ¨ wasm å’Œ js ä¹‹é—´å…±äº«äº†ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯ä¸éœ€è¦è¿”å›å€¼çš„ï¼Œç­‰è®¡ç®—å®Œæˆå js ç›´æ¥å»è¯»ä¹‹å‰å»ºç«‹çš„ TypedArrayï¼Œç”šè‡³ç›´æ¥ä½¿ç”¨é€šè¿‡ TypedArray åˆ›å»ºçš„ ImageDataï¼Œè¿›è¡Œç»˜åˆ¶ä¸Šå±ç­‰åç»­æ“ä½œã€‚\n\n#### 4. js è¯»å–æ•°æ®\n\nåœ¨ demo ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ `CanvasRenderingContext2D.putImageData()` ä¼ å…¥ä¹‹å‰è·å–çš„ imageDataï¼Œç»˜åˆ¶ä¸Šå±ã€‚\n\n### å…¶ä»–æ–¹æ¡ˆ\n\nå®é™…ä¸Šï¼Œæˆ‘ä»¬å¦‚æœç›®çš„æ˜¯åŠ é€Ÿ js è®¡ç®—ï¼Œä¸ä»…ä»…æœ‰ WebAssembly è¿™ä¸€ä¸ªæ–¹æ¡ˆå¯ä»¥é€‰æ‹©ï¼Œå¦‚æœæˆ‘ä»¬çš„ç¯å¢ƒä¸­æ‹¥æœ‰å¯ä»¥è®¿é—® Node çš„èƒ½åŠ›æˆ–è€…å¯ä»¥è®¿é—®åŸç”Ÿæ¨¡å—çš„èƒ½åŠ›ï¼ˆæ¯”å¦‚ï¼Œæˆ‘ä»¬çš„åº”ç”¨è¿è¡Œåœ¨ electron ç¯å¢ƒï¼Œæˆ–è€…æ˜¯ä¸€äº›ç§»åŠ¨å®¢æˆ·ç«¯ï¼‰ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨æ¯”å¦‚ addon çš„æ–¹å¼æ¥è¿è¡Œæˆ‘ä»¬çš„è®¡ç®—éƒ¨åˆ†ï¼Œç›¸æ¯”äº wasmï¼Œè¿™éƒ¨åˆ†çš„ä¼˜ç¼ºç‚¹åœ¨äºï¼š\n\nä¼˜ç‚¹ï¼š\n\n* é€šå¸¸å¯ä»¥æ›´å¥½çš„æ§åˆ¶ä¼˜åŒ–ï¼Œç”šè‡³åšåˆ°æ±‡ç¼–çº§åˆ«çš„ä¼˜åŒ–å®šåˆ¶ï¼Œæ€§èƒ½æå‡ç©ºé—´æ›´é«˜ï¼ˆåŒæ ·ä¹Ÿå¯èƒ½ä¼šé¢ä¸´æ•°æ®æ‹·è´çš„é—®é¢˜ï¼Œä¹Ÿéœ€è¦ä¸€å®šæ–¹å¼å‡å°‘æ‹·è´ï¼‰ã€‚\n* åœ¨é‡ addon çš„ç¯å¢ƒä¸‹ï¼ˆä¾‹å¦‚ï¼Œå…¶ä»–å¤§é‡åŠŸèƒ½ä¹Ÿä¾èµ– addonï¼‰ï¼Œå¯ä»¥æ›´å¥½çš„å¤„ç†å‡½æ•°è°ƒç”¨å…³ç³»ã€ä¾èµ–åº“ä½¿ç”¨ç­‰ï¼Œä¸€å®šç¨‹åº¦ä¸Šå‡å°‘ä½“ç§¯å’Œå¢åŠ å¼€å‘çš„ä¾¿æ·æ€§ï¼Œè€Œ wasm ä¼šè¢«ç¼–è¯‘æˆä¸€ä¸ªç‹¬ç«‹çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¤„äºæ²™ç›’ç¯å¢ƒä¸­ï¼Œæ— æ³•ç›´æ¥è°ƒç”¨å…¶ä»–çš„åŠ¨æ€åº“ã€‚\n\nç¼ºç‚¹ï¼š\n\n* æ— æ³•åšåˆ°åƒ wasm ä¸€æ ·è·¨å¹³å°ï¼Œå¹¶ä¸”å¯ä»¥åŒæ—¶è¿è¡Œåœ¨ç½‘é¡µã€æ¡Œé¢ç¯å¢ƒã€ç§»åŠ¨ç«¯ç­‰ä»»ä½• Webview å­˜åœ¨çš„ç¯å¢ƒä¸­ã€‚\n\nä¸è¿‡æ€»ä¹‹ï¼Œå¦‚æœä½¿ç”¨å¾—å½“ï¼ŒäºŒè€…çš„æ€§èƒ½éƒ½æ˜¯å¯ä»¥ä¼˜äºåŸç”Ÿçš„ jsï¼Œéƒ½å¯ä»¥ä½œä¸ºä¼˜åŒ–æ–¹æ¡ˆè€ƒè™‘ã€‚\n","tags":["Rust"]},{"title":"ä½¿ç”¨ OpenCV å®ç°ç®€å•çš„äººè„¸è¯†åˆ«ç¨‹åº","url":"/2019/09/10/ä½¿ç”¨OpenCVå®ç°ç®€å•çš„äººè„¸è¯†åˆ«ç¨‹åº/","content":"\næœ¬é—®å°± Mac ç³»ç»Ÿå®‰è£… OpenCV ä»¥åŠå®ç°ä¸€ä¸ªç®€å•çš„äººè„¸è¯†åˆ«ç¨‹åºè¿›è¡Œè®°å½•ã€‚\n\n### å®‰è£… OpenCV\n\nå®é™…ä¸Šï¼ŒOpenCV çš„å®‰è£…æ–¹å¼æ¯”è¾ƒå¤šï¼Œè¿™é‡Œä¸ºäº†é¿å…ä¸€äº›ç¬¬ä¸‰æ–¹å®‰è£…çš„é—®é¢˜ï¼Œæˆ‘ä»¬é‡‡ç”¨æºä»£ç æ–¹å¼å®‰è£…ã€‚\n\nå®‰å…¨å‰è¯·ç¡®ä¿æœ¬æœºå·²ç»å®‰è£…äº† CMake å’Œ Xcodeã€‚\n\næˆ‘ä»¬å»[ OpenCV çš„ç½‘ç«™](https://opencv.org/releases/) ä¸‹è½½æºä»£ç ï¼Œé€‰æ‹© Release -> SourceCodeï¼Œå¯ä»¥é€‰æ‹©æœ€æ–°çš„ 4.11 ç‰ˆæœ¬ã€‚\n\nè¿™é‡Œä»¥ 4.1.1 ç‰ˆæœ¬ä¸ºä¾‹ï¼Œä¸‹è½½åæˆ‘ä»¬è§£å‹åˆ° `opencv-4.1.1`ï¼Œç„¶åè¿›å…¥åˆ°è¯¥ç›®å½•ï¼Œæ–°å»ºä¸€ä¸ª release ç›®å½•ç”¨äºå­˜æ”¾æˆ‘ä»¬æ„å»ºå¥½çš„å†…å®¹ï¼Œå¹¶è¿›å…¥åˆ°è¯¥ç›®å½•ï¼š\n\n```\nmkdir release\ncd release/\n```\n\nç„¶åæˆ‘ä»¬ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š\n\n```\ncmake -G â€œUnix Makefilesâ€ .. \nmake\nmake install\n```\n\nå…¨éƒ¨å‘½ä»¤æ‰§è¡ŒæˆåŠŸåï¼Œå®é™…ä¸Šå°±å®‰è£…å®Œæˆäº†ï¼Œæˆ‘ä»¬å¯ä»¥ä»æœ€åçš„è¾“å‡ºä¸­çœ‹åˆ°ï¼Œç›¸å…³å†…å®¹å·²ç»è¢«å®‰è£…åˆ°äº† `/usr/local/include`ã€`/usr/local/lib` ç­‰æ–‡ä»¶å¤¹ä¸‹ã€‚\n\n### ä½¿ç”¨ Xcode ç¼–å†™äººè„¸è¯†åˆ«ç¨‹åº\n\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Xcode å»ºç«‹ä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åºï¼Œè¿™é‡Œæˆ‘ä»¬è¿˜éœ€è¦å¤„ç†ä¸¤ä¸ªé—®é¢˜ï¼š\n\n* OpenCV çš„å¼•å…¥\n* æ‘„åƒå¤´æƒé™çš„è·å–\n\n#### OpenCV çš„å¼•å…¥\n\nå¯¹äºç¬¬ä¸€ç‚¹ï¼Œæˆ‘ä»¬åœ¨ **Build Setting** çš„ **Search Paths** ä¸­å¢åŠ  Header å’Œ Library çš„è·¯å¾„ï¼š\n\n![è·¯å¾„](/img/cv1.jpg)\n\nç„¶åæˆ‘ä»¬éœ€è¦åœ¨ **Build Phases** çš„ **Link Binary With Libraries** ä¸­å¢åŠ åŠ¨æ€é“¾æ¥åº“ã€‚\n\næˆ‘ä»¬å¯ä»¥ç‚¹å‡»å·¦ä¸‹è§’åŠ å·ï¼Œé€‰æ‹© `Add Others` ç„¶åè¿›å…¥ `/usr/local/lib` æŠŠ OpenCV ç›¸å…³çš„åº“å‡åŒ…å«è¿›æ¥å³å¯ã€‚\n\n>å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥éƒ¨åˆ†å¼•å…¥ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬æ˜¯åˆæ­¥ä¸Šæ‰‹ï¼Œå…¨éƒ¨å¼•å…¥ä¹Ÿå¯ä»¥ã€‚\n\n#### æ‘„åƒå¤´æƒé™çš„è·å–\n\nè¿™é‡Œå¦‚æœæˆ‘ä»¬ç›´æ¥è¿è¡Œæˆ‘ä»¬çš„ç¨‹åºï¼Œåœ¨ macOS æœ€æ–°çš„ç³»ç»Ÿä¸­æ˜¯æ— æ³•è¿è¡Œé€šè¿‡çš„ï¼Œè¿™é‡Œæ¶‰åŠåˆ°æ‘„åƒå¤´æƒé™é—®é¢˜ã€‚\n\nä¸€èˆ¬æ¥è¯´ï¼Œå¯¹äº macOSï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¿è¡Œç¨‹åºçš„ç›®å½•ä¸‹å£°æ˜ `info.plist`, è¿™æ ·ç¨‹åºåœ¨è¿è¡Œçš„æ—¶å€™ç³»ç»Ÿä¼šè‡ªåŠ¨æœ‰ç”³è¯·æƒé™çš„å¼¹çª—ï¼Œå¯¹äºæˆ‘ä»¬æµ‹è¯•åœºæ™¯ä¸‹è€Œè¨€ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š\n\n* è¿›å…¥æˆ‘ä»¬ Product å­˜æ”¾çš„ç›®å½•ï¼ˆæ³¨æ„ä¸æ˜¯é¡¹ç›®ä»£ç ç›®å½•ï¼Œå¯ä»¥åœ¨ Products æ¡ç›®å³å•å‡» `Show in Finder`ï¼‰\n* å¤åˆ¶ä¸€ä¸ª info.plistï¼ˆè¿™é‡Œæˆ‘ä»¬å¯ä»¥éšä¾¿æ‰¾ä¸€ä¸ªæœ¬åœ°å®‰è£…çš„åº”ç”¨ç¨‹åºçš„ info.plistï¼Œä¸€èˆ¬å³å•å‡»æ˜¾ç¤ºåŒ…å†…å®¹å³å¯çœ‹åˆ°ï¼‰\n* åœ¨ info.plist ä¸­å¢åŠ  `NSCameraUsageDescription`ï¼Œvalue å³æç¤ºè¯­ï¼Œå¯ä»¥å†™æ¯”å¦‚ `æ‘„åƒå¤´æƒé™çš„è·å–`ã€‚\n\n#### ä¹¦å†™å¹¶è¿è¡Œç¨‹åº\n\nåšå®Œä¸Šè¿°å‡†å¤‡å·¥ä½œåï¼Œæˆ‘ä»¬å¯ä»¥å†™æˆ‘ä»¬çš„äººè„¸è¯†åˆ«ç¨‹åºäº†ï¼Œè¿™é‡Œç»™å‡ºä¸€ä¸ªæˆåŠŸè¿è¡Œçš„ä»£ç ç¤ºä¾‹ï¼ˆå‚è€ƒäº†ç½‘ä¸Šçš„ä¸€äº›ä¾‹å­ï¼‰ï¼š\n\n```\n#include <iostream>\n#include <opencv2/opencv.hpp>\n\nusing namespace std;\nusing namespace cv;\n\nvoid capture();\n\n// æ˜¯å¦é€€å‡ºæ‘„åƒå¤´æŠ“å–çº¿ç¨‹\nstatic bool g_quit = false;\n\nint main(int argc, char** argv) {\n    capture();\n    return 0;\n}\n\nvoid capture()\n{\n    // æ‰“å¼€æ‘„åƒå¤´\n    cv::VideoCapture cap(0);\n    \n    // å¦‚æœæ‰“å¼€å¤±è´¥ï¼Œè¿”å›é”™è¯¯\n    if (!cap.isOpened())\n    {\n        cout<<\"Open Capture Failed\"<<endl;\n        return;\n    }\n    \n    // äººè„¸è¯†åˆ«åˆ†ç±»å™¨\n    cv::CascadeClassifier faceCascadeClassifier(\"/usr/local/share/opencv4/haarcascades/haarcascade_frontalface_alt2.xml\");\n    \n    // è¯»å– Frame ï¼Œç›´åˆ°é€€å‡ºç³»ç»Ÿ\n    while (!g_quit)\n    {\n        cv::Mat frame;\n        if (!cap.read(frame))\n        {\n            // è¯»å–å¤±è´¥ï¼Œè¿”å›é”™è¯¯\n            break;\n        }\n        \n        // è¿›è¡Œäººè„¸è¯†åˆ«\n        std::vector<cv::Rect> faces;\n        faceCascadeClassifier.detectMultiScale(frame, faces);\n        // å°†äººè„¸è¯†åˆ«ç»“æœç»˜åˆ¶åˆ°å›¾ç‰‡ä¸Š\n        for (const auto& face : faces)\n        {\n            cout<<\"Find Face\"<<endl;\n            cv::rectangle(frame,\n                          cv::Point(face.x, face.y),\n                          cv::Point(face.x + face.width, face.y + face.height),\n                          CV_RGB(255, 0, 0),\n                          2);\n        }\n        imshow(\"Display Image\", frame);\n        waitKey(100);\n    }\n}\n```\n\nè¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„äººè„¸è¯†åˆ«åˆ†ç±»å™¨æ˜¯ OpenCV å®‰è£…åè‡ªå¸¦çš„ï¼Œä½ æœ¬æœºçš„ç›®å½•å¯èƒ½å¹¶ä¸æ˜¯è¿™ä¸€ä¸ªï¼ˆè¿™ä¸ªè·¯å¾„å®é™…ä¸Šå®‰è£…å¥½ OpenCV ä¹‹åä¼šæ‰“å°åœ¨æ§åˆ¶å°ï¼‰ã€‚\n\næ­£å¸¸æƒ…å†µä¸‹ï¼Œä»¥ä¸Šç¨‹åºå¯ä»¥ç›´æ¥ç¼–è¯‘æ‰§è¡Œã€‚","tags":["OpenCV"]},{"title":"Ruståˆæ¢:å®ç°äºŒå‰æ ‘çš„å¢åˆ ä¸éå†","url":"/2019/09/07/Ruståˆæ¢-å®ç°äºŒå‰æ ‘çš„å¢åˆ ä¸éå†/","content":"\n### Rust ç®€ä»‹\n\nå®é™…ä¸Šè‡ªå·±æ¥è§¦ Rust çš„æ—¶é—´è¿˜æ˜¯å¾ˆæœ‰é™çš„ï¼Œè¿™é‡Œä¹Ÿä¸ä¼šå¯¹ Rust è¿›è¡Œé•¿ç¯‡å¤§è®ºåœ°ä»‹ç»ï¼Œç®€å•æ¥è¯´ï¼ŒRust æ˜¯ä¸€ä¸ªæ€§èƒ½å’Œ c++ ç›¸è¿‘çš„ç³»ç»Ÿçº§ç¼–ç¨‹è¯­è¨€ï¼ŒåŒæ—¶ï¼Œç”±äºå…¶æ‰€æœ‰æƒä¸å˜é‡ç”Ÿå‘½å‘¨æœŸç­‰æœºåˆ¶çš„è®¾è®¡ï¼Œä½¿å…¶ç›¸å¯¹äº c++ æ¥è¯´æ‹¥æœ‰å†…å­˜å®‰å…¨çš„ä¼˜åŠ¿ï¼Œå‡ ä¹ä¸ä¼šå‡ºç°è¯¸å¦‚æ‚¬å‚æŒ‡é’ˆã€æ•°ç»„è¶Šç•Œã€æ®µé”™è¯¯ç­‰é—®é¢˜ï¼Œåœ¨å¾®è½¯ã€ç™¾åº¦ã€å­—èŠ‚è·³åŠ¨ç­‰å…¬å¸å‡æœ‰æ‰€ä½¿ç”¨ã€‚\n\nå…³äº Rust çš„ç‰¹æ€§ä»¥åŠæœªæ¥ï¼ŒçŸ¥ä¹[è¿™ä¸ªé—®é¢˜ä¸­çš„ä¸€äº›é«˜èµå›ç­”ä»¥åŠç›¸å…³çš„è¯„è®º](https://www.zhihu.com/question/30407715)ï¼Œéå¸¸å€¼å¾—ä¸€çœ‹ã€‚\n\næœ¬æ–‡ä¼šä»¥äºŒå‰æ ‘è¿™æ ·ä¸€ä¸ªå…·ä½“çš„ä¾‹å­å‡ºå‘ï¼Œæ¥å¯¹ Rust çš„ä¸€éƒ¨åˆ†çŸ¥è¯†å†…å®¹è¿›è¡Œå­¦ä¹ ã€‚\n\n### å®ç°äºŒå‰æ ‘æ•°æ®ç»“æ„\n\n#### å®šä¹‰ç»“æ„\n\nä¹‹å‰åœ¨ Javascript ç­‰è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬åªè¦å¯¹å¯¹è±¡æœ‰æ‰€äº†è§£ï¼Œå®ç°ä¸€ä¸ªäºŒå‰æ ‘çš„æ•°æ®ç»“æ„æ˜¯éå¸¸ç®€å•çš„äº‹æƒ…ï¼Œè€Œåœ¨ Rust ä¸­ï¼Œå¯èƒ½å¯¹äºæ–°æ‰‹æ¥è¯´ä»…ä»…æ˜¯å®ç°åŸºæœ¬çš„æ•°æ®ç»“æ„å°±æ˜¯ä¸€ä¸ªæ¯”è¾ƒè„‘å£³ç–¼çš„äº‹æƒ…ã€‚\n\næˆ‘ä»¬ä¸€èˆ¬ä¼šå†™å‡ºç±»ä¼¼è¿™æ ·çš„ä»£ç ï¼š\n\n```\nstruct Tree {\n    value: i32,\n    left: Tree, // ç›´æ¥ä½¿ç”¨ Tree æ˜¯ä¸è¡Œçš„\n    right: Tree  \n}\n```\n\nè‡ªç„¶ä¸ä¼šé€šè¿‡ Rust çš„ç¼–è¯‘æ£€æŸ¥ï¼Œä¼šæŠ¥é”™ä¾‹å¦‚ï¼š`recursive type has infinite size`ï¼Œä¸è¿‡å…¶åŒæ—¶ç»™æˆ‘ä»¬æä¾›äº†è§£å†³æ–¹æ¡ˆï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ `Box<T>` æŒ‡é’ˆã€‚\n\nå¦å¤–ï¼Œè€ƒè™‘åˆ°äºŒå‰æ ‘çš„å·¦å³å­æ ‘å¯èƒ½ä¸ºç©ºï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è¿˜éœ€è¦å¢åŠ ä¸€ä¸ª `Option`ã€‚\n\næœ€ç»ˆæˆ‘ä»¬çš„äºŒå‰æ ‘æ•°æ®ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š\n\n```\n#[derive(Debug, Default)]\nstruct Tree {\n    value: i32,\n    left: Option<Box<Tree>>,\n    right: Option<Box<Tree>>   \n}\n```\n\n#### å®ç°åŸºæœ¬çš„æ–¹æ³•\n\nè¿™é‡Œæˆ‘ä»¬å®ç°ä¸€äº›äºŒå‰æ ‘çš„åŸºæœ¬çš„æ–¹æ³•ï¼Œä½œä¸ºä¸Šè¿°ç»“æ„ä½“çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å°†å®ç°ä»¥ä¸‹æ–¹æ³•ï¼š\n\n* è·å–äºŒå‰æ ‘èŠ‚ç‚¹çš„å€¼ï¼ˆå…¶å®ä¹Ÿå¯ä»¥æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼‰ã€‚\n* ä¿®æ”¹äºŒå‰æ ‘èŠ‚ç‚¹çš„å€¼ã€‚\n* è®¾ç½®å­æ ‘ã€‚\n* åˆ é™¤å­æ ‘ã€‚\n\nè¿™é‡Œé™¤äº†ç¬¬ä¸€ä¸ªï¼Œå…¶ä½™æˆ‘ä»¬éƒ½éœ€è¦ä¼ é€’ `self` çš„å¯å˜å¼•ç”¨ï¼Œæˆ‘ä»¬çš„å®ç°å¦‚ä¸‹ï¼š\n\n```\nimpl Tree {\n    fn get_val(&self) -> i32 {\n        return self.value;\n    }\n    fn set_val(&mut self, val: i32) -> i32 {\n        self.value = val;\n        return self.value;\n    }\n    fn insert(&mut self, dir: &String, val: Tree) {\n        assert!(dir == \"left\" || dir == \"right\");\n        match dir.as_ref() {\n            \"left\" => self.left = Some(Box::new(val)),\n            \"right\" => self.right = Some(Box::new(val)),\n            _ => { \n                println!(\"Insert Error: only left and right supported\");\n                process::exit(1);\n            }\n        }\n    }\n    fn delete(&mut self, dir: &String) {\n        assert!(dir == \"left\" || dir == \"right\");\n        match dir.as_ref() {\n                \"left\" => self.left = None,\n                \"right\" => self.right = None,\n                 _ => { \n                    println!(\"Insert Error: only left and right supported\");\n                    process::exit(1);\n                }\n        }\n    }\n}\n```\n\n### éå†äºŒå‰æ ‘\n\nè¿™é‡Œéå†äºŒå‰æ ‘æˆ‘ä»¬ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯å±æ€§æ–¹æ³•æ¥å®ç°ï¼Œè¿™æ ·ä¼šæ›´ç¬¦åˆæˆ‘ä»¬å¹³æ—¶çš„ä¸šåŠ¡åœºæ™¯ï¼Œè¿™é‡Œå…¶å®é—®é¢˜æ¯”è¾ƒå¤šçš„ï¼Œæˆ‘ä»¬å…ˆç®€æ˜“å®ç°ä¸€ä¸ªç‰ˆæœ¬ï¼š\n\n```\nfn traverse(tree: Tree) {\n    println!(\"Node Value: {:?}\", tree.value);\n    if tree.left.is_some() {\n        traverse(*tree.left.unwrap()); // æ‰‹åŠ¨è§£å¼•ç”¨\n    }\n    if tree.right.is_some() {\n        traverse(*tree.right.unwrap()); // æ‰‹åŠ¨è§£å¼•ç”¨\n    }\n}\n```\n\nå¦‚æœæˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹è¿™ä¸ªç‰ˆæœ¬ï¼Œå‘ç°çš„ç¡®èƒ½å¤Ÿæ­£å¸¸éå†çš„ï¼Œä½†æ˜¯å®é™…ä¸Šè¿™æœ‰ä¸€ä¸ªè‡´å‘½çš„é—®é¢˜ï¼š\n\nè¿™é‡Œé‡‡ç”¨çš„æ˜¯æ‰€æœ‰æƒçš„ç§»åŠ¨ï¼Œè€Œä¸æ˜¯ä¸å¯å˜å€Ÿç”¨ï¼Œè¿™ä¼šå¯¼è‡´æˆ‘ä»¬çš„å‡½æ•°æ‰§è¡Œå®ŒååŸæ¥å˜é‡çš„æ‰€æœ‰æƒå·²ç»è¢«ç§»åŠ¨äº†ï¼Œæ¢ä¸€ç§è¯´æ³•åˆ™æ˜¯ä¼šæ¶ˆè€—æ‰è¿™ä¸ªå˜é‡ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬é¢„æœŸçš„ã€‚\n\nè™½ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å‡½æ•°ä¸­è¿”å› tree çš„æ–¹å¼æ¥æœ€åå†æ¬¡ç§»åŠ¨æ‰€æœ‰æƒï¼Œä½†è¿™æ ·éå¸¸ä¸ä¾¿äºå®ç°ï¼Œç»è¿‡é‡æ„ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†å¦‚ä¸‹çš„æ–¹å¼å®ç°ï¼š\n\n```\nfn traverse(tree: &Tree) {\n    println!(\"Node Value: {:?}\", tree.value);\n    match tree.left {\n        Some(ref x) => traverse(x),\n        _ => {}\n    }\n    match tree.right {\n        Some(ref x) => traverse(x),\n        _ => {}\n    }\n}\n```\n\n>å¦å¤–ä¸€ä¸ªæ³¨æ„ç‚¹åˆ™æ˜¯ç”±äº `unwrap()` æœ¬èº«æ˜¯ä¸€ä¸ªæ¶ˆè€—æ€§æ“ä½œï¼Œæˆ‘ä»¬è¿™é‡Œä¸èƒ½ä½¿ç”¨ `unwrap`ï¼Œå‚è€ƒ[stackOverflowçš„æé—®1](https://stackoverflow.com/questions/22282117/how-do-i-borrow-a-reference-to-what-is-inside-an-optiont)ã€[stackOverflowçš„æé—®2](https://stackoverflow.com/questions/32338659/cannot-move-out-of-borrowed-content-when-unwrapping)ã€‚\n\næˆ‘ä»¬æœ€ç»ˆçš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š\n\n```\nuse::std::process;\nuse std::borrow::Borrow;\n#[derive(Debug, Default)]\nstruct Tree {\n    value: i32,\n    left: Option<Box<Tree>>,\n    right: Option<Box<Tree>>   \n}\n\nimpl Tree {\n    fn get_val(&self) -> i32 {\n        return self.value;\n    }\n    fn set_val(&mut self, val: i32) -> i32 {\n        self.value = val;\n        return self.value;\n    }\n    fn insert(&mut self, dir: &String, val: Tree) {\n        assert!(dir == \"left\" || dir == \"right\");\n        match dir.as_ref() {\n            \"left\" => self.left = Some(Box::new(val)),\n            \"right\" => self.right = Some(Box::new(val)),\n            _ => { \n                println!(\"Insert Error: only left and right supported\");\n                process::exit(1);\n            }\n        }\n    }\n    fn delete(&mut self, dir: &String) {\n        assert!(dir == \"left\" || dir == \"right\");\n        match dir.as_ref() {\n                \"left\" => self.left = None,\n                \"right\" => self.right = None,\n                 _ => { \n                    println!(\"Insert Error: only left and right supported\");\n                    process::exit(1);\n                }\n        }\n    }\n}\n\n// åŸå§‹çš„éæ¶ˆè€—æ€§éå†:\n// fn traverse(tree: &Tree) {\n//     println!(\"Node Value: {:?}\", tree.value);\n//     if tree.left.is_some() {\n//         // cannot move out of borrowed content\n//         // é¦–å…ˆ unwrap æ˜¯ä¸€ä¸ªæ¶ˆè€—æ€§æ“ä½œ\n//         // è¿™æ˜¯ç”±äº unwrap å‡½æ•°é€ æˆ?  as_ref ä¹Ÿä¸è¡Œ\n//         traverse((tree.left.as_ref().map(|x| **x).unwrap()).borrow());\n//     }\n//     // if tree.right.is_some() {\n//     //     // cannot move out of borrowed content\n//     //     traverse(tree.right.unwrap().borrow());\n//     // }\n// }\n\n// éæ¶ˆè€—æ€§éå†\nfn traverse(tree: &Tree) {\n    println!(\"Node Value: {:?}\", tree.value);\n    match tree.left {\n        Some(ref x) => traverse(x),\n        _ => {}\n    }\n    match tree.right {\n        Some(ref x) => traverse(x),\n        _ => {}\n    }\n}\n\n// æ¶ˆè€—æ€§éå†ï¼š\n// fn traverse(tree: Tree) {\n//     println!(\"Node Value: {:?}\", tree.value);\n//     if tree.left.is_some() {\n//         traverse(*tree.left.unwrap()); // æ‰‹åŠ¨è§£å¼•ç”¨\n//     }\n//     if tree.right.is_some() {\n//         traverse(*tree.right.unwrap()); // æ‰‹åŠ¨è§£å¼•ç”¨\n//     }\n// }\n\nfn main() {\n    println!(\"begin rust tree test:\");\n    let mut tree = Tree { value : 12, ..Default::default() };\n    let mut left = Tree { value : 121, ..Default::default() };\n    tree.insert(&String::from(\"left\"), left);\n    let mut right = Tree { value : 122, ..Default::default() };\n    tree.insert(&String::from(\"right\"), right);\n    // tree.delete(&String::from(\"right\"));\n    // println!(\"Tree val: {:?}\", left.get_val()); ä¸èƒ½è¿™æ ·å†™ï¼Œæ‰€æœ‰æƒå·²ç»è¢«ç§»åŠ¨\n    traverse(&tree);\n    // traverse(tree);\n}\n```","tags":["Rust"]},{"title":"æ·±å…¥Vueæºä»£ç è§£å†³æ—¶åºé—®é¢˜ä¸€","url":"/2019/07/06/æ·±å…¥Vueæºä»£ç è§£å†³æ—¶åºé—®é¢˜ä¸€/","content":"\n>viola æ˜¯ä¸€ä¸ªæ”¯æŒ Vue çš„åŠ¨æ€åŒ–æ¡†æ¶ï¼Œå…¶ Vue ç‰ˆæœ¬åœ¨ Vue å®˜æ–¹ç‰ˆæœ¬ 2.5.7 ä¸Šè¿›è¡Œäº†å°‘é‡æ”¹å†™ï¼Œæœ¬æ–‡é’ˆå¯¹å…¶è¿›è¡Œå…·ä½“åˆ†æã€‚\n\næœ€åˆï¼Œæœ‰ä½¿ç”¨è€…æŠ¥å‘Šä¸€ä¸ªé”™è¯¯ï¼šåœ¨ iOS ç³»ç»Ÿï¼Œé€€å‡ºé¡µé¢çš„æ—¶å€™ï¼Œæ¡†æ¶æŠ¥é”™ï¼š\n\n```\nTypeError: undefined is not an object(evaluating 'e.isDestroyed\"\n```\n\næ¥åˆ°è¿™ä¸ªé”™è¯¯ä¹‹åï¼Œæˆ‘é¦–å…ˆè¿›å…¥ Vue çš„ debug ç‰ˆæœ¬ï¼Œå°è¯•è·å–æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼š\n\n```\nTypeError: undefined is not an object(evaluating 'componentInstance.isDestroyed\"\n```\n\næˆ‘ä»¬é¡ºåˆ©åœ°æ‹¿åˆ°äº†æŠ¥é”™çš„å˜é‡åç§°ï¼Œå» Vue æºä»£ç ä¸­æœç´¢ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æŠ¥é”™ä¹‹å¤„ï¼š\n\n```javascript\ndestroy: function destroy (vnode) {\n    var componentInstance = vnode.componentInstance;\n    if (!componentInstance._isDestroyed) { // è¿™é‡ŒæŠ¥é”™\n      if (!vnode.data.keepAlive) {\n        componentInstance.$destroy();\n      } else {\n        deactivateChildComponent(componentInstance, true /* direct */);\n      }\n    }\n  }\n```\n\nè¿™é‡Œæ˜¯ `componentInstance` ä¸º undefinedï¼Œè¿™ä¸ªå®é™…ä¸Šæ˜¯ vnode çš„å®ä¾‹ï¼Œå…¶ä¸º undefinedï¼Œè¯´æ˜è¯¥ vue ç»„ä»¶åœ¨ä¹‹å‰çš„é˜¶æ®µå°±å·²ç»å‡ºé”™ä¸æ­£å¸¸äº†ï¼Œè¿™é‡Œå¹¶ä¸æ˜¯é”™è¯¯çš„æ ¹æºæ‰€åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å†æ¬¡è¿›è¡Œå¯»æ‰¾æŠ¥é”™åŸå› ã€‚\n\näºæ˜¯æˆ‘ä»¬æŸ¥çœ‹ä¸šåŠ¡ä»£ç çš„æ‰€æœ‰æ—¥å¿—ï¼Œåˆå‘ç°äº†è¿™æ ·ä¸€æ¡æŠ¥é”™ï¼š\n\n```\n[Vue warn]: Error in nextTick: \"TypeError: undefined is not an object (evaluating 'vm.$options')\" \n```\n\nåˆå§‹åŒ–é˜¶æ®µå‡ºç°è¿™æ ·ä¸€ä¸ªé”™è¯¯ï¼Œæˆ‘ä»¬æ€€ç–‘ `vm` å°±æ˜¯ä¸Šæ–‡çš„ `componentInstance`ï¼Œäºæ˜¯ï¼Œæˆ‘ä»¬æ‰“å°æŠ¥é”™å †æ ˆï¼š\n\n```javascript\n è°ƒç”¨æ ˆ:\nfunction updateChildComponent(\n    vm,\n    propsData,\n    listeners,\n    parentVnode,\n    renderChildren\n  ) {\n        //...\n        var hasChildren = !!(\n              renderChildren ||\n              vm.$options._renderChildren || // è¿™é‡ŒæŠ¥é”™\n              parentVnode.data.scopedSlots ||\n              vm.$scopedSlots !== emptyObject\n            );\n    }\n\nfunction prepatch(oldVnode, vnode) {\n      var options = vnode.componentOptions;\n      var child = vnode.componentInstance = oldVnode.componentInstance;\n      updateChildComponent(\n        child,\n        options.propsData,\n        options.listeners,\n        vnode,\n        options.children\n      );\n    }\n\nfunction patchVnode(oldVnode, vnode, insertedVnodeQueue, removeOnly) {}\nfunction patch(oldVnode, vnode, hydrating, removeOnly) {}\nfunction (vnode, hydrating) {}\nfunction () {\n        vm._update(vm._render(), hydrating);\n      }\nfunction get() {}\nfunction getAndInvoke(cb) {}\nfunction run() {}\nfunction flushSchedulerQueue() {}\nfunction flushCallbacks() {}\n```\n\nè°ƒç”¨æ ˆå®é™…ä¸Šæœ‰ç‚¹å†—é•¿ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜æ˜¯èƒ½å‘ç°ä¸¤ä¸ªæœ‰ç”¨çš„ä¿¡æ¯ï¼š\n\n* åˆå§‹åŒ–é˜¶æ®µä¸º `undefined` çš„ `vm`ï¼Œå°±æ˜¯ `componentInstance`ï¼Œä¹Ÿå°±æ˜¯å’Œ destroy é˜¶æ®µçš„æŠ¥é”™å±äºåŒä¸€ä¸ªåŸå› ã€‚\n* æ ¹æ®è°ƒç”¨æ ˆå‘ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªæ›´æ–°é˜¶æ®µçš„æŠ¥é”™ã€‚\n\nè¿™å¼•å‘äº†æˆ‘ä»¬çš„æ€è€ƒï¼šæ›´æ–°é˜¶æ®µæ‰¾ä¸åˆ° `componentInstance` æŠ¥é”™ã€‚\n\nè¿™é‡Œå®é™…ä¸Šæœ‰ç‚¹é˜»å¡äº†ï¼Œå› ä¸ºä¸€èˆ¬æ¥è¯´ï¼ŒVue çš„æºä»£ç ç»è¿‡æµ‹è¯•ï¼Œåº”è¯¥ä¸ä¼šå‡ºç°è¿™ç§é—®é¢˜çš„ï¼Œé‚£æ˜¯ä¸æ˜¯æˆ‘ä»¬çš„é—®é¢˜å‘¢ï¼Œæˆ‘ä»¬å›å½’åˆ°ä¸šåŠ¡ä»£ç ï¼š\n\n```\ncreated() {\n    this.getFeedsListFromCache();\n},\nmethods: {\n    getFeedsListFromCache() {\n        viola.requireAPI(\"cache\").getItem(this.cacheKey_feeds, data => {\n            this.processData(data.list);\n        });\n    },\n    processData(list = [], opt = {}) {\n        if (this.list.length < cacehFeedsLength) {\n        }\n        this.list = [];\n    },\n}\n```\n\næˆ‘ä»¬å¯¹ä¸šåŠ¡ä»£ç è¿›è¡Œäº†æŠ½è±¡ç®€åŒ–ï¼Œä¸Šé¢æ˜¯æˆ‘ä»¬çš„æœ€å°é—®é¢˜ Demoï¼Œå®é™…ä¸Šæˆ‘ä»¬å°±åšäº†è¿™æ ·ä¸€ä»¶äº‹æƒ…ï¼š\n\n* åœ¨ created æ‰§è¡Œæ–¹æ³•ï¼Œè°ƒç”¨ç«¯çš„æ¥å£ï¼Œå†å›è°ƒå‡½æ•°é‡Œé¢æ›´æ–°æŸä¸ª data ä¸­å£°æ˜çš„æ•°æ®ã€‚\n\né¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥æ¢³ç†ä¸‹å¯¹ä¸€èˆ¬ vue ç»„ä»¶çš„åˆå§‹åŒ–æ›´æ–°ï¼Œvue æ˜¯å¦‚ä½•åšçš„ï¼š\n\n* created æ—¶å®é™…ä¸Š vnode å·²ç»å»ºç«‹å®Œæˆï¼Œè¿™ä¸ªæ—¶å€™è¿˜æ²¡æœ‰ mountï¼Œä½†æ˜¯æ•°æ®ç›‘å¬å·²ç»å»ºç«‹äº†ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœæ”¹åŠ¨æ•°æ®ï¼Œä¼šæŠŠç›¸å…³ update å‡½æ•°æ”¾åœ¨ä¸€ä¸ªåä¸º flushCallbacks çš„å‡½æ•°é˜Ÿåˆ—ä¸­ã€‚\n* è¯¥å‡½æ•°é˜Ÿåˆ—ä¼šé€šè¿‡é»˜è®¤ä¸º `Promise.then` çš„ microtask æ–¹å¼æ¥è°ƒåº¦ï¼Œå½“å‰é˜¶æ®µçš„ mount æµç¨‹ä¼šç»§ç»­ï¼Œmount ç»“æŸåï¼Œä¼šæ‰§è¡Œ flushCallbacks é˜Ÿåˆ—ä¸­çš„æ›´æ–°æ“ä½œã€‚\n\nä»ä»£ç å±‚é¢ä¸Šæ¥è®²ï¼Œè¿™å‡ ä¸ªæµç¨‹åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š\n\n```\n â”œâ”€â”€ callHook(vm, 'created'); // æ‰§è¡Œcreated é’©å­\n â”œâ”€â”€ proxySetter(val); // æ”¹å˜æ•°æ®ï¼Œè°ƒç”¨ proxy\n â”œâ”€â”€ Watcher.prototype.update; // è°ƒç”¨ Watcherï¼Œå°† update æ“ä½œå…¥æ ˆ\n â”œâ”€â”€ vm.$mount(vm.$options.el); // æ‰§è¡Œ mount æµç¨‹\n â”œâ”€â”€ callHook(vm, 'beforeMount');\n â”œâ”€â”€  callHook(vm, 'mounted'); // ä¾æ¬¡è°ƒç”¨ beforeMount å’Œ mounted\n â””â”€â”€ flushCallbacks // æ‰§è¡Œ æ›´æ–°\n```\n\nç„¶åæˆ‘ä»¬åˆ†ææˆ‘ä»¬è¿™é‡Œçš„æµç¨‹ï¼Œé¦–å…ˆå€¼å¾—å¼ºè°ƒçš„æ˜¯è¿™ä¸ªå‡½æ•° `viola.requireAPI(\"cache\").getItem`ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯ç«¯æ³¨å…¥çš„å‡½æ•°ï¼Œä½†æˆ‘ä»¬ä¸èƒ½å°†å…¶å½“ä½œå¼‚æ­¥å‡½æ•°æ¥å¯¹å¾…ï¼Œå®é™…ä¸Šï¼Œ**è¿™æ˜¯ä¸€ä¸ªåŒæ­¥å‡½æ•°**ï¼Œï¼ˆè‡³äºè¿™ä¸ªåŒæ­¥å‡½æ•°å’Œ js ä¸­çš„æ™®é€šå‡½æ•°ï¼Œæ˜¯å¦æœ‰åŒºåˆ«ï¼Œè¿˜æœ‰å¾…å•†æ¦·ï¼Œä¸è¿‡åº”è¯¥æ˜¯æœ‰åŒºåˆ«çš„ï¼Œå› ä¸ºå¦‚æœæˆ‘ä»¬ä¸ç”¨æ­¤å‡½æ•°çš„è¯ï¼Œå°±ä¸ä¼šå‡ºç°è¯¥é—®é¢˜ã€‚ï¼‰\n\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ‰“å‡ºè¯¦ç»†çš„è°ƒç”¨æ ˆï¼Œæ ¹æ®é¡ºåºæ¥åˆ†æå®é™…çš„æ‰§è¡Œæµç¨‹ï¼š\n\n```\n â”œâ”€â”€ callHook(vm, 'created'); // æ‰§è¡Œcreated é’©å­\n â”œâ”€â”€ proxySetter(val); // æ”¹å˜æ•°æ®ï¼Œè°ƒç”¨ proxy\n â”œâ”€â”€ Watcher.prototype.update; // è°ƒç”¨ Watcherï¼Œå°† update æ“ä½œå…¥æ ˆ\n â”œâ”€â”€ flushCallbacks // æ‰§è¡Œ æ›´æ–°\n â”œâ”€â”€ vm.$mount(vm.$options.el); // æ‰§è¡Œ mount æµç¨‹ \n â”œâ”€â”€ callHook(vm, 'beforeMount');\n â””â”€â”€ callHook(vm, 'mounted'); // ä¾æ¬¡è°ƒç”¨ beforeMount å’Œ mounted\n```\n\næˆ‘ä»¬å‘ç°ï¼Œæˆ‘ä»¬çš„æ‰§è¡Œæµç¨‹å‡ºç°äº†å¾ˆå¤§é—®é¢˜ï¼š**åœ¨ mount é˜¶æ®µæœªå®Œæˆçš„æ—¶å€™å°±æ‰§è¡Œäº† flushCallbacksï¼Œå…ˆæ‰§è¡Œæ›´æ–°æ“ä½œï¼Œè¿™é‡Œçš„é¡ºåºé”™ä¹±å¯¼è‡´äº†åç»­é—®é¢˜**ã€‚\n\næˆ‘ä»¬å¯çœ‹ä¸‹è°ƒç”¨ `flushCallbacks` çš„ä»£ç ï¼š\n\n```javascript\nif (typeof Promise !== 'undefined' && isNative(Promise)) {\n  var p = Promise.resolve();\n  microTimerFunc = function () {\n    p.then(flushCallbacks);\n    // in problematic UIWebViews, Promise.then doesn't completely break, but\n    // it can get stuck in a weird state where callbacks are pushed into the\n    // microtask queue but the queue isn't being flushed, until the browser\n    // needs to do some other work, e.g. handle a timer. Therefore we can\n    // \"force\" the microtask queue to be flushed by adding an empty timer.\n    if (isIOS) { setTimeout(noop); }\n  };\n} \n```\n\nè¿™é‡Œ `microTimerFunc` çš„ `p.then`ï¼Œè¢«åŒæ­¥æ‰§è¡Œäº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™é‡Œçš„å¾®ä»»åŠ¡ä¼˜å…ˆäºå½“å‰äº‹ä»¶å¾ªç¯çš„å‡½æ•°æ‰§è¡Œäº†ï¼ˆæ­¤æ—¶ç”±äº mount æµç¨‹æ˜¯åŒæ­¥çš„ï¼Œmount æµç¨‹çš„ç›¸å…³å‡½æ•°**ç†åº”**åœ¨è¯¥äº‹ä»¶å¾ªç¯ä¸­ï¼Œä¼˜å…ˆäºå¾®ä»»åŠ¡æ‰§è¡Œï¼‰ã€‚\n\næˆ‘ä»¬æ‰¾åˆ°äº†æ ¹æºï¼Œæ¥ä¸‹æ¥å°±æ˜¯åˆ†æè§£å†³æ–¹æ¡ˆå’Œæ ¹æœ¬åŸå› ã€‚\n\nç”±äºæˆ‘ä»¬çš„é—®é¢˜åœ¨äº update æµç¨‹æ‰§è¡Œå¤ªå¿«äº†ï¼Œæ‰€ä»¥é‡‡ç”¨ä¸€ç§æ–¹å¼æ”¾æ…¢ä¸€ç‚¹å³å¯ï¼š\n\n* å°† vue çš„å¾®ä»»åŠ¡æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰æ”¹æˆå®ä»»åŠ¡æ¨¡å¼ï¼š`var useMacroTask = false; => true`ã€‚\n* åœ¨ created é˜¶æ®µçš„åŠ ä¸€ä¸ª `setTimeout(0)`ã€‚\n\nä¸è¿‡å¯¹äºæ ¹æœ¬åŸå› ï¼Œå®é™…ä¸Šæœ¬æ¬¡ä»ç„¶æ²¡æœ‰å®Œå…¨åˆ†æé€å½»ï¼Œè¿˜ç•™æœ‰å¦‚ä¸‹ç–‘é—®ï¼š\n\n* `viola.requireAPI(\"cache\").getItem` è¿™ä¸ªå‡½æ•°åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿå…¶å¯¹äº‹ä»¶å¾ªç¯æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ\n* åœ¨æ‰§è¡Œ `microTimerFunc` çš„æ—¶å€™ï¼Œä¸ºä»€ä¹ˆ `p.then` ä¼˜å…ˆäº `vm.$mount` æ‰§è¡Œäº†ï¼Ÿ\n* è¯¥é”™è¯¯ä»…åœ¨ iOS ç³»ç»Ÿå‡ºç°ï¼ŒiOS ç³»ç»Ÿæ˜¯å¦ä¼šåœ¨æŸäº›æƒ…å†µå°†å¾®ä»»åŠ¡çš„ä¼˜å…ˆçº§å˜é«˜ï¼Ÿ\n\nå¯¹äºè¿™äº›ç–‘é—®ï¼ŒVue æºä»£ç ä¸­ä¹Ÿåšäº†ä¸€äº›è¯„è®ºï¼š\n\n```\n// Here we have async deferring wrappers using both microtasks and (macro) tasks.\n// In < 2.4 we used microtasks everywhere, but there are some scenarios where\n// microtasks have too high a priority and fire in between supposedly\n// sequential events (e.g. #4521, #6690) or even between bubbling of the same\n// event (#6566). However, using (macro) tasks everywhere also has subtle problems\n// when state is changed right before repaint (e.g. #6813, out-in transitions).\n// Here we use microtask by default, but expose a way to force (macro) task when\n// needed (e.g. in event handlers attached by v-on).\n```\n\nä¸è¿‡ï¼Œè¿™é‡Œå§‹ç»ˆéƒ½æ²¡æœ‰æ‰¾åˆ°æœ€æœ¬è´¨çš„åŸå› ï¼Œä¹Ÿè®¸è¿™å’Œ iOS JSCore çš„å¾®ä»»åŠ¡/å®ä»»åŠ¡çš„å¤„ç†æœºåˆ¶æœ‰å…³ï¼Œå…·ä½“åŸå› ï¼Œå¾…ä¸‹æ¬¡æ¢ç©¶ã€‚\n\n\n\n","tags":["Vue","viola"]},{"title":"webåº”ç”¨å¼€å‘ä¸éƒ¨ç½²â€”â€”ä½ å¿…é¡»æŒæ¡çš„å†…å®¹","url":"/2019/06/16/webåº”ç”¨å¼€å‘ä¸éƒ¨ç½²â€”â€”ä½ å¿…é¡»æŒæ¡çš„å†…å®¹/","content":"\n\n\næœ¬æ–‡åŸºäºç¬”è€…åœ¨è…¾è®¯çš„é¡¹ç›®ç»éªŒï¼Œä»çœŸå®åœºæ™¯å‡ºå‘åˆ†æä¸€ä¸ªä¸­å‹ Web åº”ç”¨ä»ç«‹é¡¹åˆ°ä¸Šçº¿ç¨³å®šè¿è¡Œçš„å¹³ç¨³è§£å†³æ–¹æ¡ˆï¼ŒåŠ›æ±‚æ—¢ä¸å¤ªç©ºæ³›ä»¥è‡³äºçœ‹å®Œäº†ä»ç„¶æ‰¾ä¸åˆ°è½åœ°çš„ç‚¹ï¼Œä¹Ÿå°½é‡ä¸ä¼šç‰¹åˆ«çº ç»“äºä¸ªåˆ«ç»†èŠ‚å¯¼è‡´æ²¡æœ‰ç›¸å…³ä½¿ç”¨ç»å†çš„åŒå­¦æ— æ³•æ„ŸåŒèº«å—ï¼Œè€Œæ˜¯ä»å®è§‚åˆ°æ–¹æ³•è®ºï¼Œåˆ†ææ•´ä¸ªæµç¨‹ä¸­æˆ‘ä»¬éœ€è¦ç”¨åˆ°çš„å·¥å…·ã€æ–¹æ³•ä¸è§„èŒƒï¼Œç»™å¤§å®¶æä¾›ä¸€ä¸ªå‚è€ƒã€‚\n\næœ¬æ–‡é€‚åˆå…·æœ‰ä¸€å®šç»éªŒçš„åˆä¸­çº§å‰ç«¯å¼€å‘è€…ï¼Œå¦‚æœæœ‰ç›¸å…³é—®é¢˜ï¼Œä¹Ÿæ¬¢è¿ä¸æˆ‘äº¤æµã€‚\n\nç›®å½•\n\n* é¡¹ç›®æ„å»ºçš„æ­å»ºï¼Œå…³é”®è¯ï¼š**webpack**ã€**react/vue cli**ï¼Œ**steamer**ï¼Œ**ç»„ä»¶åº“**\n* ä»£ç çš„è§„èŒƒçº¦æŸï¼Œå…³é”®è¯ï¼š**typescript**ã€**eslint**ã€**prettier**\n* æµ‹è¯•ä¸æµ‹è¯•éƒ¨ç½²ï¼Œå…³é”®è¯ï¼š**æµ‹è¯•éƒ¨ç½²æ–¹æ¡ˆ**ã€**docker**\n* æ—¥å¿—æŸ¥çœ‹ä¸è„šæœ¬é”™è¯¯çš„ç›‘æ§ï¼Œå…³é”®è¯ï¼š**sentry**ã€**vconsole**ã€**mlogger**\n* ç‰ˆæœ¬å‘å¸ƒæ›´æ–°ï¼Œå…³é”®è¯ï¼š**å‘å¸ƒç³»ç»Ÿ**ã€**ç°åº¦å‘å¸ƒ**\n* è®¿é—®é‡å®æ—¶ç›‘æ§\n\n### èµ·æ­¥ï¼šé¡¹ç›®æ„å»ºçš„æ­å»º\n\n#### ä½¿ç”¨ webpack æ­å»ºè„šæ‰‹æ¶\n\nç›®å‰åœ¨ä¸€èˆ¬çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬éƒ½ä¼šä½¿ç”¨ webpack ä½œä¸ºæ­å»ºå¼€å‘ç¯å¢ƒçš„åŸºç¡€ï¼Œè€Œ react å’Œ vue ä¹Ÿå„è‡ªæä¾›äº† cli å·¥å…·ç”¨äºå¼€å‘ä¸€ä¸ªä¸­å°å‹é¡¹ç›®ï¼Œreact æä¾›äº† eject åŠŸèƒ½è®©æˆ‘ä»¬å¯ä»¥æ›´åŠ è‡ªç”±çš„é…ç½® webpackï¼Œè€Œ vue è„šæ‰‹æ¶è™½ç„¶æ²¡æœ‰æä¾›ç±»ä¼¼å‘½ä»¤ï¼Œä½†æ˜¯å€ŸåŠ© webpack å·¥å…·é“¾æˆ‘ä»¬å‡ ä¹ä¹Ÿå¯ä»¥è‡ªç”±å®šåˆ¶æ¯ä¸€ä¸ªè§’è½ã€‚\n\nä¸è¿‡ï¼Œè¿™é‡Œæˆ‘çš„å»ºè®®æ˜¯ï¼Œå¦‚æœæ˜¯ä¸ªäººé¡¹ç›®æˆ–å°å‹é¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäº react æˆ– vue çš„è„šæ‰‹æ¶è¿›è¡Œæ›´æ”¹ä½¿ç”¨ï¼Œå¯¹äºä¸€ä¸ªå…·å¤‡ä¸€å®šè§„æ¨¡çš„é¡¹ç›®å›¢é˜Ÿï¼Œå»ºè®®è¿˜æ˜¯è‡ªå·±ç»´æŠ¤ä¸€å¥—å•ç‹¬çš„ webpack æ„å»ºç¯å¢ƒï¼ŒåŸå› å¦‚ä¸‹ï¼š\n\n* ç”±äºæˆ‘ä»¬ä¸€èˆ¬éœ€è¦åœ¨é¡¹ç›®ä¸­æ¥å…¥å„ç±»å¸å†…å·¥å…·ã€æ”¯æŒé«˜çº§APIå’Œè¯­æ³•ã€åŒæ—¶æ”¯æŒ react/vueã€æ„å»ºç›®å½•å®šåˆ¶åŒ–ç­‰å„ç±»å·¥ä½œï¼Œå®é™…ä¸Š 80% ä»¥ä¸Šçš„å·¥ä½œæˆ‘ä»¬éƒ½éœ€è¦åœ¨æ¨¡ç‰ˆä¹‹ä¸Šè‡ªè¡Œæ·»åŠ ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å†ç”¨è„šæ‰‹æ¶å¸¦æ¥çš„æ”¶ç›Šå·²ç»éå¸¸å°äº†ï¼Œåè€Œè¿˜ä¼šå—åˆ¶äºé¡¹ç›®çš„åˆå§‹ç›®å½•ç»“æ„ã€‚\n\næˆ‘ä»¬åœ¨è‡ªå®šä¹‰è„šæ‰‹æ¶çš„ webpack æ„å»ºçš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦æ¢³ç†å‡ºä¸€å®šçš„ç›®å½•è§„èŒƒä¸çº¦æŸï¼Œè¿™æ ·ä¹Ÿæœ‰åˆ©äºæé«˜åæœŸè„šæ‰‹æ¶çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¹Ÿè¦å¯¹è„šæ‰‹æ¶ä¸­çš„å…¬å…±éƒ¨åˆ†å’Œé¡¹ç›®ç§æœ‰éƒ¨åˆ†è¿›è¡Œåˆ†ç¦»ï¼Œå¯¹äºä¸€ä¸ªå…·ä½“é¡¹ç›®è€Œè¨€ï¼Œå¯ä»¥ä¸ç”¨æ”¹åŠ¨ webpack çš„é¡¹ç›®å…¬å…±éƒ¨åˆ†ï¼Œè¿™æ ·ä¹Ÿæœ‰åˆ©äºå‡å°‘ä¸åŒé¡¹ç›®ä¹‹é—´çš„åˆ‡æ¢æˆæœ¬ï¼Œå¯¹äºæˆ‘ä»¬ç›®å‰çš„é¡¹ç›®ï¼Œä¸€èˆ¬ä¼šæœ‰å¦‚ä¸‹ä¸¤ä¸ªç›®å½•ï¼š\n\n```\n- project\n\t- project.js\n- config\n\t- feature\n\t- plugins\n\t- rules\n\t- script.js\n\t- webpack.base.js \t\n```\n\nå¯¹äºä¸€ä¸ªé¡¹ç›®ï¼Œåªéœ€æ›´æ”¹ project ä¸‹çš„é…ç½®ã€‚\n\nè¿™é‡Œæˆ‘ä¹Ÿæ¨èä¸€ä¸ªå‰åŒäº‹åšçš„[steamerç ”å‘ä½“ç³»](https://github.com/steamerjs)ï¼Œåœ¨ä»ä¸­ä¹Ÿå¯ä»¥æ‰¾åˆ°å¾ˆå¤šç›¸å…³å‚è€ƒï¼Œæœ€ç®€å•çš„æ–¹å¼ï¼Œå°±æ˜¯ç›´æ¥åœ¨[steamer-simple](https://github.com/steamerjs/steamer-simple) çš„åŸºç¡€ä¸Šè¿›è¡Œæ‰©å±•ã€‚\n\n#### å®šåˆ¶ç”Ÿæˆç›®å½•\n\nç”Ÿæˆç›®å½•çš„æ ¼å¼ï¼Œè¿™é‡Œéœ€è¦å•ç‹¬è®²ä¸€ä¸‹ã€‚\n\nä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ç”Ÿæˆç›®å½•çš„æ ¼å¼éƒ½æ˜¯è¦è·Ÿå‘å¸ƒç³»ç»Ÿè¿›è¡Œç»“åˆçš„ï¼Œä¸è¿‡ä¹Ÿæœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬åšé¡¹ç›®çš„æ—¶å€™è¿˜æ²¡æœ‰æ˜ç¡®è¦æ¥å…¥å‘å¸ƒç³»ç»Ÿï¼Œæˆ–è€…å°šä¸çŸ¥é“å‘å¸ƒç³»ç»Ÿçš„æ ¼å¼è¦æ±‚ï¼Œä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬åº”å½“éµå¾ªä¸‹é¢çš„çº¦å®šï¼š\n\n* js/css/img ç­‰èµ„æºæ–‡ä»¶å’Œ html æ–‡ä»¶åˆ†ç¦»ï¼Œå‰è€…å‘å¸ƒåˆ° CDNï¼Œåè€…å‘å¸ƒåˆ° http æœåŠ¡å™¨ã€‚\n* html ä¸­å¼•å…¥çš„æ–‡ä»¶åœ°å€ï¼Œåº”å½“æ˜¯åœ¨æ„å»ºè¿‡ç¨‹ä¸­æ›´æ–°çš„ CDN åœ°å€ï¼Œè€Œä¸æ˜¯ç›¸å¯¹è·¯å¾„åœ°å€ã€‚\n* å¦‚æœæœ‰ç¦»çº¿åŒ…ï¼ˆoffline èƒ½åŠ›éœ€è¦å¯¹åº”çš„å®¢æˆ·ç«¯ webview æ”¯æŒï¼‰ç­‰ï¼Œéœ€è¦å•ç‹¬ä¸€ä¸ªç›®å½•ã€‚\n\nå¯¹äºæˆ‘ä»¬ç›®å‰çš„é¡¹ç›®è€Œè¨€ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¼šæœ‰ä¸‰ä¸ªç”Ÿæˆç›®å½•ï¼š\n\n```\n- cdn\n- offline # éœ€è¦å®¢æˆ·ç«¯æ”¯æŒè¯¥èƒ½åŠ›\n- webserver\n```\n\nå¦‚æœä¸€å¼€å§‹æˆ‘ä»¬æŠŠæ‰€æœ‰å†…å®¹ç”Ÿæˆåˆ°ä¸€ä¸ªç›®å½•ä¸­äº†ï¼Œè¿™ç»™æˆ‘ä»¬åæœŸçš„æ”¹åŠ¨å’Œç»´æŠ¤ï¼Œéƒ½å¸¦æ¥å¾ˆå¤§çš„éšæ‚£ã€‚\n\n#### ç»„ä»¶åº“\n\nç»„ä»¶åº“è¿™ä¸€éƒ¨åˆ†ï¼Œé€‚åˆé¡¹ç›®å¼€å§‹å˜å¾—å¤æ‚çš„æƒ…å†µä¸‹è¿›è¡Œå¯åŠ¨ï¼Œè€Œä¸å»ºè®®ä¸€å¼€å§‹è¿›è¡Œè¿‡æ¸¡è®¾è®¡ï¼Œå»ºè®¾ç»„ä»¶åº“èƒ½å¤Ÿé€šè¿‡ç»„ä»¶å¤ç”¨é™ä½æˆ‘ä»¬çš„å¼€å‘æˆæœ¬ï¼ŒåŒæ—¶ï¼Œç»„ä»¶åº“ä¹Ÿéœ€è¦ä¸“äººç»´æŠ¤ï¼Œä¿æŒæ›´æ–°ã€‚\n\n### å¼€å‘ï¼šä»£ç çš„è§„èŒƒçº¦æŸ\n\nå¯¹äº js æ–‡ä»¶çš„ä»£ç æ ¼å¼ï¼Œè¯¸å¦‚è¦ä¸è¦åˆ†å·ã€ä¸¤ä¸ªè¿˜æ˜¯å››ä¸ªå­—ç¬¦ç¼©è¿›ç­‰ï¼Œä¸€åªäº‰è®®ä¸æ–­ï¼Œæœ¬æ–‡ä¹Ÿä¸å¯¹æ­¤è¿›è¡Œè®¨è®ºï¼Œä½†æ˜¯å¯¹äºä¸€ä¸ªå›¢é˜Ÿçš„é¡¹ç›®é›†åˆï¼ˆè€Œä¸æ˜¯å•ä¸ªé¡¹ç›®ï¼‰è€Œè¨€ï¼Œä»£ç é£æ ¼çš„ç»Ÿä¸€ï¼Œæ˜¯ä¸€ä¸ªéå¸¸æœ‰å¿…è¦è€Œä¸”å¿…é¡»è¦åšçš„äº‹æƒ…ã€‚\n\n#### typescript\n\nå…³äº typescript çš„ç›¸å…³æ–‡ç« å®åœ¨å¤ªå¤šäº†ï¼Œè¿™é‡Œä¹Ÿä¸å¯¹æ­¤è¿›è¡Œè¯¦ç»†çš„è¯´æ˜ï¼Œå…¶å¯¹ä»£ç çš„å¯è¯»æ€§ã€è§„èŒƒçº¦æŸã€é™ä½æŠ¥é”™é£é™©ç­‰éƒ½æœ‰å¾ˆå¥½çš„æ”¹è¿›ï¼Œå¯¹äºè¶Šå¤æ‚çš„é¡¹ç›®å…¶æ•ˆæœè¶Šæ˜æ˜¾ã€‚\n\nå¦å¤–ï¼Œ [typescript å…¥é—¨æ•™ç¨‹](https://ts.xcatliu.com/)çš„ä½œè€…ä¹Ÿåœ¨æˆ‘ä»¬å›¢é˜Ÿä¸­ï¼Œè¿™é‡Œæˆ‘æƒ³è¯´ï¼Œå¦‚æœç°åœ¨è¿˜æ²¡æœ‰å¼€å§‹ä½¿ç”¨ typescriptï¼Œè¯·å¼€å§‹å­¦ä¹ å¹¶ä½¿ç”¨ typescript å§ã€‚\n\n#### eslint ä¸ prettier\n\né™¤äº† typescript ä»¥å¤–ï¼Œåœ¨ä»£ç æ ¼å¼æ–¹é¢è¿˜å»ºè®®ä½¿ç”¨ eslint å’Œ prettier æ¥è¿›è¡Œä»£ç æ ¼å¼çš„çº¦æŸï¼Œè¿™é‡Œè™½ç„¶ eslint å’Œ prettier ä¸¤è€…åœ¨æŸäº›æƒ…æ™¯ä¸‹ä¼šæœ‰äº›é‡å ï¼Œä½†æ˜¯ä¸¤è€…çš„ä¾§é‡ç‚¹ä¸åŒï¼Œeslint ä¾§é‡äºä»£ç è´¨é‡çš„æ£€æŸ¥å¹¶ä¸”ç»™å‡ºæç¤ºï¼Œåœ¨æŸç§å±‚é¢ä¸Šï¼Œå¯ä»¥çœ‹ä½œæ˜¯ typescript çš„è¡¥å……ï¼Œè€Œ prettier åœ¨æ ¼å¼åŒ–ä»£ç æ–¹é¢æ›´å…·æœ‰ä¼˜åŠ¿ï¼Œå¹¶ä¸” prettier åœ¨è®¾è®¡ä¹‹åˆå°±è€ƒè™‘äº†å’Œ eslint çš„é›†æˆï¼Œæ‰€ä»¥ä½ å¯ä»¥å®Œå…¨æ”¾å¿ƒçš„åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ä¸¤è€…ï¼Œè€Œä¸ç”¨æ‹…å¿ƒå‡ºç°æ— æ³•è§£å†³çš„å†²çªã€‚\n\nå¦å¤–ï¼Œeslint ç¤¾åŒºä¸­å·²ç»å½¢æˆäº†å¾ˆå¤šç§æœ€ä½³å®è·µï¼Œè€Œæˆ‘ä»¬å›¢é˜Ÿä¹Ÿè®¾è®¡å‡ºäº†è‡ªå·±çš„ä¸€å¥— eslint è§„åˆ™ï¼Œå¯ä»¥æŒ‰éœ€[å–ç”¨](https://github.com/AlloyTeam/eslint-config-alloy)\n\np.s. ç›®å‰ tslint åç»­è®¡åˆ’ä¸åœ¨ç»´æŠ¤ï¼Œè½¬å‘ eslint å¢å¼ºï¼Œå› æ­¤æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å¯ä»¥ä¸å†ä½¿ç”¨ tslintã€‚\n\nä»¥ä¸Šè¿™å‡ ç§ä»£ç é£æ ¼æ–¹é¢çš„çº¦æŸï¼Œé€‚åˆé¡¹ç›®ä¹‹åˆå³å¼€å§‹çº¦æŸï¼Œè¿™æ ·åœ¨ä¸­åæœŸä¼šæœ‰å·¨å¤§çš„æ—¶é—´æˆæœ¬çš„èŠ‚çœå’Œæ•ˆç‡çš„æå‡ã€‚\n\n### åä½œï¼šä½¿ç”¨ git\n\nä½¿ç”¨ git è¿›è¡Œåä½œè¿™é‡Œå…¶å®åŒ…æ‹¬ä¸¤ä¸ªç‚¹ï¼Œä½¿ç”¨ git ç®¡ç†é¡¹ç›®ä¸è‡ªå»º gitlabï¼Œåè€…æ˜¯ä¸€ä¸ªæ¯”è¾ƒåŸºç¡€æ€§çš„å·¥ä½œï¼Œå¹¶ä¸”å®é™…ä¸Šéš¾åº¦å¹¶ä¸å¤§ï¼Œæˆ‘è®¤ä¸ºæ¯ä¸€ä¸ªå…¬å¸éƒ½å¯ä»¥ä½¿ç”¨è‡ªå»ºçš„ gitlab è¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼Œè¿™ä¸ªå®é™…ä¸Šéš¾åº¦å¹¶ä¸å¤§ï¼Œå¹¶ä¸”å¯ä»¥æœ‰æ•ˆçš„ä¿æŠ¤å…¬å¸çš„ä»£ç è´¢äº§ï¼Œå¦‚æœä½ æ‰€åœ¨çš„å…¬å¸è¿˜æ²¡æœ‰ï¼Œé‚£ä¹ˆè¿™ä¹Ÿæ˜¯ä½ çš„æœºä¼šã€‚\n\nåœ¨å…·ä½“çš„ä½¿ç”¨ git ä¸­ï¼Œå¯¹äºgitçš„åˆ†æ”¯/TAGç®¡ç†ã€PRè§„èŒƒã€æäº¤æ–‡ä»¶çº¦æŸç­‰éƒ½åº”å½“æœ‰ä¸€å¥—åˆç†çš„æµç¨‹ï¼Œè¿™é‡Œæˆ‘å¯¹å‡ ç‚¹æ¯”è¾ƒé‡è¦çš„è¿›è¡Œè¯´æ˜ï¼š\n\n* é”å®šä¸»å¹²ä¸åˆ†æ”¯å¼€å‘ï¼Œæˆ‘ä»¬åœ¨æ—¥å¸¸å¼€å‘ä¸­ç¦æ­¢ç›´æ¥æäº¤ä¸»å¹²ï¼Œè€Œæ˜¯åªèƒ½åœ¨åˆ†æ”¯ä¸­è¿›è¡Œå¼€å‘ï¼Œå¹¶ä¸”é€šè¿‡ MR çš„æ–¹å¼æäº¤åˆ°ä¸»å¹²ã€‚\n* git hooks æ£€æŸ¥ï¼šæˆ‘ä»¬åº”è¯¥é€šè¿‡ git hooks è¿›è¡Œå¿…è¦çš„æ£€æŸ¥ï¼Œæ¯”å¦‚è‡ªåŠ¨åŒ–æµ‹è¯•ã€eslint æ£€æŸ¥ã€ä»¥åŠä¸€äº›é¡¹ç›®ä¸­å¿…è¦çš„æ£€æŸ¥ã€‚\n* MR æ£€æŸ¥ä¸ Code Reviewï¼Œè¿™é‡Œå»ºè®®åœ¨ Merge Request çš„æ—¶å€™åšä¸¤ä»¶äº‹æƒ…ï¼Œä¸€ä»¶æ˜¯ Code Reviewï¼Œä¸è¿‡è¿™ä¸ªåœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ä¸å…·å¤‡æ¡ä»¶ï¼Œå°¤å…¶æ˜¯å›¢é˜ŸäººåŠ›ç´§å¼ çš„æ—¶å€™ï¼Œå¦å¤–ä¸€ä¸ªåˆ™æ˜¯ MR çš„ HOOK è§¦å‘æ£€æŸ¥ï¼Œè¿™ä¸ªä¸€èˆ¬éœ€è¦å€ŸåŠ©ä¸€äº›æŒç»­é›†æˆå·¥å…·æ¥å®Œæˆï¼Œå¯ä»¥è¯´æ˜¯æˆ‘ä»¬ä»£ç åœ¨åˆå¹¶ä¸»å¹²ä¹‹å‰çš„æœ€åä¸€ä¸ªå…³å¡ã€‚\n\n### æµ‹è¯•ï¼šæµ‹è¯•ä¸æµ‹è¯•éƒ¨ç½²\n\næµ‹è¯•æ˜¯ä»£ç å¼€å‘ä¸­é‡è¦çš„ä¸€ä¸ªç¯èŠ‚ï¼Œä½†å®é™…ä¸Šå¯¹äºå‰ç«¯å¼€å‘æ¥è¯´ï¼Œå‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆä¸€èˆ¬è¾ƒå°‘ä¹¦å†™æµ‹è¯•ç”¨ä¾‹ï¼Œä¹Ÿå¹¶æ²¡æœ‰ä¸“ä¸šçš„æµ‹è¯•å¼€å‘å·¥ç¨‹å¸ˆæ¥è¾…åŠ©å·¥ä½œï¼Œä¸è¿‡ï¼Œä¸€èˆ¬ä¼šæœ‰é…å¤‡ç³»ç»Ÿæµ‹è¯•å·¥ç¨‹å¸ˆåœ¨é»‘ç›’çš„æƒ…å†µä¸‹è¿›è¡Œå†’çƒŸæµ‹è¯•å’ŒåŠŸèƒ½æµ‹è¯•ä»¥åŠæ•´ä½“é“¾è·¯çš„éªŒæ”¶ï¼Œä¿—ç§°â€œç‚¹ç‚¹ç‚¹â€ã€‚è€Œè¿™ä¸ªæ—¶å€™ï¼Œå‰ç«¯å¼€å‘è¦åšçš„å°±æ˜¯æŠŠç¨‹åºä»£ç éƒ¨ç½²åˆ°æµ‹è¯•æœåŠ¡å™¨ä¸Šï¼ŒåŒæ—¶æä¾›ä¸€ä¸ªå°½å¯èƒ½çœŸå®çš„åœºæ™¯ä¾›æµ‹è¯•è¿›è¡Œæµ‹è¯•ã€‚\n\nåœ¨ç¬”è€…ç»å†çš„é¡¹ç›®ä¸­ï¼Œè™½ç„¶ä¹Ÿä½¿ç”¨äº†å•å…ƒæµ‹è¯•ã€ç«¯å¯¹ç«¯æµ‹è¯•ï¼Œä¸è¿‡è¿™ä¸€éƒ¨åˆ†ä½“ç³»å¹¶ä¸ååˆ†å®Œå¤‡ï¼Œå¹¶ä¸”å¯èƒ½ä¹Ÿä¸æ˜¯å¤§å¤šæ•°å‰ç«¯å¼€å‘è€…æ„Ÿå…´è¶£çš„å†…å®¹ï¼Œæ‰€ä»¥è¿™é‡Œä¸»è¦æ€»ç»“å¦‚ä½•è¿›è¡Œé«˜æ•ˆçš„æµ‹è¯•éƒ¨ç½²ä¸å‘å¸ƒå¯¹æ¥ã€‚\n\nä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šæœ‰ä¸€å°åˆ°å¤šå° Linux æµ‹è¯•æœºï¼Œä¾›æµ‹è¯•ç¯å¢ƒéƒ¨ç½²ä½¿ç”¨ï¼Œå¯¹äºå‰ç«¯é¡¹ç›®è€Œè¨€ï¼Œä¸€èˆ¬ä¸éœ€è¦ç‰¹æ®Šç¯å¢ƒï¼Œå¯ä»¥è¿›è¡Œ webpack æ„å»ºä»¥åŠæœ‰ nginx è¿›è¡Œè½¬å‘å³å¯ã€‚\n\nè€Œæµ‹è¯•ç¯å¢ƒçš„éƒ¨ç½²ï¼Œå¦‚æœæ˜¯è®©æˆ‘ä»¬æ‰‹åŠ¨ç™»å½•å»éƒ¨ç½²ï¼Œæ˜¾ç„¶æ˜¯ä¸åˆç†çš„ï¼Œå¦‚æœæˆ‘ä»¬çº¯ç²¹ä½¿ç”¨ CI æ¥å®Œæˆè¿™ä»¶äº‹ï¼Œåˆ™å¯¹ CI å·¥å…·çš„èƒ½åŠ›å’Œé¡¹ç›®äººå‘˜ç´ è´¨æœ‰ä¸€å®šè¦æ±‚ï¼Œå¹¶ä¸”ä¸å…·å¤‡å¯è§†åŒ–ç®¡ç†èƒ½åŠ›ï¼Œå®¹æ˜“å‡ºé”™ï¼Œè¿™é‡Œæˆ‘å»ºè®®å¯ä»¥ç»´æŠ¤ä¸€ä¸ªå¯è§†åŒ–ç³»ç»Ÿæ¥è¿›è¡Œæµ‹è¯•ç¯å¢ƒçš„éƒ¨ç½²å’Œç®¡ç†ï¼Œå…¶æ•´ä¸ªç¯èŠ‚åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š\n\n```\næœ¬åœ°ä»£ç  -> gitlab -> æµ‹è¯•ç³»ç»Ÿéƒ¨ç½² -> å¯¹æ¥å‘å¸ƒç³»ç»Ÿ \n```\n\nè¿™é‡Œçš„æµ‹è¯•ç³»ç»Ÿï¼Œå®é™…ä¸Šæ˜¯ä» gitlab æ‹‰å–ä»£ç ï¼Œå¹¶ä¸”æœ¬åœ°æ‰§è¡Œ build å‘½ä»¤ï¼ˆä¸€èˆ¬æ˜¯ `npm run build`ï¼‰å¹¶æŠŠæ„å»ºç»“æœå­˜å‚¨åœ¨ nginx å¯ä»£ç†çš„ç›®å½•å³å¯ï¼Œå‡ºäºç³»ç»Ÿå®Œå¤‡æ€§è€ƒè™‘ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šæœ‰å¤šå°æµ‹è¯•æœºï¼Œè¿™é‡Œæˆ‘å»ºè®®ä¸€èˆ¬æ‹¿å…¶ä¸­çš„ä¸€å°ä½œä¸ºæ„å»ºæœºï¼Œå…¶ä»–çš„æµ‹è¯•æœºä»…æä¾› nginx ä»£ç†èƒ½åŠ›å³å¯ï¼Œæˆ‘ä»¬åœ¨ä¸€å°æ„å»ºæœºä¸­è¿›è¡Œæ„å»ºï¼Œå¹¶ä¸”å°†æ„å»ºç»“æœé€šè¿‡ç³»ç»Ÿå‘½ä»¤å‘é€åˆ°å…¶ä»–çš„æµ‹è¯•æœºã€‚\n\nä¸€å°æ„å»ºæœºå¯ä»¥æœåŠ¡äºæ‰€æœ‰çš„é¡¹ç›®ï¼Œè¿™é‡Œè¿˜å¯èƒ½æ¶‰åŠåˆ° webpackã€nodejs ç‰ˆæœ¬çš„ç»´æŠ¤ï¼Œæˆ‘ä»¬éœ€è¦çº¦æŸå„ä¸ªæµ‹è¯•é¡¹ç›®æ„å»ºå¤„åœ¨ä¸€ä¸ªç›¸å¯¹ç‹¬ç«‹çš„ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨è¿‡ Docker æ¥è¿›è¡Œæ„å»ºï¼Œä¿è¯éš”ç¦»ã€‚\n\næ„å»ºå®Œæˆåï¼Œä¸€èˆ¬æˆ‘ä»¬å€ŸåŠ© Fiddlerã€Charlesã€Whistle ç­‰ä»»æ„ä¸€æ¬¾ä»£ç†å·¥å…·ï¼Œå³å¯ä»¥è¿›è¡Œæµ‹è¯•ã€‚\n\n### ç›‘æ§ï¼šæ—¥å¿—æŸ¥çœ‹ä¸è„šæœ¬é”™è¯¯çš„ç›‘æ§\n\nå¯¹äºå‰ç«¯é¡¹ç›®è€Œè¨€ï¼Œå³ä½¿æˆ‘ä»¬å·²ç»ä½¿ç”¨äº† typescriptã€eslint å¹¶ä¸”ä¹Ÿæœ‰äº†ä¸€äº›æµ‹è¯•è„šæœ¬å’Œç³»ç»Ÿæµ‹è¯•å·¥ç¨‹å¸ˆè¿›è¡Œçš„åŠŸèƒ½æµ‹è¯•ï¼Œæˆ‘ä»¬è¿˜æ˜¯å…ä¸äº†ä¼šå‡ºç° js è„šæœ¬é”™è¯¯ï¼Œç‰¹åˆ«æ˜¯ js ä»£ç çš„è¿è¡Œç¯å¢ƒå’Œè®¾å¤‡çš„å¤šæ ·åŒ–ï¼Œå¾ˆå¤šé”™è¯¯æˆ‘ä»¬å¹¶æ²¡æœ‰å‘ç°ï¼Œä½†æ˜¯äº§å“ã€è¿è¥åŒå­¦å´å‡ºç°äº†ï¼Œæˆ–è€…åˆ°äº†çº¿ä¸Šåœ¨ç”¨æˆ·è®¾å¤‡ä¸Šå‡ºç°äº†ã€‚\n\næ‰€ä»¥ï¼Œæœ‰ä¸¤ä¸ªäº‹æƒ…æˆ‘ä»¬å¿…é¡»è¦åšï¼š\n\n1. æ—¥å¿—æŸ¥çœ‹åŠŸèƒ½ï¼ˆæ‰‹æœºç«¯ï¼‰ï¼šç°åœ¨æˆ‘ä»¬å†™çš„å¤§å¤šæ•° TO C é¡µé¢éƒ½æ˜¯åœ¨æ‰‹æœºç«¯è¿›è¡Œï¼ŒæŸ¥çœ‹ console éå¸¸ä¸æ–¹ä¾¿ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªçº¿ä¸Šå®æ—¶æŸ¥çœ‹ console çš„å·¥å…·ã€‚\n2. æˆ‘ä»¬éœ€è¦è„šæœ¬é”™è¯¯æ—¥å¿—ç»Ÿè®¡ç³»ç»Ÿæ¥è¿›è¡Œé”™è¯¯ç»Ÿè®¡ç®¡ç†ä¸å…·ä½“é”™è¯¯æŸ¥çœ‹ã€‚\n\nå¯¹äºç¬¬ä¸€ä¸ªåŠŸèƒ½ï¼Œè¿›è¡Œç»†åˆ†ï¼Œæˆ‘ä»¬éœ€è¦åšè¿™æ ·å‡ ä»¶äº‹æƒ…ï¼š\n\n* åµŒå…¥ä¸€ä¸ª console å’Œ ç½‘ç»œè¯·æ±‚æŸ¥çœ‹å™¨ï¼Œå¹¶ä¸”åªåœ¨ç‰¹æ®Šæƒ…å†µä¸‹æ‰èƒ½è§¦å‘ï¼ˆæ¯”å¦‚è¿ç»­ç‚¹å‡»æ ‡é¢˜åæ¬¡ã€æˆ–è€…ä½¿ç”¨ç‰¹å®šäº¤äº’æ‰‹åŠ¿ï¼‰\n* åœ¨è§¦å‘æŸ¥çœ‹å™¨çš„æ—¶å€™ï¼Œå¯ä»¥å°†æ—¥å¿—å®Œæ•´åœ°è¿›è¡Œä¸Šä¼ å¹¶åˆ†æã€‚\n* åŒæ—¶å¯ä»¥å¯¹è¯¥ç”¨æˆ·è¿›è¡ŒæŸ“è‰²ï¼Œä¼šè‡ªåŠ¨ä¸Šä¼ å¹¶è®°å½•è¯¥ç”¨æˆ·ä¸€å®šæ—¶é—´å†…åç»­åˆ·æ–°åæ“ä½œçš„å…¨éƒ¨æ—¥å¿—ã€‚\n\nä¸è¿‡è¿™é‡Œå¹¶æ²¡æœ‰å®Œå…¨å®ç°ä»¥ä¸Šä¸‰ç‚¹çš„å¼€æºåº“æ¨èï¼Œå¯ä»¥åœ¨ [vconsole](https://github.com/Tencent/vConsole) æˆ–è€… [mlogger](https://github.com/AlloyTeam/MLogger) çš„åŸºç¡€ä¸Šè¿›è¡Œé€‚å½“æ‰©å±•ï¼Œå®Œæˆç›¸å…³åŠŸèƒ½ã€‚\n\nå¯¹äºç¬¬äºŒä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå®Œæ•´çš„ç»Ÿè®¡åˆ†æä¸ç®¡ç†çš„é”™è¯¯ç³»ç»Ÿï¼Œè¿™ä¸ªå¦‚æœè‡ªè¡Œå¼€å‘çš„è¯ï¼Œéš¾åº¦ä¼šæ¯”è¾ƒå¤§ï¼Œè¿™é‡Œå¼ºçƒˆæ¨è [sentry](https://sentry.io/welcome/)ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„ä½¿ç”¨ Docker éƒ¨ç½²åˆ°æœåŠ¡å™¨ç«¯ï¼Œå¹¶ä¸”æ‹¥æœ‰éå¸¸å¼ºå¤§çš„æ—¥å¿—é”™è¯¯åˆ†æä¸å¤„ç†èƒ½åŠ›ï¼Œé€šè¿‡ç»“åˆ JavaScript çš„ sourcemap ï¼Œå¯ä»¥ç»™æˆ‘ä»¬çš„é”™è¯¯å®šä½å¸¦æ¥æå¤§çš„æ–¹ä¾¿ã€‚\n\næ€»ä¹‹ï¼Œæ—¥å¿—æŸ¥çœ‹ä¸è„šæœ¬é”™è¯¯ç›‘æ§ï¼Œæ˜¯æ¯”è¾ƒé‡è¦ä½†æ˜¯åŒæ—¶å®¹æ˜“è¢«å¿½è§†çš„åœ°æ–¹ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿåœ¨çº¿ä¸Šä½¿ç”¨äº†å‡ ä¸ªæœˆäº†ï¼ŒçœŸæ­£æœ‰é—®é¢˜åé¦ˆäº†ï¼Œæˆ‘ä»¬æ‰ä¼šè€ƒè™‘åŠ ä¸Šè¿™äº›åŠŸèƒ½ï¼Œä½†è¿™ä¸ªæ—¶å€™é€šå¸¸å·²ç»é€ æˆäº†æŸå¤±ã€‚\n\n### å‘å¸ƒï¼šç‰ˆæœ¬å‘å¸ƒæ›´æ–°\n\nå‘å¸ƒç³»ç»Ÿï¼Œä¸€èˆ¬ä½œä¸ºå‰ç«¯æœ€åç¯èŠ‚çš„ç³»ç»Ÿï¼Œé€šå¸¸ä¼šå’Œæµ‹è¯•éƒ¨ç½²ç³»ç»Ÿæ‰“é€šï¼ˆæˆ–åˆäºŒä¸ºä¸€ï¼‰ï¼Œä¸€èˆ¬çš„å‘å¸ƒç³»ç»Ÿçš„å¿…è¦åŠŸèƒ½å¦‚ä¸‹ï¼š\n\n* å¯¹äºå‰ç«¯çš„å‘å¸ƒï¼Œæ¯æ¬¡åªå‘å¸ƒæœ‰æ”¹å˜çš„æ–‡ä»¶ï¼Œæ— å˜åŠ¨çš„æ–‡ä»¶åˆ™æ— éœ€å‘å¸ƒã€‚\n* æ¯æ¬¡å‘å¸ƒå…ˆå‘å¸ƒ js/css/img ç­‰èµ„æºæ–‡ä»¶ï¼Œç”Ÿæ•ˆä¹‹åå†å‘å¸ƒ html æ–‡ä»¶ã€‚\n* å‘å¸ƒç³»ç»Ÿä¿ç•™çº¿ä¸Šæ—§ç‰ˆä»£ç ï¼Œå‡ºé—®é¢˜åå¯ä»¥å¿«é€Ÿä¸€é”®å›æ»šã€‚\n\nè‡³äºä¸€äº›å…¶ä»–çš„æ—¥å¿—ã€æŠ¥è¡¨ç­‰è¾…åŠ©æ€§åŠŸèƒ½ï¼Œåˆ™æ ¹æ®éœ€è¦æ»¡è¶³ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚\n\n#### ç°åº¦å‘å¸ƒ\n\nç°åº¦å‘å¸ƒæ˜¯å¤§å‹é¡¹ç›®åœ¨å‘å¸ƒæ—¶çš„å¸¸è§æ–¹æ³•ï¼ŒæŒ‡åœ¨å‘å¸ƒç‰ˆæœ¬æ—¶ï¼Œåˆå§‹æƒ…å†µä¸‹ï¼Œåªå…è®¸å°æ¯”ä¾‹ï¼ˆæ¯”å¦‚1-5%æ¯”ä¾‹çš„ç”¨æˆ·ä½¿ç”¨ï¼‰ï¼Œè‹¥å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥å¿«é€Ÿå›æ»šä½¿ç”¨è€ç‰ˆæœ¬ï¼Œé€‚ç”¨äºä¸»é“¾è·¯å’Œè®¿é—®é‡è¾ƒå¤§çš„é¡µé¢ã€‚\n\nå¯¹äºå‰ç«¯çš„ç°åº¦ï¼Œå®é™…ä¸Šæœ‰ä»¥ä¸‹å‡ ç§æ–¹æ¡ˆï¼š\n\n* åœ¨ä»£ç å±‚é¢è¿›è¡Œç°åº¦ï¼Œå³é€šè¿‡ if/else è¿›è¡Œåˆ¤æ–­ï¼Œè¿™æ ·æ— éœ€å‘å¸ƒç³»ç»Ÿå…³æ³¨ï¼Œä¹Ÿå¯ä»¥è‡ªç”±é…ç½®è§„åˆ™ã€æ¯”ä¾‹ä¸ç™½åå•/é»‘åå•ã€‚\n* åœ¨å…¥å£å±‚é¢è¿›è¡Œç°åº¦ï¼Œæ¯”å¦‚ App å†…åµŒçš„ H5 åˆ™åœ¨å®¢æˆ·ç«¯çš„å¯¹åº”å…¥å£è¿›è¡Œå›å¤ï¼Œè¿™æ ·é€šå¸¸ä¹Ÿæ— éœ€å‘å¸ƒç³»ç»Ÿå…³æ³¨ã€‚\n* é€šè¿‡å‘å¸ƒç³»ç»Ÿï¼ŒæŒ‰ç…§æ¯”ä¾‹ç°åº¦ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰ 10 å° webserverï¼Œå¦‚æœæˆ‘ä»¬å…ˆå‘å¸ƒ 1 å°ï¼Œè¿™æ ·æˆ‘ä»¬çš„ç°åº¦æ¯”ä¾‹ä¸º 10%ã€‚\n\n### è®¿é—®é‡å®æ—¶ç›‘æ§\n\næœ€åä¸€ç‚¹ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªè®¿é—®é‡å®æ—¶ç›‘æ§ç³»ç»Ÿï¼Œæˆ‘ä»¬ä¸Šè¿°æœ‰äº†é”™è¯¯æŸ¥çœ‹ä¸è„šæœ¬ç›‘æ§ç³»ç»Ÿï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬çš„å„ä¸ªé¡µé¢çš„è®¿é—®é‡ã€ç‚¹å‡»ç‡ç­‰æŒ‡æ ‡ï¼Œé€šå¸¸æ˜¯äº§å“/è¿è¥åŒå­¦æ¯”è¾ƒå…³å¿ƒçš„ï¼ŒåŒæ—¶è®¿é—®é‡çš„æ³¢åŠ¨æƒ…å†µä¹Ÿæ˜¯é¡¹ç›®å¥åº·åº¦çš„ä¸€ä¸ªè¡¨å¾ï¼ˆè®¿é—®é‡çªç„¶å¤§å¹…ä¸Šæ¶¨æˆ–ä¸‹è·Œï¼Œä¸€èˆ¬éƒ½æœ‰å…¶ç‰¹å®šåŸå› ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è®¿é—®é‡å®æ—¶ç›‘æ§ç³»ç»Ÿã€‚\n\nè€Œå®é™…ä¸Šè®¿é—®é‡ç›‘æ§ç³»ç»Ÿä¹Ÿæœ‰ä¸¤ç§ä¸åŒå½¢æ€ï¼š\n\n* å¯¹äºæ¯ä¸€ä¸ªä¸ŠæŠ¥ keyï¼Œåªè¿›è¡Œæ•°é‡ä¸Šçš„ç»Ÿè®¡\n* å¯¹äºæ¯ä¸€ä¸ªä¸ŠæŠ¥ keyï¼Œå¯ä»¥æºå¸¦ä¸€äº›ä¿¡æ¯ï¼Œå¯¹æºå¸¦ä¿¡æ¯è¿›è¡Œç»Ÿè®¡åˆ†æã€‚\n\né€šå¸¸æƒ…å†µä¸‹ï¼Œå‰è€…çš„åŠŸèƒ½æ˜¯å®æ—¶æˆ–è€…ä½å»¶æ—¶çš„ï¼Œè€Œåè€…ç”±äºéœ€è¦ä¸€éƒ¨åˆ†ç»Ÿè®¡åˆ†æï¼Œé€šå¸¸å¯ä»¥æ¥å—éå®æ—¶æƒ…å†µï¼ˆä¸€èˆ¬æ¯å¤©å‡ºå‰ä¸€å¤©çš„æŠ¥è¡¨ï¼‰ã€‚\n\nè¿™éƒ¨åˆ†å†…å®¹ï¼Œéœ€è¦è¾ƒå¼ºçš„åç«¯æ¥å£ç¨³å®šæ€§ï¼Œé€šå¸¸å‰ç«¯éœ€è¦å’Œå¯¹åº”å²—ä½çš„åŒå­¦å…±å»ºã€‚\n\n### æ€»ç»“\n\næ€»ç»“ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸€ä¸ªç¨³å®šçš„å‰ç«¯é¡¹ç›®ï¼Œè‡³å°‘æ¶‰åŠåˆ°ä»¥ä¸‹ç¯èŠ‚ï¼š\n\n* å®Œå–„çš„é¡¹ç›®è„šæ‰‹æ¶ä¸ä»£ç çº¦æŸè§„èŒƒ\n* å†…éƒ¨ gitlab\n* å¯è§†åŒ–ç®¡ç†çš„æµ‹è¯•éƒ¨ç½²ç³»ç»Ÿ\n* å®æ—¶æ—¥å¿—æŸ¥çœ‹å·¥å…·\n* è„šæœ¬é”™è¯¯ç»Ÿè®¡ç®¡ç†ç³»ç»Ÿ\n* å‘å¸ƒç®¡ç†ç³»ç»Ÿ\n* è®¿é—®é‡å®æ—¶ç›‘æ§ç³»ç»Ÿ\n\nå¦‚æœä½ æ‰€åœ¨çš„å›¢é˜Ÿå“ªä¸ªç¯èŠ‚è¿˜æ²¡æœ‰æˆ–è€…ä¸å®Œå–„ï¼Œé‚£ä¹ˆè¿™ä¹Ÿæ˜¯ä½ çš„æœºä¼šã€‚\n","tags":["å‰ç«¯æ„å»º"]},{"title":"qlcè§£å†³äº†ä»€ä¹ˆé—®é¢˜","url":"/2019/02/16/qlcè§£å†³äº†ä»€ä¹ˆé—®é¢˜/","content":"\n### ç›®å‰é‡åˆ°çš„é—®é¢˜\n\nä½œä¸ºä¸€åå‰ç«¯å·¥ç¨‹å¸ˆï¼Œé™†é™†ç»­ç»­è´Ÿè´£äº†ä¸å°‘é¡¹ç›®ï¼Œè¿™äº›é¡¹ç›®ä¸­ï¼Œæœ‰ä¸€äº›æ˜¯æ­£åœ¨è¿­ä»£çš„ï¼Œå…¶ä»–åŒäº‹åŒæ—¶åœ¨è´Ÿè´£çš„é¡¹ç›®ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸å°‘é¡¹ç›®ï¼Œè¦ä¹ˆå°±æ˜¯è€æ—§é¡¹ç›®ç»´æŠ¤çš„åŒäº‹å·²ç»ç¦»èŒæˆ–è½¬å²—äº†çš„ï¼Œè¦ä¹ˆå°±æ˜¯æ–°é¡¹ç›®ä» 0 å¼€å§‹çš„ï¼Œå†åŠ ä¸Šå‰ç«¯ä»£ç ç§¯ç´¯é€Ÿåº¦å’Œè¿­ä»£é€Ÿåº¦éƒ½æ¯”è¾ƒå¿«ï¼Œå…¶ä¸­æš´éœ²äº†ä¸å°‘é—®é¢˜ã€‚\n\næˆ‘èº«è¾¹çš„å¤§å¤šæ•°ç¨‹åºå‘˜éƒ½æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯å–œæ¬¢æŠŠå…·ä½“çš„ä¸œè¥¿æŠ½è±¡åŒ–ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæŠ½è±¡å‡ºå…¬å…±çš„å‡½æ•°æˆ–æ–¹æ³•ã€å…¬å…±çš„ç±»æˆ–HOCï¼Œæ”¾åœ¨ä¸€èµ·ï¼Œé›†ä¸­åœ¨é¡¹ç›®çš„æŸä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œå«åš js æ–‡ä»¶å¤¹æˆ– lib æ–‡ä»¶å¤¹ï¼ˆä»¥ä¸‹æˆ‘ä»¬ç”¨ js æ–‡ä»¶å¤¹ä»£è¡¨å…¬å…±å‡½æ•°æ–‡ä»¶å¤¹ ï¼‰ã€‚\n\nè¿™æ ·åšçš„ç¡®å¸¦æ¥äº†å¾ˆå¤šä¾¿åˆ©ï¼Œä½†åŒæ—¶ä¹Ÿæœ‰ä¸€äº›éšæ‚£ï¼š\n\n* js æ–‡ä»¶å¤¹ä¸‹ä»£ç è¶Šæ¥è¶Šå¤šï¼Œè€Œä¸”å¤§å¤šæ•°é¹…å‚å°ä¼™ä¼´çš„ä½œé£æ˜¯ 0 æ–‡æ¡£ 0 æ³¨é‡Šï¼Œè¿™ç»™æ–°æ¥æ‰‹é¡¹ç›®çš„åŒå­¦ç†Ÿæ‚‰é¡¹ç›®å¸¦æ¥äº†æå¤§çš„éº»çƒ¦ã€‚\n* ä¸åŒé¡¹ç›®éƒ½æœ‰è‡ªå·±çš„ js æ–‡ä»¶å¤¹ï¼Œåœ¨å¼€å‘ä¸€ä¸ªæ–°é¡¹ç›®æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸çš„åšæ³•æ˜¯ï¼š\n\t* ç›´æ¥å°†åŸæœ‰é¡¹ç›®çš„ js æ–‡ä»¶å¤¹æ‹·è´åˆ°æ–°é¡¹ç›®ä¸­ï¼Œè¿™æ ·åœ¨æ–°é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›å…¬å…±å‡½æ•°äº†ã€‚\n\t* å°†åŸæœ‰é¡¹ç›®çš„éƒ¨åˆ† js æ–‡ä»¶æ‹·è´åˆ°æ–°é¡¹ç›®ä¸­ï¼Œå¹¶ä¸”éšç€æ–°é¡¹ç›®çš„å¼€å‘ï¼Œå¢é‡æ‹·è´ã€‚\n\t* ä»¥ä¸Šä¸¤ç§åšæ³•ï¼Œæœ¬è´¨åŒºåˆ«ä¸å¤§ï¼Œå‰è€…ä¼šç›´æ¥ç»™æ–°é¡¹ç›®å¢åŠ å¾ˆå¤šæ— ç”¨ä»£ç ï¼ˆåŸæœ‰é¡¹ç›®ä¸­æ‰€è°“çš„å…¬å…±å‡½æ•°åœ¨æ–°é¡¹ç›®ä¸­å¹¶ä¸ä¸€å®šä¼šç”¨åˆ°ï¼‰ï¼Œè€Œå¯¹è¿™ä¸¤ç§æ–¹å¼ï¼Œå¦‚æœæˆ‘ä»¬è¦ä¿®å¤ä¸€ä¸ª bugï¼Œä¿®æ”¹æˆ–å‡çº§å…¬å…±ä»£ç ä¸­çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦ä¸€ä¸ªä¸€ä¸ªçš„ï¼Œå°†ä¿®å¤å¥½çš„æ–‡ä»¶æ‹·è´åˆ°ä¸åŒçš„é¡¹ç›®ä¸­ï¼Œå¦‚æœé¡¹ç›®å¤šäº†å¹¶ä¸”å·²ç»äº¤ç”±ä¸åŒçš„äººç»´æŠ¤äº†ï¼Œè¿™ç®€ç›´æ˜¯ä¸€ä¸ªç¾éš¾ã€‚\n* ç”±äºå…¬å…± js æ–‡ä»¶å¤¹ä¸‹å†…å®¹æ¯”è¾ƒå¤šï¼Œå¹¶ä¸”æœ‰çš„å¼€å‘åŒå­¦ä¹ æƒ¯ä»¥ 'urlUtils.js'ã€'strUtils.js' è¿™ç§æ–¹å¼æ¥æ•´åˆä¸€äº›å°çš„å‡½æ•°é›†ï¼Œè¿™æ ·ä¼šé€ æˆå‡½æ•°é‡å¤çš„éšæ‚£ï¼ˆæ¯•ç«Ÿæˆ‘ä»¬ä¸€ä¸ªæ–‡ä»¶ä¸€è¡Œè¡Œçš„å»åˆ†æç›®å‰çš„å…¬å…±åº“å·²ç»æœ‰äº†å“ªäº›èƒ½åŠ›æ˜¯ä¸ç°å®çš„ï¼‰ï¼Œæˆ‘è§‚å¯Ÿè¿‡ä¹‹å‰è‡ªå·±æ¥æ‰‹çš„ä¸€ä¸ªä¸ç®—å¤æ‚çš„é¡¹ç›®ï¼ˆæ½˜å¤šæ‹‰ï¼‰ï¼Œå…¶ä»…ä»…æ˜¯ä» url è§£æ query è¿™ç§åŠŸèƒ½å‡½æ•°ï¼Œå°±æœ‰å¤šè¾¾ 3ä¸ª(ç”šè‡³æ›´å¤š)ï¼Œåˆ†å¸ƒåœ¨ js æ–‡ä»¶å¤¹ä»¥åŠ node_modules é‡Œé¢ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸åŒçš„ç»´æŠ¤äººå‘˜ç”±äºä¿¡æ¯ä¸å¯¹ç§°é‡å¤å¼•å…¥çš„ã€‚\n* å¯¹äºæ€ä¹ˆæ ·æ‰èƒ½ç®—ä½œâ€œå…¬å…±â€å‡½æ•°ï¼Œç›®å‰æ˜¯ç¼ºä¹ä¸€ä¸ª review è¿‡ç¨‹çš„ï¼Œä»»ä½•é¡¹ç›®å¼€å‘äººå‘˜ï¼Œå‡ ä¹éƒ½å¯ä»¥æ— é™åˆ¶åœ°åœ¨å…¬å…± js æ–‡ä»¶å¤¹ä¸‹å¢åŠ å†…å®¹ï¼Œå¹¶åœ¨ä¹‹åè¢«æºå¸¦ç€æ‹·è´åˆ°å…¶ä»–é¡¹ç›®ä¸­ï¼Œè¿™å…¶ä¸­æœ‰äº›å‡½æ•°ï¼Œä¹Ÿè®¸å¹¶ä¸é€‚åˆåœ¨è¿™é‡Œã€‚\n\n### é—®é¢˜å½’çº³ä¸è§£å†³\n\nå®é™…ä¸Šï¼Œæ€»ç»“ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦è§£å†³ä¸‰ä¸ªç—›ç‚¹ï¼š\n\n* ä»¥ä½æˆæœ¬çš„æ–¹å¼å¢åŠ é«˜å¯è¯»æ€§çš„æ–‡æ¡£ï¼Œæ–¹ä¾¿æ–°æ¥æ‰‹é¡¹ç›®çš„åŒå­¦ç†Ÿæ‚‰ã€‚\n* è§£å†³è·¨é¡¹ç›®ä¹‹é—´çš„å…¬å…±å‡½æ•°å¤ç”¨å’Œæ›´æ–°ç»´æŠ¤å›°éš¾çš„é—®é¢˜ã€‚\n* å¢åŠ å¿…è¦çš„ review ç¯èŠ‚ï¼Œå¯¹å…¬å…±å‡½æ•°åº“çš„å¿…è¦æ€§å’Œä»£ç æ­£ç¡®æ€§è¿›è¡Œ reviewã€‚\n\nå°±ç¬¬ä¸€ä¸ªé—®é¢˜è€Œè¨€ï¼Œå…¶å®ç°åœ¨çš„å‰ç«¯æ–‡æ¡£å·¥å…·é“¾å·²ç»æå¤§é™ä½äº†å†™æ–‡æ¡£çš„æˆæœ¬äº†ï¼Œåˆ©ç”¨ [jsdoc](http://usejsdoc.org/) æˆ– [esdoc](https://esdoc.org/) ç­‰æ–‡æ¡£ç”Ÿæˆå·¥å…·ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šå·²ç»ä¸éœ€è¦æ‰‹åŠ¨å†™æ–‡æ¡£ï¼Œè€Œæ˜¯åœ¨å†™ä»£ç çš„åŒæ—¶å†™æ³¨é‡Šï¼Œå°±å¯ä»¥è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ï¼Œå¹¶ä¸”é…åˆç›¸å…³çš„ç¼–è¾‘å™¨æ’ä»¶ï¼Œä¸€éƒ¨åˆ†æ³¨é‡Šéƒ½å¯ä»¥è‡ªåŠ¨ç”Ÿæˆã€‚\n\nä½†æ˜¯ç›®å‰æˆ‘ç»å†çš„å¤§å¤šæ•°é¡¹ç›®è¿˜æ˜¯æ²¡æœ‰æ–‡æ¡£ï¼Œè¿™é‡Œå¯èƒ½æ˜¯ç”±äºä»¥ä¸‹å››ä¸ªåŸå› ï¼š\n\n* éƒ¨åˆ†åŒå­¦å¹¶ä¸çŸ¥é“æœ‰ esdocã€jsdoc è¿™ç§æ¯”è¾ƒå¥½ç”¨çš„æ–‡æ¡£ç”Ÿæˆå·¥å…·ã€‚\n* å¼€å‘ç»„ä¸­æ²¡æœ‰äººå»æ¨åŠ¨ï¼Œæ–‡æ¡£ä¸å±äº KPI å’Œè€ƒæ ¸çš„å†…å®¹ï¼ŒåŠ ä¹‹æ—¶é—´ç´§è¿­ä»£å¿«ï¼Œç¼ºä¹å‰äººæ ½æ ‘çš„åŠ¨åŠ›ã€‚\n* è™½ç„¶ç°åœ¨çš„æ–‡æ¡£ç”Ÿæˆå·¥å…·æ¯”è¾ƒç®€å•äº†ï¼Œä½†ä¸€èˆ¬è¿˜æ˜¯éœ€è¦ä¸€å®šçš„é…ç½®ï¼Œä¹Ÿæœ‰ä¸€ç‚¹ä¸Šæ‰‹æˆæœ¬ã€‚\n* ç”Ÿæˆçš„æ–‡æ¡£ä¸èƒ½ååˆ†æ»¡è¶³éœ€æ±‚ï¼Œä¾‹å¦‚ esdoc é»˜è®¤åªèƒ½ç”Ÿæˆ html æ ¼å¼çš„æ–‡æ¡£ï¼Œåœ¨ç¼–è¾‘å™¨é‡Œé¢æ²¡æ³•ç›´æ¥çœ‹ã€‚\n\né’ˆå¯¹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œqlc åšå‡ºäº†ä¸€äº›åŠªåŠ›ï¼š\n\n* 0 é…ç½®ï¼Œå…¨è‡ªåŠ¨åŒ–ç”Ÿæˆæ–‡æ¡£ï¼Œç”šè‡³é›†æˆåˆ°äº†å…¶ä»–å¼€å‘æµç¨‹ä¸­ï¼Œå‘½ä»¤è¡Œä¹Ÿä¸ç”¨æ•²ã€‚\n* åŸºäº esdoc ä»¥åŠå¼€æºæ’ä»¶äºŒæ¬¡å¼€å‘ï¼Œå¯ä»¥é€‰æ‹©æ€§ç”Ÿæˆ html å’Œ markdown æ ¼å¼çš„æ–‡æ¡£ï¼Œæ³¨é‡æ–‡æ¡£ä½“éªŒã€‚\n* åŸºäº esdoc æ³¨é‡Šå†™ä½œæˆæœ¬æ›´ä½ï¼Œæ›´èƒ½èŠ‚çœæ—¶é—´ã€‚\n\n>è·Ÿ jsdoc ç›¸æ¯”ï¼Œesdoc ä½¿ç”¨æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œä¸éœ€è¦ä¸¥æ ¼ä½¿ç”¨æ ‡ç­¾ï¼Œè€Œä¸”èƒ½å¤Ÿæ”¯æŒæœç´¢ï¼Œå¹¶ä¸”å®˜æ–¹èµ„æ–™æ›´ä¸ºé½å…¨ã€‚\n\nè‡³æ­¤ï¼Œä½¿ç”¨ qlc ç”Ÿæˆæ–‡æ¡£ï¼Œå·²ç»éå¸¸ç®€å•äº†ã€‚\n\nç¬¬äºŒã€ç¬¬ä¸‰ä¸ªé—®é¢˜å®é™…ä¸Šæ˜¯å…¬å…±å‡½æ•°åº“çš„ç»´æŠ¤é—®é¢˜ï¼Œqlc ä¹Ÿè®¾è®¡äº†å¯¹åº”çš„æµç¨‹ï¼Œç€åŠ›è§£å†³è¯¥é—®é¢˜ï¼š\n\n* é¦–å…ˆæœ‰ä¸€ä¸ªè¿œç¨‹å…¬å…±åº“ï¼ˆåŸºäº gitï¼‰ã€‚\n* å¯¹äºæŸä¸€ä¸ªé¡¹ç›®è€Œè¨€ï¼Œå¯ä»¥ä»è¿œç¨‹åº“ä¸­ä¸‹æ‹‰æ‰€éœ€è¦çš„å…¬å…±å‡½æ•°/ç±»ï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ã€‚\n* å¦‚æœæˆ‘ä»¬å¯¹æŸä¸€ä¸ªé¡¹ç›®å¢åŠ äº†ä¸€ä¸ªå…¬å…±å‡½æ•°å¹¶ä¸”è®¤ä¸ºå¯ä»¥ä¸ºæ›´å¤šçš„é¡¹ç›®æ‰€ç”¨ï¼Œå‘½ä»¤è¡Œä¸Šä¼ åˆ°è¿œç¨‹åº“è‡ªåŠ¨è§¦å‘ MRï¼Œç»´æŠ¤äººå‘˜ review é€šè¿‡åå³å¯ä¾›å…¶ä»–é¡¹ç›®ä½¿ç”¨ã€‚\n* ä¿®å¤æˆ–æ›´æ–°æŸä¸€ä¸ªå…¬å…±å‡½æ•°ä¹‹åï¼Œæˆ‘ä»¬åªéœ€åŒæ­¥åˆ°è¿œç¨‹åº“ï¼Œå…¶ä»–é¡¹ç›®ç»´æŠ¤äººå‘˜åœ¨å‘½ä»¤è¡Œå·¥å…·çš„è¾…åŠ©ä¸‹åŒæ­¥å³å¯ã€‚\n\n### æ›´å¤š\n\nåˆ°æ­¤ï¼Œä½ æ˜¯å¦è®¤ä¸º qlc ç»™ä½ å¸¦æ¥äº†ä¸€å®šçš„ä»·å€¼å‘¢ï¼Œå¯ä»¥åˆ° qlc çš„å®˜æ–¹ä»“åº“æŸ¥çœ‹æ›´å¤šçš„[æ–‡æ¡£ç»†èŠ‚](https://git.code.oa.com/qlc/qlc)\n\n\n\n\n\n","tags":["javascript"]},{"title":"å…¥é—¨WebAssemblyä»¥åŠä½¿ç”¨å…¶è¿›è¡Œå›¾åƒå·ç§¯å¤„ç†","url":"/2019/02/16/å…¥é—¨WebAssemblyä»¥åŠä½¿ç”¨å…¶è¿›è¡Œå›¾åƒå·ç§¯å¤„ç†/","content":"\n> WebAssembly å‡ºç°æœ‰å¾ˆé•¿æ—¶é—´äº†ï¼Œä½†æ˜¯ç”±äºæ—¥å¸¸å·¥ä½œå¹¶æ— ç›´æ¥æ¥è§¦ï¼Œå› æ­¤ä¸€ç›´ç–äºå°è¯•ï¼Œæœ€è¿‘ç»ˆäºåˆ©ç”¨ä¸€äº›ä¸šä½™æ—¶é—´ç®€å•å…¥é—¨äº†ä¸€ä¸‹ï¼Œå› æ­¤åœ¨æ­¤æ€»ç»“ã€‚\n\n### ç®€ä»‹\n\né¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ WebAssembly æ˜¯ä¸€ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Œå…¶å®é™…æ˜¯ä¸€ä¸ªå­—èŠ‚ç ç¼–ç æ–¹å¼ï¼Œæ¯”è¾ƒæ¥è¿‘æœºå™¨ç ï¼ˆä½†æ˜¯åˆæ— æ³•ç›´æ¥æ‰§è¡Œï¼‰ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿åœ°åšåˆ°è·¨å¹³å°åŒæ—¶çœå»åƒ JavaScript ç­‰è¯­è¨€çš„è§£é‡Šæ—¶é—´ï¼Œæ‰€ä»¥æ˜¯æœ‰ä¸€å®šä¼˜åŠ¿çš„ï¼Œä½¿ç”¨èµ·æ¥å…¶å®ä¹Ÿæ¯”è¾ƒçµæ´»ï¼Œå‡¡æ˜¯å¯ä»¥è½¬åŒ–æˆå­—èŠ‚ç çš„ï¼Œéƒ½æ˜¯å¯ä»¥ä½¿ç”¨ WebAssemblyã€‚\n\nä»¥ä¸‹ä»…åˆ—ä¸¾éƒ¨åˆ†å¯ä»¥æ”¯æŒ WebAssembly è½¬åŒ–çš„è¯­è¨€ï¼š\n\n* [AssemblyScript](https://github.com/AssemblyScript/assemblyscript): è¯­æ³•å’Œ TypeScript ä¸€è‡´(äº‹å®ä¸Šï¼Œå…¶æ˜¯ Typescript çš„ä¸€ä¸ªå­é›†)ï¼Œå¯¹å‰ç«¯æ¥è¯´å­¦ä¹ æˆæœ¬ä½ï¼Œä¸ºå‰ç«¯ç¼–å†™ WebAssembly æœ€ä½³é€‰æ‹©ï¼›\n* c\\c++: å®˜æ–¹æ¨èçš„æ–¹å¼ï¼Œè¯¦ç»†ä½¿ç”¨è§[æ–‡æ¡£](http://webassembly.org.cn/getting-started/developers-guide/);\n* [Rust](https://www.rust-lang.org/): è¯­æ³•å¤æ‚ã€å­¦ä¹ æˆæœ¬é«˜ï¼Œå¯¹å‰ç«¯æ¥è¯´å¯èƒ½ä¼šä¸é€‚åº”ã€‚è¯¦ç»†ä½¿ç”¨è§[æ–‡æ¡£](https://github.com/rust-lang-nursery/rust-wasm);\n* [Kotlin](http://kotlinlang.org/): è¯­æ³•å’Œ Javaã€JS ç›¸ä¼¼ï¼Œè¯­è¨€å­¦ä¹ æˆæœ¬ä½ï¼Œè¯¦ç»†ä½¿ç”¨è§[æ–‡æ¡£](https://kotlinlang.org/docs/reference/native-overview.html);\n* [Golang](https://golang.org/): è¯­æ³•ç®€å•å­¦ä¹ æˆæœ¬ä½ã€‚ä½†å¯¹ WebAssembly çš„æ”¯æŒè¿˜å¤„äºæœªæ­£å¼å‘å¸ƒé˜¶æ®µï¼Œè¯¦ç»†ä½¿ç”¨è§[æ–‡æ¡£](https://blog.gopheracademy.com/advent-2017/go-wasm/)ã€‚\n\nå°è¯•ä½¿ç”¨ WebAssembly å®˜æ–¹æ¨èçš„æ–¹å¼ï¼Œæˆ‘ä»¬é¦–å…ˆå¯ä»¥åœ¨[è¿™é‡Œ](http://webassembly.org.cn/getting-started/developers-guide/)æ¥ä¸‹è½½ã€‚\n\nå¦‚æœç”¨è…¾è®¯å†…ç½‘æœ‰çš„æ–‡ä»¶æ˜¯ä¸‹è½½ä¸ä¸‹æ¥çš„ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ç»™å‘½ä»¤è¡Œå¢åŠ ä¸€ä¸ªä»£ç†ï¼ˆå¦‚æœæˆ‘ä»¬ç”¨çš„ Fiddler æˆ– Charlesï¼Œå¼€å¯çš„æ—¶å€™é»˜è®¤å‘½ä»¤è¡Œä¹Ÿå¯ä»¥èµ°ä»£ç†ï¼Œå¦‚æœæ˜¯ Whistleï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è®¾ç½®ä»£ç†ï¼‰ï¼Œæœ‰äº›æ–‡ä»¶æˆ‘ä»¬è¿˜å¯ä»¥ä¸‹è½½å¥½ä¹‹åä½¿ç”¨æ–‡ä»¶ä»£ç†ã€‚\n\n```\nexport https_proxy=\"http://127.0.0.1:8899\"\nexport http_proxy=\"http://127.0.0.1:8899\"\n// æ–‡ä»¶ä»£ç†ï¼š\nhttps://s3.amazonaws.com/mozilla-games/emscripten/packages/node-v8.9.1-darwin-x64.tar.gz file:///Users/niexiaotao/node-v8.9.1-darwin-x64.tar.gz\n```\n\n## åˆä½“éªŒ\n\nè¿™é‡Œè€ƒè™‘åˆ°å‰ç«¯åŒå­¦çš„ä¸Šæ‰‹éš¾åº¦ï¼Œæˆ‘ä»¬å…ˆä½¿ç”¨ AssemblyScript å†™ä¸€ä¸ªæå°çš„ä¾‹å­ï¼Œä¸€ä¸ªæ–æ³¢é‚£å¥‘å‡½æ•°ï¼š\n\n```\nexport function f(x: i32): i32 {\n    if (x === 1 || x === 2) {\n        return 1;\n    }\n    return f(x - 1) + f(x - 2)\n}\n```\n\né€šè¿‡ç±»ä¼¼ `asc f.ts -o f.wasm` è¿™æ ·çš„å‘½ä»¤ç¼–è¯‘æˆ f.wasm ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥åˆ†åˆ«åœ¨ Node ç¯å¢ƒå’Œæµè§ˆå™¨ç¯å¢ƒæ¥æ‰§è¡Œï¼š\n\nNodeï¼š\n\n```\nconst fs = require(\"fs\");\nconst wasm = new WebAssembly.Module(\n    fs.readFileSync(__dirname + \"/f.wasm\"), {}\n);\nconst myModule = new WebAssembly.Instance(wasm).exports;\nconsole.log(myModule.f(12));\n```\n\næµè§ˆå™¨ï¼š\n\n```\nfetch('f.wasm') // ç½‘ç»œåŠ è½½ f.wasm æ–‡ä»¶\n        .then(res => res.arrayBuffer()) // è½¬æˆ ArrayBuffer\n        .then( buffer =>\n            WebAssembly.compile(buffer)\n        )\n        .then(module => { // è°ƒç”¨æ¨¡å—å®ä¾‹ä¸Šçš„ f å‡½æ•°è®¡ç®—\n            const instance = new WebAssembly.Instance(module);\n            const { f } = instance.exports;\n            console.log('instance:', instance.exports);\n            console.log('f(20):', f(20));\n        });\n```\n\näºæ˜¯ï¼Œæˆ‘ä»¬å®Œæˆäº† WebAssembly çš„åˆä½“éªŒã€‚\n\nå½“ç„¶ï¼Œè¿™ä¸ªä¾‹å­å¤ªç®€å•äº†ã€‚\n\n## ä½¿ç”¨ WebAssembly è¿›è¡Œå›¾åƒå·ç§¯å¤„ç†\n\nå®é™…ä¸Šï¼ŒWebAssembly çš„ç›®çš„åœ¨äºè§£å†³ä¸€äº›å¤æ‚çš„è®¡ç®—é—®é¢˜ï¼Œä¼˜åŒ– JavaScript çš„æ‰§è¡Œæ•ˆç‡ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ WebAssembly æ¥å¤„ç†ä¸€äº›å›¾åƒæˆ–è€…çŸ©é˜µçš„è®¡ç®—é—®é¢˜ã€‚\n\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡ WebAssembly æ¥å¤„ç†ä¸€äº›å›¾åƒçš„å·ç§¯é—®é¢˜ï¼Œç”¨äºå›¾åƒçš„é£æ ¼å˜æ¢ï¼Œæˆ‘ä»¬æœ€ç»ˆçš„ä¾‹å­å¯ä»¥åœ¨[è¿™é‡Œ](http://assembly.niexiaotao.com/)ä½“éªŒã€‚\n\næ¯æ¬¡è¿›è¡Œå·ç§¯å¤„ç†ï¼Œæˆ‘ä»¬çš„æ•´ä¸ªæµç¨‹æ˜¯è¿™æ ·çš„ï¼š\n\n* å°†åŸå›¾åƒä½¿ç”¨ canvas ç»˜åˆ¶åˆ°å±å¹•ä¸Šã€‚\n* ä½¿ç”¨ `getImageData` è·å–å›¾åƒåƒç´ å†…å®¹ï¼Œå¹¶è½¬åŒ–æˆç±»å‹æ•°ç»„ã€‚\n* å°†ä¸Šè¿°ç±»å‹æ•°ç»„é€šè¿‡å…±äº«å†…å­˜çš„æ–¹å¼ä¼ é€’ç»™ WebAssembly éƒ¨åˆ†ã€‚\n* WebAssembly éƒ¨åˆ†æ¥æ”¶åˆ°æ•°æ®ï¼Œè¿›è¡Œè®¡ç®—ï¼Œå¹¶ä¸”é€šè¿‡å…±äº«å†…å­˜çš„æ–¹å¼è¿”å›ã€‚\n* å°†æœ€ç»ˆç»“æœé€šè¿‡ canvas ç”»å¸ƒæ›´æ–°ã€‚\n\nä¸Šè¿°å„ä¸ªæ­¥éª¤ä¸­ï¼Œç»˜åˆ¶çš„éƒ¨åˆ†é›†ä¸­åœ¨ JavaScript ç«¯ï¼Œè€Œè®¡ç®—çš„éƒ¨åˆ†é›†ä¸­åœ¨ WebAssemblyï¼Œè¿™ä¸¤éƒ¨åˆ†ç›¸äº’æ¯”è¾ƒç‹¬ç«‹ï¼Œå¯ä»¥åˆ†å¼€ç¼–å†™ï¼Œè€ŒåŒç«¯æ•°æ®é€šä¿¡æ˜¯ä¸€ä¸ªæ¯”è¾ƒå€¼å¾—æ³¨æ„çš„åœ°æ–¹ï¼Œäº‹å®ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ArrayBuffer æ¥å®ç°åŒç«¯é€šä¿¡ï¼Œç®€å•çš„è¯´ï¼ŒJavaScript ç«¯å’Œ WebAssembly å¯ä»¥å…±äº«ä¸€éƒ¨åˆ†å†…å­˜ï¼Œå¹¶ä¸”éƒ½æ‹¥æœ‰è¯»å†™èƒ½åŠ›ï¼Œå½“ä¸€ç«¯å†™å…¥æ–°æ•°æ®ä¹‹åï¼Œå¦ä¸€æ®µä¹Ÿå¯ä»¥è¯»åˆ°ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œé€šä¿¡äº†ã€‚\n\nå…³äºæ•°æ®é€šä¿¡çš„é—®é¢˜ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒç›´ç™½çš„[ç§‘æ™®æ–‡ç« ](https://segmentfault.com/a/1190000010434237)ï¼Œå¯ä»¥å‚è€ƒã€‚\n\nåœ¨è¿™é‡Œæ²¡æœ‰å¿…è¦å¯¹æ•´ä¸ªé¡¹ç›®ä»£ç è¿›è¡Œå±•ç¤ºï¼Œå› æ­¤å¯ä»¥å‚è€ƒï¼ˆ[ä»£ç åœ°å€](https://github.com/aircloud/assemConvolution)ï¼‰ï¼Œæˆ‘ä»¬è¿™é‡Œä»…ä»…å¯¹éƒ¨åˆ†å…³é”®ä»£ç è¿›è¡Œè¯´æ˜ã€‚\n\n### å…±äº«å†…å­˜\n\né¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å£°æ˜ä¸€å—å…±äº«å†…å­˜ï¼Œè¿™å…¶å®å¯ä»¥ä½¿ç”¨ WebAssembly çš„ API æ¥å®Œæˆï¼š\n\n```\nlet memory = new WebAssembly.Memory({ initial: ((memSize + 0xffff) & ~0xffff) >>> 16 });\n```\n\nè¿™é‡Œç»è¿‡è¿™æ ·çš„æ¯”è¾ƒå¤æ‚çš„è®¡ç®—æ˜¯å› ä¸º initial ä¼ å…¥çš„æ˜¯ä»¥ page ä¸ºå•ä½ï¼Œè¯¦ç»†å¯ä»¥å‚è€ƒ[è¿™é‡Œ](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly/Memory)ï¼Œå®é™…ä¸Š memSize å³æˆ‘ä»¬å…±äº«å†…å­˜çš„å­—èŠ‚æ•°ã€‚\n\nç„¶åè¿™é‡Œæ¶‰åŠåˆ° memSize çš„è®¡ç®—ï¼Œæˆ‘ä»¬ä¸»è¦éœ€è¦å­˜å‚¨ä¸‰å—æ•°æ®ï¼šå·ç§¯å‰çš„æ•°æ®ã€å·ç§¯åçš„æ•°æ®ï¼ˆç”±äºå·ç§¯ç®—æ³•çš„ç‰¹æ®Šæ€§ä»¥åŠä¸ºäº†é¿å…æ›´å¤šéº»çƒ¦ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸è¿›è¡Œæ•°æ®å…±ç”¨ï¼‰ï¼Œè¿˜æœ‰å·ç§¯æ ¸ä½œä¸ºå‚æ•°éœ€è¦ä¼ é€’ã€‚\n\nè¿™é‡Œæˆ‘ä»¬å…±äº«å†…å­˜æ‰€ä¼ é€’çš„æ•°æ®æŒ‰ç…§å¦‚ä¸‹çš„è§„åˆ™è¿›è¡Œè®¾è®¡ï¼š\n\n![](http://niexiaotao.cn/img/ker1.jpg)\n\nä¼ é€’ç»™ WebAssembly ç«¯çš„æ–¹å¼å¹¶ä¸å¤æ‚ï¼Œç›´æ¥åœ¨ `WebAssembly.instantiate` ä¸­å£°æ˜å³å¯ã€‚ \n\n```\nfetch(wasmPath)\n     .then(response => response.arrayBuffer())\n     .then(buffer => WebAssembly.instantiate(buffer, {\n         env: {\n             memory,\n             abort: function() {}\n         },\n         Math\n     })).then(module => {})\n                \n```\n\nç„¶åæˆ‘ä»¬åœ¨ AssemblyScript ä¸­å°±å¯ä»¥è¿›è¡Œè¯»å†™äº†ï¼š\n\n```\n//å†™ï¼š\nstore<u32>(position, v) // position ä¸ºä½ç½®\n\n//è¯»ï¼š\nload<u32>(position) // position ä¸ºä½ç½®\n```\n\nè€Œåœ¨ JavaScript ç«¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `memory.buffer` æ‹¿åˆ°æ•°æ®ï¼Œå¹¶ä¸”è½¬åŒ–æˆç±»å‹æ•°ç»„ï¼š\n\n```\nlet mem = new Uint32Array(memory.buffer)\n//é€šè¿‡ mem.set(data) å¯ä»¥åœ¨ JavaScript ç«¯è¿›è¡Œå†™å…¥æ“ä½œ\n```\n\nè¿™æ ·ï¼Œæˆ‘ä»¬åœ¨ JavaScript ç«¯å’Œ AssemblyScript ç«¯çš„è¯»å†™éƒ½æ˜æ™°äº†ã€‚\n\nè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ**JSç«¯é‡‡ç”¨çš„æ˜¯å¤§ç«¯æ•°æ®æ ¼å¼ï¼Œè€Œ AssemblyScript ä¸­é‡‡ç”¨çš„æ˜¯å°ç«¯ï¼Œå› æ­¤å…¶é¢œè‰²æ•°æ®æ ¼å¼ä¸º AGBR**\n\n### å·ç§¯è®¡ç®—\n\næˆ‘ä»¬æ‰€é‡‡ç”¨çš„å·ç§¯è®¡ç®—æœ¬èº«ç®—æ³•æ¯”è¾ƒç®€å•ï¼Œå¹¶ä¸”ä¸æ˜¯æœ¬æ¬¡çš„é‡ç‚¹ï¼Œä½†æ˜¯è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼š\n\n* æˆ‘ä»¬æ— æ³•ç›´æ¥åœ¨ AssemblyScript ä¸­å£°æ˜æ•°ç»„å¹¶ä½¿ç”¨ï¼Œå› æ­¤é™¤äº† Kernel é€šè¿‡å…±äº«å†…å­˜çš„æ–¹å¼ä¼ é€’è¿‡æ¥ä»¥å¤–ï¼Œæˆ‘ä»¬åº”å½“å°½é‡é¿å…å£°æ˜æ•°ç»„ä½¿ç”¨ï¼ˆè™½ç„¶ä¹Ÿæœ‰ä½¿ç”¨éå…±äº«å†…å­˜æ•°ç»„çš„ç›¸å…³æ“ä½œï¼Œä½†æ˜¯ä½¿ç”¨èµ·æ¥æ¯”è¾ƒç¹çï¼‰\n* å·ç§¯åº”å½“å¯¹ Rã€Gã€B ä¸‰å±‚å•ç‹¬è¿›è¡Œï¼Œæˆ‘è¿™é‡Œ A å±‚ä¸å‚ä¸å·ç§¯ã€‚\n\nä»¥ä¸Šéƒ½åœ¨ä»£ç ä¸­æœ‰æ‰€ä½“ç°ï¼Œå‚è€ƒç›¸å…³ä»£ç ä¾¿å¯æ˜äº†ã€‚\n\nå·ç§¯å®Œæˆåï¼Œæˆ‘ä»¬é€šè¿‡å…±äº«å†…å­˜çš„æ–¹æ³•å†™å…¥ç±»å‹æ•°ç»„ï¼Œç„¶ååœ¨ JavaScript ç«¯åˆæˆæ•°æ®ï¼Œè°ƒç”¨ `putImageData` ä¸Šå±å³å¯ã€‚\n\n### å…¶ä»–\n\nå½“ç„¶ï¼Œæœ¬æ¬¡å›¾åƒå·ç§¯ç¨‹åºä»…ä»…æ˜¯å¯¹ Webassembly å’Œ AssemblyScript çš„åˆæ­¥å°è¯•ï¼Œç¬”è€…ä¹Ÿåœ¨å­¦ä¹ é˜¶æ®µï¼Œå¦‚æœä¸Šè¿°è¯´æ³•æœ‰é—®é¢˜æˆ–è€…ä½ æƒ³å’Œæˆ‘äº¤æµï¼Œä¹Ÿæ¬¢è¿ç•™è¨€æˆ–è€…æç›¸å…³ issueã€‚\n","tags":["WebAssembly"]},{"title":"webè·¨ç«¯èåˆæ–¹æ¡ˆæµ…æ","url":"/2018/12/04/webè·¨ç«¯èåˆæ–¹æ¡ˆæµ…æ/","content":"\næœ¬æ–‡ä¼šå¯¹ç›®å‰æµè¡Œçš„åŸºäº JavaScript çš„ web è·¨ç«¯èåˆæ–¹æ¡ˆè¿›è¡Œæ€»ç»“å’Œåˆ†æï¼Œç›®æ ‡äººç¾¤ä¸º web æ–¹å‘çš„ä»ä¸šè€…ä½†æ˜¯å¯¹è·¨ç«¯èåˆæ–¹æ¡ˆäº†è§£ä¸å¤šçš„äººã€‚\n\n### web è·¨ç«¯èåˆç®€ä»‹\n\nåœ¨ 2015 å¹´ React Native å‘å¸ƒä¹‹å‰ï¼Œweb åœ¨ç§»åŠ¨ç«¯ APP ä¸Šä¸»è¦é€šè¿‡ WebView è¿›è¡Œæ‰¿è½½ï¼Œå…¶æœ‰è®¸å¤šä¼˜ç‚¹ï¼Œå¯ä»¥å¿«é€Ÿè¿­ä»£å‘å¸ƒï¼Œä¸ç‰¹åˆ«å— APP ç‰ˆæœ¬çš„å½±å“ï¼Œå› æ­¤ï¼Œä¸€äº›å¿«é€Ÿå‘å±•çš„ä¸šåŠ¡ï¼ˆåŒ…æ‹¬å‰æœŸçš„æ‰‹æœºQQã€æ‰‹æœºæ·˜å®ï¼‰å¤§é‡é‡‡ç”¨äº† WebView å†…åµŒ H5 é¡µé¢çš„å½¢å¼æ¥æ¨åŠ¨ä¸šåŠ¡ã€‚\n\nä½†æ˜¯è¿™ç§æ–¹å¼ç¼ºç‚¹ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼Œä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹ä¸¤ç‚¹ï¼š\n\n* åŠ è½½æ—¶é—´è¾ƒé•¿ï¼ŒåŒ…æ‹¬ WebView åˆå§‹åŒ–çš„æ—¶é—´ã€ç½‘ç»œè¯·æ±‚çš„æ—¶é—´ã€‚\n* HTML é¡µé¢åœ¨æ€§èƒ½ä¸Šå¤©ç„¶ä¸å¦‚ Native é¡µé¢ï¼Œæ— è®ºæ€ä¹ˆè¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€‚\n\nåœ¨ 2015 å¹´ï¼ŒFacebook æ¨å‡ºäº† React Nativeï¼Œä»è€Œæ‰“å¼€äº† web è·¨ç«¯èåˆçš„å¤§é—¨ï¼Œåç»­åœ¨æ­¤æ¶æ„åŸºç¡€ä¸Šåˆå‡ºç°äº†é˜¿é‡Œå·´å·´çš„ Weexï¼ˆ2016ï¼‰ã€è…¾è®¯çš„å°ç¨‹åºï¼ˆå°ç¨‹åºå®é™…ä¸Šæ›´å web ä¸€ç‚¹ï¼Œå’Œå…¶ä»–å‡ ç±»ç¨æœ‰ä¸åŒï¼Œæœ¬æ–‡ä¸ä½œä»‹ç»ï¼‰ã€ Hippyï¼ˆ2018ï¼‰ã€Taroï¼ˆTaro å…¶å®æ›´åå‘è§£é‡Šç¿»è¯‘ï¼Œå’Œå…¶ä»–å‡ ç±»å®šä½ä¸åŒï¼‰ç­‰è·¨ç«¯èåˆè§£å†³æ–¹æ¡ˆï¼Œå¹¶ä¸”æ¸æ¸è¢«ç”¨åˆ°è¶Šæ¥è¶Šå¤šçš„é¡¹ç›®ä¸­ï¼Œç›®å‰ï¼Œè·¨ç«¯èåˆå¼€å‘å·²ç»æ˜¯ä¸€ç§æ¯”è¾ƒä¸»æµçš„ web å¼€å‘æ¨¡å¼ï¼Œåœ¨é˜¿é‡Œç³»åº”ç”¨ã€è…¾è®¯çš„å¾®ä¿¡ã€QQæµè§ˆå™¨ã€æ‰‹æœºQQå‡å·²ç»è¿›è¡Œäº†å¤§è§„æ¨¡åº”ç”¨ã€‚\n\n### åŸºæœ¬æ¶æ„\n\nè™½ç„¶ web è·¨ç«¯èåˆæ–¹æ¡ˆä¼—å¤šï¼Œé™¤äº†ä¸Šè¿°æåˆ°çš„ä¸‰ç§ï¼Œè¿˜æœ‰å„ä¸ªå…¬å¸çš„æ›´å¤šæ–¹æ¡ˆï¼Œä½†æ˜¯ä¸€èˆ¬æ¥è¯´è·¨ç«¯èåˆçš„æŠ€æœ¯æ¶æ„éƒ½æ¯”è¾ƒç›¸è¿‘ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢è¿™ä¸€ä¸ªå›¾æ¥ç®€å•æ¦‚æ‹¬ï¼š\n\n![](/img/1.jpg)\n\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€ä¸ªè¿›è¡Œç®€æï¼š\n\n* ä¸šåŠ¡ä»£ç ï¼šå³æˆ‘ä»¬å†™çš„ React Native ä»£ç ã€Weex ä»£ç ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡ä»£ç éœ€è¦ç»è¿‡æ¡†æ¶å·¥å…·æˆ–è€…æ‰“åŒ…å·¥å…·ï¼ˆä¾‹å¦‚ webpack é…åˆ loaderï¼‰è¿›è¡Œæ‰“åŒ…ï¼Œä»è€Œå…¼å®¹ä¸€äº› ES Next çš„å†™æ³•ä»¥åŠä¸€äº›æ¡†æ¶æœ¬èº«ä¸æ”¯æŒçš„ Web å†™æ³•ã€‚\n* Javascript FrameWorkï¼šè¿™éƒ¨åˆ†ä¸»è¦æ˜¯é’ˆå¯¹ Weexã€Hippy æ¥è®²çš„ï¼ŒWeex å£°ç§°æ”¯æŒ Vueã€Rax è¯­æ³•ï¼Œè€Œ Hippy å£°ç§°æ”¯æŒ Reactã€Vue å†™æ³•ï¼Œå®é™…ä¸Šï¼Œå¯¹äºè¿™äº›åº“è€Œè¨€ï¼Œå¹¶ä¸æ˜¯ç›´æ¥å°† Reactã€Vue å¼•å…¥åˆ°é¡¹ç›®ä¸­ï¼Œè€Œæ˜¯ä¼šå¯¹å…¶æºä»£ç è¿›è¡Œä¿®æ”¹ï¼ˆVue æœ‰é’ˆå¯¹ Weex å¹³å°çš„[ç‰ˆæœ¬](https://github.com/vuejs/vue/tree/dev/src/platforms)ï¼‰ï¼Œè€Œ Hippy ä¹Ÿæ˜¯å¯¹ React æºä»£ç è¿›è¡Œäº†ä¿®æ”¹ï¼Œä¾‹å¦‚ï¼Œä½ å†™çš„ä¸€ä¸ª` createElement `çš„æ“ä½œï¼Œåœ¨ Web å¹³å°ä¸­å®é™…è°ƒç”¨çš„æ˜¯ `document.createElement(tagName) `è¿™ä¸ªæ¥å£ï¼›è€Œåœ¨ Weex å¹³å°ä¸­å®é™…æ‰§è¡Œçš„æ˜¯` new renderer.Element(tagName)`ï¼ˆrenderer ç”± Javascript Runtime æä¾›ï¼Œå¹¶ä¸”æœ€ç»ˆå’Œ Native é€šä¿¡æ¸²æŸ“ä¸Šå±ï¼‰ã€‚\n* Javascript Runtimeï¼šRuntime çš„éƒ¨åˆ†ï¼Œä¸»è¦æ˜¯å¯¹å¤–æš´éœ²äº†ä¸€äº›ç»Ÿä¸€çš„æ¥å£ï¼Œæ¯”å¦‚è¯´èŠ‚ç‚¹çš„å¢åˆ æ”¹æŸ¥ã€ç½‘ç»œè¯·æ±‚çš„æ¥å£ç­‰ï¼Œè€Œè¿™äº›å€Ÿå£ï¼Œå®é™…ä¸Šæ˜¯å…¶â€œä»£ç†â€çš„å®¢æˆ·ç«¯çš„èƒ½åŠ›ï¼Œé€šè¿‡å®¢æˆ·ç«¯ JSAPI çš„æ–¹å¼è¿›è¡Œè°ƒç”¨ã€‚å¦å¤–ï¼ŒæŠŠ Runtime å’Œ FrameWork è¿›è¡ŒæŠ½ç¦»ï¼Œä¹Ÿå¯ä»¥ä¾¿äºä¸€ä¸ªè·¨ç«¯æ–¹æ¡ˆé€‚é…å¤šä¸ªæ¡†æ¶ï¼Œåªéœ€è¦å°†ä¸åŒçš„ FrameWork å’Œæµè§ˆå™¨äº¤äº’çš„éƒ¨åˆ†ä»£ç è½¬æ¢æˆ Runtime æä¾›çš„æ ‡å‡†æ¥å£ï¼Œå°±å¯ä»¥å®ç°å¯¹ä¸åŒæ¡†æ¶çš„æ”¯æŒã€‚\n* Coreï¼šè¿™éƒ¨åˆ†ä¸»è¦æ˜¯å¯¹ Javascript çš„è§£é‡Šæ‰§è¡Œï¼Œåœ¨ iOS ä¸Šä¸€èˆ¬æ˜¯ JSCoreï¼ˆç³»ç»Ÿè‡ªå¸¦ï¼Œç»™å®¢æˆ·ç«¯æä¾›äº†æ‰§è¡Œ JavaScript ç¨‹åºçš„èƒ½åŠ›ï¼‰ï¼Œè€Œå®‰å“ä¸Šåˆ™å¯ä»¥é‡‡ç”¨ V8ã€X5 ç­‰ã€‚\n* æœ€ä¸‹å±‚åˆ™æ˜¯åˆ† Android å’Œ iOS ç«¯å»è¿›è¡Œæ¸²æŸ“ã€‚\n\n### å‘å±•ç°çŠ¶\n\nå®é™…ä¸Šï¼ŒReact Native æœ€åˆæå‡ºè¿™ç§è§£å†³æ–¹æ¡ˆçš„æ—¶å€™ï¼Œå¸‚é¢ä¸Šå¹¶æ²¡æœ‰åŒç±»çš„äº§å“ï¼Œä½†æ˜¯ç”±äº React Native çš„ä¸€äº›é—®é¢˜å’Œå…¶ä»–åŸå› ï¼Œå„ä¸ªå¤§å…¬å¸åŸºæœ¬éƒ½åœ¨å®ç°è‡ªå·±çš„è·¨ç«¯èåˆæ–¹æ¡ˆï¼Œè¿™é‡Œ React Native çš„é—®é¢˜ä¸»è¦ä½“ç°åœ¨ï¼š\n\n* æœ€ä¸»è¦çš„æ˜¯åè®®é£é™©ã€‚\n* React Native æ‰“åŒ…å‡ºæ¥çš„ JSBundle è¾ƒå¤§ï¼Œå¹¶ä¸”é»˜è®¤æ²¡æœ‰çµæ´»çš„åˆ†åŒ…æœºåˆ¶ï¼Œéœ€è¦è‡ªè¡Œè§£å†³ç›¸å…³é—®é¢˜ã€‚\n* åœ¨éƒ¨åˆ†ç»„ä»¶æ¯”å¦‚ List ç»„ä»¶ä¸­ï¼Œæ€§èƒ½è¾ƒå·®ï¼ˆæ®éå®˜æ–¹è¯´æ³•ï¼Œæ€§èƒ½å¹¶ä¸æ˜¯ React Native å›¢é˜Ÿé¦–è¦è€ƒå¯Ÿå› ç´ ï¼Œä½†æ˜¯å›½å†…å›¢é˜Ÿä¸€èˆ¬éƒ½æ¯”è¾ƒé‡è§†æ€§èƒ½ï¼‰ã€‚\n* éƒ¨åˆ†äº‹ä»¶å‘é€é¢‘ç¹å¯¼è‡´æ€§èƒ½æŸå¤±ã€ä¾‹å¦‚åˆ—è¡¨æ»šåŠ¨äº‹ä»¶ã€æ‰‹åŠ¿äº‹ä»¶ç­‰ã€‚\n* åŒç«¯ API å¤§é‡æ²¡æœ‰å¯¹é½ï¼ˆè¿™ä¹Ÿå’Œå…¶ slogan æ˜¯â€˜learn once, write everywhereâ€™ è€Œä¸æ˜¯ â€˜write once, run everywhereâ€™ ç›¸å¯¹åº”ï¼‰ã€‚\n\nè€Œå¯¹äºå›½å†…çš„ Weex å’Œ Hippy æ¡†æ¶ï¼Œå…¶éƒ½åšäº†å¤§é‡çš„æ€§èƒ½ä¼˜åŒ–è§£å†³äº†ä¸Šè¿°é—®é¢˜ï¼Œå¹¶ä¸”è§„é¿äº†åè®®é£é™©ï¼ˆWeex é‡‡ç”¨äº† Apache 2.0 åè®®ï¼Œè€Œ Hippy å³å°†å¼€æºï¼‰ã€‚\n\nå¦å¤–å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒWeex å’Œ Hippy éƒ½å¯ä»¥åœ¨ web ç«¯è¿›è¡Œè¿è¡Œï¼Œä¸€èˆ¬å¯ä»¥ä½œä¸ºé™çº§æ–¹æ¡ˆä½¿ç”¨ï¼Œä»è€ŒçœŸæ­£åšåˆ°äº†â€œä¸€ä»½ä»£ç â€ï¼Œä¸‰ç«¯è¿è¡Œã€‚\n\n### æ€§èƒ½ä¼˜åŒ–\n\nå®é™…ä¸Šï¼Œé‡‡ç”¨ç›®å‰çš„è·¨ç«¯èåˆæ–¹æ¡ˆçš„ä½“éªŒå·²ç»æ¯”é‡‡ç”¨ WebView çš„æ–¹æ¡ˆå¼ºå¤ªå¤šäº†ï¼Œä½†æ˜¯æ€§èƒ½ä¼˜åŒ–æ˜¯æ²¡æœ‰æ­¢å¢ƒçš„ï¼Œéšç€é¡µé¢å¤æ‚åº¦çš„æé«˜ä»¥åŠç”¨æˆ·ä½“éªŒçš„è¦æ±‚ï¼Œå®é™…ä¸Šç›®å‰è¿™ç±»è·¨ç«¯èåˆæ–¹æ¡ˆé‡‡ç”¨äº†ä»¥ä¸‹å‡ ä¸ªæ–¹å‘çš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼š\n\n#### å‡å°‘ç½‘ç»œè¯·æ±‚\n\nåœ¨æˆ‘ä»¬ä¸Šè¿°æä¾›çš„æ¶æ„å›¾ä¸­ï¼Œä¸€èˆ¬è€Œè¨€å¯¹äºä¸€ä¸ªè¿™ç±»é¡µé¢ï¼Œä¸šåŠ¡ä»£ç æ˜¯é€šè¿‡ç½‘ç»œè¯·æ±‚åŠ è½½çš„ï¼Œè¿™ä¸ªæ—¶å€™åœ¨åŠ è½½ä¸Šä¸»è¦çœå»çš„æ˜¯ WebView çš„åˆå§‹åŒ–æ—¶é—´ï¼Œè¿™å…¶å®æ˜¯ä¸å¤Ÿçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥é‡‡ç”¨å°†ä¸šåŠ¡ä»£ç æå‰ä¸‹å‘å¹¶å­˜åœ¨ç”¨æˆ·æœ¬åœ°ï¼Œæ‰“å¼€çš„æ—¶å€™åªéœ€è¦ä»æœ¬åœ°æ‹‰å–å¹¶æ‰§è¡Œä»£ç ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ç›¸å…³çš„ç½‘ç»œè¯·æ±‚é˜»å¡ï¼Œä¼˜åŒ–åŠ è½½æ—¶é—´ã€‚\n\nå¦å¤–ï¼Œå‡å°‘ç½‘ç»œè¯·æ±‚è¿˜ä½“ç°åœ¨å¯¹èµ„æºçš„ç¼“å­˜ä¸Šï¼Œå¯¹ä¸€ä¸ªé¡µé¢ä¸­æ‰€é‡‡ç”¨çš„å›¾ç‰‡ç­‰èµ„æºæ–‡ä»¶è¿›è¡Œ LRU ç­–ç•¥çš„ç¼“å­˜ï¼Œä»è€Œé˜²æ­¢é‡å¤çš„è¯·æ±‚ï¼ˆåœ¨ä¼ ç»Ÿçš„ WebView çš„æ–¹æ¡ˆä¸Šï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨å¯¹ WebView å¢åŠ  Hook çš„æ–¹å¼å®ç°ï¼‰ã€‚\n\nå½“ç„¶ï¼Œä»¥ä¸Šä¸¤ç‚¹åœ¨ WebView çš„æ–¹æ¡ˆä¸Šä¹Ÿå¯ä»¥é‡‡ç”¨ã€‚\n\n#### é™ä½é€šä¿¡æˆæœ¬\n\næˆ‘ä»¬ä»ä¸Šæ–‡çš„æ¶æ„å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œçš„å±‚çº§å®é™…ä¸Šæ¯”è¾ƒå¤šï¼Œå¦‚æœä¸åŒå±‚çº§çš„é€šä¿¡æ•°æ®è¾ƒå¤šï¼Œå¹¶ä¸”æœ‰æ¯”è¾ƒé¢‘ç¹ç”šè‡³é‡å¤çš„ç¼–è§£ç æ“ä½œï¼Œè‚¯å®šä¼šæœ‰å¾ˆå¤§çš„å¼€é”€ï¼Œä»è€Œå½±å“æ€§èƒ½ï¼Œæ‰€ä»¥ï¼Œåœ¨ä¸åŒå±‚çº§ä¹‹é—´åšå¥½æ•°æ®çš„ä¼ é€’ï¼Œå¹¶ä¸”é˜²æ­¢é‡å¤çš„ç¼–è§£ç æ“ä½œæ˜¯æ¯”è¾ƒé‡è¦çš„ã€‚\n\nè¿™é‡Œå¯ä»¥ä¼˜åŒ–çš„ç»†èŠ‚å…¶å®æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬ä¸¾ä¸€ä¸ª Hippy çš„ä¾‹å­ï¼š\n\nåœ¨ Hippy æ¶æ„ä¸­ï¼ŒjsRuntime ä¼šç”Ÿæˆä¸€ä¸ª jsObject å¯¹è±¡æ ‘ï¼ˆå³éœ€è¦æ¸²æŸ“çš„ DOM ä¿¡æ¯ï¼‰ï¼Œå…¶åœ¨ç»è¿‡ JSBridge æ—¶éœ€è¦é€šè¿‡`JSON.stringify` è¿›è¡Œåºåˆ—åŒ–ï¼Œè€Œåœ¨ Javaï¼ˆandriod) æ¥æ”¶ç«¯ï¼Œåˆ™éœ€è¦å…ˆå°†å…¶å˜æˆä¸€ä¸ª JsonObjectï¼Œæœ€ç»ˆè½¬åŒ–æˆ HippyMapï¼Œè¿™é‡Œå®é™…ä¸Šæ˜¯æœ‰é‡å¤çš„ç¼–è§£ç æ“ä½œçš„ï¼Œæˆ‘ä»¬çœ‹çœ‹ Hippy çš„ä¼˜åŒ–ç­–ç•¥ï¼š\n\n![](/img/3.jpg)\n\n>å›¾ç‰‡æ¥è‡ª IMWeb 2018\n\né€šè¿‡ hippybuffer çš„æ–¹å¼å‡å°‘é€šä¿¡çš„æ•°æ®é‡ï¼Œå¹¶ä¸”é˜²æ­¢é‡å¤çš„ç¼–è§£ç æ“ä½œï¼Œå¯ä»¥æœ‰æ•ˆæé«˜æ€§èƒ½ã€‚\n\n#### å‡å°‘é€šä¿¡æ¬¡æ•°\n\nä¸ºäº†å‡å°‘åœ¨é€šä¿¡æ–¹é¢çš„æ¶ˆè€—ï¼Œæˆ‘ä»¬é™¤äº†é™ä½é€šä¿¡çš„æˆæœ¬ï¼Œè¿˜å¯ä»¥åšçš„å°±æ˜¯å‡å°‘é€šä¿¡æ¬¡æ•°ï¼Œå½“ç„¶ï¼Œå‰ææ˜¯ä¸å½±å“ç”¨æˆ·ä½“éªŒã€‚\n\nè¿™æ–¹é¢å¯ä»¥å‡å°‘çš„é€šä¿¡æ¶ˆè€—ï¼Œå…¶ä¸­ä¸€ä¸ªæ–¹é¢æ˜¯é¢‘ç¹çš„äº‹ä»¶é€šä¿¡ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œäº‹ä»¶çš„è§¦å‘æ˜¯åœ¨ native ç«¯çš„ï¼Œä½†æ˜¯äº‹ä»¶å¤„ç†çš„é€»è¾‘ä»£ç å®é™…ä¸Šæ˜¯åœ¨ js å±‚æ¥å®Œæˆçš„ï¼Œåœ¨è¿™æ–¹é¢çš„é€šä¿¡ï¼ŒReact Native å°±å› ä¸ºé¢‘ç¹çš„é€šä¿¡ä»è€Œå½±å“äº†æ€§èƒ½ã€‚\n\næˆ‘ä»¬å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹åœ¨äºï¼Œé¦–å…ˆå‡å°‘æ²¡æœ‰ç»‘å®šå›è°ƒå‡½æ•°çš„äº‹ä»¶é€šä¿¡ï¼Œä¸€èˆ¬è€Œè¨€è¿™éƒ¨åˆ†é€šä¿¡æ˜¯ä¸å¿…è¦çš„ï¼Œå…¶æ¬¡æ˜¯å¤šæ¬¡é€šä¿¡å¯ä»¥è¿›è¡Œåˆå¹¶ï¼Œæ¯”å¦‚è¯´ list æ»šåŠ¨å›è°ƒå‡½æ•°ã€ä»¥åŠåŠ¨ç”»é€šä¿¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®é©±åŠ¨ä»£æ›¿æ•°æ®é©±åŠ¨çš„æ–¹å¼ï¼ˆå³ä¸€æ¬¡å‘å®¢æˆ·ç«¯ä¼ é€’æ•´ä¸ªé…ç½®ï¼Œåç»­ç›¸åŒäº‹ä»¶å¯ä»¥ç›´æ¥åœ¨å®¢æˆ·ç«¯è¿›è¡Œå¤„ç†ï¼‰ï¼Œæ¥å‡å°‘é€šä¿¡æ¬¡æ•°ã€‚\n\nè¿™æ–¹é¢ Hippy å’Œ Weex éƒ½æœ‰å¤§é‡ç»†ç¢çš„å®è·µï¼Œåœ¨æ­¤ä¾¿ä¸å…·ä½“ä»‹ç»äº†ã€‚\n\n#### é™ä½é¦–å±æ—¶é—´\n\nåœ¨åŸæ¥çš„ WebView é¡µé¢ä¸­ï¼Œæˆ‘ä»¬ä¸ºäº†å¢å¼ºç”¨æˆ·ä½“éªŒï¼Œé˜²æ­¢ç”¨æˆ·è¿›æ¥ä¹‹åçœ‹åˆ°ç™½å±ï¼Œå¯ä»¥é‡‡ç”¨æœåŠ¡ç«¯æ¸²æŸ“çš„æ–¹å¼ï¼Œå°†æ¸²æŸ“å¥½çš„é¡µé¢è¿”å›ç»™å®¢æˆ·ç«¯ï¼ŒåŒæ—¶ä¼˜åŒ–äº†é¦–å±è¯·æ±‚ï¼Œä¹Ÿé˜²æ­¢äº†å®¢æˆ·ç«¯è®¾å¤‡è¾ƒå·®é€ æˆJSæ‰§è¡Œæ—¶é—´è¾ƒé•¿çš„æƒ…å†µã€‚\n\nåœ¨è·¨ç«¯èåˆæ–¹æ¡ˆä¸­æˆ‘ä»¬ä»ç„¶æœ‰ç±»ä¼¼çš„è§£å†³æ–¹æ¡ˆï¼Œåœ¨ä¸è€ƒè™‘ç¦»çº¿åŒ…çš„æƒ…å†µä¸‹ï¼ˆå³åªè€ƒè™‘ä¸šåŠ¡ä»£ç ä»è¿œç¨‹åŠ è½½çš„æƒ…å†µï¼‰ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”±æœåŠ¡ç«¯æ¸²æŸ“å¥½å†è¿”å›ï¼ŒWeex ä¾¿é‡‡ç”¨äº†ç±»ä¼¼çš„æ–¹æ¡ˆï¼Œä¸è¿‡å…¶åšçš„æ›´åŠ å½»åº•ï¼Œåœ¨æœåŠ¡ç«¯å°†ä»£ç ç»“æœç¼–è¯‘æˆ AST æ ‘å¹¶è½¬åŒ–æˆå­—èŠ‚ç ï¼ˆOPcodeï¼‰ï¼Œåœ¨å®¢æˆ·ç«¯è§£æåç›´æ¥ç”Ÿæˆè™šæ‹Ÿ DOMï¼š\n\n![](/img/2.jpg)\n\n>å›¾ç‰‡æ¥è‡ª IMWeb 2018\n\n#### å®¢æˆ·ç«¯çº§åˆ«çš„å…¶ä»–ä¼˜åŒ–\n\nå®¢æˆ·ç«¯çš„ä¼˜åŒ–æœ‰ä¸€éƒ¨åˆ†æ˜¯æœ¬æ¥å®¢æˆ·ç«¯å¼€å‘å°±ä¼šé¢ä¸´çš„å†…å®¹ï¼Œä¹Ÿæœ‰ä¸€éƒ¨åˆ†æ˜¯å’Œæ··åˆæ–¹æ¡ˆæœ‰å…³çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚ Flex Render çš„ä¼˜åŒ–ï¼Œä¸è¿‡è¿™æ–¹é¢çš„å†…å®¹ä¸€èˆ¬è€Œè¨€å’Œå‰ç«¯å…³ç³»ä¸æ˜¯éå¸¸å¯†åˆ‡ï¼Œç¬”è€…ä½œä¸ºåˆçº§å‰ç«¯å·¥ç¨‹å¸ˆï¼Œå¯¹è¿™æ–¹é¢çš„å†…å®¹è¿˜å¹¶ä¸ç†Ÿæ‚‰ã€‚\n\n### æ¡†æ¶é€‰å‹\n\næœ¬æ–‡çš„æœ€åä¸€éƒ¨åˆ†ï¼Œä»‹ç»æ¡†æ¶é€‰å‹ã€‚\n\nå¯¹äºå„ç±»è·¨ç«¯èåˆçš„æ–¹æ¡ˆï¼Œå…¶ç›¸å¯¹äº WebView éƒ½æœ‰éå¸¸å¤§çš„æ€§èƒ½æå‡ï¼Œå› æ­¤åœ¨å‰æœŸï¼Œæ— è®ºé€‰æ‹©ä»€ä¹ˆæ¡†æ¶éƒ½èƒ½å¤Ÿçœ‹åˆ°æˆæ•ˆï¼Œè¿™é‡Œä¹Ÿå¹¶ä¸è¿›è¡Œç‰¹å®šçš„æ¡†æ¶é€‰å‹æ¨èï¼Œä½†æ˜¯ä¸€èˆ¬è®¤ä¸ºï¼Œå¦‚æœæ˜¯ä» Vue çš„é¡¹ç›®åˆ‡æ¢ï¼ŒWeex ä¼šæ›´åˆé€‚ä¸€ç‚¹ï¼Œè€Œå¦‚æœä» React é¡¹ç›®åˆ‡æ¢ï¼Œåœ¨ç¡®ä¿æ²¡æœ‰è¯ä¹¦é£é™©çš„æƒ…å†µä¸‹å¯ä»¥é‡‡ç”¨ React Nativeï¼Œå¦åˆ™å¯ä»¥å°è¯•åŸç”Ÿæ”¯æŒ React çš„ Hippyã€‚\n\nä»¥ä¸Šã€‚\n\n\n","tags":["è·¨ç«¯èåˆ"]},{"title":"Node.js çš„ TCP é“¾æ¥ç®¡ç†","url":"/2018/11/25/Node-jsçš„TCPé“¾æ¥ç®¡ç†/","content":"\nåœ¨ Node.js çš„å¾®æœåŠ¡ä¸­ï¼Œä¸€èˆ¬ä¸åŒçš„æœåŠ¡æ¨¡å—æˆ‘ä»¬ä¼šé‡‡ç”¨ TCP è¿›è¡Œé€šä¿¡ï¼Œæœ¬æ–‡æ¥ç®€å•è°ˆä¸€è°ˆå¦‚ä½•è®¾è®¡ TCP æœåŠ¡çš„åŸºç¡€ç®¡ç†ã€‚\n\n>åœ¨å…·ä½“è®¾è®¡ä¸Šï¼Œæœ¬æ–‡å‚è€ƒäº†å¾®æœåŠ¡æ¡†æ¶ [Seneca](https://github.com/senecajs/seneca) æ‰€é‡‡ç”¨çš„é€šä¿¡æ–¹æ¡ˆ [Seneca-transport](https://github.com/senecajs/seneca-transport)ï¼Œå·²ç»è¢«å®è·µæ‰€è¯æ˜å…¶å¯è¡Œæ€§ã€‚\n\nä¸€æåˆ° TCP é€šä¿¡ï¼Œæˆ‘ä»¬è‚¯å®šç¦»ä¸å¼€ `net` æ¨¡å—ï¼Œäº‹å®ä¸Šï¼Œå€ŸåŠ© `net` æ¨¡å—ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ¯”è¾ƒå¿«é€Ÿåœ°å®Œæˆä¸€èˆ¬çš„ TCP é€šä¿¡çš„ä»»åŠ¡ã€‚\n\nä¸ºäº†é¿å…å¯¹åŸºç¡€çš„é—å¿˜ï¼Œæˆ‘ä»¬è¿˜æ˜¯å…ˆé™„ä¸Šä¸€ä¸ªåŸºæœ¬çš„ TCP é“¾æ¥ä»£ç ï¼š\n\n```javascript\n//server.js:\nconst net = require('net');\n\nconst server = net.createServer((socket) => {\n    socket.write('goodbye\\n');\n    socket.on('data', (data) => {\n        console.log('data:', data.toString());\n        socket.write('goodbye\\n');\n    })\n}).on('error', (err) => {\n    throw err;\n});\n\n// grab an arbitrary unused port.\nserver.listen(8024, () => {\n    console.log('opened server on', server.address());\n});\n\n//client.js:\nconst net = require('net');\n\nconst client = net.createConnection({ port: 8024 }, () => {\n    //'connect' listener\n    console.log('connected to server!');\n    client.write('world!\\r\\n');\n    setInterval(() => {\n        client.write('world!\\r\\n');\n    }, 1000)\n});\nclient.on('data', (data) => {\n    console.log(data.toString());\n    // client.end();\n});\nclient.on('end', () => {\n    console.log('disconnected from server');\n});\n```\n\nå…¶å®ï¼Œä¸Šè¿°å·²ç»æ˜¯ä¸€ä¸ªå‡ ä¹æœ€ç®€å•çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é€šä¿¡ Demoï¼Œä½†æ˜¯å¹¶ä¸èƒ½åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦å®¡è§†ï¼Œå…¶ç¦»ç”Ÿäº§ç¯å¢ƒè¿˜å·®å“ªäº›å†…å®¹ï¼š\n\n1. ä»¥ä¸Šè¦æ±‚ Server ç«¯è¦åœ¨ Client ç«¯ä¹‹å‰å¯åŠ¨ï¼Œå¹¶ä¸”ä¸€æ—¦å› ä¸ºä¸€äº›é”™è¯¯å¯¼è‡´ Server ç«¯é‡å¯äº†å¹¶ä¸”è¿™ä¸ªæ—¶å€™ Client ç«¯æ­£å¥½å’Œ Server ç«¯è¿›è¡Œé€šä¿¡ï¼Œé‚£ä¹ˆè‚¯å®šä¼š crashï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ›´ä¸ºå¹³æ»‘å…¼å®¹çš„æ–¹æ¡ˆã€‚\n2. ä»¥ä¸Š TCP é“¾æ¥çš„ Server éƒ¨åˆ†ï¼Œå¹¶æ²¡æœ‰å¯¹ connection è¿›è¡Œç®¡ç†çš„èƒ½åŠ›ï¼Œå¹¶ä¸”åœ¨åœ¨ä»¥ä¸Šçš„ä¾‹å­ä¸­ï¼ŒåŒæ–¹éƒ½æ²¡æœ‰ä¸»åŠ¨é‡Šæ”¾é“¾æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå»ºç«‹çš„æ˜¯ä¸€ä¸ª TCP é•¿è¿æ¥ã€‚\n3. ä»¥ä¸Šé“¾æ¥çš„å¤„ç†æ•°æ®èƒ½åŠ›æœ‰é™ï¼Œåªèƒ½å¤„ç†çº¯æ–‡æœ¬çš„å†…å®¹ï¼Œå¹¶ä¸”è¿˜æœ‰ä¸€å®šçš„é£é™©æ€§ï¼ˆä½ ä¹Ÿè®¸ä¼šè¯´å¯ä»¥ç”¨ JSON çš„åºåˆ—åŒ–ååºåˆ—åŒ–çš„æ–¹æ³•æ¥å¤„ç† JSON æ•°æ®ï¼Œä½†æ˜¯ä½ åˆ«å¿˜äº† `socket.on('data'...` å¾ˆå¯èƒ½æ¥æ”¶åˆ°çš„ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„ JSONï¼Œå¦‚æœ JSON è¾ƒé•¿ï¼Œå…¶å¯èƒ½åªæ¥æ”¶åˆ°ä¸€èˆ¬çš„å†…å®¹ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœç›´æ¥ `JSON.parse())` å¾ˆå¯èƒ½å°±ä¼šæŠ¥é”™ï¼‰ã€‚\n\nä»¥ä¸Šä¸‰ä¸ªé—®é¢˜ï¼Œä¾¿æ˜¯æˆ‘ä»¬è¦è§£å†³çš„ä¸»è¦é—®é¢˜ï¼Œå¦‚æœä½ çœ‹è¿‡ä¹‹åç«‹åˆ»çŸ¥é“è¯¥å¦‚ä½•è§£å†³äº†ï¼Œé‚£ä¹ˆè¿™ç¯‡æ–‡ç« å¯èƒ½ä½ ä¸éœ€è¦çœ‹äº†ï¼Œå¦åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€èµ·ç»§ç»­æ¢ç´¢è§£å†³æ–¹æ¡ˆã€‚\n\n### ä½¿ç”¨ reconnect-core\n\n[reconnect-core](https://www.npmjs.com/package/reconnect-core) æ˜¯ä¸€ä¸ªå’Œåè®®æ— å…³çš„é“¾æ¥é‡è¯•ç®—æ³•ï¼Œå…¶å·¥ä½œæ–¹å¼ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå½“ä½ éœ€è¦åœ¨ Client ç«¯å»ºç«‹é“¾æ¥çš„æ—¶å€™ï¼Œå…¶æµç¨‹æ˜¯è¿™æ ·çš„ï¼š\n\n* è°ƒç”¨äº‹å…ˆä¼ å…¥çš„é“¾æ¥å»ºç«‹å‡½æ•°ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™è¿”å›æˆåŠŸäº†ï¼Œå³æˆåŠŸå»ºç«‹é“¾æ¥ã€‚\n* å¦‚æœç¬¬ä¸€æ¬¡å»ºç«‹é“¾æ¥å¤±è´¥äº†ï¼Œé‚£ä¹ˆå†éš”ä¸€æ®µæ—¶é—´å»ºç«‹ç¬¬äºŒæ¬¡ï¼Œå¦‚æœç¬¬äºŒæ¬¡è¿˜æ˜¯å¤±è´¥ï¼Œé‚£ä¹ˆå†éš”ä¸€æ®µæ›´é•¿çš„æ—¶é—´å»ºç«‹ç¬¬ä¸‰æ¬¡ï¼Œå¦‚æœè¿˜æ˜¯å¤±è´¥ï¼Œé‚£ä¹ˆå†éš”æ›´é•¿çš„ä¸€æ®µæ—¶é—´â€¦â€¦ç›´åˆ°åˆ°è¾¾æœ€å¤§çš„å°è¯•æ¬¡æ•°ã€‚\n\nå®é™…ä¸Šå…³äºå°è¯•çš„æ—¶é—´é—´éš”ï¼Œä¹Ÿä¼šæœ‰ä¸åŒçš„ç­–ç•¥ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æ˜¯ Fibonacci ç­–ç•¥å’Œ exponential ç­–ç•¥ã€‚\n\nå½“ç„¶ï¼Œå…³äºç­–ç•¥çš„å…·ä½“å®ç°ï¼Œreconnect-core é‡‡ç”¨äº†ä¸€ä¸ª [backoff](https://www.npmjs.com/package/backoff) çš„åº“æ¥ç®¡ç†ï¼Œå…¶å¯ä»¥æ”¯æŒ  Fibonacci ç­–ç•¥å’Œ exponential ç­–ç•¥ä»¥åŠæ›´å¤šçš„è‡ªå®šä¹‰ç­–ç•¥ã€‚\n\nå¯¹äºä¸Šé¢æåˆ°çš„ DEMO ä»£ç ã€‚æˆ‘ä»¬ç»™å‡º Client ç«¯ä½¿ç”¨ reconnect-core çš„ä¸€ä¸ªå®ç°ï¼š\n\n```javascript\n//client.js:\nconst Reconnect = require('reconnect-core');\nconst net = require('net');\nconst Ndjson = require('ndjson');\n\nconst Connect = Reconnect(function() {\n    var args = [].slice.call(arguments);\n    return net.connect.apply(null, args)\n});\n\nlet connection = Connect(function(socket) {\n    socket.write('world!\\r\\n');\n    socket.on('data', (msg) => {\n        console.log('data', msg.toString());\n    });\n    socket.on('close', (msg) => {\n        console.log('close', msg).toString();\n        connection.disconnect();\n    });\n    socket.on('end', () => {\n        console.log('end');\n    });\n});\n\nconnection.connect({\n    port: 8024\n});\nconnection.on('reconnect', function () {\n    console.log('on reconnect...')\n});\nconnection.on('error', function (err) {\n   console.log('error:', err);\n});\nconnection.on('disconnect', function (err) {\n   console.log('disconnect:', err);\n});\n```\n>é‡‡ç”¨ Reconnect å®é™…ä¸Šç›¸æ¯”ä¹‹å‰æ˜¯å¤šäº†ä¸€å±‚å†…å®¹ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œéœ€è¦åŒºåˆ† connection å®ä¾‹å’Œ socket å¥æŸ„ï¼Œå¹¶ä¸”é™„åŠ æ­£ç¡®çš„æ—¶é—´ç›‘å¬ã€‚\n\nç°åœ¨ï¼Œæˆ‘ä»¬å°±ä¸ç”¨æ‹…å¿ƒåˆ°åº•æ˜¯å…ˆå¯åŠ¨æœåŠ¡ç«¯è¿˜æ˜¯å…ˆå¯åŠ¨å®¢æˆ·ç«¯äº†ï¼Œå¦å¤–ï¼Œå°±ç®—æˆ‘ä»¬çš„æœåŠ¡ç«¯åœ¨å¯åŠ¨ä¹‹åç”±äºæŸäº›é”™è¯¯å…³é—­äº†ä¸€ä¼šï¼Œåªè¦æ²¡è¶…è¿‡æœ€å¤§æ—¶é—´ï¼ˆè€Œè¿™ä¸ªä¹Ÿæ˜¯å¯é…ç½®çš„ï¼‰ï¼Œä»ç„¶ä¸ç”¨æ‹…å¿ƒå®¢æˆ·ç«¯ä¸å…¶å»ºç«‹è¿æ¥ã€‚\n\n\n### ç»™ Server ç«¯å¢åŠ ç®¡ç†èƒ½åŠ›\n\nç»™ Server ç«¯å¢åŠ ç®¡ç†èƒ½åŠ›æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¿…è¦çš„å¹¶ä¸”å¯ä»¥åšæˆä¸åŒç¨‹åº¦çš„ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæœ€é‡è¦çš„åŠŸèƒ½åˆ™æ˜¯åŠæ—¶æ¸…ç†é“¾æ¥ï¼Œå¸¸ç”¨çš„åšæ³•æ˜¯æ”¶åˆ°æŸæ¡æŒ‡ä»¤ä¹‹åè¿›è¡Œæ¸…ç†ï¼Œæˆ–è€…åˆ°è¾¾ä¸€å®šæ—¶é—´ä¹‹åå®šæ—¶æ¸…ç†ã€‚\n\nè¿™é‡Œæˆ‘ä»¬å¯ä»¥å¢åŠ ä¸€ä¸ªåŠŸèƒ½ï¼Œè¾¾åˆ°ä¸€å®šæ—¶é—´ä¹‹åï¼Œè‡ªåŠ¨æ¸…ç†æ‰€æœ‰é“¾æ¥ï¼š\n\n```javascript\n//server.js\nconst net = require('net');\n\nvar connections = [];\n\nconst server = net.createServer((socket) => {\n    connections.push(socket);\n    socket.write('goodbye\\n');\n    socket.on('data', (data) => {\n        console.log('data:', data.toString());\n        socket.write('goodbye\\n');\n    })\n}).on('error', (err) => {\n    throw err;\n});\n\nsetTimeout(() => {\n    console.log('clear connections');\n    connections.forEach((connection) => {\n        connection.end('end')\n        // connection.destory()\n    })\n}, 10000);\n\n// grab an arbitrary unused port.\nserver.listen(8024, () => {\n    console.log('opened server on', server.address());\n});\n```\n\næˆ‘ä»¬å¯ä»¥é€šè¿‡`connection.end('end')` å’Œ `connection.destory()` æ¥æ¸…ç†ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå‰è€…æ˜¯æ­£å¸¸æƒ…å†µä¸‹çš„å…³é—­æŒ‡ä»¤ï¼Œéœ€è¦ Client ç«¯è¿›è¡Œç¡®è®¤ï¼Œè€Œåè€…åˆ™æ˜¯å¼ºåˆ¶å…³é—­ï¼Œä¸€èˆ¬åœ¨å‡ºé”™çš„æ—¶å€™ä¼šè¿™æ ·è°ƒç”¨ã€‚\n\n### ä½¿ç”¨ ndjson æ¥æ ¼å¼åŒ–æ•°æ®\n\n[ndjson](https://www.npmjs.com/package/ndjson) æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ–¹ä¾¿çš„ JSON åºåˆ—åŒ–/ååºåˆ—åŒ–åº“ï¼Œç›¸æ¯”äºæˆ‘ä»¬ç›´æ¥ç”¨ JSONï¼Œå…¶å¥½å¤„ä¸»è¦ä½“ç°åœ¨ï¼š\n\n* å¯ä»¥åŒæ—¶è§£æå¤šä¸ª JSON å¯¹è±¡ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªæ–‡ä»¶æµï¼Œå³å…¶å¯ä»¥åŒ…å«å¤šä¸ª `{}`ï¼Œä½†æ˜¯è¦æ±‚åˆ™æ˜¯æ¯ä¸€ä¸ªå æ®ä¸€è¡Œï¼Œå…¶æŒ‰è¡Œåˆ†å‰²å¹¶ä¸”è§£æã€‚\n* å†…éƒ¨ä½¿ç”¨äº† [split2](https://www.npmjs.com/package/split2)ï¼Œå¥½å¤„å°±æ˜¯å…¶è¿”å›æ—¶å¯ä»¥ä¿è¯è¯¥è¡Œçš„æ‰€æœ‰å†…å®¹å·²ç»æ¥å—å®Œæ¯•ï¼Œä»è€Œé˜²æ­¢ ndjson åœ¨åºåˆ—åŒ–çš„æ—¶å€™å‡ºé”™ã€‚\n\nå…³äº ndjson çš„åŸºæœ¬ä½¿ç”¨ï¼Œå¯ä»¥æ ¹æ®ä¸Šè¿°é“¾æ¥æŸ¥æ‰¾æ–‡æ¡£ï¼Œè¿™é‡Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼ˆä»¥ä¸‹æ˜¯ä¸€ä¸ª demoï¼‰ï¼š\n\n```javascript\n//server.js:\nconst net = require('net');\n\nvar connections = [];\n\nconst server = net.createServer((socket) => {\n    connections.push(socket);\n    socket.on('data', (data) => {\n        console.log('data:', data.toString());\n        socket.write('{\"good\": 1234}\\r\\n');\n        socket.write('{\"good\": 4567}\\n\\n');\n    })\n}).on('error', (err) => {\n    throw err;\n});\n\n// grab an arbitrary unused port.\nserver.listen(8024, () => {\n    console.log('opened server on', server.address());\n});\n\n//client.js:\nconst Reconnect = require('reconnect-core');\nconst net = require('net');\nconst Ndjson = require('ndjson');\nvar Stream = require('stream');\n\nconst Connect = Reconnect(function() {\n    var args = [].slice.call(arguments);\n    return net.connect.apply(null, args)\n});\n\nlet connection = Connect(function(socket) {\n    socket.write('world!\\r\\n');\n    var parser = Ndjson.parse();\n    var stringifier = Ndjson.stringify();\n\n    function yourhandler(){\n        var messager = new Stream.Duplex({ objectMode: true });\n        messager._read = function () {\n            // console.log('data:', data);\n        };\n        messager._write = function (data, enc, callback) {\n            console.log(typeof data, data);\n            // your handler\n            return callback()\n        };\n        return messager\n    }\n    socket // é“¾æ¥å¥æŸ„\n        .pipe(parser)\n        .pipe(yourhandler())\n        .pipe(stringifier)\n        .pipe(socket);\n\n    socket.on('close', (msg) => {\n        console.log('close', msg).toString();\n        connection.disconnect();\n    });\n    socket.on('end', (msg) => {\n        console.log('end', msg);\n    });\n});\nconnection.connect({\n    port: 8024\n});\nconnection.on('reconnect', function () {\n    console.log('on reconnect...')\n});\nconnection.on('error', function (err) {\n   console.log('error:', err);\n});\nconnection.on('disconnect', function (err) {\n   console.log('disconnect:', err);\n});\n```\n\nå…¶ä¸­ï¼Œç”¨æˆ·å…·ä½“çš„é€»è¾‘ä»£ç ï¼Œå¯ä»¥æ˜¯ `yourhandler` å‡½æ•° `_write` é‡Œé¢çš„ä¸€éƒ¨åˆ†ï¼Œå…¶æ¥æ”¶çš„æ˜¯ä¸€ä¸ªä¸€ä¸ªå¤„ç†å¥½çš„å¯¹è±¡ã€‚\n\n","tags":["Node.js","TCP"]},{"title":"å¤šç»„ä»¶å•é¡µåˆ—è¡¨åº”ç”¨çš„ä»£ç ç»„ç»‡å®è·µ","url":"/2018/11/10/å¤šç»„ä»¶å•é¡µåˆ—è¡¨åº”ç”¨çš„ä»£ç ç»„ç»‡å®è·µ/","content":"\næœ¬æ–‡ä¸»è¦å¯¹å¤šç»„ä»¶å•é¡µé¢åˆ—è¡¨åº”ç”¨çš„ä»£ç ç»„ç»‡å®è·µè¿›è¡Œæ€»ç»“ï¼Œä»è€Œç»™ç›¸å…³åº”ç”¨çš„ Web å¼€å‘æä¾›å‚è€ƒã€‚\n\n### ä»€ä¹ˆæ˜¯å¤šç»„ä»¶å•é¡µé¢åˆ—è¡¨åº”ç”¨ï¼Ÿ\n\nç›®å‰ï¼Œå…¶å®å¤šç»„ä»¶å•é¡µé¢åˆ—è¡¨åº”ç”¨éå¸¸å¸¸è§ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»ä¸­ä½¿ç”¨éå¸¸é«˜é¢‘çš„ä¸€ä¸ªç±»åˆ«çš„åº”ç”¨ï¼Œæœ€å…¸å‹çš„æ¯”å¦‚æ–°é—»ä¿¡æ¯æµäº§å“è…¾è®¯æ–°é—»ã€ä»Šæ—¥å¤´æ¡ç­‰è¿™ç±»æ–°é—»åº”ç”¨ï¼Œåœ¨è¿™ç±»æ–°é—»åº”ç”¨ä¸­ï¼Œå¾€å¾€å›¾ç‰‡ã€å›¾æ–‡ã€è§†é¢‘ã€é—®ç­”ã€æŠ•ç¥¨ç­‰å¤šç§æ¨¡å—æ··æ‚æ’åˆ—ã€‚å†ç®€å•ä¸€ç‚¹çš„è¯ï¼ŒçŸ¥ä¹ã€è±†ç“£ç”šè‡³ä¸€äº›è®ºå›ä»¥åŠä¸€äº›è´­ç‰©è½¯ä»¶ï¼Œä¹Ÿå¯ä»¥å½’ä¸ºæ­¤ç±»åº”ç”¨ã€‚\n\nç”±äºç¬”è€…åœ¨è´Ÿè´£QQçœ‹ç‚¹æœç´¢æ¨¡å—çš„ç›¸å…³å†…å®¹ï¼Œ å› æ­¤ï¼Œè¿™é‡Œç»™å‡ºä¸€ä¸ªQQçœ‹ç‚¹æœç´¢çš„å±•ç¤ºå›¾ï¼š\n\n![](/img/kd.jpg)\n\nè¿™ç±»åº”ç”¨å…¶å®æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š\n\n* å±äºé•¿åˆ—è¡¨æ»šåŠ¨ï¼Œå†…å®¹éšç€æ»šåŠ¨ä¸æ–­åŠ è½½ï¼Œä¸€èˆ¬åœ¨ç”¨æˆ·è¿”å›ä¹‹å‰å¯èƒ½ç§¯ç´¯äº†å¤§é‡çš„å†…å®¹ï¼Œå› æ­¤å¯èƒ½ä¼šé€ æˆä¸€å®šçš„æ€§èƒ½é—®é¢˜ã€‚\n* æ¨¡å—ä¼—å¤šï¼Œå¹¶ä¸”æ¨¡å—çš„ç§ç±»å’Œæ ·å¼æ›´æ–°è¿­ä»£å¿«ï¼Œè¿™ç»™æˆ‘ä»¬åœ¨å¤ç”¨ç»„ä»¶çš„é€‰æ‹©ä¸Šå¸¦æ¥äº†æŒ‘æˆ˜ï¼Œå¦‚æœæˆ‘ä»¬ç›²ç›®å¤ç”¨ç»„ä»¶ï¼Œåˆ™ä¼šé€ æˆèƒ¶æ°´ä»£ç è¶Šæ¥è¶Šå¤šï¼Œå¦‚æœä¸å¤ç”¨ç»„ä»¶ï¼Œé‚£ä¹ˆä»£ç é‡ä¼šéšç€ä¸šåŠ¡å‘å±•çº¿æ€§å¢é•¿ï¼Œè¿™éƒ½ç»™æˆ‘ä»¬åç»­çš„ç»´æŠ¤å¸¦æ¥äº†æŒ‘æˆ˜ã€‚\n\nå½“ç„¶ï¼Œä¸€èˆ¬çš„åŸºäº Web çš„åº”ç”¨ï¼ˆå®é™…ä¸Šï¼ŒQQçœ‹ç‚¹æœç´¢å¹¶ä¸å®Œå…¨æ˜¯çº¯ç²¹çš„ WebView åº”ç”¨ï¼‰æ‰€é¢ä¸´çš„é—®é¢˜è¿™é‡Œä¹Ÿéƒ½ä¼šé‡åˆ°ã€‚ä¸è¿‡ï¼Œä¸Šè¿°ä¸¤ç±»é—®é¢˜åº”è¯¥ç®—æ˜¯è¿™ç±»åº”ç”¨çš„æ¯”è¾ƒé‡è¦çš„é—®é¢˜ï¼Œå…¶å®å½’æ ¹åˆ°åº•ï¼Œå‰è€…æ˜¯æ€§èƒ½é—®é¢˜ï¼ˆé¢å‘ç”¨æˆ·ï¼‰ï¼Œåè€…æ˜¯ç»´æŠ¤é—®é¢˜ï¼ˆé¢å‘å¼€å‘è€…ï¼‰ã€‚\n\nå¦‚ä½•è§£å†³è¿™é‡Œçš„æ€§èƒ½é—®é¢˜ï¼Œå…¶å®å·²ç»æœ‰å¾ˆå¤šå¸¸è§„çš„æ–¹æ¡ˆå¯ä»¥å€Ÿé‰´äº†ï¼Œè¿™å¹¶ä¸æ˜¯æœ¬ç¯‡æ–‡ç« çš„é‡ç‚¹ï¼Œé™¤äº†ä¼ ç»Ÿ Web ç”¨åˆ°çš„æ€§èƒ½ä¼˜åŒ–æ–¹æ³•ï¼Œè¿™é‡Œä»…ä»…åˆ—ä¸¾ä¸€äº›å¸¸è§„çš„åšæ³•ï¼š\n\n* å›¾ç‰‡ç­‰èµ„æºçš„æ‡’åŠ è½½ã€‚\n* åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨ï¼Œå³ä½¿ç”¨æœ‰é™çš„å…ƒç´ ï¼Œä¼˜åŒ–CSSå†™æ³•ç­‰ã€‚\n* ä½¿ç”¨è·¨ç«¯èåˆæ–¹æ¡ˆæ¸²æŸ“ï¼Œä¾‹å¦‚ Weexã€ReactNativeã€Hippy ç­‰ã€‚\n\n### å¤šç»„ä»¶å•é¡µé¢åº”ç”¨çš„ç»´æŠ¤å›°å¢ƒ\n\nå¯¹äºè¿™ç±»å¤šç»„ä»¶å•é¡µé¢åº”ç”¨ï¼Œä¸€èˆ¬éƒ½æ˜¯å¢é‡å‘å±•çš„ï¼Œå³æœ€å¼€å§‹åªæœ‰å¾ˆä¸ªåˆ«çš„å‡ ä¸ªæ¨¡å—ï¼Œéšç€ä¸šåŠ¡è¶Šæ¥è¶Šå¤æ‚ï¼Œæ¨¡å—è¶Šæ¥è¶Šå¤šï¼Œé€»è¾‘ä¹Ÿè¶Šæ¥è¶Šå¤æ‚ã€‚\n\næˆ‘ä»¬ä¸€å¼€å§‹ï¼Œè‚¯å®šå¯ä»¥æƒ³åˆ°ä¸€ä¸ªæ¨¡å—ï¼ˆå³ä¸Šæ–‡ä¸­ç°è‰²åˆ†å‰²çº¿åˆ†å‰²çš„ä¸€å—ï¼‰æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œä¸åŒç»„ä»¶ä¹‹é—´æŠ½ç¦»å‡ºå…¬å…±çš„å‡½æ•°ï¼Œæˆ–è€…é‡‡ç”¨ mixin å°†å…¬å…±çš„éƒ¨åˆ†æŠ½ç¦»ï¼Œè‡³äºæ•°æ®ç«¯ï¼Œç”±äºè¿™ç±»åº”ç”¨é€šå¸¸åœ¨æ·±åº¦ä¸Šä¸å¤æ‚ï¼Œç›´æ¥é‡‡ç”¨ React æˆ–è€… Vue æä¾›çš„çˆ¶å­ç»„ä»¶é€šä¿¡çš„æ–¹å¼ä¸€èˆ¬å°±å¤Ÿç”¨äº†ã€‚è¿™æ ·è®¾è®¡æ—¢æ»¡è¶³ç»„ä»¶åŒ–çš„æ€è·¯ï¼Œä¹Ÿèƒ½å¤Ÿæ–¹ä¾¿çš„ç»´æŠ¤é¡¹ç›®ï¼Œæ¯”è¾ƒé€‚åˆé¡¹ç›®çš„åˆæœŸã€‚\n\nä½†æ˜¯éšç€é¡¹ç›®å‘å±•ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œé—®é¢˜æ…¢æ…¢åœ°äº§ç”Ÿäº†ï¼š\n\n* å•å…ƒç»„ä»¶éå¸¸ä¸å¥½ç•Œå®šï¼Œæ¯”å¦‚ä¸€ä¸ªå·¦å›¾å³æ–‡çš„å›¾æ–‡æ··æ’ç»„ä»¶ï¼ˆä¾‹å¦‚åˆ˜äº¦è²çš„çƒ­ç‚¹ï¼‰ï¼Œä¹‹ååˆä¼šå¢åŠ å·¦è§†é¢‘å³æ–‡å­—ï¼Œå’Œå›¾æ–‡å±•ç¤ºçš„åŒºåˆ«ä¸å¤§ä½†æ˜¯åŠ äº†è§†é¢‘çš„æ’­æ”¾æ—¶é•¿ï¼Œä¹‹ååˆåŠ äº†å·¦è§†é¢‘é›†åˆå³æ–‡å­—ï¼ˆä¾‹å¦‚åŒä¸–å® å¦ƒç¬¬ä¸€éƒ¨åˆ†ï¼‰ï¼Œå¦‚æœæˆ‘ä»¬æŠŠè¿™å¤šç±»å†…å®¹å½“ä½œä¸€ä¸ªç»„ä»¶ï¼Œæˆ‘ä»¬çš„ç»„ä»¶ä¸­å°±ä¼šæœ‰éå¸¸å¤šçš„åˆ¤æ–­ä»£ç ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰å¤§é‡çš„ä»£ç å†—ä½™ï¼Œæˆ–è€…è®¾è®¡å¤æ‚çš„ mixin å’Œå·¥å…·å‡½æ•°ã€‚\n* é™¤äº†æˆ‘ä»¬è‡ªèº«çš„é—®é¢˜ï¼Œå¾€å¾€éšç€å†…å®¹å¢å¤šï¼Œåç«¯è¿”å›çš„æ•°æ®å†…å®¹ä¹Ÿä¼šéå¸¸çš„ä¸ä¸€è‡´ï¼Œåœ¨ç›¸ä¼¼ç”šè‡³ç›¸åŒçš„ç»„ä»¶ä¸­ï¼Œæ•°æ®æ ¼å¼ä¹Ÿä¸å°½ç›¸åŒï¼Œæˆ‘ä»¬éœ€è¦åœ¨æˆ‘ä»¬çš„å•å…ƒç»„ä»¶ä¸­ï¼Œæ¥è§£æåˆ¤æ–­å¤šç§æ•°æ®æ ¼å¼ã€‚\n* ç¬¬ä¸‰ç‚¹å°±æ˜¯æ ·å¼æ›´æ–°éšæ‚£ï¼Œå½“æˆ‘ä»¬çš„ç»„ä»¶å¤šäº†ä¹‹åï¼Œå¦‚æœæˆ‘ä»¬å¯¹æˆ‘ä»¬çš„ç»„ä»¶è¿›è¡Œæ›´æ–°ï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½éœ€è¦åŒæ—¶æ›´æ–°å¤šå¤„ï¼ˆå—¯ï¼Œå…¨å±€æ›¿æ¢ä¹Ÿè®¸æ˜¯ä¸ªä¸é”™çš„ä¸»æ„ï¼‰ï¼Œè¿™ä¹Ÿæ˜¯ç›¸å½“æœ‰é£é™©çš„ï¼Œä¹Ÿè®¸ä¼šæ— æ„é—´æ”¹åŠ¨æˆ‘ä»¬å¹¶ä¸æƒ³æ”¹åŠ¨çš„ UIã€‚\n\nå¦‚æœæˆ‘ä»¬ç­‰é¡¹ç›®å¤æ‚åé¢å¯¹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¼šå‘ç°æ”¹åŠ¨å‰æœŸçš„ä»£ç å·¥ä½œé‡æ¯”è¾ƒå·¨å¤§ï¼Œä½†æ˜¯è¿™åˆæ˜¯æˆ‘ä»¬ä¸å¾—ä¸åšçš„äº‹æƒ…ï¼Œè¿™ç±»é—®é¢˜çš„äº§ç”Ÿï¼Œå®é™…ä¸Šä¸»è¦åŸå› æ˜¯æˆ‘ä»¬çš„ç»„ä»¶è®¾è®¡è§„åˆ’çš„ä¸åˆç†ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åœ¨æœ€åˆçš„é¡¹ç›®ä¸­ï¼Œé€šè¿‡ä¸€å®šçš„è®¾è®¡è§„åˆ’ï¼Œæ¥è§„é¿è¿™äº›é—®é¢˜ã€‚\n\n### å¤šç»„ä»¶å•é¡µé¢åº”ç”¨çš„ç»„ä»¶è§„åˆ’\n\næ—¢ç„¶ï¼Œæˆ‘ä»¬ç°åœ¨å¸Œæœ›è®¾è®¡ä¸€å¥—æ¯”è¾ƒå¥½çš„ç»„ä»¶è§„åˆ’ï¼Œæˆ‘ä»¬å°±éœ€è¦é‡æ–°å®¡è§†æˆ‘ä»¬çš„é¡¹ç›®ï¼Œå¯¹äºæˆ‘ä»¬çš„é¡¹ç›®è€Œè¨€ï¼Œä¸€ä¸ªä¸šåŠ¡æ¨¡å—ä¸€ä¸ªç»„ä»¶çš„æ–¹å¼ï¼Œçš„ç¡®ç®€å•æ–¹ä¾¿ï¼Œä½†æ˜¯è¿™æ ·ç²—æ”¾çš„ç»„ä»¶åˆ’åˆ†åŸåˆ™ï¼Œå®é™…ä¸Šå¹¶ä¸èƒ½å®Œå…¨æ»¡è¶³æˆ‘ä»¬å¤æ‚çš„ç»´æŠ¤éœ€æ±‚ï¼Œåè€Œä¼šç»™æˆ‘ä»¬å¸¦æ¥å›°æ‰°ã€‚\n\nç»è¿‡ä¸€ç³»åˆ—çš„é‡æ„å’Œæ•´ç†ï¼Œç›®å‰QQçœ‹ç‚¹æœç´¢çš„ç»„ä»¶è§„åˆ’é€»è¾‘æ˜¯è¿™æ ·çš„ï¼š\n\n![](/img/kds.jpg)\n\nè¿™é‡Œä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬é‡‡å–ä¸Šé¢æ ·ä¾‹å›¾ç‰‡ä¸­æ¯”è¾ƒå¸¸è§çš„ä¸€ç±»ä¸šåŠ¡ï¼šå›¾æ–‡æ··æ’æ¡ç›®ï¼ˆå·¦å›¾å³æ–‡å’Œå³å›¾å·¦æ–‡ï¼‰æ¥è¿›è¡Œä¸¾ä¾‹ï¼Œå¦‚ä½•è®¾è®¡ç»„ä»¶æ¥è®©æé«˜æˆ‘ä»¬é¡¹ç›®çš„å¯ç»´æŠ¤æ€§ã€‚\n\nè¿™é‡Œé¦–å…ˆæ˜¯é›¶ä»¶å±‚ï¼Œé›¶ä»¶å±‚åº”è¯¥æœ‰å¦‚ä¸‹å†…å®¹ï¼š\n\n* å›¾ç‰‡é›¶ä»¶ï¼Œå®šå®½ï¼Œå®šé«˜ï¼Œè‡ªå¸¦æ‡’åŠ è½½ï¼Œæ­£å¸¸æƒ…å†µä¸‹åªéœ€ä¼ å…¥ä¸€ä¸ª URL å³å¯ä½¿ç”¨ã€‚\n* æ ‡é¢˜ç»„ä»¶ï¼Œä¸€è¡Œæ ‡é¢˜å’Œä¸¤è¡Œæ ‡é¢˜å¯ä»¥è®¾è®¡æˆä¸¤ä¸ªç»„ä»¶ï¼Œä½†è¿›è¡Œ CSS å±‚é¢çš„å¤ç”¨ã€‚\n* æè¿°å†…å®¹ç»„ä»¶ï¼Œä¾‹å¦‚åŒä¸–å® å¦ƒçš„ä¸¤è¡Œå‰§é›†æè¿°ã€‚\n* å…ƒä¿¡æ¯å†…å®¹ç»„ä»¶ï¼Œä¾‹å¦‚æ™®é€šå›¾æ–‡çš„æ¥æºå’Œå‘è¡¨æ—¶é—´ã€‚\n* æ—¶é•¿ç»„ä»¶ï¼Œè§†é¢‘å›¾æ–‡ä¸­ç”¨åˆ°ã€‚\n* å¸¦æœ‰æè¿°æ€§çš„å›¾ç‰‡ç»„ä»¶ï¼Œè§†é¢‘å›¾æ–‡ä¸­ç”¨åˆ°ã€‚\n* å›¾æ ‡ç»„ä»¶ï¼šå¯ä»¥æ‰¿è½½å›¾æ ‡ã€‚\n\nä»¥ä¸Šå„ä¸ªç»„ä»¶çš„å†…å®¹ï¼Œå‡ ä¹éƒ½è¶³å¤Ÿç®€å•ï¼Œåªéœ€ä¼ å…¥ä¸€ä¸ª props ä½œä¸ºå†…å®¹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç»„ä»¶ä¸­ä¸èƒ½å‡ºç° if æˆ– switch ç­‰é€»è¾‘ã€‚\n\næ¥ä¸‹æ¥æ˜¯ç»„åˆå™¨éƒ¨åˆ†ï¼Œç»„åˆå™¨ä¹Ÿæ˜¯é›¶ä»¶ï¼Œåªä¸è¿‡æ˜¯é›¶ä»¶çš„ç»„åˆï¼Œå…¶å®ä¹Ÿå¯ä»¥è®¾è®¡çš„æ¯”è¾ƒè–„å¼±ï¼Œä»è€Œå°†æ›´å¤šçš„åŠŸèƒ½åœ¨å¸ƒå±€å™¨ä¸­å®Œæˆï¼Œä½†æ˜¯ä¸ªåˆ«çš„æ—¶å€™ï¼Œæœ‰è¿™ä¸€å±‚ä¼šç»™æˆ‘ä»¬å¸¦æ¥ä¸€å®šçš„æ–¹ä¾¿ï¼Œè¿™é‡Œæ¯”å¦‚ï¼š\n\n* å›¾æ ‡+æ–‡å­—çš„ç»„åˆå™¨æ ‡é¢˜ã€‚\n\nå¯¹äºé›¶ä»¶å±‚å’Œç»„åˆå±‚ï¼Œä¸€èˆ¬æƒ…å†µä¸‹éƒ½ä¸éœ€è¦æœ‰å½±å“å¤–éƒ¨çš„ margin å’Œ paddingï¼Œå³å¦‚æœä¸å¢åŠ ä»»ä½•å¤šä½™æ ·å¼ç½—åˆ—é›¶ä»¶å±‚å’Œç»„åˆå±‚ï¼Œå…¶ä¸Šä¸‹å·¦å³å››è¾¹åº”è¯¥æ˜¯äº’ç›¸è´´åˆçš„ã€‚\n\næ¥ä¸‹æ¥æ˜¯å¸ƒå±€å±‚ï¼Œè¿™é‡Œçš„å¸ƒå±€å±‚ï¼Œå…¶å®å¯ä»¥è¿›è¡Œå¤šç§æ–¹å¼çš„è®¾è®¡ï¼Œæ ¹æ®è®¾è®¡ä¸åŒå…¶æ•°ç›®ä¹Ÿä¸åŒï¼Œè¿™é‡Œç»™å‡ºä¸€ç§è®¾è®¡æ–¹å¼ï¼š\n\n* ç¬¬ä¸€ç§æ˜¯å·¦å›¾å³æ–‡å½¢å¼ï¼Œå³è¾¹å¯ä»¥é€‰æ‹©æ™®é€šå›¾ç‰‡ã€æ™®é€šå›¾ç‰‡+æ—¶é•¿ç»„ä»¶ã€æ™®é€šå›¾ç‰‡+æè¿°ã€‚å³è¾¹å¯ä»¥åœ¨ä¸€è¡Œæ ‡é¢˜ã€ä¸¤è¡Œæ ‡é¢˜ã€æè¿°é›¶ä»¶ã€å…ƒä¿¡æ¯é›¶ä»¶ä¸­ä»»æ„é€‰æ‹©å’Œç»„åˆã€‚\n* ç¬¬äºŒç§æ˜¯å³å›¾å·¦æ–‡å½¢å¼ï¼Œå·¦è¾¹çš„å¯é…ç½®å†…å®¹å’Œä¸Šæ–‡å³è¾¹ç›¸åŒã€‚\n\nå½“ç„¶ï¼Œè¿™ä¸¤ç§æ•´åˆæˆä¸€ç§ä¹Ÿæ— å¦¨ã€‚\n\nåœ¨å¸ƒå±€å±‚ï¼Œæ˜¯æ‹¥æœ‰äº‹ä»¶èƒ½åŠ›çš„ï¼Œä½†æ˜¯å…¶ä¸»è¦åº”è¯¥æ˜¯ç»‘å®šå“åº”æ—¶é—´å¹¶ä¸”è°ƒç”¨é€šè¿‡ props ä¼ å…¥çš„å›è°ƒå‡½æ•°ï¼Œå…¶ä¸åº”è¯¥è‡ªå·±æ‰§è¡Œäº‹ä»¶çš„å“åº”é€»è¾‘ã€‚\n\næœ€åæ˜¯æ§åˆ¶å™¨å±‚ï¼Œ**åœ¨æ§åˆ¶å™¨å±‚ï¼Œé™¤äº†åŒ…è£¹æ ‡ç­¾ä¹‹å¤–ï¼Œä¸åº”è¯¥å‡ºç°ä»»ä½• html æ ‡ç­¾ï¼Œå…¶ä¹Ÿä¸åº”å½“å¼•ç”¨é™¤äº†å¸ƒå±€å±‚ç»„ä»¶ä»¥å¤–çš„æ›´æ·±å±‚æ¬¡çš„ç»„ä»¶ã€‚æ§åˆ¶å±‚çš„ä¸»è¦ä½œç”¨æ˜¯è¿›è¡Œæ•°æ®å¤„ç†ã€‚**\n\næ§åˆ¶å±‚çš„åˆ†ç±»æ–¹å¼å’Œä¸Šè¿°å‡ å±‚ç¨æœ‰ä¸åŒï¼Œè¿™é‡Œï¼Œæˆ‘ä»¬å°±ä¸æ˜¯æŒ‰ç…§ UI æ¥åˆ†ä¸åŒçš„æ§åˆ¶å™¨äº†ï¼Œè€Œæ˜¯æŒ‰ç…§æ•°æ®æˆ–è€…ä¸šåŠ¡æ¥åˆ†ç±»ï¼Œå› ä¸ºè¿™é‡Œæˆ‘ä»¬ä¸»è¦æ˜¯è¿›è¡Œæ•°æ®é€»è¾‘çš„å¤„ç†ï¼Œå’Œ UI çš„å…³ç³»ä¸æ˜¯é‚£ä¹ˆé‡è¦äº†ï¼ˆå·²ç»å°† UI çš„å‹åŠ›è¿›è¡Œäº†ä¸‹æ²‰ï¼‰ã€‚\n\né€šè¿‡ä¸Šè¿°çš„åšæ³•ï¼Œä¹‹åå¦‚æœæœ‰æ–°çš„éœ€æ±‚å¢åŠ è¿›æ¥ï¼Œæˆ‘ä»¬æ ¹æ®éœ€è¦ï¼Œåœ¨ä¸åŒå±‚çº§çš„ç»„ä»¶å¢åŠ å†…å®¹å°±å¥½äº†ã€‚\n\n### æ€»ç»“\n\né€šè¿‡ä»¥ä¸Šçš„é€»è¾‘ï¼Œæˆ‘ä»¬æŠŠç»„ä»¶åˆ’åˆ†çš„æ›´åŠ æ¸…æ™°æ˜ç¡®ï¼Œå°† UI å±•ç¤ºå’Œæ•°æ®é€»è¾‘åˆ†ç¦»ï¼Œå¹¶ä¸”æ–¹ä¾¿æˆ‘ä»¬å¯¹æ ·å¼è¿›è¡Œè¿­ä»£å‡çº§ã€‚\n\nå½“ç„¶ï¼Œè¿™ä¸ªæ—¶å€™ä½ ä¹Ÿè®¸è¿˜ä¼šé—®ï¼Œå¦‚æœæˆ‘å¯¹éƒ¨åˆ†ç»„ä»¶æ ·å¼è¿›è¡Œå‡çº§æ”¹é€ ï¼Œæ€ä¹ˆæ ·é˜²æ­¢å¯¹åŸæœ‰çš„æ ·å¼æ— å½±å“å‘¢ï¼Ÿæš‚æ—¶è¿˜æ²¡æœ‰å¥½çš„åŠæ³•ï¼Œä¸è¿‡ï¼Œæˆ‘ä»¬æ­£åœ¨åšçš„ UI è‡ªåŠ¨åŒ–æµ‹è¯•å¥—ä»¶â€”â€”mangosteenï¼Œå¯ä»¥å®Œç¾è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ•¬è¯·æœŸå¾…ã€‚","tags":["ç»„ä»¶åŒ–"]},{"title":"ä½¿ç”¨ Node.js æ‰“é€ å¤šç”¨æˆ·å®æ—¶ç›‘æ§ç³»ç»Ÿ","url":"/2018/10/21/ä½¿ç”¨ Node.js æ‰“é€ å¤šç”¨æˆ·å®æ—¶ç›‘æ§ç³»ç»Ÿ/","content":"\n### èƒŒæ™¯æ¦‚è¿°\n\né¦–å…ˆæè¿°ä¸€ä¸‹ç¬”è€…é‡åˆ°çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥è®¾å®šè¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šç°åœ¨æœ‰ä¸€ä¸ªå®æ—¶ç›‘æ§ç³»ç»Ÿçš„å¼€å‘éœ€æ±‚ï¼Œè¦æ±‚åŒæ—¶æ”¯æŒå¤šä¸ªç”¨æˆ·ï¼ˆè¿™é‡Œæˆ‘ä»¬ä¸ºäº†ç®€åŒ–ï¼Œæš‚æ—¶ä¸æ¶‰åŠç™»é™†æ€ï¼Œå‡å®šä¸€ä¸ªè®¾å¤‡å³ä¸ºä¸€ä¸ªç”¨æˆ·ï¼‰ï¼Œå¯¹äºä¸åŒçš„ç”¨æˆ·æ¥è®²ï¼Œä»–ä»¬éœ€è¦ç›‘æ§çš„ä¸€éƒ¨åˆ†å†…å®¹æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œæ¯”å¦‚è®¾å¤‡çš„ CPU ä¿¡æ¯ã€å†…å­˜ä¿¡æ¯ç­‰ï¼Œè€Œå¦å¤–ä¸€éƒ¨åˆ†å†…å®¹æ˜¯éƒ¨åˆ†ç”¨æˆ·é‡å çš„ï¼Œæ¯”å¦‚å¯¹æŸä¸€åŒºåŸŸçš„ç”¨æˆ·æ¥è¯´æŸäº›ç›‘æ§ä¿¡æ¯æ˜¯ç›¸åŒçš„ï¼Œè€Œè¿˜æœ‰ä¸€äº›ä¿¡æ¯ï¼Œåˆ™æ˜¯ç”¨æˆ·ä¹‹é—´å®Œå…¨ä¸åŒçš„ã€‚\n\nå¯¹äºæ¯ä¸ªç”¨æˆ·æ¥è®²ï¼Œå½“å…¶è¿›å…¥é¡µé¢ä¹‹åå³è¡¨æ˜å…¶å¼€å§‹ç›‘æ§ï¼Œéœ€è¦æŒç»­åœ°è¿›è¡Œæ•°æ®æ›´æ–°ï¼Œè€Œå½“å…¶é€€å‡ºç•Œé¢æˆ–è€…æ‰‹åŠ¨ç‚¹å‡»åœæ­¢ç›‘æ§ï¼Œåˆ™åœæ­¢ç›‘æ§ã€‚\n\n### é—®é¢˜æè¿°\n\nå®é™…ä¸Šï¼Œå¯¹äºä»¥ä¸Šæƒ…å†µï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°é€šè¿‡ WebSocketï¼Œå¯¹ä¸åŒçš„ç”¨æˆ·è¿›è¡Œéš”ç¦»å¤„ç†ï¼Œå½“ä¸€ä¸ªç”¨æˆ·å¼€å§‹ç›‘æ§çš„æ—¶å€™ï¼Œé€šè¿‡å‡½æ•°æ¥é€ä¸ªå¯åŠ¨å…¶æ‰€æœ‰çš„ç›‘æ§é¡¹ç›®ï¼Œå½“å…¶åœæ­¢ç›‘æ§çš„æ—¶å€™ï¼Œå–æ¶ˆç›¸å…³ç›‘æ§ï¼Œå¹¶ä¸”æ¸…é™¤æ— å…³å˜é‡ç­‰ã€‚æˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰å†…å®¹å†™åˆ° WebSocket çš„è¿æ¥å›è°ƒä¸­ï¼Œç”±äºä½œç”¨åŸŸéš”ç¦»ï¼Œä¸åŒç”¨æˆ·ä¹‹é—´çš„ç›‘æ§ï¼ˆè¯»æ“ä½œï¼‰ä¸ä¼šäº§ç”Ÿäº’ç›¸å½±å“ã€‚\n\nè¿™ç§æ–¹å¼å¯ä»¥è¯´æ˜¯æœ€ä¸ºå¿«æ·æ–¹ä¾¿çš„æ–¹å¼äº†ï¼Œå¹¶ä¸”å‡ ä¹æ— éœ€è¿›è¡Œè®¾è®¡ï¼Œä½†æ˜¯è¿™æ ·æœ‰ä¸€ä¸ªéå¸¸æ˜æ˜¾çš„æ•ˆç‡é—®é¢˜ï¼š\n\nç”±äºä¸åŒç”¨æˆ·çš„éƒ¨åˆ†ç›‘æ§é¡¹ç›®æ˜¯æœ‰é‡å çš„ï¼Œå¯¹äºè¿™äº›é‡å çš„é¡¹ç›®ï¼Œæˆ‘ä»¬å¦‚æœå¯¹äºæ¯ä¸€ä¸ªç”¨æˆ·éƒ½å•ç‹¬ç›‘æ§ï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿéå¸¸å¤šçš„æµªè´¹ï¼Œå¦‚æœè¿™äº›ç›‘æ§ä¸­è¿˜æ¶‰åŠåˆ°æ•°æ®åº“äº¤äº’æˆ–è€…è¾ƒä¸ºå¤æ‚çš„è®¡ç®—ï¼Œé‚£ä¹ˆæˆå€ä¹‹åçš„æ€§èƒ½æŸå¤±æ˜¯éå¸¸éš¾ä»¥æ‰¿å—çš„ã€‚\n\næ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å°†ä¸åŒç”¨æˆ·é‡å çš„é‚£äº›ç›‘æ§é¡¹ç›®ï¼Œè¿›è¡Œåˆå¹¶ï¼Œåˆå¹¶æˆä¸€ä¸ªä¹‹åï¼Œå¦‚æœæœ‰æ–°çš„æ¶ˆæ¯ï¼Œæˆ‘ä»¬å°±æ¨åˆ°æ‰€æœ‰ç›¸å…³ç”¨æˆ·çš„å›è°ƒå‡½æ•°ä¸­å»å¤„ç†ã€‚\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦ç®¡ç†ä¸€ä¸ªä¸€å¯¹å¤šçš„è®¢é˜…å‘å¸ƒæ¨¡å¼ã€‚\n\nåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å‘ç°æˆ‘ä»¬æƒ³è¦å®ç°è¿™æ ·ä¸€ä¸ªç›‘æ§ç³»ç»Ÿï¼Œå¹¶ä¸æ˜¯éå¸¸ç®€å•ï¼Œä¸»è¦æœ‰ä¸‹åˆ—é—®é¢˜ï¼š\n\n* [1]å¯¹äºå¯èƒ½æœ‰ç”¨æˆ·é‡å çš„ç›‘æ§é¡¹ç›®ï¼Œæˆ‘ä»¬éœ€è¦æŠ½ç¦»åˆ°ç”¨æˆ·ä½œç”¨åŸŸä¹‹å¤–ï¼Œå¹¶ä¸”é€šè¿‡ç»Ÿè®¡è®¡æ•°ç­‰æ–¹å¼æ¥\"è®°ä½\"å½“å‰æ‰€æœ‰çš„ç›‘æ§ç”¨æˆ·ï¼Œå½“æœ‰æ–°å†…å®¹æ—¶æ¨åˆ°å„ä¸ªç”¨æˆ·çš„å¤„ç†å‡½æ•°ä¸­ï¼Œå¹¶ä¸”å½“æœ€åä¸€ä¸ªç”¨æˆ·å–æ¶ˆç›‘æ§çš„æ—¶å€™è¦åŠæ—¶æ¸…ç†ç›¸å…³å¯¹è±¡ã€‚\n* [2]ä¸åŒç”¨æˆ·çš„é‡å ç›‘æ§é¡¹ç›®çš„ç›‘æ§æ–¹å¼ä¹Ÿå„ä¸ç›¸åŒï¼Œæœ‰çš„æ˜¯é€šè¿‡ `setInterval` ç­‰æ–¹å¼çš„å®šæ—¶ä»»åŠ¡ï¼Œæœ‰çš„æ˜¯äº‹ä»¶ç›‘å¬å™¨ç­‰ç­‰ã€‚\n* [3]åˆ¤æ–­ä¸åŒç”¨æˆ·çš„é¡¹ç›®æ˜¯å¦é‡å ä¹Ÿæœ‰ä¸€å®šçš„äº‰è®®ï¼Œæ¯”å¦‚å‡è®¾ä¸åŒç”¨æˆ·ç«¯ç›‘æ§çš„æ˜¯åŒä¸€ä¸ªé¡¹ç›®ï¼Œè°ƒç”¨çš„ä¹Ÿæ˜¯ç›¸åŒçš„å‡½æ•°ï¼Œä½†æ˜¯ç”±äºç”¨æˆ· ID ä¸åŒï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¦‚ä½•åˆ¤æ–­æ˜¯å¦ç®—\"åŒä¸€ä¸ªç›‘æ§\"ï¼Ÿ\n\nä»¥ä¸Šçš„è¿™äº›é—®é¢˜ï¼Œå¦‚æœæˆ‘ä»¬ä¸å€ŸåŠ©ç°æœ‰çš„åº“å’Œå·¥å…·ï¼Œè‡ªå·±é¡ºç€æ€è·¯ä¸€ç‚¹ç‚¹å»å†™ï¼Œåˆ™å¾ˆå®¹æ˜“é™·å…¥ä¿®ä¿®è¡¥è¡¥çš„å¾ªç¯ï¼Œæ— æ³•ä¸“æ³¨ç›‘æ§æœ¬èº«ï¼Œå¹¶ä¸”æœ€åç”šè‡³åœ¨æ•ˆç‡ä¸Šé€‚å¾—å…¶åã€‚\n\n### è§£å†³æ–¹æ¡ˆ\n\nä»¥ä¸‹è§£å†³æ–¹æ¡ˆåŸºäº Rx.jsï¼Œéœ€è¦å¯¹ [Observable](https://cn.rx.js.org/class/es6/Observable.js~Observable.html) æœ‰ä¸€å®šäº†è§£ã€‚\n\n#### å¤šä¸ªç”¨æˆ·çš„ç›‘æ§ä»¥åŠå–æ¶ˆ\n\n[Monitor-RX](https://github.com/aircloud/monitor-rx) æ˜¯å¯¹ä»¥ä¸Šåœºæ™¯é—®é¢˜çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆå°è£…ï¼Œå…¶åˆ©ç”¨äº† Rx.js å¯¹è®¢é˜…å‘å¸ƒçš„ç®¡ç†èƒ½åŠ›ï¼Œå¯ä»¥è®©æ•´ä¸ªæµç¨‹å˜çš„æ¸…æ™°ã€‚\n\nåœ¨ Rx.js ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å»ºç«‹ä¸€ä¸ªå¤šæ’­å¯¹è±¡ `multicasted`ï¼š\n\n```\nvar source = Rx.from([1, 2, 3]);\nvar subject = new Rx.Subject();\nvar multicasted = source.pipe(multicast(subject)).refCount();\n// å…¶å±äº monitor-rx çš„å®ç°ç»†èŠ‚ï¼Œæ— éœ€ç†è§£äº¦å¯ä½¿ç”¨ monitor-rx\n\nsubscription1 = refCounted.subscribe({\n    next: (v) => console.log('observerA: ' + JSON.stringify(v))\n});\n\nsetTimeout(() => {\n    subscription2 = refCounted.subscribe({\n        next: (v) => console.log('observerB: ' + JSON.stringify(v))\n    });\n}, 1200);\n\nsubscription1.unsubscribe();\nsetTimeout(() => {\n    subscription2.unsubscribe();\n    // è¿™é‡Œ refCounted çš„ unsubscribe ç›¸å…³æ¸…ç†é€»è¾‘ä¼šè‡ªåŠ¨è¢«è°ƒç”¨\n}, 3200);\n```\n\nåœ¨è¿™é‡Œé‡‡ç”¨å¤šæ’­ï¼Œæœ‰å¦‚ä¸‹å‡ ä¸ªå¥½å¤„ï¼š\n\n* å¯ä»¥éšæ—¶å¢åŠ æ–°çš„è®¢é˜…è€…ï¼Œå¹¶ä¸”æ–°çš„è®¢é˜…è€…åªä¼šæ”¶åˆ°å…¶åŠ å…¥è®¢é˜…ä¹‹åçš„æ•°æ®ã€‚\n* å¯ä»¥éšæ—¶å¯¹ä»»æ„ä¸€ä¸ªè®¢é˜…è€…å–æ¶ˆè®¢é˜…ã€‚\n* å½“æ‰€æœ‰è®¢é˜…è€…å–æ¶ˆè®¢é˜…ä¹‹åï¼ŒObservable ä¼šè‡ªåŠ¨è§¦å‘ Observable å‡½æ•°ï¼Œä»è€Œå¯ä»¥å¯¹å…¶äº‹ä»¶å¾ªç¯ç­‰è¿›è¡Œæ¸…ç†ã€‚\n\nä»¥ä¸Šèƒ½åŠ›å…¶å®å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³ä¸Šæ–‡æåˆ°çš„é—®é¢˜ [1]ã€‚\n\n#### ç›‘æ§æ ¼å¼çš„ç»Ÿä¸€\n\nå®é™…ä¸Šï¼Œåœ¨æˆ‘ä»¬çš„ç›‘æ§ç³»ç»Ÿä¸­ï¼Œä»æ•°æ®ä¾èµ–çš„è§’åº¦ï¼Œæˆ‘ä»¬çš„ç›‘æ§å‡½æ•°ä¼šæœ‰è¿™æ ·å‡ ç±»ï¼š\n\n* [a]çº¯ç²¹çš„å®šæ—¶ä»»åŠ¡ï¼Œæ— æ•°æ®ä¾èµ–ï¼Œè¿™æ–¹é¢æ¯”å¦‚å½“å‰å†…å­˜å¿«ç…§æ•°æ®ç­‰ã€‚\n* [b]å¸¦æœ‰è®°å¿†ä¾èµ–çš„å®šæ—¶ä»»åŠ¡ï¼šå®šæ—¶ä»»åŠ¡ä¾èµ–å‰ä¸€æ¬¡çš„æ•°æ®ï¼ˆç”šè‡³æ›´å¤šæ¬¡ï¼‰ï¼Œéœ€è¦ä¸¤æ¬¡æ•°æ®åšå·®ç­‰ï¼Œè¿™æ–¹é¢çš„æ•°æ®æ¯”å¦‚ä¸€æ®µæ—¶é—´çš„æ¶ˆè€—æ•°æ®ï¼Œcpu ä½¿ç”¨ç‡çš„è®¡ç®—ã€‚\n* [c]å¸¦æœ‰ç”¨æˆ·ä¾èµ–çš„å®šæ—¶ä»»åŠ¡ï¼šä¾èµ–ç”¨æˆ· id ç­‰ä¿¡æ¯ï¼Œä¸åŒç”¨æˆ·æ— æ³•å…±ç”¨ã€‚\n\nè€Œä»ä»»åŠ¡è§¦å‘çš„è§’åº¦ï¼Œæˆ‘ä»¬ä»å¾…å¯ä»¥å¯¹å…¶åˆ†ç±»ï¼š\n\n* [i]ç®€å•çš„ `setInterval` å®šæ—¶ä»»åŠ¡ã€‚\n* [ii]åŸºäºäº‹ä»¶æœºåˆ¶çš„ä¸å®šæ—¶ä»»åŠ¡ã€‚\n* [iii]åŸºäºå…¶ä»–è§¦å‘æœºåˆ¶çš„ä»»åŠ¡ã€‚\n\nå®é™…ä¸Šï¼Œæˆ‘ä»¬å¦‚æœé‡‡ç”¨ Rx.js çš„æ¨¡å¼è¿›è¡Œç¼–å†™ï¼Œæ— éœ€è€ƒè™‘ä»»åŠ¡çš„æ•°æ®ä¾èµ–å’Œè§¦å‘çš„æ–¹å¼ï¼Œåªéœ€å†™æˆä¸€ä¸ªä¸€ä¸ª Observable å®ä¾‹å³å¯ã€‚å¦å¤–ï¼Œå¯¹äºæ¯”è¾ƒç®€å•çš„ [a]&[i] æˆ– [c]&[i]  ç±»å‹ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ monitor-rx æä¾›çš„ `convertToRx` æˆ– `convertToSimpleRx` è½¬æ¢æˆ Observable å®ä¾‹ç”Ÿæˆå‡½æ•°ï¼Œä¾‹å¦‚ï¼š\n\n```\nvar os = require('os');\nvar process = require('process');\nconst monitorRx = require('monitor-rx');\n\nfunction getMemoryInfo() {\n    return process.memoryUsage();\n}\n\nconst memory = monitorRx.Utils.convertToSimpleRx(getMemoryInfo)\n\n// æˆ–è€…\n//const memory = monitorRx.Utils.convertToRx({\n//    getMemoryInfo\n//});\n\nmodule.exports = memory;\n```\n\nconvertToRx ç›¸æ¯”äº convertToSimpleRxï¼Œå¯ä»¥æ”¯æŒå‡½æ•°é…ç½®æ³¨å…¥ï¼ˆå³ä¸‹æ–‡ä¸­ opts çš„ func å±æ€§å’Œ args å±æ€§ï¼‰,å¯ä»¥åœ¨å…·ä½“ç”Ÿæˆ Observable å®ä¾‹çš„æ—¶å€™å…·ä½“æŒ‡å®šä½¿ç”¨å“ªäº›å‡½æ•°ä»¥åŠå…¶å‚æ•°ã€‚\n\nå¦‚æœæ˜¯æ¯”è¾ƒå¤æ‚çš„ Observable ç±»å‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ— æ³•ç›´æ¥é€šè¿‡æ™®é€šå‡½æ•°è¿›è¡Œè½¬åŒ–äº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éµå¾ª Observable çš„æ ‡å‡†è¿”å› Observable ç”Ÿæˆå‡½æ•°å³å¯ï¼ˆä¸æ˜¯ç›´æ¥è¿”å› Observable å®ä¾‹ï¼‰ \n\nè¿™å®é™…ä¸Šä¹Ÿå¯¹é—®é¢˜ [2] è¿›è¡Œäº†è§£å†³ã€‚\n\n#### ç›‘æ§å”¯ä¸€æ€§ï¼š\n\næˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœä¸¤ä¸ªç”¨æˆ·éƒ½ç›‘æ§åŒä¸€ä¸ªä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å…±ç”¨ä¸€ä¸ª Observableï¼Œè¿™é‡Œçš„é—®é¢˜ï¼Œå°±æ˜¯å¦‚ä½•å®šä¹‰ä¸¤ä¸ªç”¨æˆ·çš„ç›‘æ§æ˜¯\"ç›¸åŒ\"çš„ã€‚\n\nè¿™é‡Œæˆ‘ä»¬é‡‡ç”¨ä¸€ä¸ªå¯é€‰é¡¹ opts çš„æ¦‚å¿µï¼Œå…¶ä¸€å…±æœ‰å¦‚ä¸‹å±æ€§ï¼š\n\n```\n{\n    module: 'ModuleName',\n    func: ['FuncName'],\n    args: [['arg1','arg2']],\n    opts: {interval:1000}, \n}\n```\n\nmodule å³ç”¨æˆ·æ˜¯å¯¹å“ªä¸€ä¸ªæ¨¡å—è¿›è¡Œç›‘æ§ï¼ˆå®é™…ä¸Šæ˜¯ Observableï¼‰ï¼Œfunc å’Œ args åˆ™æ˜¯ç›‘æ§è¿‡ç¨‹ä¸­éœ€è¦è°ƒç”¨çš„å‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ agrs ä¼ å…¥ç”¨æˆ·ä¸ªäººä¿¡æ¯ã€‚äºæ²¡æœ‰å†…éƒ¨å­å‡½æ•°è°ƒç”¨çš„ç›‘æ§ï¼ŒäºŒè€…ä¸ºç©ºå³å¯ï¼Œopts æ˜¯ä¸€äº›å…¶ä»–å¯é€‰é¡¹ï¼Œæ¯”å¦‚å®šä¹‰è¯·æ±‚é—´éš”ç­‰ã€‚\n\nä¹‹åï¼Œæˆ‘ä»¬é€šè¿‡ `JSON.stringify(opts)` æ¥åºåˆ—åŒ–è¿™ä¸ªå¯é€‰é¡¹é…ç½®ï¼Œå¦‚æœä¸¤ä¸ªç”¨æˆ·åºåˆ—åŒ–åçš„å¯é€‰é¡¹é…ç½®ç›¸åŒï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è®¤ä¸ºè¿™ä¸¤ä¸ªç”¨æˆ·å¯ä»¥å…±ç”¨ä¸€ä¸ªç›‘æ§ï¼Œå³å…±ç”¨ä¸€ä¸ª Observableã€‚\n\n### æ›´å¤šå†…å®¹\n\nå®é™…ä¸Šï¼Œå€ŸåŠ© Monitor-RXï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„è§£å†³ä¸Šè¿°æå‡ºçš„é—®é¢˜ï¼ŒMonitor-RX ä¹Ÿåœ¨ç§¯æçš„æ›´æ–°ä¸­ï¼Œå¤§å®¶å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/aircloud/monitor-rx)äº†è§£åˆ°æ›´å¤šçš„ä¿¡æ¯ã€‚","tags":["Node.js","javascript","Rx.js"]},{"title":"ä»æºç åˆ†æsentryçš„é”™è¯¯ä¿¡æ¯æ”¶é›†","url":"/2018/08/18/ä»æºç åˆ†æsentryçš„é”™è¯¯ä¿¡æ¯æ”¶é›†/","content":"\nraven.js æ˜¯ sentry ä¸º JavaScript é”™è¯¯ä¸ŠæŠ¥æä¾›çš„ JS-SDKï¼Œæœ¬ç¯‡æˆ‘ä»¬åŸºäºå…¶æºä»£ç å¯¹å…¶åŸç†è¿›è¡Œåˆ†æï¼Œæœ¬ç¯‡æ–‡ç« åªåˆ†æå‰ç«¯éƒ¨åˆ†ï¼Œå¯¹åº”çš„æ–‡ä»¶ç›®å½•æ˜¯`https://github.com/getsentry/sentry-javascript/tree/master/packages/raven-js`ã€‚\n\né¦–å…ˆæŠ›å‡ºå‡ ä¸ªé—®é¢˜ï¼š\n\n* **raven.js æ˜¯å¦‚ä½•æ”¶é›†æµè§ˆå™¨é”™è¯¯ä¿¡æ¯çš„ï¼Ÿ**\n* **raven.js ä¸ŠæŠ¥çš„é”™è¯¯ä¿¡æ¯æ ¼å¼æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿåˆæ˜¯å¦‚ä½•æŠŠè¿™äº›ä¿¡æ¯ä¼ ç»™åç«¯ï¼Ÿæ”¯ä¸æ”¯æŒåˆå¹¶ä¸ŠæŠ¥ï¼Ÿ**\n* **é¢åŒ…å±‘ï¼ˆbreadcrumbsï¼‰æ˜¯ä»€ä¹ˆï¼Ÿraven.js å¦‚ä½•æ¥æ”¶é›†é¢åŒ…å±‘ä¿¡æ¯ï¼Ÿ**\n* **raven.js å¦‚ä½•å’Œæ¡†æ¶é…åˆä½¿ç”¨ï¼ˆæ¯”å¦‚ vueã€reactï¼‰ï¼Ÿ**\n\nåœ¨å›ç­”ä»¥ä¸Šè¿™å‡ ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥å¯¹ raven.js åšä¸€ä¸ªå®è§‚çš„åˆ†æï¼Œä¸»è¦æ¶‰åŠå…¶æ–‡ä»¶ç›®å½•ã€æ‰€å¼•ç”¨çš„ç¬¬ä¸‰æ–¹æ¡†æ¶ç­‰ã€‚\n\nraven.js çš„æ ¸å¿ƒæ–‡ä»¶å†…å®¹å¹¶ä¸å¤šï¼Œå…¶ä¸­ä½¿ç”¨äº†ä¸‰ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œæ”¾åœ¨äº† vendor æ–‡ä»¶å¤¹ä¸‹ï¼š\n\n* [json-stringify-safe](https://github.com/moll/json-stringify-safe) ï¼šä¸€ä¸ªå¯¹ `JSON.stringify` çš„å°è£…ï¼Œå®‰å…¨çš„ json åºåˆ—åŒ–æ“ä½œå‡½æ•°ï¼Œä¸ä¼šæŠ›å‡ºå¾ªç¯å¼•ç”¨çš„é”™è¯¯ã€‚\n\t* è¿™é‡Œé¢æœ‰ä¸€ä¸ªæ³¨æ„ç‚¹è¦å•ç‹¬è¯´ä¸€ä¸‹ï¼Œæˆ‘ä»¬ç†ŸçŸ¥çš„ `JSON.stringify` , å¯ä»¥æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æˆ‘ä»¬è¦åºåˆ—åŒ–çš„å¯¹è±¡ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯¹å…¶ä¸­é”®å€¼å¯¹çš„å¤„ç†å‡½æ•°ï¼›ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æ§åˆ¶ç¼©è¿›ç©ºæ ¼ã€‚reven.js çš„ `json-stringify-safe` å°±æ˜¯å……åˆ†åˆ©ç”¨äº†è¿™ä¸‰ä¸ªå‚æ•°ã€‚\n* [md5](https://github.com/blueimp/JavaScript-MD5)ï¼šjs çš„ md5 å‡½æ•°ã€‚\n* [TraceKit](https://github.com/csnover/TraceKit)ï¼šTraceKit æ˜¯ä¸€ä¸ªå·²ç»æ¯”è¾ƒå®Œå–„çš„é”™è¯¯æ”¶é›†ã€å †æ ˆæ ¼å¼åŒ–çš„åº“ï¼Œreven.js çš„åŠŸèƒ½åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå¯¹å®ƒæœ‰æ‰€ä¾èµ–ã€‚\n\né™¤æ­¤ä¹‹å¤–ï¼Œraven.js æ”¯æŒæ’ä»¶ï¼Œå®˜æ–¹æä¾›çš„ä¸€äº›çŸ¥ååº“çš„ sentry æ’ä»¶ä¸»è¦æ”¾åœ¨äº† plugin æ–‡ä»¶å¤¹ä¸‹é¢ï¼Œraven.js çš„ä¸€äº›æ ¸å¿ƒæ–‡ä»¶ï¼Œåˆ™æ”¾åœ¨äº† src æ–‡ä»¶å¤¹ä¸‹é¢ã€‚\n\n### raven.js æ˜¯å¦‚ä½•æ”¶é›†é”™è¯¯ä¿¡æ¯çš„ï¼Ÿ\n\næˆ‘ä»¬çŸ¥é“ï¼Œåœ¨å‰ç«¯æ”¶é›†é”™è¯¯ï¼Œè‚¯å®šç¦»ä¸å¼€ `window.onerror` è¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä»è¿™ä¸ªå‡½æ•°è¯´èµ·ã€‚\n\nå®é™…ä¸Šï¼Œè¿™éƒ¨åˆ†å·¥ä½œæ˜¯ raven.js å¼•ç”¨çš„ç¬¬ä¸‰æ–¹åº“ TraceKit å®Œæˆçš„ï¼š\n\n```\nfunction installGlobalHandler() {\n  if (_onErrorHandlerInstalled) { // ä¸€ä¸ªèµ·åˆ°æ ‡å¿—ä½œç”¨çš„å…¨å±€å˜é‡\n    return;\n  }\n  _oldOnerrorHandler = _window.onerror; \n  // _oldOnerrorHandler æ˜¯é˜²æ­¢å¯¹ç”¨æˆ·å…¶ä»–åœ°æ–¹å®šä¹‰çš„å›è°ƒå‡½æ•°è¿›è¡Œè¦†ç›–\n  // è¯¥ _window ç»è¿‡å…¼å®¹ï¼Œå®é™…ä¸Šå°±æ˜¯ window\n  _window.onerror = traceKitWindowOnError;\n  _onErrorHandlerInstalled = true;\n}\n```\n\nç›¸å…³é”™è¯¯å›è°ƒå‡½æ•°äº¤ç»™ traceKitWindowOnError å¤„ç†ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ traceKitWindowOnError å‡½æ•°ï¼Œä¸ºäº†é¿å…å¤ªå¤šå†—ä½™ä»£ç ï¼Œæˆ‘ä»¬ä»…åˆ†æä¸€ç§ä¸»è¦æƒ…å†µï¼š\n\n```\nfunction traceKitWindowOnError(msg, url, lineNo, colNo, ex) {\n\t\n\tvar exception = utils.isErrorEvent(ex) ? ex.error : ex;\n\t//...\n    stack = TraceKit.computeStackTrace(exception);\n    notifyHandlers(stack, true);\n    //...\n   \n    //...\n    if (_oldOnerrorHandler) {\n       return _oldOnerrorHandler.apply(this, arguments);\n    }\n    return false;\n}\n```\n\nå…¶ä¸­è°ƒç”¨çš„æœ€é‡è¦çš„ä¸€ä¸ªå‡½æ•°ï¼Œå°±æ˜¯ computeStackTraceï¼Œè€Œè¿™ä¸ªå‡½æ•°ä¹Ÿæ˜¯ TraceKit çš„æ ¸å¿ƒå‡½æ•°ï¼Œç®€å•æ¥è®²ï¼Œå®ƒåšçš„äº‹æƒ…å°±æ˜¯ç»Ÿä¸€æ ¼å¼åŒ–æŠ¥é”™ä¿¡æ¯è°ƒç”¨æ ˆï¼Œå› ä¸ºå¯¹äºå„ä¸ªæµè§ˆå™¨æ¥è¯´ï¼Œè¿”å›çš„ Error è°ƒç”¨æ ˆä¿¡æ¯æ ¼å¼ä¸å°½ç›¸åŒï¼Œå¦å¤–ç”šè‡³è¿˜æœ‰çš„æµè§ˆå™¨å¹¶ä¸è¿”å›è°ƒç”¨æ ˆï¼ŒcomputeStackTrace å‡½æ•°å¯¹è¿™äº›æƒ…å†µéƒ½åšäº†å…¼å®¹æ€§å¤„ç†ï¼Œå¹¶ä¸”å¯¹äºä¸€äº›ä¸è¿”å›è°ƒç”¨æ ˆçš„æƒ…å†µï¼Œè¿˜ä½¿ç”¨äº† caller æ¥å‘ä¸Šå›æº¯å‡½æ•°çš„è°ƒç”¨æ ˆï¼Œæœ€ç»ˆæŠŠæŠ¥é”™ä¿¡æ¯è½¬åŒ–æˆä¸€ä¸ªé”®ç›¸åŒçš„å¯¹è±¡æ•°ç»„ï¼Œåšåˆ°äº†æŠ¥é”™ä¿¡æ¯æ ¼å¼çš„ç»Ÿä¸€ã€‚\n\nnotifyHandlers å‡½æ•°åˆ™æ˜¯é€šçŸ¥ç›¸å…³çš„å›è°ƒå‡½æ•°ã€‚ å®é™…ä¸Šï¼Œraven.js åœ¨ install å‡½æ•°ä¸­ä¼šè°ƒç”¨ TraceKit.report.subscribe å‡½æ•°ï¼Œå¹¶æŠŠå¯¹é”™è¯¯çš„å¤„ç†é€»è¾‘å†™å…¥å›è°ƒï¼š\n\n```\nfunction subscribe(handler) {\n    installGlobalHandler();\n    handlers.push(handler);\n}\n```\n\nä»¥ä¸Šè¿‡ç¨‹å®Œæˆäº†é”™è¯¯å¤„ç†è¿‡ç¨‹ä¸­çš„è´Ÿè´£è§’è‰²è½¬æ¢ï¼Œå¹¶ä¸”å€ŸåŠ© TraceKitï¼Œå¯ä»¥ä½¿ raven.js å¾—åˆ°ä¸€ä¸ªç»“æ„æ¯”è¾ƒæ¸…æ™°çš„å¸¦æœ‰æ ¼å¼åŒ–å¥½çš„è°ƒç”¨æ ˆä¿¡æ¯çš„é”™è¯¯å†…å®¹å¯¹è±¡ï¼Œä¹‹åï¼Œraven.js å¯¹é”™è¯¯å†…å®¹è¿›ä¸€æ­¥å¤„ç†å¹¶æœ€ç»ˆä¸ŠæŠ¥ã€‚\n\nä¸‹é¢æˆ‘ä»¬å¯¹é”™è¯¯å¤„ç† raven.js æ§åˆ¶çš„éƒ¨åˆ†åšäº†ä¸€äº›æ¢³ç†ï¼š\n\n```\n _handleOnErrorStackInfo: function(stackInfo, options) {\n    options.mechanism = options.mechanism || {\n      type: 'onerror',\n      handled: false\n    };\n    // mechanism å’Œé”™è¯¯ç»Ÿè®¡æ¥æºæœ‰å…³\n\n    if (!this._ignoreOnError) {\n      this._handleStackInfo(stackInfo, options);\n    }\n},\n\n_handleStackInfo: function(stackInfo, options) {\n    var frames = this._prepareFrames(stackInfo, options);\n\n    this._triggerEvent('handle', {\n      stackInfo: stackInfo,\n      options: options\n    });\n\n    this._processException(\n      stackInfo.name,\n      stackInfo.message,\n      stackInfo.url,\n      stackInfo.lineno,\n      frames,\n      options\n    );\n},\n\n_processException: function(type, message, fileurl, lineno, frames, options) {\n    // é¦–å…ˆæ ¹æ® message ä¿¡æ¯åˆ¤æ–­æ˜¯å¦æ˜¯éœ€è¦å¿½ç•¥çš„é”™è¯¯ç±»å‹\n    // ç„¶ååˆ¤æ–­å‡ºé”™çš„æ–‡ä»¶æ˜¯å¦åœ¨é»‘åå•ä¸­æˆ–è€…ç™½åå•ä¸­\n    // æ¥ä¸‹æ¥å¯¹é”™è¯¯å†…å®¹è¿›è¡Œå¿…è¦çš„æ•´åˆä¸è½¬æ¢ï¼Œæ„é€ å‡º data å¯¹è±¡\n    // æœ€åè°ƒç”¨ä¸ŠæŠ¥å‡½æ•°\n    this._send(data);\n}\n\n_send: function(data) {\n\t\n\t// å¯¹ data è¿›ä¸€æ­¥å¤„ç†ï¼Œå¢åŠ å¿…è¦çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬åç»­ä¼šæåˆ°çš„é¢åŒ…å±‘ä¿¡æ¯\n\n\t// äº¤ç”± _sendProcessedPayload è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†\n\tthis._sendProcessedPayload(data);\n}\n\n_sendProcessedPayload: function(data, callback) {\n\n\t// å¯¹ data å¢åŠ ä¸€äº›å¿…è¦çš„å…ƒä¿¡æ¯\n\t// å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ globalOptions.transport çš„æ–¹å¼æ¥è‡ªå®šä¹‰ä¸ŠæŠ¥å‡½æ•° \n\t(globalOptions.transport || this._makeRequest).call(this, {\n\t     url: url,\n\t     auth: auth,\n\t     data: data,\n\t     options: globalOptions,\n\t     onSuccess: function success() {\n\t       \n\t     },\n\t     onError: function failure(error) {\n\t       \n\t     }\n\t});\n}    \n\n// çœŸæ­£å‘èµ·è¯·æ±‚çš„å‡½æ•°\n_makeRequest: function(opts) {\n\t// å¯¹äºæ”¯æŒ fetch çš„æµè§ˆå™¨ï¼Œç›´æ¥ä½¿ç”¨ fetch çš„æ–¹å¼å‘é€ POST è¯·æ±‚\n\t// å¦‚æœæµè§ˆå™¨ä¸æ”¯æŒ fetchï¼Œåˆ™ä½¿ç”¨ XHR çš„ä¼ ç»Ÿæ–¹å¼å‘é€ POST è¯·æ±‚\n}\n``` \n\nå®é™…ä¸Šæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œä»æ‹¿åˆ°å·²ç»åˆæ­¥æ ¼å¼åŒ–çš„æŠ¥é”™ä¿¡æ¯ï¼Œåˆ°æœ€ç»ˆçœŸæ­£æ‰§è¡Œæ•°æ®ä¸ŠæŠ¥ï¼Œraven.js çš„è¿‡ç¨‹éå¸¸æ¼«é•¿ï¼Œè¿™å…¶ä¸­æˆ‘åˆ†ææœ‰å¦‚ä¸‹å‡ ä¸ªåŸå› ï¼š\n\n* æ¯ä¸ªå‡½æ•°åªå¤„ç†ä¸€ä»¶æˆ–è€…ä¸€äº›äº‹æƒ…ï¼Œä¿æŒå‡½æ•°çš„çŸ­å°æ•´æ´ã€‚\n* éƒ¨åˆ†å‡½æ•°å¯ä»¥åšåˆ°å¤ç”¨ï¼ˆå› ä¸ºé™¤äº†è‡ªåŠ¨æ•è·é”™è¯¯çš„æ–¹å¼ï¼Œ raven.js è¿˜æä¾›é€šè¿‡ captureExceptionï¼Œå³ `try {\n    doSomething(a[0])\n} catch(e) {\n    Raven.captureException(e)\n}` çš„æ–¹å¼æ¥ä¸ŠæŠ¥é”™è¯¯ï¼Œä¸¤ä¸ªè¿‡ç¨‹ä¸­æœ‰ä¸€äº›å‡½æ•°çš„è°ƒç”¨æ˜¯æœ‰é‡å çš„ï¼‰ã€‚\n\nä½†æ˜¯ç¬”è€…è®¤ä¸ºï¼Œraven.js çš„ä»£ç è®¾è®¡è¿˜æœ‰å¾ˆå¤šå€¼å¾—ä¼˜åŒ–çš„åœ°æ–¹ï¼Œæ¯”å¦‚ï¼š\n\n* å¯¹æœ€ç»ˆä¸ŠæŠ¥æ•°æ®ï¼ˆdataï¼‰çš„å±æ€§å¤„ç†å’Œå¢åŠ åˆ†æ•£åœ¨å¤šä¸ªå‡½æ•°ï¼Œå¹¶ä¸”æœ‰è¾ƒå¤šå¯é€‰é¡¹ç›®ï¼Œå¾ˆéš¾æ¢³ç†å‡ºä¸€ä¸ªå®Œæ•´çš„ data æ ¼å¼ï¼Œå¹¶ä¸”ä¸ä¾¿äºç»´æŠ¤ã€‚\n* éƒ¨åˆ†å‡½æ•°çš„æ‹†åˆ†å¿…è¦æ€§ä¸è¶³ï¼Œå¹¶ä¸”ä¼šå¢åŠ é“¾è·¯çš„å¤æ‚æ€§ï¼Œæ¯”å¦‚ `_processException `ã€`_sendProcessedPayload `ã€`_makeRequest `ç­‰éƒ½åªåœ¨ä¸€ä¸ªé“¾è·¯ä¸­è¢«è°ƒç”¨ä¸€æ¬¡ã€‚\n* éƒ¨åˆ†å±æ€§é‡å‘½åä¼šé€ æˆèµ„æºæµªè´¹ï¼Œç”±äº TraceKit éƒ¨åˆ†æœ€ç»ˆè¿”å›çš„æ•°æ®æ ¼å¼å¹¶ä¸å®Œå…¨æ»¡è¶³ raven.js çš„éœ€è¦ï¼Œæ‰€ä»¥ raven.js ä¹‹ååˆåœ¨è¾ƒåé˜¶æ®µè¿›è¡Œäº†é‡å‘½åç­‰å¤„ç†ï¼Œå®é™…ä¸Šè¿™äº›å†…å®¹å®Œå…¨å¯ä»¥é€šè¿‡ä¸€äº›å…¶ä»–çš„æ–¹å¼é¿å…ã€‚\n\næœ€åï¼Œéå¸¸é—æ†¾ï¼Œsentry ç›®å‰å®Œå…¨ä¸æ”¯æŒåˆå¹¶ä¸ŠæŠ¥ï¼Œå°±ç®—æ˜¯åœ¨åŒä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼ˆç”šè‡³äº‹ä»¶å¾ªç¯çš„åŒä¸€ä¸ªé˜¶æ®µï¼Œå…³äºäº‹ä»¶å¾ªç¯ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰ç»˜åˆ¶çš„[ä¸€å¼ å›¾](https://www.processon.com/view/link/5b6ec8cbe4b053a09c2fb977)ï¼‰çš„ä¸¤ä¸ªé”™è¯¯ï¼Œsentry éƒ½æ˜¯åˆ†å¼€æ¥ä¸ŠæŠ¥çš„ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªç®€å•ä¾‹å­ï¼š\n\n```javascript\nRaven.config('http://8ec3f1a9f652463bb58191bd0b35f20c@localhost:9000/2').install()\nlet s = window.ss;\n\ntry{\n    let b = s.b\n} catch (e) {\n    Raven.captureException(e)\n    // sentry should report error now\n}\n\ns.nomethod();\n// sentry should report error now\n```\n\nä»¥ä¸Šä¾‹å­ä¸­ï¼Œsentry ä¼šå‘é€ä¸¤ä¸ª POST è¯·æ±‚ã€‚\n\n### raven.js æœ€ç»ˆä¸ŠæŠ¥æ•°æ®çš„æ ¼å¼\n\n\nè¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šè¯¦ç»†åœ°åˆ†æ raven.js ä¸ŠæŠ¥çš„æ•°æ®çš„æ¯ä¸€é¡¹å†…å®¹ï¼Œä»…ä¼šç»™è¯»è€…å±•ç¤ºä¸€ä¸ªæ¯”è¾ƒå…¸å‹çš„æƒ…å†µã€‚\n\næˆ‘ä»¬çœ‹ä¸€ä¸‹å¯¹äºä¸€ä¸ªä¸€èˆ¬çš„ js é”™è¯¯ï¼Œraven.js ä¸ŠæŠ¥çš„ json ä¸­åŒ…å«å“ªäº›å†…å®¹ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå·²ç»åˆ æ‰ä¸€äº›å†—ä½™å†…å®¹çš„å…¸å‹ä¸ŠæŠ¥ä¿¡æ¯ï¼š\n\n```\n{\n  \"project\": \"2\",\n  \"logger\": \"javascript\",\n  \"platform\": \"javascript\",\n  \"request\": {\n    \"headers\": {\n      \"User-Agent\": \"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1\"\n    },\n    \"url\": \"http://localhost:63342/sentry-test1/test1.html?_ijt=j54dmgn136gom08n8v8v9fdddu\"\n  },\n  \"exception\": {\n    \"values\": [\n      {\n        \"type\": \"TypeError\",\n        \"value\": \"Cannot read property 'b' of undefined\",\n        \"stacktrace\": {\n          \"frames\": [\n            {\n              \"filename\": \"http://localhost:63342/sentry-test1/test1.html?_ijt=j54dmgn136gom08n8v8v9fdddu\",\n              \"lineno\": 19,\n              \"colno\": 19,\n              \"function\": \"?\",\n              \"in_app\": true\n            }\n          ]\n        }\n      }\n    ],\n    \"mechanism\": {\n      \"type\": \"generic\",\n      \"handled\": true\n    }\n  },\n  \"transaction\": \"http://localhost:63342/sentry-test1/test1.html?_ijt=j54dmgn136gom08n8v8v9fdddu\",\n  \"extra\": {\n    \"session:duration\": 6\n  },\n  \"breadcrumbs\": {\n    \"values\": [\n      {\n        \"timestamp\": 1534257309.996,\n        \"message\": \"_prepareFrames stackInfo: [object Object]\",\n        \"level\": \"log\",\n        \"category\": \"console\"\n      },\n      // ...\n   ]\n  },\n  \"event_id\": \"ea0334adaf9d43b78e72da2b10e084a9\",\n  \"trimHeadFrames\": 0\n}\n```\n\nå…¶ä¸­æ”¯æŒçš„ä¿¡æ¯ç±»å‹é‡ç‚¹åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š\n\n* sentry åŸºæœ¬é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬åº“æœ¬èº«çš„é…ç½®å’Œä½¿ç”¨è€…çš„é…ç½®ä¿¡æ¯ï¼Œä»¥åŠç”¨æˆ·çš„ä¸€äº›è‡ªå®šä¹‰ä¿¡æ¯\n* é”™è¯¯ä¿¡æ¯ï¼Œä¸»è¦åŒ…æ‹¬é”™è¯¯è°ƒç”¨æ ˆä¿¡æ¯\n* request ä¿¡æ¯ï¼Œä¸»è¦åŒ…æ‹¬æµè§ˆå™¨çš„ User-Agentã€å½“å‰è¯·æ±‚åœ°å€ç­‰\n* é¢åŒ…å±‘ä¿¡æ¯ï¼Œå…³äºé¢åŒ…å±‘å…·ä½“æŒ‡çš„æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬ä¼šåœ¨ä¸‹ä¸€ç¯èŠ‚è¿›è¡Œä»‹ç»\n\n### raven.js é¢åŒ…å±‘æ”¶é›†\n\né¢åŒ…å±‘ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯é”™è¯¯åœ¨å‘ç”Ÿä¹‹å‰ï¼Œä¸€äº›ç”¨æˆ·ã€æµè§ˆå™¨çš„è¡Œä¸ºä¿¡æ¯ï¼Œraven.js å®ç°äº†ä¸€ä¸ªç®€å•çš„é˜Ÿåˆ—ï¼ˆæœ‰ä¸€ä¸ªæœ€å¤§æ¡ç›®é•¿åº¦ï¼Œé»˜è®¤ä¸º 100ï¼‰ï¼Œè¿™ä¸ªé˜Ÿåˆ—åœ¨æ—¶åˆ»è®°å½•ç€è¿™äº›ä¿¡æ¯ï¼Œä¸€æ—¦é”™è¯¯å‘ç”Ÿå¹¶ä¸”éœ€è¦ä¸ŠæŠ¥ï¼Œraven.js å°±æŠŠè¿™ä¸ªé˜Ÿåˆ—çš„ä¿¡æ¯å†…å®¹ï¼Œä½œä¸ºé¢åŒ…å±‘ breadcrumbsï¼Œå‘å›å®¢æˆ·ç«¯ã€‚\n\né¢åŒ…å±‘ä¿¡æ¯ä¸»è¦åŒ…æ‹¬è¿™å‡ ç±»ï¼š\n\n* ç”¨æˆ·å¯¹æŸä¸ªå…ƒç´ çš„ç‚¹å‡»æˆ–è€…ç”¨æˆ·å¯¹æŸä¸ªå¯è¾“å…¥å…ƒç´ çš„è¾“å…¥\n* å‘é€çš„ http è¯·æ±‚\n* console æ‰“å°çš„ä¿¡æ¯ï¼ˆæ”¯æŒé…ç½® 'debug', 'info', 'warn', 'error', 'log' ç­‰ä¸åŒçº§åˆ«ï¼‰\n* window.location å˜åŒ–ä¿¡æ¯\n\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯¹è¿™å‡ ç±»é¢åŒ…å±‘ä¿¡æ¯ sentry çš„è®°å½•å®ç°è¿›è¡Œç®€å•çš„åˆ†æã€‚\n\nå®é™…ä¸Šï¼Œsentry å¯¹è¿™äº›ä¿¡æ¯è®°å½•çš„æ–¹å¼æ¯”è¾ƒä¸€è‡´ï¼Œéƒ½æ˜¯é€šè¿‡å¯¹åŸå£°çš„å‡½æ•°è¿›è¡ŒåŒ…è£…ï¼Œå¹¶ä¸”åœ¨åŒ…è£…å¥½çš„å‡½æ•°ä¸­å¢åŠ è‡ªå·±çš„é’©å­å‡½æ•°ï¼Œæ¥å®ç°è§¦å‘æ—¶å€™çš„äº‹ä»¶è®°å½•ï¼Œå®é™…ä¸Šï¼Œsentry æ€»å…±åŒ…è£…çš„å‡½æ•°æœ‰ï¼š\n\n* window.setTimeout\n* window.setInterval\n* window.requestAnimationFrame\n* EventTarget.addEventListener\n* EventTarget.removeEventListener\n* XMLHTTPRequest.open\n* XMLHTTPRequest.send\n* window.fetch\n* History.pushState\n* History.replaceState\n\n>å¤‡æ³¨ï¼šè¿™é‡ŒåŒ…è£…çš„æ‰€æœ‰å‡½æ•°ï¼Œå…¶ä¸­æœ‰ä¸€éƒ¨åˆ†åªæ˜¯ä½¿ raven.js å…·æœ‰æ•è·å›è°ƒå‡½æ•°ä¸­é”™è¯¯çš„èƒ½åŠ›ï¼ˆå¯¹å›è°ƒå‡½æ•°è¿›è¡ŒåŒ…è£…ï¼‰\n\næ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€æ®µå…¸å‹çš„ä»£ç ï¼Œæ¥åˆ†æ raven.js æ˜¯å¦‚ä½•è®°å½•ç”¨æˆ·çš„ç‚¹å‡»å’Œè¾“å…¥ä¿¡æ¯çš„ï¼ˆé€šè¿‡å¯¹ EventTarget.addEventListener è¿›è¡Œå°è£…ï¼‰ï¼š\n\n```javascript\nfunction wrapEventTarget(global) {\n      var proto = _window[global] && _window[global].prototype;\n      if (proto && proto.hasOwnProperty && proto.hasOwnProperty('addEventListener')) {\n        fill(\n          proto,\n          'addEventListener',\n          function(orig) {\n            return function(evtName, fn, capture, secure) {\n              try {\n                if (fn && fn.handleEvent) { //å…¼å®¹é€šè¿‡ handleEvent çš„æ–¹å¼è¿›è¡Œç»‘å®šäº‹ä»¶\n                  fn.handleEvent = self.wrap(\n                    {\n                      mechanism: {\n                        type: 'instrument',\n                        data: {\n                          target: global,\n                          function: 'handleEvent',\n                          handler: (fn && fn.name) || '<anonymous>'\n                        }\n                      }\n                    },\n                    fn.handleEvent\n                  );\n                }\n              } catch (err) {\n              }\n\n              var before, clickHandler, keypressHandler;\n\n              if (\n                autoBreadcrumbs &&\n                autoBreadcrumbs.dom &&\n                (global === 'EventTarget' || global === 'Node')\n              ) {\n                // NOTE: generating multiple handlers per addEventListener invocation, should\n                //       revisit and verify we can just use one (almost certainly)\n                clickHandler = self._breadcrumbEventHandler('click');\n                keypressHandler = self._keypressEventHandler();\n                before = function(evt) { // é’©å­å‡½æ•°ï¼Œç”¨äºåœ¨å›è°ƒå‡½æ•°è°ƒç”¨çš„æ—¶å€™è®°å½•ä¿¡æ¯\n                  if (!evt) return;\n\n                  var eventType;\n                  try {\n                    eventType = evt.type;\n                  } catch (e) {\n                    // just accessing event properties can throw an exception in some rare circumstances\n                    // see: https://github.com/getsentry/raven-js/issues/838\n                    return;\n                  }\n                  if (eventType === 'click') return clickHandler(evt);\n                  else if (eventType === 'keypress') return keypressHandler(evt);\n                };\n              }\n              return orig.call(\n                this,\n                evtName,\n                self.wrap(\n                  {\n                    mechanism: {\n                      type: 'instrument',\n                      data: {\n                        target: global,\n                        function: 'addEventListener',\n                        handler: (fn && fn.name) || '<anonymous>'\n                      }\n                    }\n                  },\n                  fn,\n                  before\n                ),\n                capture,\n                secure\n              );\n            };\n          },\n          wrappedBuiltIns\n        );\n        fill(\n          proto,\n          'removeEventListener',\n          function(orig) {\n            return function(evt, fn, capture, secure) {\n              try {\n                fn = fn && (fn.__raven_wrapper__ ? fn.__raven_wrapper__ : fn);\n              } catch (e) {\n                // ignore, accessing __raven_wrapper__ will throw in some Selenium environments\n              }\n              return orig.call(this, evt, fn, capture, secure);\n            };\n          },\n          wrappedBuiltIns\n        );\n      }\n    }\n```\n\nä»¥ä¸Šä»£ç å…¼å®¹äº†é€šè¿‡ handleEvent çš„æ–¹å¼è¿›è¡Œç»‘å®šäº‹ä»¶ï¼ˆå¦‚æœæ²¡æœ‰å¬è¯´è¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥åœ¨[è¿™é‡Œ](http://www.ayqy.net/blog/handleevent%E4%B8%8Eaddeventlistener/)è¡¥å……ä¸€äº›ç›¸å…³çš„çŸ¥è¯†ï¼‰ã€‚\n\né»˜è®¤æƒ…å†µä¸‹ï¼Œraven.js åªè®°å½•é€šè¿‡ `EventTarget.addEventListener` ç»‘å®šçš„ç‚¹å‡»å’Œè¾“å…¥ä¿¡æ¯ï¼Œå®é™…ä¸Šè¿™æ˜¯æ¯”è¾ƒç§‘å­¦çš„ï¼Œå¹¶ä¸”è¿™äº›ä¿¡æ¯è¾ƒä¸ºæœ‰æ•ˆã€‚å¦å¤–ï¼Œraven.js ä¹Ÿæä¾›äº†è®°å½•æ‰€æœ‰ç‚¹å‡»å’Œè¾“å…¥ä¿¡æ¯çš„å¯é€‰é¡¹ï¼Œå…¶å®ç°æ–¹å¼æ›´ä¸ºç®€å•ï¼Œç›´æ¥åœ¨ document ä¸Šæ·»åŠ ç›¸å…³çš„ç›‘å¬å³å¯ã€‚\n\n### raven.js å¦‚ä½•å’Œæ¡†æ¶é…åˆä½¿ç”¨\n\nraven.js å’Œæ¡†æ¶é…åˆä½¿ç”¨çš„æ–¹å¼éå¸¸ç®€å•ï¼Œä½†æ˜¯æˆ‘ä»¬è¦çŸ¥é“ï¼Œå¾ˆå¤šæ¡†æ¶å†…ç½®äº†é”™è¯¯è¾¹ç•Œå¤„ç†ï¼Œæˆ–è€…å¯¹é”™è¯¯è¿›è¡Œè½¬ä¹‰ã€‚ä»¥è‡³äºæˆ‘ä»¬é€šè¿‡ window.onerror çš„æ–¹å¼å¾—ä¸åˆ°å®Œæ•´çš„é”™è¯¯ä¿¡æ¯ã€‚åŒæ—¶ï¼Œæœ‰äº›æ¡†æ¶æä¾›äº†é”™è¯¯å¤„ç†çš„æ¥å£ï¼ˆæ¯”å¦‚ vueï¼‰ï¼Œåˆ©ç”¨é”™è¯¯å¤„ç†çš„æ¥å£ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè·å–åˆ°å’Œé”™è¯¯æœ‰å…³çš„æ›´å¤šæ›´é‡è¦çš„ä¿¡æ¯ã€‚\n\nraven.js åˆ©ç”¨å„ä¸ªæ¡†æ¶çš„å®˜æ–¹æ¥å£ï¼Œæä¾›äº† vueã€require.jsã€angularã€emberã€react-native ç­‰å„ä¸ªæ¡†æ¶çš„å®˜æ–¹æ’ä»¶ã€‚\n\næ’ä»¶å†…å®¹æœ¬èº«éå¸¸ç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ vue æ’ä»¶çš„ä»£ç ï¼š\n\n```\nfunction formatComponentName(vm) {\n  if (vm.$root === vm) {\n    return 'root instance';\n  }\n  var name = vm._isVue ? vm.$options.name || vm.$options._componentTag : vm.name;\n  return (\n    (name ? 'component <' + name + '>' : 'anonymous component') +\n    (vm._isVue && vm.$options.__file ? ' at ' + vm.$options.__file : '')\n  );\n}\n\nfunction vuePlugin(Raven, Vue) {\n  Vue = Vue || window.Vue;\n\n  // quit if Vue isn't on the page\n  if (!Vue || !Vue.config) return;\n\n  var _oldOnError = Vue.config.errorHandler;\n  Vue.config.errorHandler = function VueErrorHandler(error, vm, info) {\n    var metaData = {};\n\n    // vm and lifecycleHook are not always available\n    if (Object.prototype.toString.call(vm) === '[object Object]') {\n      metaData.componentName = formatComponentName(vm);\n      metaData.propsData = vm.$options.propsData;\n    }\n\n    if (typeof info !== 'undefined') {\n      metaData.lifecycleHook = info;\n    }\n\n    Raven.captureException(error, {\n      extra: metaData\n    });\n\n    if (typeof _oldOnError === 'function') {\n      _oldOnError.call(this, error, vm, info);\n    }\n  };\n}\n\nmodule.exports = vuePlugin;\n```\n\nåº”è¯¥ä¸ç”¨è¿›è¡Œè¿‡å¤šè§£é‡Šã€‚\n\nä½ ä¹Ÿè®¸æƒ³çŸ¥é“ä¸ºä»€ä¹ˆæ²¡æœ‰æä¾› react æ’ä»¶ï¼Œäº‹å®ä¸Šï¼Œreact 16 ä»¥åæ‰å¼•å…¥äº†[Error Boundaries](https://reactjs.org/blog/2017/07/26/error-handling-in-react-16.html)ï¼Œè¿™ç§æ–¹å¼ç”±äºçµæ´»æ€§å¤ªå¼ºï¼Œå¹¶ä¸å¤ªé€‚åˆä½¿ç”¨æ’ä»¶ï¼Œå¦å¤–ï¼Œå°±ç®—ä¸ä½¿ç”¨æ’ä»¶ï¼Œä¹Ÿéå¸¸æ–¹ä¾¿åœ°ä½¿ç”¨ raven.js è¿›è¡Œé”™è¯¯ä¸ŠæŠ¥ï¼Œå¯ä»¥å‚è€ƒ[è¿™é‡Œ](https://docs.sentry.io/clients/javascript/integrations/react/)\n\n>ä½†ç¬”è€…è®¤ä¸ºï¼Œç›®å‰ react çš„å¼•å…¥æ–¹å¼ä¼šå¯¹æºä»£ç è¿›è¡Œä¾µå…¥ï¼Œå¹¶ä¸”æ¯”è¾ƒéš¾é€šè¿‡æ„å»ºçš„æ–¹å¼è¿›è¡Œ sentry çš„é…ç½®ï¼Œä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥å¯»æ‰¾æ›´å¥½çš„æ–¹å¼ã€‚\n\nå®Œã€‚\n\n","tags":["javascript","å‰ç«¯ç›‘æ§"]},{"title":"ä¸€ç¯‡å…³äºreactå†å²çš„æµæ°´è´¦","url":"/2018/06/10/ä¸€ç¯‡å…³äºreactå†å²çš„æµæ°´è´¦/","content":"\nreact ç›®å‰å·²ç»æ›´æ–°åˆ° V16.3ï¼Œå…¶ä¸€è·¯èµ°æ¥ï¼Œæ—¥è‡»å®Œå–„ï¼Œç¬”è€…æ¥è§¦ react ä¸¤å¹´æœ‰ä½™ï¼Œåœ¨è¿™é‡Œåšä¸€ä¸ªé˜¶æ®µæ€§çš„æ•´ç†ï¼Œä¹Ÿå¯¹ react çš„å‘å±•å’Œæˆ‘å¯¹ react çš„å­¦ä¹ åšä¸€ä¸ªæ•´ä½“è®°å½•ã€‚\n\nç¬”è€…æ˜¯åœ¨ 16 å¹´åˆå¼€å§‹å…³æ³¨ reactï¼Œè€Œå®é™…ä¸Šé‚£ä¸ªæ—¶å€™ react å·²ç»å‘å¸ƒå¿«ä¸‰å¹´äº†ï¼Œ 16 å¹´åˆçš„æˆ‘å†™é¡µé¢è¿˜æ˜¯ä¸»è¦ä½¿ç”¨ backbone.jsã€Jqueryï¼Œå¹¶ä¸”è®¤ä¸ºï¼Œç›¸æ¯”äºçº¯ç²¹ä½¿ç”¨ Jquery çš„â€œåˆ€è€•ç«ç§â€çš„æ—¶ä»£ï¼Œä½¿ç”¨ backbone.js å·²ç»è¶³å¤Ÿæ–¹ä¾¿å¹¶ä¸”ä¸éœ€è¦æ›¿ä»£å“äº†ã€‚\n\nè¿™ç¯‡æ–‡ç« ä¼šä» react å¼€æºä¹‹åˆè¿›è¡Œè®²èµ·ï¼Œç›´åˆ° 2018 å¹´å…­æœˆã€‚\n\n### ä¸ºä»€ä¹ˆæ˜¯ react\n\næˆ‘ä»¬çŸ¥é“ï¼Œreact å¹¶ä¸æ˜¯ä¸€ä¸ª MVC æ¡†æ¶ï¼Œä¹Ÿå¹¶æ²¡æœ‰ä½¿ç”¨ä¼ ç»Ÿçš„å‰ç«¯æ¨¡ç‰ˆï¼Œè€Œæ˜¯é‡‡ç”¨äº†çº¯ JS ç¼–å†™ï¼ˆå®é™…ä¸Šç”¨åˆ°äº† JSX ï¼‰ï¼Œä½¿ç”¨äº†è™šæ‹Ÿ DOMï¼Œä½¿ç”¨ diff æ¥ä¿è¯ DOM çš„æ›´æ–°æ•ˆç‡ï¼Œå¹¶ä¸”å¯ä»¥ç»“åˆ facebook çš„ Flux æ¶æ„ï¼Œè§£å†³ä¼ ç»Ÿ MVC æ¨¡å¼çš„ä¸€äº›ç—›ç‚¹ã€‚\n\nåœ¨ react å¼€æºä¹‹åˆï¼Œç›¸å…³ç”Ÿæ€ä½“ç³»å¹¶ä¸å®Œå–„ï¼Œç”šè‡³å®˜æ–¹è¿˜åœ¨ç”¨`Backbone.Router`åŠ  react æ¥å¼€å‘å•é¡µé¢åº”ç”¨ã€‚\n\nä½†æ˜¯é‚£ä¸ªæ—¶å€™çš„ reactï¼Œå’Œç°åœ¨çš„ reactï¼Œè§£å†³çš„æ ¸å¿ƒé—®é¢˜éƒ½æ²¡æœ‰å˜åŒ–ï¼Œé‚£å°±æ˜¯**å¤æ‚çš„UIæ¸²æŸ“é—®é¢˜ï¼ˆ complex UI rendering ï¼‰**ï¼Œæ‰€æœ‰çš„å®ƒçš„ç»„ä»¶åŒ–ï¼Œè™šæ‹Ÿ DOM å’Œ diff ç®—æ³•ï¼Œç”šè‡³ç›®å‰æå‡ºçš„ Fiberã€async renderingç­‰ç­‰ï¼Œéƒ½æ˜¯å›´ç»•è¿™ä¸ªä¸­å¿ƒã€‚\n\n### FLUX\n\nåœ¨ 2014 å¹´äº”æœˆå·¦å³ï¼Œä¹Ÿå°±æ˜¯è·ç¦» react å¼€æºæ¥è¿‘ä¸€å¹´æ—¶é—´ï¼Œreact å…¬å¼€äº† FLUX æ¶æ„ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ç°åœ¨åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œç”šè‡³éƒ½å¾ˆéš¾å¬åˆ° FLUX è¿™ä¸ªè¯æ±‡äº†ï¼Œæ›´å¤šçš„åˆ™æ˜¯ redux ç”šè‡³ dva ç­‰æ›´ä¸Šå±‚çš„æ¡†æ¶ï¼Œä½†æ˜¯ç›®å‰ç»å¤§å¤šæ•° react ç›¸å…³çš„æ•°æ®ç®¡ç†æ¡†æ¶éƒ½å—åˆ°äº† FLUX å¾ˆå¤§å¯å‘ã€‚\n\nFLUX å’ŒåŒå‘æ•°æ®ç»‘å®šçš„å…³ç³»ï¼Œæˆ‘è®¤ä¸ºè¿™é‡Œæœ‰å¿…è¦æ´å¼•å½“åˆå®˜æ–¹å†™çš„ä¸€ç‚¹è§£é‡Šï¼ˆæ›´è¯¦ç»†çš„ä¸€äº›ä¿¡æ¯ï¼Œå¯ä»¥çœ‹[è¿™ç¯‡æ–‡ç« ](https://www.10000h.top/react_flux.pdf)ï¼‰ï¼š\n\n```\nTo summarize, Flux works well for us because the single directional data flow makes it easy to understand and modify an application as it becomes more complicated. We found that two-way data bindings lead to cascading updates, where changing one data model led to another data model updating, making it very difficult to predict what would change as the result of a single user interaction.\n\næ€»è€Œè¨€ä¹‹ï¼ŒFluxå¯¹æˆ‘ä»¬æ¥è¯´æ•ˆæœå¾ˆå¥½ï¼Œå› ä¸ºå•å‘æ•°æ®æµå¯ä»¥è®©åº”ç”¨ç¨‹åºå˜å¾—æ›´åŠ å¤æ‚ï¼Œä»è€Œè½»æ¾ç†è§£å’Œä¿®æ”¹åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬å‘ç°åŒå‘æ•°æ®ç»‘å®šå¯¼è‡´çº§è”æ›´æ–°ï¼Œå…¶ä¸­æ›´æ”¹ä¸€ä¸ªæ•°æ®æ¨¡å‹å¯¼è‡´å¦ä¸€ä¸ªæ•°æ®æ¨¡å‹æ›´æ–°ï¼Œä½¿å¾—å¾ˆéš¾é¢„æµ‹å•ä¸ªç”¨æˆ·äº¤äº’çš„ç»“æœä¼šå‘ç”Ÿä»€ä¹ˆå˜åŒ–ã€‚\n```\n\nä»æ­¤ä¹‹åï¼Œä¸‹é¢è¿™å¼ å›¾ä¾¿å¤šæ¬¡å‡ºç°åœ¨å®˜æ–¹åšå®¢å’Œå„ä¸ªç½‘ç«™ä¸­ï¼Œç›¸ä¿¡æˆ‘ä»¬ä¹Ÿè‚¯å®šè§è¿‡ä¸‹å›¾ï¼š\n\n![](https://www.10000h.top/images/flux.png)\n\n### react-router\n\n2014å¹´8æœˆï¼Œreact-router çš„é›å½¢å‘å¸ƒï¼Œåœ¨å…¶å‘å¸ƒä¹‹å‰ï¼Œä¸å°‘ç¤ºä¾‹åº”ç”¨è¿˜åœ¨ä½¿ç”¨ backbone\n.js çš„ routerï¼Œè€Œ react-router çš„å‘å¸ƒï¼Œæ ‡å¿—ç€ react ç”Ÿæ€çš„è¿›ä¸€æ­¥æˆç†Ÿã€‚\n\n### react ES6 Class\n\nå®é™…ä¸Šï¼Œåœ¨ 2015.01.27 ä¹‹å‰ï¼Œæˆ‘ä»¬éƒ½æ˜¯åœ¨ä½¿ç”¨ `React.createClass`æ¥ä¹¦å†™ç»„ä»¶ã€‚\n\nè€Œåœ¨ 2015.01.27 è¿™ä¸€å¤©ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€å±Š `reactjs conf` çš„å‰ä¸€å¤©ï¼Œreact å®˜æ–¹å‘å¸ƒäº† React V0.13.0 beta ç‰ˆæœ¬ã€‚è¿™ä¸€ä¸ªç‰ˆæœ¬çš„æœ€å¤§æ›´æ–°å°±æ˜¯æ”¯æŒ ES6 çš„ Class å†™æ³•æ¥ä¹¦å†™ç»„ä»¶ï¼ŒåŒæ—¶ä¹Ÿå…¬å¸ƒäº†æ¯”å¦‚ propTypes ç±»å‹æ£€æŸ¥ã€defaultPropsã€AutoBindã€ref ç­‰ä¸€ç³»åˆ—ç›¸å…³å·¥ä½œåœ¨ ES6 Class æ¨¡å¼ä¸‹çš„å†™æ³•ã€‚\n\nè¿™æ¬¡å‘å¸ƒæ˜¯ react å¼€æºè‡³æ­¤æœ€ä¸ºé‡å¤§çš„ä¸€æ¬¡æ›´æ–°ï¼Œä¹Ÿå› æ­¤ç›´æ¥å°† react çš„å†™æ³•è¿›è¡Œäº†é©æ–°ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œè¿™æ ‡å¿—ç€ react ä»åˆ€è€•ç«ç§çš„åŸå§‹æ—¶ä»£è¿›å…¥äº†çŸ³å™¨æ—¶ä»£ã€‚\n\n*å®é™…ä¸Šï¼Œç›´åˆ°ä¸€ä¸ªåŠæœˆåçš„ 03.10 ï¼ŒV0.13 çš„æ­£å¼ç‰ˆæœ¬æ‰å‘å¸ƒã€‚*\n\nè€Œåœ¨ä¹‹åçš„ V15.5 ç‰ˆæœ¬ï¼ˆ2017å¹´4æœˆå‘å¸ƒï¼‰ï¼Œreact æ‰å°†`React.createClass`çš„ä½¿ç”¨è®¾ç½®ä¸º Deprecationï¼Œå¹¶ä¸”å®£å¸ƒä¼šåœ¨å°†æ¥ç§»é™¤è¯¥ APIï¼Œä¸æ­¤åŒæ—¶ï¼Œreact å›¢é˜Ÿä»ç„¶æä¾›äº†ä¸€ä¸ªå•ç‹¬çš„åº“`create-react-class` æ¥æ”¯æŒåŸæ¥çš„ `React.createClass` åŠŸèƒ½ã€‚\n\n### Relay & GraphQL\n\nåœ¨ 2015 å¹´çš„ 2æœˆï¼ŒFacebook å…¬å¸ƒäº† GraphQLï¼ŒGraphQL æ˜¯ä¸€ç§æ–°çš„æ•°æ®æŸ¥è¯¢è§£å†³æ–¹æ¡ˆï¼Œäº‹å®è¯æ˜ï¼Œå®ƒæ˜¯éå¸¸ä¼˜ç§€çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œåˆ°ç°åœ¨å·²ç»åŸºæœ¬åœ¨è¡Œä¸šå†…äººå°½çš†çŸ¥ã€‚\n\nè€Œ Relay åˆ™æ˜¯é“¾æ¥ react å’Œ GraphQL çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæœ‰ç‚¹ç±»ä¼¼ reduxï¼ˆä½†æ˜¯ stat æ•°åªæœ‰ redux çš„å››åˆ†ä¹‹ä¸€å·¦å³ï¼‰ï¼Œä½†æ˜¯å¯¹ GraphQL æ›´ä¸ºå‹å¥½ï¼Œå¹¶ä¸”åœ¨ç¼“å­˜æœºåˆ¶çš„è®¾è®¡ï¼ˆæŒ‰ç…§ Graph æ¥ cacheï¼‰ã€å£°æ˜å¼çš„æ•°æ®è·å–ç­‰æ–¹é¢ï¼Œæœ‰ä¸€äº›è‡ªå·±çš„ç‹¬åˆ°ä¹‹å¤„ã€‚\n\nå½“ç„¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ redux é…åˆç›¸å…³æ’ä»¶ï¼Œä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ Relayã€‚\n\n\n### React Native\n\nåœ¨ç¬¬ä¸€å±Š React.js Conf ä¸­ï¼Œreact å›¢é˜Ÿé¦–æ¬¡å…¬å¼€äº† React Nativeï¼Œå¹¶ä¸”åœ¨3æœˆä»½çœŸæ­£å¼€æºäº† React Nativeï¼ˆå®é™…ä¸Šè¿™ä¸ªæ—¶å€™å®‰å“ç‰ˆæœ¬è¿˜å¹¶ä¸å¯ç”¨ï¼‰ï¼Œä¹‹ååœ¨2015å¹´ä¸ŠåŠå¹´ï¼Œç›¸å…³å›¢é˜Ÿé™†é™†ç»­ç»­æŠ«éœ²äº†å…³äº React Native å‘å±•æƒ…å†µçš„æ›´å¤šä¿¡æ¯ã€‚\n\nå¹¶ä¸”ä¹Ÿæ˜¯åœ¨è¿™ä¸ªæ—¶å€™ï¼ˆ2015å¹´3æœˆï¼‰ï¼Œreact å›¢é˜Ÿå¼€å§‹ä½¿ç”¨ **learn once, write anywhere** è¿™ä¸ªå¦‚ä»Šæˆ‘ä»¬è€³ç†Ÿèƒ½è¯¦çš„å£å·ã€‚\n\n### react & react-dom & babel\n\nåœ¨2015å¹´ä¸ƒæœˆï¼Œå®˜æ–¹å‘å¸ƒäº†React v0.14 Beta 1ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå˜åŠ¨æ¯”è¾ƒå¤§çš„ç‰ˆæœ¬ï¼Œåœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œä¸»è¦æœ‰å¦‚ä¸‹æ¯”è¾ƒå¤§çš„å˜åŒ–:\n\n* å®˜æ–¹å®£å¸ƒåºŸå¼ƒ react-tools å’Œ JSTransformï¼Œè¿™æ˜¯å’Œ JSX è§£æç›¸å…³çš„åº“ï¼Œè€Œä»æ­¤ react å¼€å§‹ä½¿ç”¨ babelï¼Œæˆ‘è®¤ä¸ºè¿™å¯¹ react ä»¥åŠå…¶ä½¿ç”¨è€…æ¥è¯´æ— ç–‘æ˜¯ä¸€ä¸ªåˆ©å¥½ã€‚\n* åˆ†ç¦» react å’Œ react-domï¼Œç”±äº React Native å·²ç»è¿­ä»£äº†ä¸€æ®µæ—¶é—´ï¼Œè¿™ä¸ªåˆ†ç¦»åŒæ—¶ä¹Ÿæ„å‘³ç€ react ä¹‹åçš„å‘å±•æ–¹å‘ï¼Œreact æœ¬èº«å°†ä¼šå…³æ³¨æŠ½è±¡å±‚å’Œç»„ä»¶æœ¬èº«ï¼Œè€Œ react-dom å¯ä»¥å°†å…¶åœ¨æµè§ˆå™¨ä¸­è½åœ°ï¼ŒReact Native å¯ä»¥å°†å…¶åœ¨å®¢æˆ·ç«¯ä¸­è½åœ°ï¼Œä¹‹åä¹Ÿè®¸è¿˜ä¼šæœ‰ react-xxx ...\n\nå°† react å’Œ react-dom åˆ†ç¦»ä¹‹åï¼Œreact å›¢é˜Ÿåˆå¯¹ react-dom åœ¨ dom æ–¹é¢åšäº†è¾ƒä¸ºå¤§é‡çš„æ›´æ–°ã€‚\n\n### Discontinuing IE 8 Support\n\nåœ¨ react V15 çš„ç‰ˆæœ¬ä¸­ï¼Œæ”¾å¼ƒäº†å¯¹ IE 8 çš„æ”¯æŒã€‚\n\n\n### Fiber\n\nreact å›¢é˜Ÿä½¿ç”¨ Fiber æ¶æ„å®Œæˆäº† react V16 çš„å¼€å‘ï¼Œå¾—ç›Šäº Fiber æ¶æ„ï¼Œreact çš„æ€§èƒ½åˆå¾—åˆ°äº†æ˜¾è‘—æå‡ï¼ˆå°¤å…¶æ˜¯åœ¨æŸäº›è¦æ±‚äº¤äº’è¿ç»­çš„åœºæ™¯ä¸‹ï¼‰ï¼Œå¹¶ä¸”åŒ…å¤§å°ç¼©å°äº† 32%ã€‚\n\nåˆ°ç›®å‰æ¥è¯´ï¼Œå…³äº Fiber æ¶æ„çš„ä¸­è‹±æ–‡èµ„æ–™éƒ½å·²ç»ç›¸å½“ä¸°å¯Œï¼Œç¬”è€…åœ¨è¿™é‡Œå°±ä¸è¿›è¡Œè¿‡å¤šçš„èµ˜è¿°äº†ã€‚\n\n### æ¥ä¸‹æ¥çš„å±•æœ›\n\nreact å›¢é˜Ÿç›®å‰çš„ä¸»è¦å·¥ä½œé›†ä¸­åœ¨ async rendering æ–¹é¢ï¼Œè¿™æ–¹é¢çš„æ”¹è¿›å¯ä»¥æå¤§æå‡ç”¨æˆ·äº¤äº’ä½“éªŒï¼ˆç‰¹åˆ«æ˜¯åœ¨å¼±ç½‘ç»œç¯å¢ƒä¸‹ï¼‰ï¼Œä¼šåœ¨ 2018 å¹´å‘å¸ƒã€‚\n\nå¦‚æœä½ å¯¹è¿™æ–¹é¢çš„å†…å®¹å¾ˆæ„Ÿå…´è¶£ï¼Œä¸å¦¨çœ‹çœ‹ react ä¹‹å‰çš„[æ¼”è®²è§†é¢‘](https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html)\n\n### é™„å½•1 ä¸€äº›ä½ å¯èƒ½ä¸çŸ¥é“çš„å˜åŒ–\n\n* reactå¹¶éç›´æ¥å°† JSX æ¸²æŸ“æˆ DOMï¼Œè€Œæ˜¯å¯¹æŸäº›äº‹ä»¶å’Œå±æ€§åšäº†å°è£…ï¼ˆä¼˜åŒ–ï¼‰ã€‚ react å¯¹è¡¨å•ç±»å‹çš„ DOM è¿›è¡Œäº†ä¼˜åŒ–ï¼Œæ¯”å¦‚å°è£…äº†è¾ƒä¸ºé€šç”¨çš„ onChange å›è°ƒå‡½æ•°ï¼Œè¿™å…¶ä¸­éœ€è¦å¤„ç†ä¸å°‘é—®é¢˜ï¼Œreact åœ¨ V0.4 å³æ‹¥æœ‰äº†è¿™ä¸€ç‰¹æ€§ï¼Œå¯ä»¥å‚è€ƒ[è¿™é‡Œ](https://reactjs.org/blog/2013/07/23/community-roundup-5.html#cross-browser-onchange)\n* äº‹å®ä¸Šï¼Œreact åœ¨V0.8ä¹‹å‰ï¼Œä¸€ç›´åœ¨ä»¥â€œreact-toolsâ€è¿™ä¸ªåå­—å‘å¸ƒï¼Œè€Œ npm ä¸Šé¢å«åš react çš„å®é™…ä¸Šæ˜¯å¦å¤–ä¸€ä¸ªåŒ…ï¼Œè€Œåˆ° V0.8 çš„æ—¶å€™ï¼Œreact å›¢é˜Ÿå’ŒåŸæ¥çš„ â€œreactâ€ åŒ…å¼€å‘è€…åå•†ï¼Œä¹‹å react ä¾¿æ¥ç®¡äº†åŸæ¥çš„è¿™ä¸ªåŒ…ï¼Œä¹Ÿå› æ­¤ï¼Œreactå¹¶æ²¡æœ‰ V0.6 å’Œ V0.7ï¼Œè€Œæ˜¯ä» V0.5 ç›´æ¥åˆ°äº† V0.8\n* react ä» V0.14 ä¹‹åï¼Œå°±ç›´æ¥è·³è·ƒåˆ°äº† V15ï¼Œå®˜æ–¹å›¢é˜Ÿç»™å‡ºçš„ç†ç”±æ˜¯ï¼Œreact å¾ˆæ—©å°±å·²ç»è¶³å¤Ÿç¨³å®šå¹¶ä¸”å¯ä»¥ä½¿ç”¨åœ¨ç”Ÿäº§ç‰ˆæœ¬ä¸­ï¼Œæ›´æ”¹ç‰ˆæœ¬çš„è¡¨è¾¾æ–¹å¼æ›´æœ‰åŠ©äºè¡¨ç¤º react é¡¹ç›®æœ¬èº«çš„ç¨³å®šæ€§ã€‚\n\n### é™„å½•2 ä¸€äº›æ¯”è¾ƒä¼˜ç§€çš„åšå®¢\n\n* å…³äºReact Components, Elements, å’Œ Instancesï¼Œå¦‚æœä½ è¿˜æœ‰ä¸€äº›ç–‘é—®ï¼Œå¯ä»¥çœ‹ä¸€çœ‹Reactå®˜æ–¹å›¢é˜Ÿçš„æ–‡ç« ï¼š[React Components, Elements, and Instances](https://reactjs.org/blog/2015/12/18/react-components-elements-and-instances.html)\n* å¦‚æœä½ å€¾å‘äºä½¿ç”¨ mixinsï¼Œä¸å¦¨çœ‹çœ‹ react å…³äºå–æ¶ˆ mixinçš„è¯´æ³•ï¼š[Mixins Considered Harmful](https://reactjs.org/blog/2016/07/13/mixins-considered-harmful.html)\n* react props ç›¸å…³çš„å¼€å‘æ¨¡å¼çš„å»ºè®®ï¼Œæˆ‘è®¤ä¸ºç›®å‰åœ¨ä½¿ç”¨ react çš„ç¨‹åºå‘˜éƒ½åº”è¯¥äº†è§£ä¸€ä¸‹[You Probably Don't Need Derived State](https://reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html)","tags":["React"]},{"title":"åæ¡ç¼–å†™ä¼˜åŒ–çš„ JavaScript ä»£ç çš„å»ºè®®","url":"/2018/05/29/åæ¡ç¼–å†™ä¼˜åŒ–çš„JavaScriptä»£ç çš„å»ºè®®/","content":"\næœ¬æ–‡æ€»ç»“äº†åæ¡ç¼–å†™ä¼˜ç§€çš„ JavaScript ä»£ç çš„ä¹ æƒ¯ï¼Œä¸»è¦é’ˆå¯¹ V8 å¼•æ“ï¼š\n\n1.å§‹ç»ˆä»¥ç›¸åŒçš„é¡ºåºå®ä¾‹åŒ–å¯¹è±¡å±æ€§ï¼Œä»¥ä¾¿å¯ä»¥å…±äº«éšè—ç±»å’Œéšåä¼˜åŒ–çš„ä»£ç ã€‚V8 åœ¨å¯¹ js ä»£ç è§£æçš„æ—¶å€™ä¼šæœ‰æ„å»ºéšè—ç±»çš„è¿‡ç¨‹ï¼Œä»¥ç›¸åŒçš„é¡ºåºå®ä¾‹åŒ–ï¼ˆå±æ€§èµ‹å€¼ï¼‰çš„å¯¹è±¡ä¼šå…±äº«ç›¸åŒçš„éšè—ç±»ã€‚ä¸‹é¢ç»™å‡ºä¸€ä¸ªä¸å¥½çš„å®è·µï¼š\n\n```javascript\nfunction Point(x, y) {\n    this.x = x;\n    this.y = y;\n}\nvar p1 = new Point(1, 2);\np1.a = 5;\np1.b = 6;\nvar p2 = new Point(3, 4);\np2.b = 7;\np2.a = 8;\n// ç”±äº a å’Œ b çš„èµ‹å€¼é¡ºåºä¸åŒï¼Œp1 å’Œ p2 æ— æ³•å…±äº«éšè—ç±»\n```\n\n2.é¿å…åˆ†é…åŠ¨æ€å±æ€§ã€‚åœ¨å®ä¾‹åŒ–ä¹‹åå‘å¯¹è±¡æ·»åŠ å±æ€§å°†å¼ºåˆ¶éšè—ç±»æ›´æ”¹ï¼Œå¹¶å‡æ…¢ä¸ºå…ˆå‰éšè—ç±»ä¼˜åŒ–çš„æ‰€æœ‰æ–¹æ³•ã€‚ç›¸åï¼Œåœ¨å…¶æ„é€ å‡½æ•°ä¸­åˆ†é…æ‰€æœ‰å¯¹è±¡çš„å±æ€§ã€‚  \n\n3.é‡å¤æ‰§è¡Œç›¸åŒæ–¹æ³•çš„ä»£ç å°†æ¯”ä»…æ‰§è¡Œä¸€æ¬¡ï¼ˆç”±äºå†…è”ç¼“å­˜ï¼‰æ‰§è¡Œè®¸å¤šä¸åŒæ–¹æ³•çš„ä»£ç è¿è¡Œå¾—æ›´å¿«ã€‚  \n\n4.é¿å…åˆ›å»ºç¨€ç–æ•°ç»„ã€‚ç¨€ç–æ•°ç»„ç”±äºä¸æ˜¯æ‰€æœ‰çš„å…ƒç´ éƒ½å­˜åœ¨ï¼Œå› æ­¤æ˜¯ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œå› æ­¤è®¿é—®ç¨€ç–æ•°ç»„ä¸­çš„å…ƒç´ ä»£ä»·æ›´é«˜ã€‚å¦å¤–ï¼Œå°½é‡ä¸è¦é‡‡ç”¨é¢„åˆ†é…æ•°é‡çš„å¤§æ•°ç»„ï¼Œæ›´å¥½çš„åŠæ³•æ˜¯éšç€ä½ çš„éœ€è¦æŠŠå®ƒçš„å®¹é‡å¢å¤§ã€‚æœ€åï¼Œå°½é‡ä¸è¦åˆ é™¤æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œå®ƒä¼šè®©æ•°ç»„å˜å¾—ç¨€ç–ã€‚  \n\n5.æ ‡è®°å€¼ï¼šV8é‡‡ç”¨32ä½æ¥è¡¨ç¤ºå¯¹è±¡å’Œæ•°å­—ï¼Œå…¶ä¸­ç”¨ä¸€ä½æ¥åŒºåˆ«å¯¹è±¡ï¼ˆflag = 0ï¼‰æˆ–æ•°å­—ï¼ˆflag = 1ï¼‰ï¼Œå› æ­¤è¿™è¢«ç§°ä¹‹ä¸º SMI (Small Integer)å› ä¸ºå®ƒåªæœ‰31ä½ã€‚å› æ­¤ï¼Œå¦‚æœä¸€ä¸ªæ•°å­—å¤§äº31ä½ï¼ŒV8éœ€è¦å¯¹å…¶è¿›è¡ŒåŒ…è£…ï¼Œå°†å…¶å˜æˆåŒç²¾åº¦å¹¶ä¸”ç”¨ä¸€ä¸ªå¯¹è±¡æ¥å°è£…å®ƒï¼Œå› æ­¤åº”è¯¥å°½é‡ä½¿ç”¨31ä½æœ‰ç¬¦å·æ•°å­—ä»è€Œé¿å…æ˜‚è´µçš„å°è£…æ“ä½œã€‚  \n\n6.æ£€æŸ¥ä½ çš„ä¾èµ–ï¼Œå»æ‰ä¸éœ€è¦ import çš„å†…å®¹ã€‚  \n\n7.å°†ä½ çš„ä»£ç åˆ†å‰²æˆä¸€äº›å°çš„ chunks ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå¼•å…¥ã€‚ \n \n8.å°½å¯èƒ½ä½¿ç”¨ defer æ¥æ¨è¿ŸåŠ è½½ JavaScriptï¼Œå¦å¤–åªåŠ è½½å½“å‰è·¯ç”±éœ€è¦çš„ä»£ç æ®µã€‚\n  \n9.ä½¿ç”¨ dev tools å’Œ DeviceTiming æ¥å¯»æ‰¾ä»£ç ç“¶é¢ˆã€‚  \n\n10.ä½¿ç”¨è¯¸å¦‚Optimize.jsè¿™æ ·çš„å·¥å…·æ¥å¸®åŠ©è§£æå™¨å†³å®šä½•æ—¶éœ€è¦æå‰è§£æä»¥åŠä½•æ—¶éœ€è¦å»¶åè§£æã€‚  \n  \nä»¥ä¸Šå†…å®¹æ¥æºï¼š\n* [How JavaScript works: Parsing, Abstract Syntax Trees (ASTs) + 5 tips on how to minimize parse time](https://blog.sessionstack.com/how-javascript-works-parsing-abstract-syntax-trees-asts-5-tips-on-how-to-minimize-parse-time-abfcf7e8a0c8)\n* [How JavaScript works: inside the V8 engine + 5 tips on how to write optimized code](https://blog.sessionstack.com/how-javascript-works-inside-the-v8-engine-5-tips-on-how-to-write-optimized-code-ac089e62b12e)\n\n","tags":["javascript"]},{"title":"æµ…è°ˆå‰ç«¯ä¸­çš„äºŒè¿›åˆ¶æ•°æ®ç±»å‹","url":"/2018/05/09/æµ…è°ˆå‰ç«¯ä¸­çš„äºŒè¿›åˆ¶æ•°æ®ç±»å‹/","content":"\n>ç›®å‰åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼ŒWebSocketéƒ¨åˆ†ç”±äºåç«¯ä½¿ç”¨äº†gzipå‹ç¼©ï¼Œå‰ç«¯å¤„ç†èµ·æ¥åºŸäº†ä¸€ç‚¹æ—¶é—´ï¼Œä»è€Œå‘ç°è‡ªå·±åœ¨äºŒè¿›åˆ¶æ•°æ®ç±»å‹è¿™ä¸ªçŸ¥è¯†ç‚¹è¿˜å­˜åœ¨ä¸€å®šçš„ç›²åŒºï¼Œå› æ­¤è¿™é‡Œè¿›è¡Œæ€»ç»“ã€‚\n\næœ¬æ–‡ä¸»è¦ç®€å•ä»‹ç»ArrayBufferå¯¹è±¡ã€TypedArrayå¯¹è±¡ã€DataViewå¯¹è±¡ä»¥åŠBlobåŸå§‹æ•°æ®ç±»å‹ï¼Œå’Œå®ƒä»¬ä¹‹é—´çš„äº’ç›¸è½¬æ¢æ–¹æ³•ã€‚éƒ¨åˆ†ä»£ç å‚è€ƒ[è¿™é‡Œ](http://javascript.ruanyifeng.com/stdlib/arraybuffer.html#toc4)è€Œéæœ¬äººåŸåˆ›ï¼Œä»…åšä¸ªäººå­¦ä¹ ä½¿ç”¨ã€‚\n\nè¿™äº›ç±»å‹åŒ–å¯¹è±¡ï¼Œä¸€èˆ¬ä¼šåœ¨ä»¥ä¸‹åœºæ™¯ä¸­ä½¿ç”¨ï¼š\n\n* WebGL ä¸­ï¼Œæµè§ˆå™¨å’Œæ˜¾å¡ä¹‹é—´éœ€è¦ä½¿ç”¨äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œé€šä¿¡ã€‚\n* åœ¨ä¸€äº› Rest æ¥å£æˆ–è€… WebSocket ä¸­ï¼Œé‡‡ç”¨å‹ç¼©è¿‡çš„æ•°æ®è¿›è¡Œé€šä¿¡ï¼Œè¿™ä¸ªå‹ç¼©å’Œè§£å‹ç¼©çš„è¿‡ç¨‹å¯èƒ½éœ€è¦å€ŸåŠ©äºŒè¿›åˆ¶å¯¹è±¡ã€‚\n* åœ¨ Canvas ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦é€šè¿‡ç”Ÿæˆ Blob çš„æ–¹å¼ä¿å­˜å½“å‰å†…å®¹ã€‚\n* åœ¨ Img ç­‰èµ„æºæ–‡ä»¶ä¸­ï¼ŒURL å¯ä»¥ä¸º Blob åŸå§‹æ•°æ®ç±»å‹ã€‚\n* åœ¨è¯»å–ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œå¯èƒ½éœ€è¦ç”¨åˆ°äºŒè¿›åˆ¶æ•°æ®ç±»å‹è¿›è¡Œä¸­é—´è½¬æ¢ã€‚\n\nä¸‹æ–‡åˆ†ä¸¤éƒ¨åˆ†ï¼Œå‰ä¸€éƒ¨åˆ†æ¦‚è¿°å„ä¸ªäºŒè¿›åˆ¶æ•°æ®ç±»å‹ï¼Œåä¸€éƒ¨åˆ†å°†å®ƒä»¬ä¹‹é—´çš„äº’ç›¸è½¬æ¢ã€‚\n\n### äºŒè¿›åˆ¶æ•°æ®ç±»å‹æ¦‚è¿°\n\n#### ArrayBuffer\n\nArrayBufferå¯¹è±¡ä»£è¡¨å‚¨å­˜äºŒè¿›åˆ¶æ•°æ®çš„ä¸€æ®µå†…å­˜ï¼Œå®ƒä¸èƒ½ç›´æ¥è¯»å†™ï¼Œåªèƒ½é€šè¿‡è§†å›¾ï¼ˆTypedArrayè§†å›¾å’ŒDataViewè§†å›¾)æ¥è¯»å†™ï¼Œè§†å›¾çš„ä½œç”¨æ˜¯ä»¥æŒ‡å®šæ ¼å¼è§£è¯»äºŒè¿›åˆ¶æ•°æ®ã€‚\n\nArrayBufferä¹Ÿæ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå¯ä»¥åˆ†é…ä¸€æ®µå¯ä»¥å­˜æ”¾æ•°æ®çš„è¿ç»­å†…å­˜åŒºåŸŸã€‚\n\n```\nvar buf = new ArrayBuffer(32);\n```\n\nä¸Šé¢ä»£ç ç”Ÿæˆäº†ä¸€æ®µ32å­—èŠ‚çš„å†…å­˜åŒºåŸŸï¼Œæ¯ä¸ªå­—èŠ‚çš„å€¼é»˜è®¤éƒ½æ˜¯0ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒArrayBufferæ„é€ å‡½æ•°çš„å‚æ•°æ˜¯æ‰€éœ€è¦çš„å†…å­˜å¤§å°ï¼ˆå•ä½å­—èŠ‚ï¼‰ã€‚\n\nä¸ºäº†è¯»å†™è¿™æ®µå†…å®¹ï¼Œéœ€è¦ä¸ºå®ƒæŒ‡å®šè§†å›¾ã€‚DataViewè§†å›¾çš„åˆ›å»ºï¼Œéœ€è¦æä¾›ArrayBufferå¯¹è±¡å®ä¾‹ä½œä¸ºå‚æ•°ã€‚\n\n```\nvar buf = new ArrayBuffer(32);\nvar dataView = new DataView(buf);\ndataView.getUint8(0) // 0\n```\n\nä¸Šé¢ä»£ç å¯¹ä¸€æ®µ32å­—èŠ‚çš„å†…å­˜ï¼Œå»ºç«‹DataViewè§†å›¾ï¼Œç„¶åä»¥ä¸å¸¦ç¬¦å·çš„8ä½æ•´æ•°æ ¼å¼ï¼Œè¯»å–ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œç»“æœå¾—åˆ°0ï¼Œå› ä¸ºåŸå§‹å†…å­˜çš„ArrayBufferå¯¹è±¡ï¼Œé»˜è®¤æ‰€æœ‰ä½éƒ½æ˜¯0ã€‚\n\nå¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥å°†ArrayBufferç”Ÿæˆçš„ç»“æœï¼Œä¼ å…¥TypedArrayä¸­ï¼š\n\n```\nvar buffer = new ArrayBuffer(12);\n\nvar x1 = new Int32Array(buffer);\nx1[0] = 1;\nvar x2 = new Uint8Array(buffer);\nx2[0]  = 2;\n\nx1[0] // 2\n```\n\nArrayBufferå®ä¾‹çš„byteLengthå±æ€§ï¼Œè¿”å›æ‰€åˆ†é…çš„å†…å­˜åŒºåŸŸçš„å­—èŠ‚é•¿åº¦ã€‚\n\n```\nvar buffer = new ArrayBuffer(32);\nbuffer.byteLength\n// 32\n```\nå¦‚æœè¦åˆ†é…çš„å†…å­˜åŒºåŸŸå¾ˆå¤§ï¼Œæœ‰å¯èƒ½åˆ†é…å¤±è´¥ï¼ˆå› ä¸ºæ²¡æœ‰é‚£ä¹ˆå¤šçš„è¿ç»­ç©ºä½™å†…å­˜ï¼‰ï¼Œæ‰€ä»¥æœ‰å¿…è¦æ£€æŸ¥æ˜¯å¦åˆ†é…æˆåŠŸã€‚\n\n```\nif (buffer.byteLength === n) {\n  // æˆåŠŸ\n} else {\n  // å¤±è´¥\n}\n```\n\nArrayBufferå®ä¾‹æœ‰ä¸€ä¸ªsliceæ–¹æ³•ï¼Œå…è®¸å°†å†…å­˜åŒºåŸŸçš„ä¸€éƒ¨åˆ†ï¼Œæ‹·è´ç”Ÿæˆä¸€ä¸ªæ–°çš„ArrayBufferå¯¹è±¡ã€‚\n\n```\nvar buffer = new ArrayBuffer(8);\nvar newBuffer = buffer.slice(0, 3);\n```\n\nä¸Šé¢ä»£ç æ‹·è´bufferå¯¹è±¡çš„å‰3ä¸ªå­—èŠ‚ï¼ˆä»0å¼€å§‹ï¼Œåˆ°ç¬¬3ä¸ªå­—èŠ‚å‰é¢ç»“æŸï¼‰ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„ArrayBufferå¯¹è±¡ã€‚sliceæ–¹æ³•å…¶å®åŒ…å«ä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥æ˜¯å…ˆåˆ†é…ä¸€æ®µæ–°å†…å­˜ï¼Œç¬¬äºŒæ­¥æ˜¯å°†åŸæ¥é‚£ä¸ªArrayBufferå¯¹è±¡æ‹·è´è¿‡å»ã€‚\n\nsliceæ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºæ‹·è´å¼€å§‹çš„å­—èŠ‚åºå·ï¼ˆå«è¯¥å­—èŠ‚ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ‹·è´æˆªæ­¢çš„å­—èŠ‚åºå·ï¼ˆä¸å«è¯¥å­—èŠ‚ï¼‰ã€‚å¦‚æœçœç•¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œåˆ™é»˜è®¤åˆ°åŸArrayBufferå¯¹è±¡çš„ç»“å°¾ã€‚\n\né™¤äº†sliceæ–¹æ³•ï¼ŒArrayBufferå¯¹è±¡ä¸æä¾›ä»»ä½•ç›´æ¥è¯»å†™å†…å­˜çš„æ–¹æ³•ï¼Œåªå…è®¸åœ¨å…¶ä¸Šæ–¹å»ºç«‹è§†å›¾ï¼Œç„¶åé€šè¿‡è§†å›¾è¯»å†™ã€‚\n\nArrayBufferæœ‰ä¸€ä¸ªé™æ€æ–¹æ³•isViewï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå‚æ•°æ˜¯å¦ä¸ºArrayBufferçš„è§†å›¾å®ä¾‹ã€‚è¿™ä¸ªæ–¹æ³•å¤§è‡´ç›¸å½“äºåˆ¤æ–­å‚æ•°ï¼Œæ˜¯å¦ä¸ºTypedArrayå®ä¾‹æˆ–DataViewå®ä¾‹ã€‚\n\n```\nvar buffer = new ArrayBuffer(8);\nArrayBuffer.isView(buffer) // false\n\nvar v = new Int32Array(buffer);\nArrayBuffer.isView(v) // true\n```\n\n#### TypedArray\n\nç›®å‰ï¼ŒTypedArrayå¯¹è±¡ä¸€å…±æä¾›9ç§ç±»å‹çš„è§†å›¾ï¼Œæ¯ä¸€ç§è§†å›¾éƒ½æ˜¯ä¸€ç§æ„é€ å‡½æ•°ã€‚\n\n* Int8Arrayï¼š8ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦1ä¸ªå­—èŠ‚ã€‚\n* Uint8Arrayï¼š8ä½æ— ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦1ä¸ªå­—èŠ‚ã€‚\n* Uint8ClampedArrayï¼š8ä½æ— ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦1ä¸ªå­—èŠ‚ï¼Œæº¢å‡ºå¤„ç†ä¸åŒã€‚\n* Int16Arrayï¼š16ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦2ä¸ªå­—èŠ‚ã€‚\n* Uint16Arrayï¼š16ä½æ— ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦2ä¸ªå­—èŠ‚ã€‚\n* Int32Arrayï¼š32ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦4ä¸ªå­—èŠ‚ã€‚\n* Uint32Arrayï¼š32ä½æ— ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦4ä¸ªå­—èŠ‚ã€‚\n* Float32Arrayï¼š32ä½æµ®ç‚¹æ•°ï¼Œé•¿åº¦4ä¸ªå­—èŠ‚ã€‚\n* Float64Arrayï¼š64ä½æµ®ç‚¹æ•°ï¼Œé•¿åº¦8ä¸ªå­—èŠ‚ã€‚\n\nè¿™9ä¸ªæ„é€ å‡½æ•°ç”Ÿæˆçš„å¯¹è±¡ï¼Œç»Ÿç§°ä¸ºTypedArrayå¯¹è±¡ã€‚å®ƒä»¬å¾ˆåƒæ­£å¸¸æ•°ç»„ï¼Œéƒ½æœ‰lengthå±æ€§ï¼Œéƒ½èƒ½ç”¨æ–¹æ‹¬å·è¿ç®—ç¬¦ï¼ˆ[]ï¼‰è·å–å•ä¸ªå…ƒç´ ï¼Œæ‰€æœ‰æ•°ç»„çš„æ–¹æ³•ï¼Œåœ¨ç±»å‹åŒ–æ•°ç»„ä¸Šé¢éƒ½èƒ½ä½¿ç”¨ã€‚ä¸¤è€…çš„å·®å¼‚ä¸»è¦åœ¨ä»¥ä¸‹æ–¹é¢ã€‚\n\n* TypedArrayæ•°ç»„çš„æ‰€æœ‰æˆå‘˜ï¼Œéƒ½æ˜¯åŒä¸€ç§ç±»å‹å’Œæ ¼å¼ã€‚\n* TypedArrayæ•°ç»„çš„æˆå‘˜æ˜¯è¿ç»­çš„ï¼Œä¸ä¼šæœ‰ç©ºä½ã€‚\n* TypedåŒ–æ•°ç»„æˆå‘˜çš„é»˜è®¤å€¼ä¸º0ã€‚æ¯”å¦‚ï¼Œnew Array(10)è¿”å›ä¸€ä¸ªæ­£å¸¸æ•°ç»„ï¼Œé‡Œé¢æ²¡æœ‰ä»»ä½•æˆå‘˜ï¼Œåªæ˜¯10ä¸ªç©ºä½ï¼›new Uint8Array(10)è¿”å›ä¸€ä¸ªç±»å‹åŒ–æ•°ç»„ï¼Œé‡Œé¢10ä¸ªæˆå‘˜éƒ½æ˜¯0ã€‚\n* TypedArrayæ•°ç»„åªæ˜¯ä¸€å±‚è§†å›¾ï¼Œæœ¬èº«ä¸å‚¨å­˜æ•°æ®ï¼Œå®ƒçš„æ•°æ®éƒ½å‚¨å­˜åœ¨åº•å±‚çš„ArrayBufferå¯¹è±¡ä¹‹ä¸­ï¼Œè¦è·å–åº•å±‚å¯¹è±¡å¿…é¡»ä½¿ç”¨bufferå±æ€§ã€‚\n\n##### æ„é€ å‡½æ•°\n\nTypedArrayæ•°ç»„æä¾›9ç§æ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆç›¸åº”ç±»å‹çš„æ•°ç»„å®ä¾‹ã€‚\n\næ„é€ å‡½æ•°æœ‰å¤šç§ç”¨æ³•ã€‚\n\n* TypedArray(buffer, byteOffset=0, length?)\n\nåŒä¸€ä¸ªArrayBufferå¯¹è±¡ä¹‹ä¸Šï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œå»ºç«‹å¤šä¸ªè§†å›¾ã€‚\n\n```\n// åˆ›å»ºä¸€ä¸ª8å­—èŠ‚çš„ArrayBuffer\nvar b = new ArrayBuffer(8);\n\n// åˆ›å»ºä¸€ä¸ªæŒ‡å‘bçš„Int32è§†å›¾ï¼Œå¼€å§‹äºå­—èŠ‚0ï¼Œç›´åˆ°ç¼“å†²åŒºçš„æœ«å°¾\nvar v1 = new Int32Array(b);\n\n// åˆ›å»ºä¸€ä¸ªæŒ‡å‘bçš„Uint8è§†å›¾ï¼Œå¼€å§‹äºå­—èŠ‚2ï¼Œç›´åˆ°ç¼“å†²åŒºçš„æœ«å°¾\nvar v2 = new Uint8Array(b, 2);\n\n// åˆ›å»ºä¸€ä¸ªæŒ‡å‘bçš„Int16è§†å›¾ï¼Œå¼€å§‹äºå­—èŠ‚2ï¼Œé•¿åº¦ä¸º2\nvar v3 = new Int16Array(b, 2, 2);\n```\n\nå¯¹äºä»¥ä¸Šä»£ç ï¼Œv1ã€v2å’Œv3æ˜¯é‡å çš„ï¼šv1[0]æ˜¯ä¸€ä¸ª32ä½æ•´æ•°ï¼ŒæŒ‡å‘å­—èŠ‚0ï½å­—èŠ‚3ï¼›v2[0]æ˜¯ä¸€ä¸ª8ä½æ— ç¬¦å·æ•´æ•°ï¼ŒæŒ‡å‘å­—èŠ‚2ï¼›v3[0]æ˜¯ä¸€ä¸ª16ä½æ•´æ•°ï¼ŒæŒ‡å‘å­—èŠ‚2ï½å­—èŠ‚3ã€‚åªè¦ä»»ä½•ä¸€ä¸ªè§†å›¾å¯¹å†…å­˜æœ‰æ‰€ä¿®æ”¹ï¼Œå°±ä¼šåœ¨å¦å¤–ä¸¤ä¸ªè§†å›¾ä¸Šååº”å‡ºæ¥ã€‚\n\næ³¨æ„ï¼ŒbyteOffsetå¿…é¡»ä¸æ‰€è¦å»ºç«‹çš„æ•°æ®ç±»å‹ä¸€è‡´ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚\n\n```\nvar buffer = new ArrayBuffer(8);\nvar i16 = new Int16Array(buffer, 1);\n// Uncaught RangeError: start offset of Int16Array should be a multiple of 2\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œæ–°ç”Ÿæˆä¸€ä¸ª8ä¸ªå­—èŠ‚çš„ArrayBufferå¯¹è±¡ï¼Œç„¶ååœ¨è¿™ä¸ªå¯¹è±¡çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œå»ºç«‹å¸¦ç¬¦å·çš„16ä½æ•´æ•°è§†å›¾ï¼Œç»“æœæŠ¥é”™ã€‚å› ä¸ºï¼Œå¸¦ç¬¦å·çš„16ä½æ•´æ•°éœ€è¦ä¸¤ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥byteOffsetå‚æ•°å¿…é¡»èƒ½å¤Ÿè¢«2æ•´é™¤ã€‚\n\nå¦‚æœæƒ³ä»ä»»æ„å­—èŠ‚å¼€å§‹è§£è¯»ArrayBufferå¯¹è±¡ï¼Œå¿…é¡»ä½¿ç”¨DataViewè§†å›¾ï¼Œå› ä¸ºTypedArrayè§†å›¾åªæä¾›9ç§å›ºå®šçš„è§£è¯»æ ¼å¼ã€‚\n\n* TypedArray(length)\n\nè§†å›¾è¿˜å¯ä»¥ä¸é€šè¿‡ArrayBufferå¯¹è±¡ï¼Œç›´æ¥åˆ†é…å†…å­˜è€Œç”Ÿæˆã€‚\n\n```\nvar f64a = new Float64Array(8);\nf64a[0] = 10;\nf64a[1] = 20;\nf64a[2] = f64a[0] + f64a[1];\n```\n\n* TypedArray(typedArray)\n\nç±»å‹åŒ–æ•°ç»„çš„æ„é€ å‡½æ•°ï¼Œå¯ä»¥æ¥å—å¦ä¸€ä¸ªè§†å›¾å®ä¾‹ä½œä¸ºå‚æ•°ã€‚\n\n```\nvar typedArray = new Int8Array(new Uint8Array(4));\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼ŒInt8Arrayæ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªUint8Arrayå®ä¾‹ä½œä¸ºå‚æ•°ã€‚\n\næ³¨æ„ï¼Œæ­¤æ—¶ç”Ÿæˆçš„æ–°æ•°ç»„ï¼Œåªæ˜¯å¤åˆ¶äº†å‚æ•°æ•°ç»„çš„å€¼ï¼Œå¯¹åº”çš„åº•å±‚å†…å­˜æ˜¯ä¸ä¸€æ ·çš„ã€‚æ–°æ•°ç»„ä¼šå¼€è¾Ÿä¸€æ®µæ–°çš„å†…å­˜å‚¨å­˜æ•°æ®ï¼Œä¸ä¼šåœ¨åŸæ•°ç»„çš„å†…å­˜ä¹‹ä¸Šå»ºç«‹è§†å›¾ã€‚\n\n```\nvar x = new Int8Array([1, 1]);\nvar y = new Int8Array(x);\nx[0] // 1\ny[0] // 1\n\nx[0] = 2;\ny[0] // 1\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œæ•°ç»„yæ˜¯ä»¥æ•°ç»„xä¸ºæ¨¡æ¿è€Œç”Ÿæˆçš„ï¼Œå½“xå˜åŠ¨çš„æ—¶å€™ï¼Œyå¹¶æ²¡æœ‰å˜åŠ¨ã€‚\n\nå¦‚æœæƒ³åŸºäºåŒä¸€æ®µå†…å­˜ï¼Œæ„é€ ä¸åŒçš„è§†å›¾ï¼Œå¯ä»¥é‡‡ç”¨ä¸‹é¢çš„å†™æ³•ã€‚\n\n```\nvar x = new Int8Array([1, 1]);\nvar y = new Int8Array(x.buffer);\nx[0] // 1\ny[0] // 1\n\nx[0] = 2;\ny[0] // 2\n```\n\n* TypedArray(arrayLikeObject)\n\næ„é€ å‡½æ•°çš„å‚æ•°ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ™®é€šæ•°ç»„ï¼Œç„¶åç›´æ¥ç”ŸæˆTypedArrayå®ä¾‹ã€‚\n\n```\nvar typedArray = new Uint8Array([1, 2, 3, 4]);\n```\n\næ³¨æ„ï¼Œè¿™æ—¶TypedArrayè§†å›¾ä¼šé‡æ–°å¼€è¾Ÿå†…å­˜ï¼Œä¸ä¼šåœ¨åŸæ•°ç»„çš„å†…å­˜ä¸Šå»ºç«‹è§†å›¾ã€‚\n\nä¸Šé¢ä»£ç ä»ä¸€ä¸ªæ™®é€šçš„æ•°ç»„ï¼Œç”Ÿæˆä¸€ä¸ª8ä½æ— ç¬¦å·æ•´æ•°çš„TypedArrayå®ä¾‹ã€‚\n\nTypedArrayæ•°ç»„ä¹Ÿå¯ä»¥è½¬æ¢å›æ™®é€šæ•°ç»„ã€‚\n\n```\nvar normalArray = Array.prototype.slice.call(typedArray);\n```\n\n##### BYTES_PER_ELEMENTå±æ€§\n\næ¯ä¸€ç§è§†å›¾çš„æ„é€ å‡½æ•°ï¼Œéƒ½æœ‰ä¸€ä¸ªBYTES_PER_ELEMENTå±æ€§ï¼Œè¡¨ç¤ºè¿™ç§æ•°æ®ç±»å‹å æ®çš„å­—èŠ‚æ•°ã€‚\n\n```\nInt8Array.BYTES_PER_ELEMENT // 1\nUint8Array.BYTES_PER_ELEMENT // 1\nInt16Array.BYTES_PER_ELEMENT // 2\nUint16Array.BYTES_PER_ELEMENT // 2\nInt32Array.BYTES_PER_ELEMENT // 4\nUint32Array.BYTES_PER_ELEMENT // 4\nFloat32Array.BYTES_PER_ELEMENT // 4\nFloat64Array.BYTES_PER_ELEMENT // 8\n```\n\n##### ArrayBufferä¸å­—ç¬¦ä¸²çš„äº’ç›¸è½¬æ¢\n\nArrayBufferè½¬ä¸ºå­—ç¬¦ä¸²ï¼Œæˆ–è€…å­—ç¬¦ä¸²è½¬ä¸ºArrayBufferï¼Œæœ‰ä¸€ä¸ªå‰æï¼Œå³å­—ç¬¦ä¸²çš„ç¼–ç æ–¹æ³•æ˜¯ç¡®å®šçš„ã€‚å‡å®šå­—ç¬¦ä¸²é‡‡ç”¨UTF-16ç¼–ç ï¼ˆJavaScriptçš„å†…éƒ¨ç¼–ç æ–¹å¼ï¼‰ï¼Œå¯ä»¥è‡ªå·±ç¼–å†™è½¬æ¢å‡½æ•°ã€‚\n\n```\n// ArrayBufferè½¬ä¸ºå­—ç¬¦ä¸²ï¼Œå‚æ•°ä¸ºArrayBufferå¯¹è±¡\nfunction ab2str(buf) {\n  return String.fromCharCode.apply(null, new Uint16Array(buf));\n}\n\n// å­—ç¬¦ä¸²è½¬ä¸ºArrayBufferå¯¹è±¡ï¼Œå‚æ•°ä¸ºå­—ç¬¦ä¸²\nfunction str2ab(str) {\n  var buf = new ArrayBuffer(str.length * 2); // æ¯ä¸ªå­—ç¬¦å ç”¨2ä¸ªå­—èŠ‚\n  var bufView = new Uint16Array(buf);\n  for (var i = 0, strLen = str.length; i < strLen; i++) {\n    bufView[i] = str.charCodeAt(i);\n  }\n  return buf;\n}\n```\n\n##### TypedArray.prototype.set()\n\nTypedArrayæ•°ç»„çš„setæ–¹æ³•ç”¨äºå¤åˆ¶æ•°ç»„ï¼ˆæ­£å¸¸æ•°ç»„æˆ–TypedArrayæ•°ç»„ï¼‰ï¼Œä¹Ÿå°±æ˜¯å°†ä¸€æ®µå†…å®¹å®Œå…¨å¤åˆ¶åˆ°å¦ä¸€æ®µå†…å­˜ã€‚\n\n```\nvar a = new Uint8Array(8);\nvar b = new Uint8Array(8);\n\nb.set(a);\n```\n\nä¸Šé¢ä»£ç å¤åˆ¶aæ•°ç»„çš„å†…å®¹åˆ°bæ•°ç»„ï¼Œå®ƒæ˜¯æ•´æ®µå†…å­˜çš„å¤åˆ¶ï¼Œæ¯”ä¸€ä¸ªä¸ªæ‹·è´æˆå‘˜çš„é‚£ç§å¤åˆ¶å¿«å¾—å¤šã€‚setæ–¹æ³•è¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¡¨ç¤ºä»bå¯¹è±¡å“ªä¸€ä¸ªæˆå‘˜å¼€å§‹å¤åˆ¶aå¯¹è±¡ã€‚\n\n```\nvar a = new Uint16Array(8);\nvar b = new Uint16Array(10);\n\nb.set(a, 2)\n```\nä¸Šé¢ä»£ç çš„bæ•°ç»„æ¯”aæ•°ç»„å¤šä¸¤ä¸ªæˆå‘˜ï¼Œæ‰€ä»¥ä»b[2]å¼€å§‹å¤åˆ¶ã€‚\n\n##### TypedArray.prototype.subarray()\n\nsubarrayæ–¹æ³•æ˜¯å¯¹äºTypedArrayæ•°ç»„çš„ä¸€éƒ¨åˆ†ï¼Œå†å»ºç«‹ä¸€ä¸ªæ–°çš„è§†å›¾ã€‚\n\n```\nvar a = new Uint16Array(8);\nvar b = a.subarray(2,3);\n\na.byteLength // 16\nb.byteLength // 2\n```\n\nsubarrayæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯èµ·å§‹çš„æˆå‘˜åºå·ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç»“æŸçš„æˆå‘˜åºå·ï¼ˆä¸å«è¯¥æˆå‘˜ï¼‰ï¼Œå¦‚æœçœç•¥åˆ™åŒ…å«å‰©ä½™çš„å…¨éƒ¨æˆå‘˜ã€‚æ‰€ä»¥ï¼Œä¸Šé¢ä»£ç çš„a.subarray(2,3)ï¼Œæ„å‘³ç€båªåŒ…å«a[2]ä¸€ä¸ªæˆå‘˜ï¼Œå­—èŠ‚é•¿åº¦ä¸º2ã€‚\n\n##### TypedArray.prototype.slice()\n\nTypeArrayå®ä¾‹çš„sliceæ–¹æ³•ï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªæŒ‡å®šä½ç½®çš„æ–°çš„TypedArrayå®ä¾‹ã€‚\n\n```\nlet ui8 = Uint8Array.of(0, 1, 2);\nui8.slice(-1)\n// Uint8Array [ 2 ]\n```\n\n\nä¸Šé¢ä»£ç ä¸­ï¼Œui8æ˜¯8ä½æ— ç¬¦å·æ•´æ•°æ•°ç»„è§†å›¾çš„ä¸€ä¸ªå®ä¾‹ã€‚å®ƒçš„sliceæ–¹æ³•å¯ä»¥ä»å½“å‰è§†å›¾ä¹‹ä¸­ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„è§†å›¾å®ä¾‹ã€‚\n\nsliceæ–¹æ³•çš„å‚æ•°ï¼Œè¡¨ç¤ºåŸæ•°ç»„çš„å…·ä½“ä½ç½®ï¼Œå¼€å§‹ç”Ÿæˆæ–°æ•°ç»„ã€‚è´Ÿå€¼è¡¨ç¤ºé€†å‘çš„ä½ç½®ï¼Œå³-1ä¸ºå€’æ•°ç¬¬ä¸€ä¸ªä½ç½®ï¼Œ-2è¡¨ç¤ºå€’æ•°ç¬¬äºŒä¸ªä½ç½®ï¼Œä»¥æ­¤ç±»æ¨ã€‚\n\n##### TypedArray.of()\n\nTypedArrayæ•°ç»„çš„æ‰€æœ‰æ„é€ å‡½æ•°ï¼Œéƒ½æœ‰ä¸€ä¸ªé™æ€æ–¹æ³•ofï¼Œç”¨äºå°†å‚æ•°è½¬ä¸ºä¸€ä¸ªTypedArrayå®ä¾‹ã€‚\n\n```\nFloat32Array.of(0.151, -8, 3.7)\n// Float32Array [ 0.151, -8, 3.7 ]\n```\n\n##### TypedArray.from()\n\né™æ€æ–¹æ³•fromæ¥å—ä¸€ä¸ª**å¯éå†çš„æ•°æ®ç»“æ„ï¼ˆæ¯”å¦‚æ•°ç»„ï¼‰**ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªåŸºäºè¿™ä¸ªç»“æ„çš„TypedArrayå®ä¾‹ã€‚\n\n```\nUint16Array.from([0, 1, 2])\n// Uint16Array [ 0, 1, 2 ]\n```\n\nè¿™ä¸ªæ–¹æ³•è¿˜å¯ä»¥å°†ä¸€ç§TypedArrayå®ä¾‹ï¼Œè½¬ä¸ºå¦ä¸€ç§ã€‚\n\n```\nvar ui16 = Uint16Array.from(Uint8Array.of(0, 1, 2));\nui16 instanceof Uint16Array // true\n```\n\nfromæ–¹æ³•è¿˜å¯ä»¥æ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨æ¥å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œéå†ï¼ŒåŠŸèƒ½ç±»ä¼¼mapæ–¹æ³•ã€‚\n\n```\nInt8Array.of(127, 126, 125).map(x => 2 * x)\n// Int8Array [ -2, -4, -6 ]\n\nInt16Array.from(Int8Array.of(127, 126, 125), x => 2 * x)\n// Int16Array [ 254, 252, 250 ]\n```\n\nä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œfromæ–¹æ³•æ²¡æœ‰å‘ç”Ÿæº¢å‡ºï¼Œè¿™è¯´æ˜éå†æ˜¯é’ˆå¯¹æ–°ç”Ÿæˆçš„16ä½æ•´æ•°æ•°ç»„ï¼Œè€Œä¸æ˜¯é’ˆå¯¹åŸæ¥çš„8ä½æ•´æ•°æ•°ç»„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œfromä¼šå°†ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šçš„TypedArrayæ•°ç»„ï¼Œæ‹·è´åˆ°å¦ä¸€æ®µå†…å­˜ä¹‹ä¸­ï¼ˆå ç”¨å†…å­˜ä»3å­—èŠ‚å˜ä¸º6å­—èŠ‚ï¼‰ï¼Œç„¶åå†è¿›è¡Œå¤„ç†ã€‚\n\n#### DataView\n\nå¦‚æœä¸€æ®µæ•°æ®åŒ…æ‹¬å¤šç§ç±»å‹ï¼ˆæ¯”å¦‚æœåŠ¡å™¨ä¼ æ¥çš„HTTPæ•°æ®ï¼‰ï¼Œè¿™æ—¶é™¤äº†å»ºç«‹ArrayBufferå¯¹è±¡çš„å¤åˆè§†å›¾ä»¥å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡DataViewè§†å›¾è¿›è¡Œæ“ä½œã€‚\n\nDataViewè§†å›¾æä¾›æ›´å¤šæ“ä½œé€‰é¡¹ï¼Œè€Œä¸”æ”¯æŒè®¾å®šå­—èŠ‚åºã€‚æœ¬æ¥ï¼Œåœ¨è®¾è®¡ç›®çš„ä¸Šï¼ŒArrayBufferå¯¹è±¡çš„å„ç§TypedArrayè§†å›¾ï¼Œæ˜¯ç”¨æ¥å‘ç½‘å¡ã€å£°å¡ä¹‹ç±»çš„æœ¬æœºè®¾å¤‡ä¼ é€æ•°æ®ï¼Œæ‰€ä»¥ä½¿ç”¨æœ¬æœºçš„å­—èŠ‚åºå°±å¯ä»¥äº†ï¼›è€ŒDataViewè§†å›¾çš„è®¾è®¡ç›®çš„ï¼Œæ˜¯ç”¨æ¥å¤„ç†ç½‘ç»œè®¾å¤‡ä¼ æ¥çš„æ•°æ®ï¼Œæ‰€ä»¥å¤§ç«¯å­—èŠ‚åºæˆ–å°ç«¯å­—èŠ‚åºæ˜¯å¯ä»¥è‡ªè¡Œè®¾å®šçš„ã€‚\n\nDataViewè§†å›¾æœ¬èº«ä¹Ÿæ˜¯æ„é€ å‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªArrayBufferå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œç”Ÿæˆè§†å›¾ã€‚\n\n```\nDataView(ArrayBuffer buffer [, å­—èŠ‚èµ·å§‹ä½ç½® [, é•¿åº¦]]);\n```\nä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚\n\n```\nvar buffer = new ArrayBuffer(24);\nvar dv = new DataView(buffer);\n```\n\nDataViewå®ä¾‹æœ‰ä»¥ä¸‹å±æ€§ï¼Œå«ä¹‰ä¸TypedArrayå®ä¾‹çš„åŒåæ–¹æ³•ç›¸åŒã€‚\n\n* DataView.prototype.bufferï¼šè¿”å›å¯¹åº”çš„ArrayBufferå¯¹è±¡\n* DataView.prototype.byteLengthï¼šè¿”å›å æ®çš„å†…å­˜å­—èŠ‚é•¿åº¦\n* DataView.prototype.byteOffsetï¼šè¿”å›å½“å‰è§†å›¾ä»å¯¹åº”çš„ArrayBufferå¯¹è±¡çš„å“ªä¸ªå­—èŠ‚å¼€å§‹\n\nDataViewå®ä¾‹æä¾›8ä¸ªæ–¹æ³•è¯»å–å†…å­˜ã€‚\n\n* getInt8ï¼šè¯»å–1ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ª8ä½æ•´æ•°ã€‚\n* getUint8ï¼šè¯»å–1ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ªæ— ç¬¦å·çš„8ä½æ•´æ•°ã€‚\n* getInt16ï¼šè¯»å–2ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ª16ä½æ•´æ•°ã€‚\n* getUint16ï¼šè¯»å–2ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ªæ— ç¬¦å·çš„16ä½æ•´æ•°ã€‚\n* getInt32ï¼šè¯»å–4ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ª32ä½æ•´æ•°ã€‚\n* getUint32ï¼šè¯»å–4ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ªæ— ç¬¦å·çš„32ä½æ•´æ•°ã€‚\n* getFloat32ï¼šè¯»å–4ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ª32ä½æµ®ç‚¹æ•°ã€‚\n* getFloat64ï¼šè¯»å–8ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ª64ä½æµ®ç‚¹æ•°ã€‚\n\nè¿™ä¸€ç³»åˆ—getæ–¹æ³•çš„å‚æ•°éƒ½æ˜¯ä¸€ä¸ªå­—èŠ‚åºå·ï¼ˆä¸èƒ½æ˜¯è´Ÿæ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼‰ï¼Œè¡¨ç¤ºä»å“ªä¸ªå­—èŠ‚å¼€å§‹è¯»å–ã€‚\n\n```\nvar buffer = new ArrayBuffer(24);\nvar dv = new DataView(buffer);\n\n// ä»ç¬¬1ä¸ªå­—èŠ‚è¯»å–ä¸€ä¸ª8ä½æ— ç¬¦å·æ•´æ•°\nvar v1 = dv.getUint8(0);\n\n// ä»ç¬¬2ä¸ªå­—èŠ‚è¯»å–ä¸€ä¸ª16ä½æ— ç¬¦å·æ•´æ•°\nvar v2 = dv.getUint16(1);\n\n// ä»ç¬¬4ä¸ªå­—èŠ‚è¯»å–ä¸€ä¸ª16ä½æ— ç¬¦å·æ•´æ•°\nvar v3 = dv.getUint16(3);\n```\n\nä¸Šé¢ä»£ç è¯»å–äº†ArrayBufferå¯¹è±¡çš„å‰5ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª8ä½æ•´æ•°å’Œä¸¤ä¸ªåå…­ä½æ•´æ•°ã€‚\n\nå¦‚æœä¸€æ¬¡è¯»å–ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šå­—èŠ‚ï¼Œå°±å¿…é¡»æ˜ç¡®æ•°æ®çš„å­˜å‚¨æ–¹å¼ï¼Œåˆ°åº•æ˜¯å°ç«¯å­—èŠ‚åºè¿˜æ˜¯å¤§ç«¯å­—èŠ‚åºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒDataViewçš„getæ–¹æ³•ä½¿ç”¨å¤§ç«¯å­—èŠ‚åºè§£è¯»æ•°æ®ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨å°ç«¯å­—èŠ‚åºè§£è¯»ï¼Œå¿…é¡»åœ¨getæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®štrueã€‚\n\n```\n// å°ç«¯å­—èŠ‚åº\nvar v1 = dv.getUint16(1, true);\n\n// å¤§ç«¯å­—èŠ‚åº\nvar v2 = dv.getUint16(3, false);\n\n// å¤§ç«¯å­—èŠ‚åº\nvar v3 = dv.getUint16(3);\n```\n\nDataViewè§†å›¾æä¾›8ä¸ªæ–¹æ³•å†™å…¥å†…å­˜ã€‚\n\n* setInt8ï¼šå†™å…¥1ä¸ªå­—èŠ‚çš„8ä½æ•´æ•°ã€‚\n* setUint8ï¼šå†™å…¥1ä¸ªå­—èŠ‚çš„8ä½æ— ç¬¦å·æ•´æ•°ã€‚\n* setInt16ï¼šå†™å…¥2ä¸ªå­—èŠ‚çš„16ä½æ•´æ•°ã€‚\n* setUint16ï¼šå†™å…¥2ä¸ªå­—èŠ‚çš„16ä½æ— ç¬¦å·æ•´æ•°ã€‚\n* setInt32ï¼šå†™å…¥4ä¸ªå­—èŠ‚çš„32ä½æ•´æ•°ã€‚\n* setUint32ï¼šå†™å…¥4ä¸ªå­—èŠ‚çš„32ä½æ— ç¬¦å·æ•´æ•°ã€‚\n* setFloat32ï¼šå†™å…¥4ä¸ªå­—èŠ‚çš„32ä½æµ®ç‚¹æ•°ã€‚\n* setFloat64ï¼šå†™å…¥8ä¸ªå­—èŠ‚çš„64ä½æµ®ç‚¹æ•°ã€‚\n\nè¿™ä¸€ç³»åˆ—setæ–¹æ³•ï¼Œæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å­—èŠ‚åºå·ï¼Œè¡¨ç¤ºä»å“ªä¸ªå­—èŠ‚å¼€å§‹å†™å…¥ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå†™å…¥çš„æ•°æ®ã€‚å¯¹äºé‚£äº›å†™å…¥ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šå­—èŠ‚çš„æ–¹æ³•ï¼Œéœ€è¦æŒ‡å®šç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œfalseæˆ–è€…undefinedè¡¨ç¤ºä½¿ç”¨å¤§ç«¯å­—èŠ‚åºå†™å…¥ï¼Œtrueè¡¨ç¤ºä½¿ç”¨å°ç«¯å­—èŠ‚åºå†™å…¥ã€‚\n\n```\n// åœ¨ç¬¬1ä¸ªå­—èŠ‚ï¼Œä»¥å¤§ç«¯å­—èŠ‚åºå†™å…¥å€¼ä¸º25çš„32ä½æ•´æ•°\ndv.setInt32(0, 25, false);\n\n// åœ¨ç¬¬5ä¸ªå­—èŠ‚ï¼Œä»¥å¤§ç«¯å­—èŠ‚åºå†™å…¥å€¼ä¸º25çš„32ä½æ•´æ•°\ndv.setInt32(4, 25);\n\n// åœ¨ç¬¬9ä¸ªå­—èŠ‚ï¼Œä»¥å°ç«¯å­—èŠ‚åºå†™å…¥å€¼ä¸º2.5çš„32ä½æµ®ç‚¹æ•°\ndv.setFloat32(8, 2.5, true);\n```\n\nå¦‚æœä¸ç¡®å®šæ­£åœ¨ä½¿ç”¨çš„è®¡ç®—æœºçš„å­—èŠ‚åºï¼Œå¯ä»¥é‡‡ç”¨ä¸‹é¢çš„åˆ¤æ–­æ–¹å¼ã€‚\n\n```\nvar littleEndian = (function() {\n  var buffer = new ArrayBuffer(2);\n  new DataView(buffer).setInt16(0, 256, true);\n  return new Int16Array(buffer)[0] === 256;\n})();\n```\n\n#### Blob\n\nBlob å¯¹è±¡è¡¨ç¤ºä¸€ä¸ªä¸å¯å˜ã€åŸå§‹æ•°æ®çš„ç±»æ–‡ä»¶å¯¹è±¡ã€‚Blob è¡¨ç¤ºçš„ä¸ä¸€å®šæ˜¯JavaScriptåŸç”Ÿæ ¼å¼çš„æ•°æ®ã€‚File æ¥å£åŸºäºBlobï¼Œç»§æ‰¿äº† blob çš„åŠŸèƒ½å¹¶å°†å…¶æ‰©å±•ä½¿å…¶æ”¯æŒç”¨æˆ·ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ã€‚\n\nè¦ä»å…¶ä»–éblobå¯¹è±¡å’Œæ•°æ®æ„é€ ä¸€ä¸ªBlobï¼Œè¯·ä½¿ç”¨ Blob() æ„é€ å‡½æ•°ã€‚è¦åˆ›å»ºåŒ…å«å¦ä¸€ä¸ªblobæ•°æ®çš„å­é›†blobï¼Œè¯·ä½¿ç”¨ slice()æ–¹æ³•ã€‚è¦è·å–ç”¨æˆ·æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶å¯¹åº”çš„Blobå¯¹è±¡ï¼Œè¯·å‚é˜… Fileæ–‡æ¡£ã€‚\n\nä»Blobä¸­è¯»å–å†…å®¹çš„å”¯ä¸€æ–¹æ³•æ˜¯ä½¿ç”¨ FileReaderã€‚ä»¥ä¸‹ä»£ç å°† Blob çš„å†…å®¹ä½œä¸ºç±»å‹æ•°ç»„è¯»å–ï¼š\n\n```\nvar reader = new FileReader();\nreader.addEventListener(\"loadend\", function() {\n   // reader.result åŒ…å«è½¬åŒ–ä¸ºç±»å‹æ•°ç»„çš„blob\n});\nreader.readAsArrayBuffer(blob);\n```\n\næ›´å¤šå…³äºBlobçš„å†…å®¹ï¼Œè¯·ç›´æ¥æŸ¥çœ‹[è¿™é‡Œ](https://developer.mozilla.org/zh-CN/docs/Web/API/Blob)\n\n### æ•°æ®æ ¼å¼è½¬æ¢\n\n#### Stringè½¬Blob\n\n```\n//å°†å­—ç¬¦ä¸² è½¬æ¢æˆ Blob å¯¹è±¡\nvar blob = new Blob([\"Hello World!\"], {\n    type: 'text/plain'\n});\nconsole.info(blob);\nconsole.info(blob.slice(1, 3, 'text/plain'));\n```\n#### TypeArrayè½¬Blob\n\n```\n//å°† TypeArray  è½¬æ¢æˆ Blob å¯¹è±¡\nvar array = new Uint16Array([97, 32, 72, 101, 108, 108, 111, 32, 119, 111, 114, 108, 100, 33]);\n//æµ‹è¯•æˆåŠŸ\n//var blob = new Blob([array], { type: \"application/octet-binary\" });\n//æµ‹è¯•æˆåŠŸï¼Œ æ³¨æ„å¿…é¡»[]çš„åŒ…è£¹\nvar blob = new Blob([array]);\n//å°† Blobå¯¹è±¡ è¯»æˆå­—ç¬¦ä¸²\nvar reader = new FileReader();\nreader.readAsText(blob, 'utf-8');\nreader.onload = function (e) {\n    console.info(reader.result); //a Hello world!\n}\n```\n\n#### ArrayBufferè½¬Blob\n\n```\nvar buffer = new ArrayBuffer(32);\nvar blob = new Blob([buffer]);       // æ³¨æ„å¿…é¡»åŒ…è£¹[]\n```\n\n#### Blobè½¬String\n\nè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯readAsTextæ–¹æ³•çš„ä½¿ç”¨ã€‚\n\n```\n//å°†å­—ç¬¦ä¸²è½¬æ¢æˆ Blobå¯¹è±¡\nvar blob = new Blob(['ä¸­æ–‡å­—ç¬¦ä¸²'], {\n    type: 'text/plain'\n});\n//å°†Blob å¯¹è±¡è½¬æ¢æˆå­—ç¬¦ä¸²\nvar reader = new FileReader();\nreader.readAsText(blob, 'utf-8');\nreader.onload = function (e) {\n    console.info(reader.result);\n}\n```\n\n#### Blobè½¬ArrayBuffer\n\nè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯readAsArrayBufferæ–¹æ³•çš„ä½¿ç”¨ã€‚\n\n```\n//å°†å­—ç¬¦ä¸²è½¬æ¢æˆ Blobå¯¹è±¡\nvar blob = new Blob(['ä¸­æ–‡å­—ç¬¦ä¸²'], {\n    type: 'text/plain'\n});\n//å°†Blob å¯¹è±¡è½¬æ¢æˆ ArrayBuffer\nvar reader = new FileReader();\nreader.readAsArrayBuffer(blob);\nreader.onload = function (e) {\n    console.info(reader.result); //ArrayBuffer {}\n    //ç»å¸¸ä¼šé‡åˆ°çš„å¼‚å¸¸ Uncaught RangeError: byte length of Int16Array should be a multiple of 2\n    //var buf = new int16array(reader.result);\n    //console.info(buf);\n\n    //å°† ArrayBufferView  è½¬æ¢æˆBlob\n    var buf = new Uint8Array(reader.result);\n    console.info(buf); //[228, 184, 173, 230, 150, 135, 229, 173, 151, 231, 172, 166, 228, 184, 178]\n    reader.readAsText(new Blob([buf]), 'utf-8');\n    reader.onload = function () {\n        console.info(reader.result); //ä¸­æ–‡å­—ç¬¦ä¸²\n    };\n\n    //å°† ArrayBufferView  è½¬æ¢æˆBlob\n    var buf = new DataView(reader.result);\n    console.info(buf); //DataView {}\n    reader.readAsText(new Blob([buf]), 'utf-8');\n    reader.onload = function () {\n        console.info(reader.result); //ä¸­æ–‡å­—ç¬¦ä¸²\n    };\n}\n```\n\n","tags":["javascript"]},{"title":"LinuxæœåŠ¡å™¨åˆå§‹åŒ–è®¾ç½®ç”¨æˆ·å’Œsshå…¬ç§é’¥ç™»é™†","url":"/2018/04/11/LinuxæœåŠ¡å™¨åˆå§‹åŒ–è®¾ç½®ç”¨æˆ·å’Œsshå…¬ç§é’¥ç™»é™†/","content":"\n>å½“æˆ‘ä»¬å¼€å§‹ä½¿ç”¨ä¸€ä¸ªæ–°çš„æœåŠ¡å™¨çš„æ—¶å€™ï¼Œé¦–å…ˆä¸€å®šè¦å¯¹æœåŠ¡å™¨çš„ç™»é™†ç­‰åšä¸€äº›ä¿®æ”¹å·¥ä½œï¼Œç¬”è€…æ›¾ç»å°±å› ä¸ºå¯¹æœåŠ¡å™¨ç™»é™†å®‰å…¨æ²¡æœ‰é‡è§†ï¼Œå¯¼è‡´æœåŠ¡å™¨æ•°æ®å…¨éƒ¨ä¸¢å¤±ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æŒ‰ç…§æ­¥éª¤ï¼Œç½—åˆ—å‡ºåº”è¯¥åšçš„ä¸€äº›äº‹æƒ…ã€‚\n\n### ä¿®æ”¹sshç«¯å£å·\n\nç¬¬ä¸€ä»¶äº‹æƒ…ï¼š\n\nä¿®æ”¹sshç«¯å£å·ï¼š ä¹‹ååŠ ä¸Šä¸€ä¸ªç«¯å£æ¯”å¦‚è¯´50000\n\n`vi /etc/ssh/sshd_config`ä¹‹ååœ¨portå­—æ®µåŠ ä¸Šä¸€ä¸ªç«¯å£æ¯”å¦‚è¯´50000ï¼ŒåŸæ¥çš„ç«¯å£å·å­—æ®µå¯èƒ½æ˜¯è¢«æ³¨é‡Šæ‰çš„ï¼Œè¦å…ˆè§£é™¤æ³¨é‡Šã€‚\n\nç„¶åæ‰§è¡Œï¼š\n\n```\nservice sshd restart\n```\n\nè¿™ä¸ªæ—¶å€™å¯èƒ½è¿˜è¦é‡æ–°é…ç½®ä¸€ä¸‹é˜²ç«å¢™ï¼Œå¼€æ”¾50000ç«¯å£ï¼Œå…·ä½“å¦‚ä½•é…ç½®ä¹Ÿå¯ä»¥å‚è€ƒ[è¿™é‡Œ](https://blog.csdn.net/ul646691993/article/details/52104082)çš„ååŠéƒ¨åˆ†ã€‚ä½†æ˜¯ç›®å‰ï¼Œé˜¿é‡Œäº‘çš„æœåŠ¡å™¨å®æµ‹æ˜¯ä¸éœ€è¦å†é…ç½®é˜²ç«å¢™çš„ï¼Œä½†æ˜¯éœ€è¦å»ç™»é™†åˆ°ç½‘é¡µåå°ä¿®æ”¹å®‰å…¨ç»„ã€‚\n\nä¹‹åå°±å¯ä»¥é€šè¿‡è¿™æ ·çš„æ–¹å¼ç™»å½•äº†ï¼š(æ³¨æ„ç™»å½•æ–¹å¼ä¸€å®šè¦å†™å¯¹)\n\n```shell\nssh root@115.29.102.81 -p 50000\n```\n\n### åˆ›å»ºç”¨æˆ·\n\nè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¿˜æ˜¯ç”¨rootè¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥ä¸‹æ¥è¦ç»™è‡ªå·±åˆ›å»ºä¸€ä¸ªè´¦æˆ·ï¼Œæ¯”å¦‚åˆ›å»ºä¸€ä¸ªå¦‚ä¸‹çš„ç”¨æˆ·ï¼š\n\n```\nuseradd xiaotao\npasswd xiaotao\n```\n\nå¯ä»¥ç”¨`ls -al /home/``æŸ¥çœ‹ä¸€ä¸‹è´¦æˆ·\n\nå¯¹åˆ›å»ºçš„è¿™ä¸ªç”¨æˆ·å¢åŠ sudoæƒé™ï¼š ç›¸å…³é…ç½®æ–‡ä»¶/etc/sudoersä¸­ï¼Œä½†æ˜¯è¿™ä¸ªæ–‡ä»¶æ˜¯åªè¯»çš„ï¼Œæ‰€ä»¥è¦æ›´æ”¹ä¸€ä¸‹æƒé™\n\n```\nchmod u+w sudoers\n```\n\nç„¶åè¿›å…¥è¿™ä¸ªæ–‡ä»¶åœ¨è¿™é‡Œè¿›è¡Œæ›´æ”¹ï¼š\n\n```\nroot    ALL=(ALL)       ALL\nxiaotao  ALL=(ALL)       ALL\n```\n\nç„¶åå†æ”¹å›æƒé™ï¼š\n\n```\nchmod u-w sudoers\n```\n\næ³¨æ„ä¸€ç‚¹ï¼ŒCentOS 7é¢„è®¾å®¹è®¸ä»»ä½•å¸å·é€è¿‡sshç™»å…¥ï¼ˆä¹Ÿå°±æ˜¯è¯´è‡ªå·±æ ¹æœ¬ä¸ç”¨æ”¹æ”¹ï¼Œç›´æ¥æ–°å»ºå¸å·ç™»å½•å³å¯ï¼‰ï¼ŒåŒ…æ‹¬æ ¹å’Œä¸€èˆ¬å¸å·ï¼Œä¸ºäº†ä¸å—æ ¹å¸å·è¢«é»‘å®¢æš´åŠ›å…¥ä¾µï¼Œæˆ‘ä»¬å¿…é¡»ç¦æ­¢ rootå¸å·çš„sshåŠŸèƒ½ï¼Œäº‹å®ä¸Šrootä¹Ÿæ²¡æœ‰å¿…è¦sshç™»å…¥ä¼ºæœå™¨ï¼Œå› ä¸ºåªè¦ä½¿ç”¨suæˆ–sudoï¼ˆå½“ç„¶éœ€è¦è¾“å…¥rootçš„å¯†ç ï¼‰æ™®é€šå¸å·ä¾¿å¯ä»¥æ‹¥æœ‰rootçš„æƒé™ã€‚ä½¿ç”¨vimï¼ˆæˆ–ä»»ä½•æ–‡æœ¬ç¼–è¾‘å™¨ï¼‰å¼€å¯çš„/ etc/ SSH/ sshd_configä¸­ï¼Œå¯»æ‰¾ï¼š\n\n```\nï¼ƒPermitRootLogin yes\n```\nä¿®æ”¹ï¼š\n\n```\nPermitRootLogin no\n```\n\n### é…ç½®å…¬ç§é’¥åŠ å¯†ç™»å½•\n\n**è¿™ä¸€æ­¥éª¤è¦åˆ‡æ¢åˆ°è‡ªå·±æ–°å»ºçš„ç”¨æˆ·ï¼Œä¸èƒ½å†ç”¨ root ç”¨æˆ·äº†ï¼Œå¦åˆ™å¯èƒ½æ— æ³•æ­£å¸¸ç™»é™†ã€‚**\n\nå¾ˆå¤šæ—¶å€™ä»¥ä¸Šæ‰€è¯´çš„è¿˜æ˜¯ä¸å¤Ÿå®‰å…¨ï¼Œä¸ºäº†æ›´åŠ å®‰å…¨æ–¹ä¾¿ï¼Œæˆ‘ä»¬é‡‡ç”¨å…¬ç§é’¥å¯¹ç§°åŠ å¯†ç™»å½•ï¼Œç®€å•çš„è®²åšæ³•å°±æ˜¯å†å®¢æˆ·ç«¯ç”Ÿæˆä¸€æŠŠç§é’¥ä¸€æŠŠå…¬é’¥ï¼Œç§é’¥æ˜¯åœ¨å®¢æˆ·ç«¯çš„ï¼Œå…¬é’¥ä¸Šä¼ åˆ°æœåŠ¡ç«¯ï¼Œå¯¹ç§°åŠ å¯†è¿›è¡Œç™»å½•ã€‚\n\nåœ¨å®¢æˆ·ç«¯å…ˆè¿›åˆ°è¿™ä¸ªç›®å½•ï¼š\n\n```\ncd ~/.ssh\n```\n\nç”Ÿæˆå…¬é’¥å’Œç§é’¥ï¼ˆå®é™…ä¸Šå¦‚æœä¹‹å‰æœ‰çš„è¯å°±ä¸ç”¨é‡æ–°ç”Ÿæˆäº†ï¼‰\n\n```\nssh-keygen -t rsa\n```\n\næ¥ä¸‹æ¥æŠŠå…¬é’¥ä¸Šä¼ åˆ°æœåŠ¡ç«¯\n\n```\nscp ~/.ssh/id_rsa.pub xiaotao@<ssh_server_ip>:~\n```\n\nåœ¨æœåŠ¡ç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤(å¦‚æœæ²¡æœ‰ç›¸å…³çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹è¦å…ˆè¿›è¡Œåˆ›å»ºï¼Œæ³¨æ„ä¸è¦ä½¿ç”¨ sudo )\n\n```\ncat  id_rsa.pub >> ï½/.ssh/authorized_keys\n```\n\né…ç½®æœåŠ¡å™¨çš„/etc/ssh/sshd_configï¼Œä¸‹é¢æ˜¯ä¸€äº›å»ºè®®çš„é…ç½®ï¼š\n\n```\nvim /etc/ssh/sshd_config\n# ç¦ç”¨rootè´¦æˆ·ç™»å½•ï¼Œéå¿…è¦ï¼Œä½†ä¸ºäº†å®‰å…¨æ€§ï¼Œè¯·é…ç½®\nPermitRootLogin no\n\n# æ˜¯å¦è®© sshd å»æ£€æŸ¥ç”¨æˆ·å®¶ç›®å½•æˆ–ç›¸å…³æ¡£æ¡ˆçš„æƒé™æ•°æ®ï¼Œ\n# è¿™æ˜¯ä¸ºäº†æ‹…å¿ƒä½¿ç”¨è€…å°†æŸäº›é‡è¦æ¡£æ¡ˆçš„æƒé™è®¾é”™ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜æ‰€è‡´ã€‚\n# ä¾‹å¦‚ä½¿ç”¨è€…çš„ ~.ssh/ æƒé™è®¾é”™æ—¶ï¼ŒæŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ä¼šä¸è®¸ç”¨æˆ·ç™»å…¥\nStrictModes no\n\n# æ˜¯å¦å…è®¸ç”¨æˆ·è‡ªè¡Œä½¿ç”¨æˆå¯¹çš„å¯†é’¥ç³»ç»Ÿè¿›è¡Œç™»å…¥è¡Œä¸ºï¼Œä»…é’ˆå¯¹ version 2ã€‚\n# è‡³äºè‡ªåˆ¶çš„å…¬é’¥æ•°æ®å°±æ”¾ç½®äºç”¨æˆ·å®¶ç›®å½•ä¸‹çš„ .ssh/authorized_keys å†…\nRSAAuthentication yes\nPubkeyAuthentication yes\nAuthorizedKeysFile      %h/.ssh/authorized_keys\n\n#æœ‰äº†è¯ä¹¦ç™»å½•äº†ï¼Œå°±ç¦ç”¨å¯†ç ç™»å½•å§ï¼Œå®‰å…¨è¦ç´§\nPasswordAuthentication no\n```\n\nç„¶åä¸è¦å¿˜è®° `sudo service sshd restart`\n\n\nä¸€èˆ¬æ¥è®²ï¼Œè¿™æ ·å°±ç®—æ˜¯æˆåŠŸäº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®¢æˆ·ç«¯å°è¯•ï¼š\n\n```\nssh -i ~/.ssh/id_rsa remote_username@remote_ip\n```\n\nå¦‚æœä¸è¡Œï¼Œå¯èƒ½æ˜¯æœåŠ¡ç«¯æˆ–å®¢æˆ·ç«¯ç›¸å…³ `.ssh` æ–‡ä»¶æƒé™ä¸å¯¹ï¼Œå¯ä»¥è¿›è¡Œå¦‚ä¸‹å°è¯•ï¼š\n\n```\næœåŠ¡ç«¯\nchown -R 0700  ~/.ssh\nchown -R 0644  ~/.ssh/authorized_keys\n\nå®¢æˆ·ç«¯æ”¹ä¸€ä¸‹\nchmod 600 id_rsa\n```","tags":["Linux","ssh"]},{"title":"dvaæºç è§£è¯»","url":"/2018/04/11/dvaæºç è§£è¯»/","content":"\n### å£°æ˜\n\næœ¬æ–‡ç« ç”¨äºä¸ªäººå­¦ä¹ ç ”ç©¶ï¼Œå¹¶ä¸ä»£è¡¨ dva å›¢é˜Ÿçš„ä»»ä½•è§‚ç‚¹ã€‚\n\nåŸæ–‡ä»¥åŠåŒ…å«ä¸€å®šæ³¨é‡Šçš„ä»£ç è§[è¿™é‡Œ](https://github.com/aircloud/dva-analysis)ï¼Œè‹¥æœ‰é—®é¢˜ä¹Ÿå¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/aircloud/dva-analysis/issues)è¿›è¡Œè®¨è®º\n\n### èµ·æ­¥\n\n#### ä¸ºä»€ä¹ˆæ˜¯dva?\n\nç¬”è€…å¯¹ dva çš„æºä»£ç è¿›è¡Œè§£è¯»ï¼Œä¸»è¦è€ƒè™‘åˆ° dva å¹¶ä¸æ˜¯ä¸€ä¸ªå’Œæˆ‘ä»¬ç†ŸçŸ¥çš„ä¸»æµæŠ€æœ¯æ— å…³çš„ä»0åˆ°1çš„æ¡†æ¶ï¼Œç›¸åï¼Œå®ƒæ˜¯å¯¹ä¸»æµæŠ€æœ¯è¿›è¡Œæ•´åˆï¼Œæç‚¼ï¼Œä»è€Œå½¢æˆä¸€ç§æœ€ä½³å®è·µï¼Œåˆ†æ dvaï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥å¯¹è‡ªå·±æŒæ¡çš„å¾ˆå¤šç›¸å…³æŠ€æœ¯è¿›è¡Œå›é¡¾ï¼Œå¦å¤–ï¼Œdva çš„ä»£ç é‡å¹¶ä¸å¤šï¼Œä¹Ÿä¸è‡³äºæ™¦æ¶©éš¾æ‡‚ï¼Œå¯ä»¥ç»™æˆ‘ä»¬å¹³æ—¶çš„ä¸šåŠ¡å¼€å‘ä»¥å¯å‘ã€‚\n\næœ¬æ–‡ç« ä½œä¸º dva çš„æºç è§£è¯»æ–‡ç« ï¼Œå¹¶ä¸é¢å‘æ–°æ‰‹ç”¨æˆ·ï¼Œè¯»è€…åº”å½“æœ‰ä¸€å®šçš„ react ä½¿ç”¨ç»éªŒå’Œ ECMAscript 2015+ çš„ä½¿ç”¨ç»éªŒï¼Œå¹¶ä¸”åº”å½“äº†è§£ redux å’Œ redux-sagaï¼Œä»¥åŠå¯¹ dva çš„ä½¿ç”¨æœ‰æ‰€äº†è§£(å¯ä»¥ä»[è¿™é‡Œ](https://github.com/dvajs/dva/blob/master/README_zh-CN.md#%E4%B8%BA%E4%BB%80%E4%B9%88%E7%94%A8-dva-)äº†è§£ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨ dva)\n\né‡ç‚¹æ¨è:\n\n* é€šè¿‡[è¿™é‡Œ](https://github.com/dvajs/dva-knowledgemap)çš„å†…å®¹äº†è§£ä½¿ç”¨dvaçš„æœ€å°çŸ¥è¯†é›†\n* é€šè¿‡[è¿™é‡Œ](https://redux-saga-in-chinese.js.org/docs/introduction/index.html)å­¦ä¹  redux-saga\n\nå…¶ä»–æ¨èï¼š\n\n* [dvaçš„æ¦‚å¿µ](https://github.com/dvajs/dva/blob/master/docs/Concepts_zh-CN.md)\n* [dvaçš„å…¨éƒ¨API](https://github.com/dvajs/dva/blob/master/docs/API_zh-CN.md)\n* [React+Redux æœ€ä½³å®è·µ](https://github.com/sorrycc/blog/issues/1)\n* [Reactåœ¨èš‚èšé‡‘æœçš„å®è·µ](http://slides.com/sorrycc/dva#/)\n* [dva 2.0çš„æ”¹è¿›](https://github.com/sorrycc/blog/issues/48)\n* [ReSelectä»‹ç»](http://cn.redux.js.org/docs/recipes/ComputingDerivedData.html)\n* [æµ…æRedux çš„ store enhancer](https://www.jianshu.com/p/04d3fefea8d7)\n\n\nå‡ ä¸ª dva ç‰ˆæœ¬ä¹‹é—´çš„å…³ç³»:\n\n* dva@2.0ï¼šåŸºäº react å’Œ react-router@4\n* dva-react-router-3@1.0ï¼šåŸºäº react å’Œ react-router@3\n* dva-no-router@1.0ï¼šæ— è·¯ç”±ç‰ˆæœ¬ï¼Œé€‚ç”¨äºå¤šé¡µé¢åœºæ™¯ï¼Œå¯ä»¥å’Œ next.js ç»„åˆä½¿ç”¨\n* dva-core@1.0ï¼šä»…å°è£…äº† redux å’Œ redux-saga\n\næˆ‘ä»¬æœ¬æ¬¡ä¸»è¦åˆ†æç›®æ ‡ä¸º dva@2.0 å’Œ dva-core@1.0\n\n\n### æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦ redux-saga\n\nç›®å‰ï¼Œåœ¨å¤§å¤šæ•°é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç°åœ¨ä¾ç„¶é‡‡ç”¨çš„æ˜¯redux-thunk + async/await (æˆ– Promise)ã€‚\n\nå®é™…ä¸Šè¿™ä¸ªåå‡ è¡Œçš„æ’ä»¶å·²ç»å®Œå…¨å¯ä»¥è§£å†³å¤§å¤šæ˜¯åœºæ™¯ä¸‹çš„é—®é¢˜äº†ï¼Œå¦‚æœä½ åœ¨ç›®å‰çš„å·¥ä½œä¸­æ­£åœ¨ä½¿ç”¨è¿™ä¸€å¥—æ–¹æ¡ˆå¹¶ä¸”èƒ½å¤Ÿå®Œå…¨å°†å½“ä¸‹çš„éœ€æ±‚åº”ä»˜è‡ªå¦‚å¹¶ä¸”æ²¡æœ‰ä»€ä¹ˆå‡Œä¹±çš„åœ°æ–¹ï¼Œå…¶å®ä¹Ÿæ˜¯æ²¡æœ‰å¿…è¦æ¢æˆredux-sagaçš„ã€‚\n\næ¥ä¸‹æ¥æˆ‘ä»¬è®² redux-sagaï¼Œå…ˆçœ‹åå­—ï¼šsagaï¼Œè¿™ä¸ªæœ¯è¯­å¸¸ç”¨äºCQRSæ¶æ„ï¼Œä»£è¡¨æŸ¥è¯¢ä¸è´£ä»»åˆ†ç¦»ã€‚\n\nç›¸æ¯”äº redux-thunkï¼Œå‰è€…é€šå¸¸æ˜¯æŠŠæ•°æ®æŸ¥è¯¢ç­‰è¯·æ±‚æ”¾åœ¨ actions ä¸­(ä¸çº¯å‡€çš„ actions)ï¼Œå¹¶ä¸”è¿™äº› actions å¯ä»¥ç»§ç»­å›è°ƒè°ƒç”¨å…¶ä»– actions(çº¯å‡€çš„ actions)ï¼Œä»è€Œå®Œæˆæ•°æ®çš„æ›´æ–°ï¼›è€Œ redux-sagaï¼Œåˆ™ä¿æŒäº† actions çš„çº¯ç²¹æ€§ï¼Œå•ç‹¬æŠ½å‡ºä¸€å±‚ä¸“é—¨æ¥å¤„ç†æ•°æ®è¯·æ±‚ç­‰æ“ä½œ(sagaå‡½æ•°)ã€‚\n\nè¿™æ ·åšè¿˜æœ‰å¦å¤–ä¸€äº›å¥½å¤„ï¼š\n\n* ç”±äºæˆ‘ä»¬å·²ç»å°†æ•°æ®å¤„ç†æ•°æ®è¯·æ±‚ç­‰å¼‚æ­¥æ“ä½œæŠ½ç¦»å‡ºæ¥äº†ï¼Œå¹¶ä¸”é€šè¿‡ generator æ¥å¤„ç†ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œå¤šç§å¼‚æ­¥ç®¡ç†ï¼šæ¯”å¦‚åŒæ—¶æŒ‰é¡ºåºæ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€åœ¨å¤šä¸ªå¼‚æ­¥ä»»åŠ¡ä¸­å¯åŠ¨raceç­‰ã€‚\n* è¿™æ ·åšå¯ä»¥å»¶é•¿ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œæˆ‘ä»¬çš„ä¸€æ¬¡è°ƒç”¨å¯ä»¥ä¸å†æ˜¯ä¸€ä¸ª\"è°ƒå®Œå³èµ°\"çš„è¿‡ç¨‹ï¼Œè¿˜å¯ä»¥æ˜¯ä¸€ä¸ªLLTï¼ˆLong Lived Transaction)çš„äº‹ç‰©å¤„ç†è¿‡ç¨‹ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥å°†ç”¨æˆ·çš„ç™»å…¥ã€ç™»å‡ºçš„ç®¡ç†æ”¾åœ¨ä¸€ä¸ªsagaå‡½æ•°ä¸­å¤„ç†ã€‚\n\nå½“ç„¶ï¼Œredux-sagaè¿˜æœ‰æ¯”å¦‚æ‹¥æœ‰æœ‰è¯¸å¤šå¸¸ç”¨å¹¶ä¸”å£°æ˜å¼æ˜“æµ‹çš„ Effectsã€å¯ä»¥æ— é˜»å¡çš„forkç­‰ä¸€äº›æ›´å¤æ‚çš„å¼‚æ­¥æ“ä½œå’Œç®¡ç†æ–¹æ³•ï¼Œå¦‚æœåº”ç”¨ä¸­æœ‰è¾ƒå¤šå¤æ‚çš„å¼‚æ­¥æ“ä½œæµç¨‹ï¼Œä½¿ç”¨redux-sagaæ— ç–‘ä¼šè®©æ¡ç†æ›´åŠ æ¸…æ¥šã€‚\n\nå½“ç„¶ï¼Œæœ¬æ–‡çš„ç›®çš„ä¸æ˜¯ä»‹ç»æˆ–è€…å®‰åˆ©redux-sagaï¼Œåªæ˜¯å› ä¸ºredux-sagaæ˜¯ dva çš„ä¸€ä¸ªåŸºç¡€ï¼Œç›¸å…³æ¦‚å¿µç‚¹åˆ°ä¸ºæ­¢ï¼Œå¦‚éœ€äº†è§£æ›´å¤šè¯·è‡ªè¡Œå‚è€ƒèµ„æ–™ã€‚\n\n### dva æºç è§£è¯»\n\næˆ‘ä»¬çš„æºç åˆ†ææµç¨‹æ˜¯è¿™æ ·çš„ï¼šé€šè¿‡ä¸€ä¸ªä½¿ç”¨ dva å¼€å‘çš„ä¾‹å­ï¼Œéšç€å…¶å¯¹ dva å‡½æ•°çš„é€æ­¥è°ƒç”¨ï¼Œæ¥åˆ†æå†…éƒ¨ dva ç›¸å…³å‡½æ•°çš„å®ç°åŸç†ã€‚\n\næˆ‘ä»¬åˆ†æé‡‡ç”¨çš„ä¾‹å­æ˜¯ dva å®˜æ–¹æä¾›çš„ä¸€ä¸ªå¢åˆ æ”¹æŸ¥çš„åº”ç”¨ï¼Œå¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/dvajs/dva/tree/rewrite-dynamic)æ‰¾åˆ°å®ƒçš„æºä»£ç ã€‚\n\næˆ‘ä»¬å…ˆçœ‹è¯¥ä¾‹å­çš„å…¥å£æ–‡ä»¶ï¼š\n\n```\nimport dva from 'dva';\nimport createHistory from 'history/createBrowserHistory';\nimport createLoading from 'dva-loading';\nimport { message } from 'antd';\nimport './index.css';\n\nconst ERROR_MSG_DURATION = 3; // 3 ç§’\n\n// 1. Initialize\nconst app = dva({\n  history: createHistory(),\n  onError(e) {\n    message.error(e.message, ERROR_MSG_DURATION);\n  },\n});\n\n// 2. Plugins\napp.use(createLoading());\n\n// 3. Model\n// Moved to router.js\n// è¿™é‡Œçš„ Model è¢«è½¬ç§»åˆ°äº†åŠ¨æ€åŠ è½½çš„ router é‡Œé¢ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¦‚ä¸‹å†™ï¼š\n// app.model(require('./models/users'));\n\n// 4. Router\napp.router(require('./router'));\n\n// 5. Start\napp.start('#root');\n```\n\næˆ‘ä»¬å‘ç°dvaä»åˆå§‹åŒ–é…ç½®åˆ°æœ€åçš„start(ç°åœ¨çš„dva startå‡½æ•°åœ¨ä¸ä¼ å…¥containerçš„æƒ…å†µä¸‹å¯ä»¥è¿”å›React Componentï¼Œä¾¿äºæœåŠ¡ç«¯æ¸²æŸ“ç­‰ï¼Œä½†è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯æŒ‰ç…§ä¾‹å­çš„å†™æ³•æ¥)ã€‚\n\nè¿™é‡Œæˆ‘ä»¬å…ˆæœ‰å¿…è¦è§£é‡Šä¸€ä¸‹ï¼Œdva åœ¨å½“å‰ä¾æ®èƒ½åŠ›å’Œä¾èµ–ç‰ˆæœ¬çš„ä¸åŒï¼Œæœ‰å¤šä¸ªå¯å¼•å…¥çš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬çš„ä¾‹å­å’Œæ‰€è¦åˆ†æçš„æºä»£ç éƒ½æ˜¯åŸºäº react-router V4 çš„ dva ç‰ˆæœ¬ã€‚\n\nåœ¨æºä»£ç ä¸­ï¼Œç›¸å…³ç›®å½•ä¸»è¦ä¸º dva ç›®å½•(packages/dva) å’Œ dva-core(packages/dva-core)ç›®å½•ï¼Œå‰è€…ä¸»è¦æ‹¥æœ‰historyç®¡ç†ã€routerã€åŠ¨æ€åŠ è½½ç­‰åŠŸèƒ½ï¼Œè€Œåè€…æ˜¯ä¸ä¾èµ–è¿™äº›å†…å®¹çš„åŸºç¡€æ¨¡å—éƒ¨åˆ†ï¼Œä¸ºå‰è€…æ‰€å¼•ç”¨\n\n#### ç¬¬ä¸€æ­¥\n\nç¬¬ä¸€æ­¥è¿™é‡Œä¼ å…¥äº†ä¸¤ä¸ªå†…å®¹ï¼š(dvaæ„é€ å‡½æ•°æ€»å…±å¯ä»¥ä¼ å…¥é‚£äº› optsï¼Œä¼šåœ¨ä¸‹æ–‡ä¸­è¿›è¡Œè¯´æ˜)\n\n```\nconst app = dva({\n  history: createHistory(),\n  onError(e) {\n    message.error(e.message, ERROR_MSG_DURATION);\n  },\n});\n```\n\nè¿™ä¸€æ­¥çš„ç›¸å…³æ ¸å¿ƒä»£ç å¦‚ä¸‹:\n\n```\nexport default function (opts = {}) {\n  const history = opts.history || createHashHistory(); // é»˜è®¤ä¸º HashHistory\n  const createOpts = {\n    initialReducer: {\n      routing, // æ¥è‡ª react-router-redux çš„ routerReducer\n    },\n    setupMiddlewares(middlewares) {\n      return [\n        routerMiddleware(history), // æ¥è‡ª react-router-redux çš„ routerMiddleware\n        ...middlewares,\n      ];\n    },\n    setupApp(app) {\n      app._history = patchHistory(history); \n    },\n  };\n\n  const app = core.create(opts, createOpts);\n  const oldAppStart = app.start;\n  app.router = router;\n  app.start = start;\n  return app;\n  \n  // ä¸€äº›ç”¨åˆ°çš„å‡½æ•°çš„å®šä¹‰...\n  \n}  \n```\n\nè¿™é‡Œé¢å¤§å¤šæ•°å†…å®¹éƒ½æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œé¢æä¸¤ä¸ªåœ°æ–¹ï¼š\n\n1. patchHistoryï¼š\n\n```\nfunction patchHistory(history) {\n  const oldListen = history.listen;\n  history.listen = (callback) => {\n    callback(history.location);\n    return oldListen.call(history, callback);\n  };\n  return history;\n}\n```\n\næ˜¾ç„¶ï¼Œè¿™é‡Œçš„æ„æ€æ˜¯è®©ç¬¬ä¸€æ¬¡è¢«ç»‘å®š listener çš„æ—¶å€™æ‰§è¡Œä¸€é callbackï¼Œå¯ä»¥ç”¨äºåˆå§‹åŒ–ç›¸å…³æ“ä½œã€‚\n\næˆ‘ä»¬å¯ä»¥åœ¨`router.js`ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç æ¥éªŒè¯ï¼š\n\n```\n  history.listen((location, action)=>{\n    console.log('history listen:', location, action)\n  })\n```\n\n2. åœ¨å®Œæˆå¯é€‰é¡¹çš„æ„é€ ä¹‹åï¼Œè°ƒç”¨äº† dva-core ä¸­æš´éœ²çš„ create å‡½æ•°ã€‚\n\ncreate å‡½æ•°æœ¬èº«ä¹Ÿå¹¶ä¸å¤æ‚ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š\n\n```javascript\nexport function create(hooksAndOpts = {}, createOpts = {}) {\n  const {\n    initialReducer,\n    setupApp = noop,\n  } = createOpts;\n\n  const plugin = new Plugin(); // å®ä¾‹åŒ–é’©å­å‡½æ•°ç®¡ç†ç±»\n  plugin.use(filterHooks(hooksAndOpts)); // è¿™ä¸ªæ—¶å€™å…ˆå¯¹ obj è¿›è¡Œæ¸…ç†ï¼Œæ¸…ç†å‡ºåœ¨æˆ‘ä»¬å®šä¹‰çš„ç±»å‹ä¹‹å¤–çš„ hooksï¼Œä¹‹åè¿›è¡Œç»Ÿä¸€ç»‘å®š\n\n  const app = {\n    _models: [\n      prefixNamespace({ ...dvaModel }), // å‰ç¼€å¤„ç†\n    ],\n    _store: null,\n    _plugin: plugin,\n    use: plugin.use.bind(plugin),\n    model, // ä¸‹æ–‡å®šä¹‰\n    start, // ä¸‹æ–‡å®šä¹‰\n  };\n  return app;\n \n  //ä¸€äº›å‡½æ•°çš„å®šä¹‰\n  \n}  \n```\n\nè¿™é‡Œé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„ `hooksAndOpts` å®é™…ä¸Šå°±æ˜¯ä¸€å¼€å§‹æˆ‘ä»¬æ„é€  dva çš„æ—¶å€™ä¼ å…¥çš„ opts å¯¹è±¡ç»è¿‡å¤„ç†ä¹‹åçš„ç»“æœã€‚\n\næˆ‘ä»¬å¯ä»¥ä¼ å…¥çš„å¯é€‰é¡¹ï¼Œå®é™…ä¸Šéƒ½åœ¨ `Plugin.js` ä¸­å†™æ˜äº†:\n\n```\nconst hooks = [\n  'onError',\n  'onStateChange',\n  'onAction',\n  'onHmr',\n  'onReducer',\n  'onEffect',\n  'extraReducers',\n  'extraEnhancers',\n];\n```\n\nå…·ä½“ [hooksçš„ä½œç”¨å¯ä»¥åœ¨è¿™é‡Œè¿›è¡ŒæŸ¥é˜…](https://github.com/dvajs/dva/blob/master/docs/API_zh-CN.md#appusehooks)ã€‚\n\nPlugin æ’ä»¶ç®¡ç†ç±»(å®é™…ä¸Šæˆ‘è®¤ä¸ºç§°å…¶ä¸ºé’©å­å‡½æ•°ç®¡ç†ç±»æ¯”è¾ƒåˆé€‚)é™¤äº†å®šä¹‰äº†ä¸Šæ–‡çš„ä½¿ç”¨åˆ°çš„useæ–¹æ³•(æŒ‚è½½æ’ä»¶)ã€è¿˜æœ‰applyæ–¹æ³•(æ‰§è¡ŒæŸä¸€ä¸ªé’©å­ä¸‹æŒ‚è½½çš„æ‰€æœ‰å›è°ƒ)ã€getæ–¹æ³•(è·å–æŸä¸€ä¸ªé’©å­ä¸‹çš„æ‰€æœ‰å›è°ƒï¼Œè¿”å›æ•°ç»„)\n\n\n#### ç¬¬äºŒæ­¥\n\n\nè¿™é‡Œçš„ç¬¬äºŒæ­¥æ¯”è¾ƒç®€æ´ï¼šæˆ‘ä»¬çŸ¥é“å®é™…ä¸Šè¿™é‡Œå°±æ˜¯ä½¿ç”¨äº†`plugin.use`æ–¹æ³•æŒ‚è½½äº†ä¸€ä¸ªæ’ä»¶\n\n```javascript\napp.use(createLoading()); // éœ€è¦æ³¨æ„ï¼Œæ’ä»¶æŒ‚è½½éœ€è¦åœ¨ app.start ä¹‹å‰\n```\n\ncreateLoading è¿™ä¸ªæ’ä»¶å®é™…ä¸Šæ˜¯å®˜æ–¹æä¾›çš„ Loading æ’ä»¶ï¼Œé€šè¿‡è¿™ä¸ªæ’ä»¶æˆ‘ä»¬å¯ä»¥éå¸¸æ–¹ä¾¿åœ°è¿›è¡Œ Loading çš„ç®¡ç†ï¼Œæ— éœ€è¿›è¡Œæ‰‹åŠ¨ç®¡ç†ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆ[çœ‹ä¸€ç¯‡æ–‡ç« ](https://www.jianshu.com/p/61fe7a57fad4)æ¥ç®€å•äº†è§£ä¸€ä¸‹ã€‚\n\nè¿™ä¸ªæ’ä»¶çœ‹ä¼¼ç¥å¥‡ï¼Œå®é™…ä¸ŠåŸç†ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä¸»è¦ç”¨äº†`onEffect`é’©å­å‡½æ•°(è£…é¥°å™¨)ï¼š\n\n```javascript\nfunction onEffect(effect, { put }, model, actionType) {\n    const { namespace } = model;\n    if (\n        (only.length === 0 && except.length === 0)\n        || (only.length > 0 && only.indexOf(actionType) !== -1)\n        || (except.length > 0 && except.indexOf(actionType) === -1)\n    ) {\n        return function*(...args) {\n            yield put({ type: SHOW, payload: { namespace, actionType } });\n            yield effect(...args);\n            yield put({ type: HIDE, payload: { namespace, actionType } });\n        };\n    } else {\n        return effect;\n    }\n  }\n```\n\nç»“åˆåŸºäºçš„redux-sagaï¼Œåœ¨ç›®æ ‡å¼‚æ­¥è°ƒç”¨å¼€å§‹çš„æ—¶å€™`yield put({ type: SHOW, payload: { namespace, actionType } });`ï¼Œåœ¨å¼‚æ­¥è°ƒç”¨ç»“æŸçš„æ—¶å€™`yield put({ type: HIDE, payload: { namespace, actionType } });`ï¼Œè¿™æ ·å°±å¯ä»¥ç®¡ç†å¼‚æ­¥è°ƒç”¨å¼€å§‹å’Œç»“æŸçš„LoadingçŠ¶æ€äº†ã€‚\n\n\n#### ç¬¬ä¸‰æ­¥\n\nç¬¬ä¸‰æ­¥è¿™é‡Œå…¶å®çœç•¥äº†ï¼Œå› ä¸ºä½¿ç”¨äº†åŠ¨æ€åŠ è½½ï¼Œå°† Models å®šä¹‰çš„å†…å®¹å’Œ React Component è¿›è¡Œäº†åŠ¨æ€åŠ è½½ï¼Œå®é™…ä¸Šä¹Ÿå¯ä»¥æŒ‰ç…§æ³¨é‡Šçš„æ–¹æ³•æ¥å†™ã€‚\n\nä½†æ˜¯æ²¡æœ‰å…³ç³»ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥åˆ†æ models å¼•å…¥çš„æ–‡ä»¶ä¸­åšäº†å“ªäº›äº‹æƒ…(ä¸‹é¢åˆ—å‡ºçš„ä»£ç åœ¨åŸåŸºç¡€ä¸Šè¿›è¡Œäº†ä¸€äº›ç®€åŒ–):\n\n```javascript\nimport queryString from 'query-string';\nimport * as usersService from '../services/users';\n\nexport default {\n  namespace: 'users',\n  state: {\n    list: [],\n    total: null,\n    page: null,\n  },\n  reducers: {\n    save(state, { payload: { data: list, total, page } }) {\n      return { ...state, list, total, page };\n    },\n  },\n  effects: {\n    *fetch({ payload: { page = 1 } }, { call, put }) {\n      const { data, headers } = yield call(usersService.fetch, { page });\n      yield put({\n        type: 'save',\n        payload: {\n          data,\n          total: parseInt(headers['x-total-count'], 10),\n          page: parseInt(page, 10),\n        },\n      });\n    },\n    //...\n    *reload(action, { put, select }) {\n      const page = yield select(state => state.users.page);\n      yield put({ type: 'fetch', payload: { page } });\n    },\n  },\n  subscriptions: {\n    setup({ dispatch, history }) {\n      return history.listen(({ pathname, search }) => {\n        const query = queryString.parse(search);\n        if (pathname === '/users') {\n          dispatch({ type: 'fetch', payload: query });\n        }\n      });\n    },\n  },\n};\n```\n\nè¿™äº›å†…å®¹ï¼Œæˆ‘ä»¬é€šè¿‡`app.model(require('./models/users'));`å°±å¯ä»¥å¼•å…¥ã€‚\n\nå®é™…ä¸Šï¼Œmodel å‡½æ•°æœ¬èº«è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œä½†ç”±äº dva æ‹¥æœ‰ model åŠ¨æ€åŠ è½½çš„èƒ½åŠ›ï¼Œå®é™…ä¸Šè°ƒç”¨ app.start å‰å’Œ app.start åmodelå‡½æ•°æ˜¯ä¸ä¸€æ ·çš„ã€‚\n\nè°ƒç”¨ start å‡½æ•°å‰ï¼Œæˆ‘ä»¬ç›´æ¥æŒ‚è½½å³å¯(å› ä¸ºstartå‡½æ•°ä¸­ä¼šå¯¹æ‰€æœ‰modelè¿›è¡Œéå†æ€§ç»Ÿä¸€å¤„ç†ï¼Œæ‰€ä»¥æ— éœ€è¿‡å¤šå¤„ç†)ï¼š\n\n```javascript\nfunction model(m) {\n    if (process.env.NODE_ENV !== 'production') {\n      checkModel(m, app._models);\n    }\n    app._models.push(prefixNamespace(m));\n    // æŠŠ model æ³¨å†Œåˆ° app çš„ _models é‡Œé¢ï¼Œä½†æ˜¯å½“ app start ä¹‹åï¼Œå°±ä¸èƒ½ä»…ä»…ç”¨è¿™ç§æ–¹æ³•äº†ï¼Œéœ€è¦ injectModel\n  }\n```\n\nè°ƒç”¨äº† start å‡½æ•°ä¹‹åï¼Œmodelå‡½æ•°è¢«æ›¿æ¢æˆå¦‚ä¸‹:\n\n```javascript\nfunction injectModel(createReducer, onError, unlisteners, m) {\n    model(m);\n\n    const store = app._store;\n    if (m.reducers) {\n      store.asyncReducers[m.namespace] = getReducer(m.reducers, m.state);\n      store.replaceReducer(createReducer(store.asyncReducers));\n    }\n    if (m.effects) {\n      store.runSaga(app._getSaga(m.effects, m, onError, plugin.get('onEffect')));\n    }\n    if (m.subscriptions) {\n      unlisteners[m.namespace] = runSubscription(m.subscriptions, m, app, onError);\n    }\n  }\n```\n\n**æˆ‘ä»¬é¦–å…ˆåˆ†æç¬¬ä¸€ä¸ª if ä¸­çš„å†…å®¹**ï¼šé¦–å…ˆé€šè¿‡getReducerå‡½æ•°å°†è½¬æ¢å¥½çš„ reducers æŒ‚è½½(æˆ–æ›¿æ¢)åˆ° store.asyncReducers[m.namespace] ä¸­ï¼Œç„¶åé€šè¿‡ redux æœ¬èº«æä¾›çš„èƒ½åŠ› replaceReducer å®Œæˆ reducer çš„æ›¿æ¢ã€‚\n\nè¿™é‡Œæˆ‘ä»¬éœ€è¦æ³¨æ„ getReducer å‡½æ•°ï¼Œå®é™…ä¸Šï¼Œdva é‡Œé¢ reducers å†™æ³•å’Œæˆ‘ä»¬ä¹‹å‰ç›´æ¥ä½¿ç”¨ redux çš„å†™æ³•ç•¥æœ‰ä¸åŒï¼š\n\næˆ‘ä»¬è¿™é‡Œçš„ reducersï¼Œå®é™…ä¸Šè¦å’Œ action ä¸­çš„ actionType åŒåçš„ reducerï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰å¿…è¦å»å†™ switch case äº†ï¼Œå¯¹äºæŸä¸€ä¸ª reducer æ¥è¯´å…¶è¡Œä¸ºåº”è¯¥æ˜¯ç¡®å®šçš„ï¼Œè¿™ç»™ reducers çš„å†™æ³•å¸¦æ¥äº†ä¸€å®šçš„ç®€åŒ–ï¼Œå½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ extraReducers å®šä¹‰æˆ‘ä»¬ä¹‹å‰ä¹ æƒ¯çš„é‚£ç§æ¯”è¾ƒå¤æ‚çš„ reducersã€‚\n\n**æ¥ä¸‹æ¥æˆ‘ä»¬åˆ†æç¬¬äºŒä¸ª if ä¸­çš„å†…å®¹**ï¼šç¬¬äºŒä¸ªå‡½æ•°é¦–å…ˆè·å–åˆ°äº†æˆ‘ä»¬å®šä¹‰çš„ effects å¹¶é€šè¿‡ _getSaga è¿›è¡Œå¤„ç†ï¼Œç„¶åä½¿ç”¨ `runSaga`(å®é™…ä¸Šå°±æ˜¯createSagaMiddleware().runï¼Œæ¥è‡ªäºredux-saga) è¿›è¡Œæ‰§è¡Œã€‚\n\nå®é™…ä¸Šï¼Œè¿™é‡Œçš„ `_getSaga` å‡½æ•°æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥é‡ç‚¹ä»‹ç»è¿™ä¸ªå‡½æ•°ã€‚\n\n`_getSaga` å‡½æ•°ç”± `getSaga.js` æš´éœ²ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š\n\n```javascript\nexport default function getSaga(resolve, reject, effects, model, onError, onEffect) {\n  return function *() {  // è¿”å›ä¸€ä¸ªå‡½æ•°\n    for (const key in effects) {  // è¿™ä¸ªå‡½æ•°å¯¹ effects é‡Œé¢çš„æ‰€æœ‰é”®\n      if (Object.prototype.hasOwnProperty.call(effects, key)) { // å…ˆåˆ¤æ–­ä¸€ä¸‹é”®æ˜¯å±äºè‡ªå·±çš„\n        const watcher = getWatcher(resolve, reject, key, effects[key], model, onError, onEffect);\n        // ç„¶åè°ƒç”¨getWatchè·å–watcher\n        const task = yield sagaEffects.fork(watcher); // åˆ©ç”¨ fork å¼€å¯ä¸€ä¸ª task\n        yield sagaEffects.fork(function *() { // è¿™æ ·å†™çš„ç›®çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ç§»é™¤äº†è¿™ä¸ª model è¦åŠæ—¶ç»“æŸæ‰\n          yield sagaEffects.take(`${model.namespace}/@@CANCEL_EFFECTS`);\n          yield sagaEffects.cancel(task);\n        });\n      }\n    }\n  };\n}\n```\n\ngetWatcher çš„ä¸€äº›æ ¸å¿ƒä»£ç å¦‚ä¸‹:\n\n```javascript\n\nfunction getWatcher(resolve, reject, key, _effect, model, onError, onEffect) {\n  let effect = _effect;\n  let type = 'takeEvery';\n  let ms;\n\n  if (Array.isArray(_effect)) {\n    effect = _effect[0];\n    const opts = _effect[1];\n    // å¯¹ opts è¿›è¡Œä¸€å®šçš„æ ¡éªŒ\n    //...\n  }\n\n  function *sagaWithCatch(...args) { // éƒ½ä¼šè°ƒç”¨è¿™ä¸ªè¿‡ç¨‹\n    try {\n      yield sagaEffects.put({ type: `${key}${NAMESPACE_SEP}@@start` });\n      const ret = yield effect(...args.concat(createEffects(model)));\n      yield sagaEffects.put({ type: `${key}${NAMESPACE_SEP}@@end` });\n      resolve(key, ret);\n    } catch (e) {\n      onError(e);\n      if (!e._dontReject) {\n        reject(key, e);\n      }\n    }\n  }\n\n  const sagaWithOnEffect = applyOnEffect(onEffect, sagaWithCatch, model, key); \n  // æŒ‚è½½ onEffect é’©å­\n\n  switch (type) {\n    case 'watcher':\n      return sagaWithCatch;\n    case 'takeLatest':\n      return function*() {\n        yield takeLatest(key, sagaWithOnEffect);\n      };\n    case 'throttle': // èµ·åˆ°èŠ‚æµçš„æ•ˆæœï¼Œåœ¨ ms æ—¶é—´å†…ä»…ä»…ä¼šè¢«è§¦å‘ä¸€æ¬¡\n      return function*() {\n        yield throttle(ms, key, sagaWithOnEffect);\n      };\n    default:\n      return function*() {\n        yield takeEvery(key, sagaWithOnEffect);\n      };\n  }\n}\n```\n\nè¿™ä¸ªå‡½æ•°çš„å·¥ä½œï¼Œå¯ä»¥ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ï¼š\n\n1.å°† effect åŒ…è£¹æˆ sagaWithCatchï¼Œé™¤äº†ä¾¿äºé”™è¯¯å¤„ç†å’Œå¢åŠ å‰åé’©å­ï¼Œå€¼å¾—æˆ‘ä»¬æ³¨æ„çš„æ˜¯ resolve å’Œ rejectï¼Œ\n\nè¿™ä¸ª resolve å’Œ rejectï¼Œå®é™…ä¸Šæ˜¯æ¥è‡ª`createPromiseMiddleware.js`\n\næˆ‘ä»¬çŸ¥é“ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨redux-sagaçš„è¿‡ç¨‹ä¸­ï¼Œå®é™…ä¸Šæ˜¯ç›‘å¬æœªæ¥çš„actionï¼Œå¹¶æ‰§è¡Œ effectsï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä¸€ä¸ª effects å‡½æ•°ä¸­æ‰§è¡Œä¸€äº›å¼‚æ­¥æ“ä½œï¼Œç„¶å put(dispatch) ä¸€ä¸ª actionï¼Œè¿˜æ˜¯ä¼šè¢«ç›‘å¬è¿™ä¸ª action çš„å…¶ä»– saga ç›‘å¬åˆ°ã€‚\n\næ‰€ä»¥å°±æœ‰å¦‚ä¸‹åœºæ™¯ï¼šæˆ‘ä»¬ dispatch ä¸€ä¸ª actionï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœæˆ‘ä»¬æƒ³è·å–åˆ°ä»€ä¹ˆæ—¶å€™ç›‘å¬è¿™ä¸ª action çš„ saga ä¸­çš„å¼‚æ­¥æ“ä½œæ‰§è¡Œç»“æŸï¼Œæ˜¯åŠä¸åˆ°çš„(å› ä¸ºä¸æ˜¯æ‰€æœ‰çš„æ—¶å€™æˆ‘ä»¬éƒ½æŠŠæ‰€æœ‰å¤„ç†é€»è¾‘å†™åœ¨ saga ä¸­)ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ dispatch æœ‰çš„æ—¶å€™éœ€è¦è¿”å›ä¸€ä¸ª Promise ä»è€Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œå¼‚æ­¥ç»“æŸåçš„å›è°ƒ(è¿™ä¸ª Promise åœ¨ç›‘å¬è€… saga å¼‚æ­¥æ‰§è¡Œå®Œåè¢«å†³è®®ï¼Œè§ä¸Šæ–‡`sagaWithCatch`å‡½æ•°æºä»£ç )ã€‚\n\nå¦‚æœæˆ‘è®²çš„è¿˜æ˜¯æ¯”è¾ƒæ··ä¹±ï¼Œä¹Ÿå¯ä»¥å‚è€ƒ[è¿™ä¸ªissue](https://github.com/dvajs/dva/issues/175)\n\nå¯¹äºè¿™ä¸ªæƒ…å†µï¼Œæˆ‘è®¤ä¸ºè¿™æ˜¯ dva ä»£ç æœ€ç²¾å½©çš„åœ°æ–¹ä¹‹ä¸€ï¼Œä½œè€…é€šè¿‡å®šä¹‰å¦‚ä¸‹çš„middleware:\n\n```javascript\n const middleware = () => next => (action) => {\n    const { type } = action;\n    if (isEffect(type)) {\n      return new Promise((resolve, reject) => {\n        map[type] = {\n          resolve: wrapped.bind(null, type, resolve),\n          reject: wrapped.bind(null, type, reject),\n        };\n      });\n    } else {\n      return next(action);\n    }\n  };\n\n  function wrapped(type, fn, args) {\n    if (map[type]) delete map[type];\n    fn(args);\n  }\n\n  function resolve(type, args) {\n    if (map[type]) {\n      map[type].resolve(args);\n    }\n  }\n\n  function reject(type, args) {\n    if (map[type]) {\n      map[type].reject(args);\n    }\n  }\n```\n\nå¹¶ä¸”åœ¨ä¸Šæ–‡çš„`sagaWithCatch`ç›¸å…³effectæ‰§è¡Œç»“æŸçš„æ—¶å€™è°ƒç”¨ resolveï¼Œè®© dispatch è¿”å›äº†ä¸€ä¸ª Promiseã€‚\n\nå½“ç„¶ï¼Œä¸Šé¢è¿™æ®µä»£ç è¿˜æ˜¯æœ‰ç‚¹é—®é¢˜çš„ï¼Œè¿™æ ·ä¼šå¯¼è‡´åŒå reducer å’Œ effect ä¸ä¼š fallthroughï¼ˆå³ä¸¤è€…éƒ½æ‰§è¡Œï¼‰ï¼Œå› ä¸ºéƒ½å·²ç»è¿”å›äº†ï¼Œaction ä¾¿ä¸ä¼šå†è¿›ä¸€æ­¥ä¼ é€’ï¼Œå…³äºè¿™æ ·è®¾è®¡çš„å¥½åï¼Œåœ¨[è¿™é‡Œ](https://github.com/sorrycc/blog/issues/48)æœ‰è¿‡ä¸€äº›è®¨è®ºï¼Œç¬”è€…ä¸è¿›è¡Œå±•å¼€è¡¨è¿°ã€‚\n\n2.åœ¨ä¸Šé¢å†—é•¿çš„ç¬¬ä¸€æ­¥ä¹‹åï¼Œåˆé€šè¿‡`applyOnEffect`å‡½æ•°åŒ…è£¹äº†`OnEffect`çš„é’©å­å‡½æ•°ï¼Œè¿™ç›¸å½“äºæ˜¯ä¸€ç§`compose`ï¼Œ(ä¸Šæ–‡çš„ dva-loading ä¸­é—´ä»¶å®é™…ä¸Šå°±æ˜¯åœ¨è¿™é‡Œè¢«å¤„ç†çš„)å…¶å®ç°å¯¹äºç†Ÿæ‚‰ redux çš„åŒå­¦æ¥è¯´åº”è¯¥ä¸éš¾ç†è§£ï¼š\n\n```javascript\nfunction applyOnEffect(fns, effect, model, key) {\n  for (const fn of fns) {\n    effect = fn(effect, sagaEffects, model, key);\n  }\n  return effect;\n}\n```\n\n3.æœ€åï¼Œæ ¹æ®æˆ‘ä»¬å®šä¹‰çš„type(é»˜è®¤æ˜¯`takeEvery`ï¼Œä¹Ÿå°±æ˜¯éƒ½æ‰§è¡Œ)ï¼Œæ¥é€‰æ‹©ä¸åŒçš„ sagaï¼ŒtakeLatest å³ä¸ºåªæ˜¯æ‰§è¡Œæœ€è¿‘çš„ä¸€ä¸ªï¼Œthrottleåˆ™èµ·åˆ°èŠ‚æµçš„æ•ˆæœï¼Œä¸€å®šæ—¶é—´å†…ä»…ä»…å…è®¸è¢«è§¦å‘ä¸€æ¬¡ï¼Œè¿™äº›éƒ½æ˜¯ redux-saga çš„å†…éƒ¨å®ç°ï¼Œdva ä¹Ÿæ˜¯åŸºæœ¬ç›´æ¥å¼•ç”¨ï¼Œå› æ­¤åœ¨è¿™é‡Œä¸è¿›è¡Œå±•å¼€ã€‚\n\n**æœ€åæˆ‘ä»¬åˆ†æ`injectModel`ç¬¬ä¸‰ä¸ª`if`ä¸­çš„å†…å®¹**:å¤„ç†`subscriptions`:\n\n```javascript\nif (m.subscriptions) {\n  unlisteners[m.namespace] = runSubscription(m.subscriptions, m, app, onError);\n}\n```\n\n`subscriptions`å¯ä»¥ç†è§£ä¸ºå’Œè¿™ä¸ªmodelæœ‰å…³çš„å…¨å±€ç›‘å¬ï¼Œä½†æ˜¯ç›¸å¯¹ç‹¬ç«‹ã€‚è¿™ä¸€ä¸ªæ­¥éª¤é¦–å…ˆè°ƒç”¨`runSubscription`æ¥ä¸€ä¸ªä¸€ä¸ªè°ƒç”¨æˆ‘ä»¬çš„`subscriptions`:\n\n```javascript\nexport function run(subs, model, app, onError) { // åœ¨index.jsä¸­è¢«é‡å‘½åä¸º runSubscription\n  const funcs = [];\n  const nonFuncs = [];\n  for (const key in subs) {\n    if (Object.prototype.hasOwnProperty.call(subs, key)) {\n      const sub = subs[key];\n      const unlistener = sub({\n        dispatch: prefixedDispatch(app._store.dispatch, model),\n        history: app._history,\n      }, onError);\n      if (isFunction(unlistener)) {\n        funcs.push(unlistener);\n      } else {\n        nonFuncs.push(key);\n      }\n    }\n  }\n  return { funcs, nonFuncs };\n}\n```\n\næ­£å¦‚æˆ‘ä»¬æ‰€æœŸå¾…çš„ï¼Œ`run`å‡½æ•°å°±æ˜¯ä¸€ä¸ªä¸€ä¸ªæ‰§è¡Œ`subscriptions`ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æˆ‘ä»¬æ³¨æ„çš„ï¼Œæˆ‘ä»¬å®šä¹‰çš„`subscriptions`åº”è¯¥æ˜¯éœ€è¦è¿”å›ä¸€ä¸ª`unlistener`æ¥è¿”å›æ¥è§¦å‡½æ•°ï¼Œè¿™æ ·å½“æ•´ä¸ª model è¢«å¸è½½çš„æ—¶å€™ dva ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ¥è§£é™¤å‡½æ•°(ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè¿™é‡Œçš„è¿”å›å‡½æ•°è¢«å‘½åä¸º`unlistener`)\n\n#### ç¬¬å››æ­¥\n\næºä»£ç ä¸­çš„ç¬¬å››æ­¥ï¼Œæ˜¯å¯¹ router çš„æŒ‚è½½ï¼š\n\n```javascript\napp.router(require('./router'));\n```\n\n`require('./router')`è¿”å›çš„å†…å®¹åœ¨æºä»£ç ä¸­ç»è¿‡ä¸€ç³»åˆ—å¼•ç”¨ä¼ é€’æœ€åç›´æ¥è¢«æ„é€ æˆ React Component å¹¶ä¸”æœ€ç»ˆè°ƒç”¨ ReactDom.render è¿›è¡Œæ¸²æŸ“ï¼Œè¿™é‡Œæ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„ï¼Œå€¼å¾—ä¸€æçš„å°±æ˜¯ router çš„åŠ¨æ€åŠ è½½ã€‚\n\nåŠ¨æ€åŠ è½½åœ¨è¯¥æ ·ä¾‹ä¸­æ˜¯è¿™æ ·ä½¿ç”¨çš„ï¼š\n\n```javascript\nimport React from 'react';\nimport { Router, Switch, Route } from 'dva/router';\nimport dynamic from 'dva/dynamic';\n\nfunction RouterConfig({ history, app }) {\n  const IndexPage = dynamic({\n    app,\n    component: () => import('./routes/IndexPage'),\n  });\n\n  const Users = dynamic({\n    app,\n    models: () => [\n      import('./models/users'),\n    ],\n    component: () => import('./routes/Users'),\n  });\n\n  history.listen((location, action)=>{\n    console.log('history listen:', location, action)\n  })\n\n  return (\n    <Router history={history}>\n      <Switch>\n        <Route exact path=\"/\" component={IndexPage} />\n        <Route exact path=\"/users\" component={Users} />\n      </Switch>\n    </Router>\n  );\n}\n```\n\næˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œä¸»è¦å°±æ˜¯åˆ©ç”¨`dva/dynamic.js`æš´éœ²çš„ dynamic å‡½æ•°è¿›è¡ŒåŠ¨æ€åŠ è½½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç®€å•çœ‹ä¸€ä¸‹ dynamic å‡½æ•°åšäº†ä»€ä¹ˆ:\n\n```javascript\nexport default function dynamic(config) {\n  const { app, models: resolveModels, component: resolveComponent } = config;\n  return asyncComponent({\n    resolve: config.resolve || function () {\n      const models = typeof resolveModels === 'function' ? resolveModels() : [];\n      const component = resolveComponent();\n      return new Promise((resolve) => {\n        Promise.all([...models, component]).then((ret) => {\n          if (!models || !models.length) {\n            return resolve(ret[0]);\n          } else {\n            const len = models.length;\n            ret.slice(0, len).forEach((m) => {\n              m = m.default || m;\n              if (!Array.isArray(m)) {\n                m = [m];\n              }\n              m.map(_ => registerModel(app, _)); // æ³¨å†Œæ‰€æœ‰çš„ model\n            });\n            resolve(ret[len]);\n          }\n        });\n      });\n    },\n    ...config,\n  });\n}\n```\n\nè¿™é‡Œä¸»è¦è°ƒç”¨äº† asyncComponent å‡½æ•°ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†çœ‹ä¸€ä¸‹è¿™ä¸ªå‡½æ•°ï¼š\n\n```javascript\nfunction asyncComponent(config) {\n  const { resolve } = config;\n\n  return class DynamicComponent extends Component {\n    constructor(...args) {\n      super(...args);\n      this.LoadingComponent =\n        config.LoadingComponent || defaultLoadingComponent;\n      this.state = {\n        AsyncComponent: null,\n      };\n      this.load();\n    }\n\n    componentDidMount() {\n      this.mounted = true;\n    }\n\n    componentWillUnmount() {\n      this.mounted = false;\n    }\n\n    load() {\n      resolve().then((m) => {\n        const AsyncComponent = m.default || m;\n        if (this.mounted) {\n          this.setState({ AsyncComponent });\n        } else {\n          this.state.AsyncComponent = AsyncComponent; // eslint-disable-line\n        }\n      });\n    }\n\n    render() {\n      const { AsyncComponent } = this.state;\n      const { LoadingComponent } = this;\n      if (AsyncComponent) return <AsyncComponent {...this.props} />;\n\n      return <LoadingComponent {...this.props} />;\n    }\n  };\n}\n```\n\nè¿™ä¸ªå‡½æ•°é€»è¾‘æ¯”è¾ƒç®€æ´ï¼Œæˆ‘ä»¬åˆ†æä¸€ä¸‹åŠ¨æ€åŠ è½½æµç¨‹ï¼›\n\n* åœ¨ constructor é‡Œé¢è°ƒç”¨ `this.load();` ( LoadingComponent ä¸ºå ä½ component)\n* åœ¨ `this.load();` å‡½æ•°é‡Œé¢è°ƒç”¨ `dynamic` å‡½æ•°è¿”å›çš„ resolve æ–¹æ³•\n* resolve æ–¹æ³•å®é™…ä¸Šæ˜¯ä¸€ä¸ª Promiseï¼ŒæŠŠç›¸å…³ models å’Œ component åŠ è½½å®Œä¹‹å resolve (åŒºåˆ†è¿™ä¸¤ä¸ª resolve)\n* åŠ è½½å®Œæˆä¹‹åè¿”å› AsyncComponent (å³åŠ è½½çš„ Component)\n\nåŠ¨æ€åŠ è½½ä¸»æµç¨‹ç»“æŸï¼Œè‡³äºåŠ¨æ€åŠ è½½çš„ä»£ç åˆ†å‰²å·¥ä½œï¼Œå¯ä»¥ä½¿ç”¨ webpack3 çš„ `import()` åŠ¨æ€åŠ è½½èƒ½åŠ›(ä¾‹å­ä¸­ä¹Ÿæ˜¯è¿™æ ·ä½¿ç”¨çš„)ã€‚\n\n\n#### ç¬¬äº”æ­¥\n\nç¬¬äº”æ­¥éª¤å°±æ˜¯ start äº†ï¼š\n\n```javascript\napp.start('#root');\n```\n\nè¿™ä¸ªæ—¶å€™å¦‚æœæˆ‘ä»¬åœ¨ start å‡½æ•°ä¸­ä¼ å…¥ DomElement æˆ–è€… DomQueryStringï¼Œå°±ä¼šç›´æ¥å¯åŠ¨åº”ç”¨äº†ï¼Œå¦‚æœæˆ‘ä»¬è¿™ä¸ªæ—¶å€™ä¸ä¼ å…¥ä»»ä½•å†…å®¹ï¼Œå®é™…ä¸Šè¿”å›çš„æ˜¯ä¸€ä¸ª`<Provider />` (React Component)ï¼Œä¾¿äºæœåŠ¡ç«¯æ¸²æŸ“ã€‚ ç›¸å…³åˆ¤æ–­é€»è¾‘å¦‚ä¸‹ï¼š\n\n```javascript\n if (container) {\n      render(container, store, app, app._router);\n      app._plugin.apply('onHmr')(render.bind(null, container, store, app));\n    } else {\n      return getProvider(store, this, this._router);\n    }\n```\n\nè‡³æ­¤ï¼Œä¸»è¦æµç¨‹ç»“æŸï¼Œä»¥ä¸Šå‡ ä¸ªæ­¥éª¤ä¹ŸåŒ…æ‹¬äº† dva æºç åšçš„ä¸»è¦å·¥ä½œã€‚\n\nå½“ç„¶ dva æºç ä¸­è¿˜æœ‰ä¸€äº›æ¯”å¦‚å‰ç¼€å¤„ç†ç­‰å·¥ä½œï¼Œä½†æ˜¯ç›¸æ¯”äºä»¥ä¸Šå†…å®¹éå¸¸ç®€å•ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œä¸è¿›è¡Œåˆ†æäº†ã€‚\n\n\n### dva-core æ–‡ä»¶ç›®å½•\n\ndva-coreä¸­çš„æºç æ–‡ä»¶ç›®å½•ä»¥åŠå…¶åŠŸèƒ½:\n\n* checkModel å¯¹æˆ‘ä»¬å®šä¹‰çš„ Model è¿›è¡Œæ£€æŸ¥æ˜¯å¦ç¬¦åˆè¦æ±‚\n* constants éå¸¸ç®€å•çš„å¸¸é‡æ–‡ä»¶ï¼Œç›®å‰åªå®šä¹‰äº†ä¸€ä¸ªå¸¸é‡ï¼šNAMESPACE_SEP(/)\n* cratePromiseMiddleware ç¬”è€…è‡ªå·±å®šä¹‰çš„ redux æ’ä»¶\n* createStore å°è£…äº† redux åŸç”Ÿçš„ createStore\n* getReducer è¿™é‡Œé¢çš„å‡½æ•°å…¶å®ä¸»è¦å°±æ˜¯è°ƒç”¨äº† handleActions æ–‡ä»¶å¯¼å‡ºçš„å‡½æ•°\n* getSaga å°†ç”¨æˆ·è¾“å…¥çš„ effects éƒ¨åˆ†çš„é”®å€¼å¯¹å‡½æ•°è¿›è¡Œç®¡ç†\n* handleActions æ˜¯å°† dva é£æ ¼çš„ reducer å’Œ state è½¬åŒ–æˆ redux æœ¬æ¥æ¥å—çš„é‚£ç§æ–¹å¼\n* index ä¸»å…¥å£æ–‡ä»¶\n* Plugin æ’ä»¶ç±»ï¼šå¯ä»¥ç®¡ç†ä¸åŒé’©å­äº‹ä»¶çš„å›è°ƒå‡½æ•°ï¼Œæ‹¥æœ‰å¢åŠ ã€è·å–ã€æ‰§è¡Œé’©å­å‡½æ•°çš„åŠŸèƒ½\n* perfixedDispatch è¯¥æ–‡ä»¶æä¾›äº†å¯¹ Dispatch å¢åŠ å‰ç¼€çš„å·¥å…·æ€§å‡½æ•° prefixedDispatch\n* prefixNamespace è¯¥æ–‡ä»¶æä¾›äº†å¯¹ reducer å’Œ effects å¢åŠ å‰ç¼€çš„å·¥å…·æ€§å‡½æ•° prefixNamespace\n* prefixType åˆ¤æ–­æ˜¯ reducer è¿˜æ˜¯ effects\n* subscriptions è¯¥æ–‡ä»¶æä¾›äº†è¿è¡Œ subscriptions å’Œè°ƒç”¨ç”¨æˆ·è¿”å›çš„ unlisten å‡½æ•°ä»¥åŠåˆ é™¤ç¼“å­˜çš„åŠŸèƒ½\n* utils æä¾›ä¸€äº›éå¸¸åŸºç¡€çš„å·¥å…·å‡½æ•°\n\n\n### ä¼˜åŠ¿æ€»ç»“\n\n* åŠ¨æ€ modelï¼Œå·²ç»å°è£…å¥½äº†æ•´å¥—è°ƒç”¨ï¼ŒåŠ¨æ€æ·»åŠ /åˆ é™¤ model å˜å¾—éå¸¸ç®€å•\n* é»˜è®¤å°è£…å¥½äº†ç®¡ç† effects çš„æ–¹å¼ï¼Œæœ‰é™å¯é€‰å¯é…ç½®ï¼Œé™ä½å­¦ä¹ æˆæœ¬çš„åŒæ—¶ä»£ç æ›´åˆ©äºç»´æŠ¤\n* æ˜“äºä¸Šæ‰‹ï¼Œé›†æˆreduxã€redux-sagaã€react-routerç­‰å¸¸ç”¨åŠŸèƒ½\n\n\n### åŠ£åŠ¿æ€»ç»“\n\n* ç‰ˆæœ¬åŒºéš”ä¸æ˜æ˜¾ï¼Œdva æœ‰ 1.x å’Œ 2.x ä¸¤ç§ç‰ˆæœ¬ï¼Œä¹‹é—´APIæœ‰äº›å·®å¼‚ï¼Œä½†æ˜¯å®˜ç½‘æä¾›çš„ä¸€äº›æ ·ä¾‹ç­‰ä¸­æ²¡æœ‰è¯´æ˜åŸºäºçš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”æœ‰çš„è¿˜æ˜¯åŸºäºæ—§ç‰ˆæœ¬çš„ï¼Œä¼šç»™æ–°æ‰‹å¸¦æ¥å¾ˆå¤šç–‘æƒ‘ã€‚\n* å†…å®¹ç¹æ‚ï¼Œä½†æ˜¯å´æ²¡æœ‰ä¸€ä¸ªæ•´åˆæ€§è´¨çš„å®˜æ–¹ç½‘ç«™ï¼Œå¤§éƒ½æ˜¯é€šè¿‡ list çš„å½¢å¼åˆ—ä¸‹æ¥å†™åœ¨READMEçš„ã€‚\n* ç›®å‰æ¯”å¦‚åŠ¨æ€åŠ è½½ç­‰è¿˜å­˜åœ¨ç€ä¸€äº›é—®é¢˜ï¼Œå’Œç›´æ¥é‡‡ç”¨reacté…å¥—å·¥å…·å†™çš„æ•ˆæœæœ‰æ‰€åŒºåˆ«ã€‚\n* å¾ˆå¤š issues ä¸çŸ¥é“ä¸ºä»€ä¹ˆå°±è¢«å…³é—­äº†ï¼Œä½œè€…åœ¨æœ€åä¹Ÿå¹¶æœªç»™å‡ºåˆç†çš„è§£é‡Šã€‚\n* dva2 ä¹‹åæœ‰ç‚¹å°† effects å’Œ actions æ··æ·†ï¼Œè¿™ä¸€ç‚¹æˆ‘ä¹Ÿå¹¶ä¸æ˜¯éå¸¸è®¤åŒï¼Œå½“ç„¶åŸä½œè€…å¯èƒ½æœ‰è‡ªå·±çš„è€ƒè™‘ï¼Œè¿™é‡Œä¸è¿‡å¤šè¯„è®®ã€‚\n\næ€»ä¹‹ï¼Œä½œä¸ºä¸€ä¸ªä¸ªäººä¸»åŠ›çš„é¡¹ç›®(ä¸»è¦å¼€å‘è€…è´¡çŒ®äº†99%ä»¥ä¸Šçš„ä»£ç )ï¼Œå¯ä»¥çœ‹å‡ºä½œè€…çš„åŠŸåº•æ·±åšï¼Œç»éªŒä¸°å¯Œï¼Œä½†æ˜¯ç”±äºè¿™æ ·ä¸€ä¸ªä½“ç³»åŒ–çš„ä¸œè¥¿ç‰µæ‰¯å†…å®¹è¾ƒå¤šï¼Œå¹¶ä¸”éå¸¸å—åˆ¶äºreactã€reduxã€react-routerã€redux-sagaç­‰çš„ç‰ˆæœ¬å½±å“ï¼Œ**ä¸å»ºè®®å…·å¤‡ä¸€å®šè§„æ¨¡çš„éé˜¿é‡Œç³»å›¢é˜Ÿåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨**ï¼Œä½†æ˜¯å¦‚æœæ˜¯å¿«é€Ÿæˆå‹çš„ä¸­å°å‹é¡¹ç›®æˆ–è€…ä¸ªäººåº”ç”¨ï¼Œä½¿ç”¨èµ·æ¥è¿˜æ˜¯æœ‰å¾ˆå¤§å¸®åŠ©çš„ã€‚\n\n### TODOS\n\nç¬”è€…ä¹Ÿåœ¨å‡†å¤‡åšä¸€ä¸ªå’Œ dva å¤„äºåŒä¸€æ€§è´¨ï¼Œä½†æ˜¯è®¾è®¡ã€å®ç°å’Œä½¿ç”¨æœ‰æ‰€åŒºåˆ«çš„æ¡†æ¶ï¼Œå¸Œæœ›èƒ½å¤Ÿå°½å¿«è½æˆã€‚\n","tags":["å‰ç«¯æ¡†æ¶"]},{"title":"æ„å»ºåˆ©ç”¨Proxyå’ŒReflectå®ç°åŒå‘æ•°æ®ç»‘å®šçš„å¾®æ¡†æ¶","url":"/2018/04/09/æ„å»ºåˆ©ç”¨Proxyå’ŒReflectå®ç°åŒå‘æ•°æ®ç»‘å®šçš„å¾®æ¡†æ¶/","content":">å†™åœ¨å‰é¢ï¼šè¿™ç¯‡æ–‡ç« è®²è¿°äº†å¦‚ä½•åˆ©ç”¨Proxyå’ŒReflectå®ç°åŒå‘æ•°æ®ç»‘å®šï¼Œä¸ªäººç³»Vueæ—©æœŸç©å®¶ï¼Œå†™è¿™ä¸ªå°æ¡†æ¶çš„æ—¶å€™ä¹Ÿæ²¡æœ‰å‚è€ƒVueç­‰æºä»£ç ï¼Œä¹‹å‰äº†è§£è¿‡å…¶ä»–å®ç°ï¼Œä½†æ²¡æœ‰ç›´æ¥å‚è€ƒå…¶ä»–ä»£ç ï¼Œå¦‚æœ‰é›·åŒï¼Œçº¯å±å·§åˆã€‚\n\nä»£ç ä¸‹è½½åœ°å€ï¼š[è¿™é‡Œä¸‹è½½](https://github.com/aircloud/Polar.js)\n\n### ç»¼è¿°\n\n*å…³äºProxyå’ŒReflectçš„èµ„æ–™æ¨èé˜®è€å¸ˆçš„æ•™ç¨‹:http://es6.ruanyifeng.com/ è¿™é‡Œä¸åšè¿‡å¤šä»‹ç»ã€‚*\n\nå®ç°åŒå‘æ•°æ®ç»‘å®šçš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œä¹Ÿå¯ä»¥å‚è€ƒæœ¬ä¸“æ ä¹‹å‰çš„å…¶ä»–å®ç°ï¼Œæˆ‘ä¹‹æ‰€ä»¥é€‰æ‹©ç”¨Proxyå’ŒReflectï¼Œä¸€æ–¹é¢æ˜¯å› ä¸ºå¯ä»¥å¤§é‡èŠ‚çº¦ä»£ç ï¼Œå¹¶ä¸”ç®€åŒ–é€»è¾‘ï¼Œå¯ä»¥è®©æˆ‘æŠŠæ›´å¤šçš„ç»å†æ”¾åœ¨å…¶ä»–å†…å®¹çš„æ„å»ºä¸Šé¢ï¼Œå¦å¤–ä¸€æ–¹é¢æœ¬é¡¹ç›®ç›´æ¥åŸºäºES6ï¼Œç”¨è¿™äº›å†…å®¹ä¹Ÿç¬¦åˆé¢å‘æœªæ¥çš„JSç¼–ç¨‹è§„èŒƒï¼Œç¬¬ä¸‰ç‚¹æœ€åè¯´ã€‚\n\nç”±äºè¿™ä¸ªå°æ¡†æ¶æ˜¯è‡ªå·±åœ¨PolarBearè¿™ä¸ªå’–å•¡é¦†åœ¨ä¸€ä¸ªå®‰é™çš„åˆåå¼€å§‹å†™æˆï¼Œæš‚ä¸”èµ·åPolarï¼Œæ—¥åå¸Œæœ›æˆ‘èƒ½ç»§ç»­å®Œå–„è¿™ä¸ªå°æ¡†æ¶ï¼Œç»™æ·»åŠ ä¸Šæ›´å¤šæœ‰è¶£çš„åŠŸèƒ½ã€‚\n\né¦–å…ˆæˆ‘ä»¬å¯ä»¥çœ‹æ•´ä½“åŠŸèƒ½æ¼”ç¤ºï¼š  \n[ä¸€ä¸ªgifåŠ¨å›¾ï¼Œå¦‚æœä¸èƒ½çœ‹ï¼Œè¯·ç‚¹å‡»[è¿™é‡Œçš„é“¾æ¥](https://www.10000h.top/images/data_img/gif1.gif)]\n\n![](https://www.10000h.top/images/data_img/gif1.gif)\n\n### ä»£ç åˆ†æ\n\næˆ‘ä»¬è¦åšè¿™æ ·ä¸€ä¸ªå°æ¡†æ¶ï¼Œæ ¸å¿ƒæ˜¯è¦ç›‘å¬æ•°æ®çš„æ”¹å˜ï¼Œå¹¶ä¸”åœ¨æ•°æ®çš„æ”¹å˜çš„æ—¶å€™è¿›è¡Œä¸€äº›æ“ä½œï¼Œä»è€Œç»´æŒæ•°æ®çš„ä¸€è‡´ã€‚\n\næˆ‘çš„æ€è·¯æ˜¯è¿™æ ·çš„ï¼š\n\n* å°†æ‰€æœ‰çš„æ•°æ®ä¿¡æ¯æ”¾åœ¨ä¸€ä¸ªå±æ€§å¯¹è±¡ä¸­(this._data),ä¹‹åç»™è¿™ä¸ªå±æ€§å¯¹è±¡ç”¨ProxyåŒ…è£…set,åœ¨ä»£ç†å‡½æ•°ä¸­æˆ‘ä»¬æ›´æ–°å±æ€§å¯¹è±¡çš„å…·ä½“å†…å®¹ï¼ŒåŒæ—¶é€šçŸ¥æ‰€æœ‰ç›‘å¬è€…ï¼Œä¹‹åè¿”å›æ–°çš„ä»£ç†å¯¹è±¡(this.data)ï¼Œæˆ‘ä»¬ä¹‹åæ“ä½œçš„éƒ½æ˜¯æ–°çš„ä»£ç†å¯¹è±¡ã€‚\n* å¯¹äºinputç­‰è¡¨å•ï¼Œæˆ‘ä»¬éœ€è¦ç›‘å¬inputäº‹ä»¶ï¼Œåœ¨å›è°ƒå‡½æ•°ä¸­ç›´æ¥è®¾ç½®æˆ‘ä»¬ä»£ç†å¥½çš„æ•°æ®å¯¹è±¡ï¼Œä»è€Œè§¦å‘æˆ‘ä»¬çš„ä»£ç†å‡½æ•°ã€‚\n* æˆ‘ä»¬åŒæ—¶ä¹Ÿåº”è¯¥æ”¯æŒäº‹ä»¶æœºåˆ¶ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥æœ€å¸¸ç”¨çš„clickæ–¹æ³•ä½œä¸ºä¾‹å­å®ç°ã€‚\n\nä¸‹é¢å¼€å§‹ç¬¬ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬ä¹‹åä½¿ç”¨è¿™ä¸ªåº“çš„æ—¶å€™å¯ä»¥è¿™æ ·è°ƒç”¨:\n\n```\n<div id=\"app\">\n    <form>\n        <label>name:</label>\n        <input p-model = \"name\" />\n    </form>\n    <div>name:{{name}} age:{{age}}</div>\n    <i>note:{{note}}</i><br/>\n    <button p-click=\"test(2)\">button1</button>\n</div>\n<script>\n var myPolar = new Polar({\n        el:\"#app\",\n        data: {\n            name: \"niexiaotao\",\n            age:16,\n            note:\"Student of Zhejiang University\"\n        },\n        methods:{\n            test:function(e,addNumber){\n                console.log(\"e:\",e);\n                this.data.age+=Number(addNumber);\n            }\n        }\n});\n</script>\n```\n\næ²¡é”™ï¼Œå’ŒVueç¥ä¼¼å§ï¼Œæ‰€ä»¥è¿™ç§è°ƒç”¨æ–¹å¼åº”å½“ä¸ºæˆ‘ä»¬æ‰€ç†Ÿæ‚‰ã€‚\n\næˆ‘ä»¬éœ€è¦å»ºç«‹ä¸€ä¸ªPolarç±»ï¼Œè¿™ä¸ªç±»çš„æ„é€ å‡½æ•°åº”è¯¥è¿›è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œ:\n\n```\n constructor(configs){\n        this.root = this.el = document.querySelector(configs.el);\n        this._data = configs.data;\n        this._data.__bindings = {};\n        //åˆ›å»ºä»£ç†å¯¹è±¡\n        this.data = new Proxy(this._data, {set});\n        this.methods = configs.methods;\n\n        this._compile(this.root);\n}\n```\n\nè¿™é‡Œé¢çš„ä¸€éƒ¨ä»½å†…å®¹æ˜¯ç›´æ¥å°†æˆ‘ä»¬ä¼ å…¥çš„configsæŒ‰ç…§å±æ€§åˆ†åˆ«èµ‹å€¼ï¼Œå¦å¤–å°±æ˜¯æˆ‘ä»¬åˆ›å»ºä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ï¼Œæœ€åçš„`_compile`æ–¹æ³•å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªç§æœ‰çš„åˆå§‹åŒ–æ–¹æ³•ã€‚\n\nå®é™…ä¸Šæˆ‘æŠŠå‰©ä¸‹çš„å†…å®¹å‡ ä¹éƒ½æ”¾åœ¨`_compile`æ–¹æ³•é‡Œé¢äº†ï¼Œè¿™æ ·ç†è§£èµ·æ¥æ–¹ä¾¿ï¼Œä½†æ˜¯ä¹‹åå¯èƒ½è¦æ”¹åŠ¨ã€‚\n\næˆ‘ä»¬è¿˜æ˜¯å…ˆä¸èƒ½çœ‹æˆ‘ä»¬ä»£ç†çš„setè¯¥æ€ä¹ˆå†™ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¿˜è¦å…ˆç»§ç»­æ¢³ç†æ€è·¯ï¼š\n\nå‡è®¾æˆ‘ä»¬è¿™æ ·`<div>name:{{name}}</div>`å°†æ•°æ®ç»‘å®šåˆ°domèŠ‚ç‚¹ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦åšä»€ä¹ˆå‘¢ï¼Œæˆ–è€…è¯´ï¼Œæˆ‘ä»¬é€šè¿‡ä»€ä¹ˆæ–¹å¼è®©domèŠ‚ç‚¹å’Œæ•°æ®å¯¹åº”èµ·æ¥ï¼Œéšç€æ•°æ®æ”¹å˜è€Œæ”¹å˜ã€‚\n\nçœ‹ä¸Šæ–‡çš„`__bindings`ã€‚è¿™ä¸ªå¯¹è±¡ç”¨æ¥å­˜å‚¨æ‰€æœ‰ç»‘å®šçš„domèŠ‚ç‚¹ä¿¡æ¯ï¼Œ`__bindings`æœ¬èº«æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ¯ä¸€ä¸ªæœ‰å¯¹åº”domèŠ‚ç‚¹ç»‘å®šçš„æ•°æ®åç§°éƒ½æ˜¯å®ƒçš„å±æ€§ï¼Œå¯¹åº”ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå†…å®¹éƒ½æ˜¯ä¸€ä¸ªç»‘å®šä¿¡æ¯ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬åœ¨è‡ªå·±å†™çš„setä»£ç†å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸ªè°ƒç”¨è¿‡å»ï¼Œå°±å¯ä»¥æ›´æ–°å†…å®¹äº†ï¼š\n\n```\ndataSet.__bindings[key].forEach(function(item){\n       //do something to update...\n});\n```\n\næˆ‘è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªç”¨äºæ„é€ è°ƒç”¨çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ç”¨äºåˆ›å»ºå­˜å‚¨ç»‘å®šä¿¡æ¯çš„å¯¹è±¡ï¼š\n\n```\nfunction Directive(el,polar,attr,elementValue){\n    this.el=el;//å…ƒç´ æœ¬èº«domèŠ‚ç‚¹\n    this.polar = polar;//å¯¹åº”çš„polarå®ä¾‹\n    this.attr = attr;//å…ƒç´ çš„è¢«ç»‘å®šçš„å±æ€§å€¼ï¼Œæ¯”å¦‚å¦‚æœæ˜¯æ–‡æœ¬èŠ‚ç‚¹å°±å¯ä»¥æ˜¯nodeValue\n    this.el[this.attr] = this.elementValue = elementValue;//åˆå§‹åŒ–\n}\n```\n\nè¿™æ ·ï¼Œæˆ‘ä»¬çš„setå¯ä»¥è¿™æ ·å†™:\n\n```\nfunction set(target, key, value, receiver) {\n    const result = Reflect.set(target, key, value, receiver);\n    var dataSet = receiver || target;\n    dataSet.__bindings[key].forEach(function(item){\n        item.el[item.attr] = item.elementValue = value;\n    });\n    return result;\n}\n```\n\næ¥ä¸‹æ¥å¯èƒ½è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬çš„`{{name}}`å®é™…ä¸Šåªæ˜¯èŠ‚ç‚¹çš„ä¸€éƒ¨åˆ†ï¼Œè¿™å¹¶ä¸æ˜¯èŠ‚ç‚¹å•Šï¼Œå¦å¤–æˆ‘ä»¬æ˜¯ä¸æ˜¯è¿˜å¯ä»¥è¿™ä¹ˆå†™ï¼š`<div>name:{{name}} age:{{age}}</div>`ï¼Ÿ\n\nå…³äºè¿™ä¸¤ä¸ªé—®é¢˜ï¼Œå‰è€…çš„ç­”æ¡ˆæ˜¯æˆ‘ä»¬å°†`{{name}}`æ›¿æ¢æˆä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ï¼Œè€Œä¸ºäº†åº”å¯¹åè€…çš„æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦å°†ä¸¤ä¸ªè¢«ç»‘å®šæ•°æ®ä¸­é—´å’Œå‰åçš„å†…å®¹ï¼Œéƒ½å˜æˆæ–°çš„æ–‡æœ¬èŠ‚ç‚¹ï¼Œç„¶åè¿™äº›æ–‡æœ¬èŠ‚ç‚¹ç»„æˆæ–‡æœ¬èŠ‚ç‚¹ä¸²ã€‚(è¿™é‡Œå¤šè¯´ä¸€å¥ï¼Œhtml5çš„normalizeæ–¹æ³•å¯ä»¥å°†å¤šä¸ªæ–‡æœ¬èŠ‚ç‚¹åˆå¹¶æˆä¸€ä¸ªï¼Œå¦‚æœä¸å°å¿ƒè°ƒç”¨äº†å®ƒï¼Œé‚£æˆ‘ä»¬çš„ç¨‹åºå°±è¦GGäº†)\n\næ‰€ä»¥æˆ‘ä»¬åœ¨`_compile`å‡½æ•°é¦–å…ˆï¼š\n\n```\nvar _this = this;\n\n        var nodes = root.children;\n\n        var bindDataTester = new RegExp(\"{{(.*?)}}\",\"ig\");\n\n        for(let i=0;i<nodes.length;i++){\n            var node=nodes[i];\n\n            //å¦‚æœè¿˜æœ‰htmlå­—èŠ‚ç‚¹ï¼Œåˆ™é€’å½’\n            if(node.children.length){\n                this._compile(node);\n            }\n\n            var matches = node.innerHTML.match(bindDataTester);\n            if(matches){\n                var newMatches = matches.map(function (item) {\n                    return  item.replace(/{{(.*?)}}/,\"$1\")\n                });\n                var splitTextNodes  = node.innerHTML.split(/{{.*?}}/);\n                node.innerHTML=null;\n                //æ›´æ–°DOMï¼Œå¤„ç†åŒä¸€ä¸ªtextnodeé‡Œé¢å¤šæ¬¡ç»‘å®šæƒ…å†µ\n                if(splitTextNodes[0]){\n                    node.append(document.createTextNode(splitTextNodes[0]));\n                }\n                for(let ii=0;ii<newMatches.length;ii++){\n                    var el = document.createTextNode('');\n                    node.appendChild(el);\n                    if(splitTextNodes[ii+1]){\n                        node.append(document.createTextNode(splitTextNodes[ii+1]));\n                    }\n                //å¯¹æ•°æ®å’Œdomè¿›è¡Œç»‘å®š\n                let returnCode = !this._data.__bindings[newMatches[ii]]?\n                    this._data.__bindings[newMatches[ii]] = [new Directive(el,this,\"nodeValue\",this.data[newMatches[ii]])]\n                    :this._data.__bindings[newMatches[ii]].push(new Directive(el,this,\"nodeValue\",this.data[newMatches[ii]]))\n                }\n            }\n\n```\n\nè¿™æ ·ï¼Œæˆ‘ä»¬çš„æ•°æ®ç»‘å®šé˜¶æ®µå°±å†™å¥½äº†ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¤„ç†`<input p-model = \"name\" />`è¿™æ ·çš„æƒ…å†µã€‚\n\nè¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ªæŒ‡ä»¤ï¼Œæˆ‘ä»¬åªéœ€è¦å½“è¯†åˆ«åˆ°è¿™ä¸€ä¸ªæŒ‡ä»¤çš„æ—¶å€™ï¼Œåšä¸€äº›å¤„ç†ï¼Œå³å¯ï¼š\n\n```\nif(node.hasAttribute((\"p-model\"))\n                && node.tagName.toLocaleUpperCase()==\"INPUT\" || node.tagName.toLocaleUpperCase()==\"TEXTAREA\"){\n                node.addEventListener(\"input\", (function () {\n\n                    var attributeValue = node.getAttribute(\"p-model\");\n\n                    if(_this._data.__bindings[attributeValue]) _this._data.__bindings[attributeValue].push(new Directive(node,_this,\"value\",_this.data[attributeValue])) ;\n                    else _this._data.__bindings[attributeValue] = [new Directive(node,_this,\"value\",_this.data[attributeValue])];\n\n                    return function (event) {\n                        _this.data[attributeValue]=event.target.value\n                    }\n                })());\n}\n```\n\nè¯·æ³¨æ„ï¼Œä¸Šé¢è°ƒç”¨äº†ä¸€ä¸ª`IIFE`ï¼Œå®é™…ç»‘å®šçš„å‡½æ•°åªæœ‰è¿”å›çš„å‡½æ•°é‚£ä¸€å°éƒ¨åˆ†ã€‚\n\næœ€åæˆ‘ä»¬å¤„ç†äº‹ä»¶çš„æƒ…å†µï¼š`<button p-click=\"test(2)\">button1</button>`\n\nå®é™…ä¸Šè¿™æ¯”å¤„ç†`p-model`è¿˜ç®€å•ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸ºäº†æ”¯æŒå‡½æ•°å‚æ•°çš„æƒ…å†µï¼Œå¤„ç†äº†ä¸€ä¸‹ä¼ å…¥å‚æ•°ï¼Œå¦å¤–æˆ‘å®é™…ä¸Šå°†`event`å§‹ç»ˆä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ é€’ï¼Œè¿™ä¹Ÿè®¸å¹¶ä¸æ˜¯å¥½çš„å®è·µï¼Œå› ä¸ºä½¿ç”¨çš„æ—¶å€™è¿˜è¦å¤šæ³¨æ„ã€‚\n\n```\nif(node.hasAttribute(\"p-click\")) {\n                node.addEventListener(\"click\",function(){\n                    var attributeValue=node.getAttribute(\"p-click\");\n                    var args=/\\(.*\\)/.exec(attributeValue);\n                    //å…è®¸å‚æ•°\n                    if(args) {\n                        args=args[0];\n                        attributeValue=attributeValue.replace(args,\"\");\n                        args=args.replace(/[\\(\\)\\'\\\"]/g,'').split(\",\");\n                    }\n                    else args=[];\n                    return function (event) {\n                        _this.methods[attributeValue].apply(_this,[event,...args]);\n                    }\n                }());\n}\n```\n\nç°åœ¨æˆ‘ä»¬å·²ç»å°†æ‰€æœ‰çš„ä»£ç åˆ†æå®Œäº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ¸…çˆ½ï¼Ÿä»£ç é™¤å»æ³¨é‡Šçº¦100è¡Œï¼Œæ‰€æœ‰æºä»£ç å¯ä»¥åœ¨[è¿™é‡Œä¸‹è½½](https://github.com/aircloud/Polar.js)ã€‚è¿™å½“ç„¶ä¸èƒ½ç®—ä½œä¸€ä¸ªæ¡†æ¶äº†ï¼Œä¸è¿‡å¯ä»¥å­¦ä¹ å­¦ä¹ ï¼Œè¿™å­¦æœŸæœ‰æ—¶é—´çš„è¯ï¼Œè¿˜è¦ç»§ç»­å®Œå–„ï¼Œä¹Ÿæ¬¢è¿å¤§å®¶ä¸€èµ·æ¢è®¨ã€‚\n\nä¸€èµ·å­¦ä¹ ï¼Œä¸€èµ·æé«˜ï¼ŒåšæŠ€æœ¯åº”å½“æ˜¯ç›´æ¥çš„ï¼Œæœ‰é—®é¢˜æ¬¢è¿æŒ‡å‡ºï½\n\n---\n\n\næœ€åè¯´çš„ç¬¬ä¸‰ç‚¹ï¼šæ˜¯è‡ªå·±è¿˜æ˜¯ä¸€ä¸ªå­¦ç”Ÿï¼Œåšè¿™äº›å†…å®¹ä¹Ÿä»…ä»…æ˜¯å‡ºäºå…´è¶£ï¼Œå› ä¸ºæ‰¾æš‘æœŸå®ä¹ æ¯”è¾ƒè‰°éš¾ï¼Œåœ¨ç­‰å¾…é¹…å‚é¢è¯•é—´éš™å†™çš„è¿™ä¸ªç¨‹åºï¼Œå‹å‹æƒŠ(ç„¶è€Œå¹¶æ²¡æœ‰æ¶ˆæ¯)ã€‚","tags":["MVVM"]},{"title":"[PWAå®è·µ]serviceWorkerç”Ÿå‘½å‘¨æœŸã€è¯·æ±‚ä»£ç†ä¸é€šä¿¡","url":"/2018/02/11/PWAå®è·µ-serviceWorkerç”Ÿå‘½å‘¨æœŸã€è¯·æ±‚ä»£ç†ä¸é€šä¿¡/","content":"\næœ¬æ–‡ä¸»è¦è®² serviceWorker ç”Ÿå‘½å‘¨æœŸå’ŒæŒ‚è½½ã€å¸è½½ç­‰é—®é¢˜ï¼Œé€‚åˆå¯¹ serviceWorker çš„ä½œç”¨æœ‰æ‰€äº†è§£ä½†æ˜¯å…·ä½“ç»†èŠ‚ä¸æ˜¯ç‰¹åˆ«æ¸…æ¥šçš„è¯»è€…\n\n**ä»¥ä¸‹æ‰€æœ‰åˆ†æåŸºäº Chrome V63**\n\n### serviceWorkerçš„æŒ‚è½½\n\nå…ˆæ¥ä¸€æ®µä»£ç æ„Ÿå—serviceWorkeræ³¨å†Œ:\n\n```\nif ('serviceWorker' in navigator) {\n      window.addEventListener('load', function () {\n          navigator.serviceWorker.register('/sw.js', {scope: '/'})\n              .then(function (registration) {\n                  // æ³¨å†ŒæˆåŠŸ\n                  console.log('ServiceWorker registration successful with scope: ', registration.scope);\n              })\n              .catch(function (err) {\n                  // æ³¨å†Œå¤±è´¥:(\n                  console.log('ServiceWorker registration failed: ', err);\n              });\n      });\n}\n```\né€šè¿‡ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬å®šä¹‰åœ¨`/sw.js`é‡Œçš„å†…å®¹å°±ä¼šç”Ÿæ•ˆ(å¯¹äºå½“å‰é¡µé¢ä¹‹å‰æ²¡æœ‰ serviceWorker çš„æƒ…å†µè€Œè¨€ï¼Œæˆ‘ä»¬æ³¨å†Œçš„ serviceWorker è‚¯å®šä¼šç”Ÿæ•ˆï¼Œå¦‚æœå½“å‰é¡µé¢å·²ç»æœ‰äº†æˆ‘ä»¬ä¹‹å‰æ³¨å†Œçš„ serviceWorkerï¼Œè¿™ä¸ªæ—¶å€™æ¶‰åŠåˆ° serviceWorkerçš„æ›´æ–°æœºåˆ¶ï¼Œä¸‹æ–‡è¯¦è¿°)\n\nå¦‚æœæˆ‘ä»¬åœ¨`sw.js`æ²¡æœ‰å˜åŒ–çš„æƒ…å†µä¸‹åˆ·æ–°è¿™ä¸ªé¡µé¢ï¼Œæ¯æ¬¡è¿˜æ˜¯ä¼šæœ‰æ³¨å†ŒæˆåŠŸçš„å›è°ƒä»¥åŠç›¸åº”çš„logè¾“å‡ºï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™æµè§ˆå™¨å‘ç°æˆ‘ä»¬çš„ serviceWorker å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå¹¶ä¸ä¼šé‡ç½®ä¸€é serviceWorker\n\n### serviceWorkeræ›´æ–°\n\næˆ‘ä»¬å¦‚æœæƒ³æ›´æ–°ä¸€ä¸ª serviceWorkerï¼Œæ ¹æ®æˆ‘ä»¬çš„ä¸€èˆ¬webå¼€å‘ç­–ç•¥ï¼Œå¯èƒ½ä¼šæƒ³åˆ°ä»¥ä¸‹å‡ ç§ç­–ç•¥ï¼š\n\n* ä»…å˜æ›´æ–‡ä»¶å(æ¯”å¦‚æŠŠ`sw.js`å˜æˆ`sw-v2.js`æˆ–è€…åŠ ä¸€ä¸ªhash)\n* ä»…å˜æ›´æ–‡ä»¶å†…å®¹(ä»…ä»…æ›´æ–°`sw.js`çš„å†…å®¹ï¼Œæ–‡ä»¶åä¸å˜)\n* åŒæ—¶å˜æ›´ï¼šåŒæ—¶æ‰§è¡Œä»¥ä¸Šä¸¤æ¡\n\nåœ¨è¿™é‡Œï¼Œæˆ‘å¯ä»¥å¾ˆè´Ÿè´£çš„å‘Šè¯‰ä½ ï¼Œ**å˜æ›´serviceWorkeræ–‡ä»¶åç»å¯¹ä¸æ˜¯ä¸€ä¸ªå¥½çš„å®è·µ**ï¼Œæµè§ˆå™¨åˆ¤æ–­ serviceWorker æ˜¯å¦ç›¸åŒåŸºæœ¬å’Œæ–‡ä»¶åæ²¡æœ‰å…³ç³»ï¼Œç”šè‡³æœ‰å¯èƒ½è¿˜ä¼šé€ æˆæµè§ˆå™¨æŠ›å‡º404å¼‚å¸¸(å› ä¸ºæ‰¾ä¸åˆ°åŸæ¥çš„æ–‡ä»¶åå¯¹åº”çš„æ–‡ä»¶äº†)ã€‚\n\næ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å˜æ›´å†…å®¹å³å¯ï¼Œå®é™…ä¸Šï¼Œæˆ‘ä»¬æ¯æ¬¡æ‰“å¼€æˆ–è€…åˆ·æ–°è¯¥é¡µé¢ï¼Œæµè§ˆå™¨éƒ½ä¼šé‡æ–°è¯·æ±‚ä¸€é serviceWorker çš„å®šä¹‰æ–‡ä»¶ï¼Œå¦‚æœå‘ç°æ–‡ä»¶å†…å®¹å’Œä¹‹å‰çš„ä¸åŒäº†ï¼Œè¿™ä¸ªæ—¶å€™:\n\n(*ä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨â€œæœ‰å…³ tabâ€æ¥è¡¨ç¤ºå— serviceWorker æ§åˆ¶çš„é¡µé¢*ï¼Œåˆ·æ–°å‡æŒ‡æ™®é€šåˆ·æ–°(F5/CommandR)å¹¶ä¸æŒ‡Hard Reload)\n\n* è¿™ä¸ªæ–°çš„ serviceWorker å°±ä¼šè¿›å…¥åˆ°ä¸€ä¸ª â€œwaiting to activateâ€ çš„çŠ¶æ€ï¼Œå¹¶ä¸”åªè¦æˆ‘ä»¬ä¸å…³é—­è¿™ä¸ªç½‘ç«™çš„æ‰€æœ‰tab(æ›´å‡†ç¡®åœ°è¯´ï¼Œæ˜¯è¿™ä¸ª serviceWorker æ§åˆ¶çš„æ‰€æœ‰é¡µé¢)ï¼Œæ–°çš„ serviceWorker å§‹ç»ˆä¸ä¼šè¿›å…¥æ›¿æ¢åŸæœ‰çš„è¿›å…¥åˆ° running çŠ¶æ€(å°±ç®—æˆ‘ä»¬åªæ‰“å¼€äº†ä¸€ä¸ªæœ‰å…³ tabï¼Œç›´æ¥åˆ·æ–°ä¹Ÿä¸ä¼šè®©æ–°çš„æ›¿æ¢æ—§çš„)ã€‚\n\n* å¦‚æœæˆ‘ä»¬å¤šæ¬¡æ›´æ–°äº† serviceWorker å¹¶ä¸”æ²¡æœ‰å…³é—­å½“å‰çš„ tab é¡µé¢ï¼Œé‚£ä¹ˆæ–°çš„ serviceWorker å°±ä¼šæŒ¤æ‰åŸå…ˆå¤„äºç¬¬äºŒé¡ºä½(waiting to activate)çš„serviceWorkerï¼Œå˜æˆ`waiting to activate`çŠ¶æ€\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åªæœ‰å…³é—­å½“å‰æ—§çš„ serviceWorker æ§åˆ¶çš„æ‰€æœ‰é¡µé¢ çš„æ‰€æœ‰tabï¼Œä¹‹åæµè§ˆå™¨æ‰ä¼šæŠŠæ—§çš„ serviveWorker ç§»é™¤æ‰ï¼Œæ¢æˆæ–°çš„ï¼Œå†æ‰“å¼€ç›¸åº”çš„é¡µé¢å°±ä¼šä½¿ç”¨æ–°çš„äº†ã€‚\n\nå½“ç„¶ï¼Œä¹Ÿæœ‰ä¸€ä¸ªç‰¹æ®Šæƒ…å†µï¼šå¦‚æœæˆ‘ä»¬åœ¨æ–°çš„ serviceWorker ä½¿ç”¨äº†`self.skipWaiting();`ï¼Œåƒè¿™æ ·ï¼š\n\n```\nself.addEventListener('install', function(event) {\n    self.skipWaiting();\n});\n```\n\nè¿™ä¸ªæ—¶å€™ï¼Œè¦åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š\n\n* å¦‚æœå½“å‰æˆ‘ä»¬åªæ‰“å¼€äº†ä¸€ä¸ªæœ‰å…³ tabï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬ç›´æ¥åˆ·æ–°ï¼Œå‘ç°æ–°çš„å·²ç»æ›¿æ¢æ‰æ—§çš„äº†ã€‚\n* å¦‚æœæˆ‘ä»¬å½“å‰æ‰“å¼€äº†è‹¥å¹²æœ‰å…³ tabï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæ— è®ºæˆ‘ä»¬åˆ·æ–°å¤šå°‘æ¬¡ï¼Œæ–°çš„ä¹Ÿä¸ä¼šæ›¿æ¢æ‰æ—§çš„ï¼Œåªæœ‰æˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªå…³æ‰tab(æˆ–è€…è·³è½¬èµ°)åªå‰©ä¸‹æœ€åä¸€ä¸ªäº†ï¼Œè¿™ä¸ªæ—¶å€™åˆ·æ–°ï¼Œä¼šè®©æ–°çš„æ›¿æ¢æ—§çš„(ä¹Ÿå°±æ˜¯ä¸Šä¸€ç§æƒ…å†µ)\n\nChrome çš„è¿™ç§æœºåˆ¶ï¼Œé˜²æ­¢äº†åŒä¸€ä¸ªé¡µé¢å…ˆåè¢«æ–°æ—§ä¸¤ä¸ªä¸åŒçš„ serviceWorker æ¥ç®¡çš„æƒ…å†µå‡ºç°ã€‚\n\n#### æ‰‹åŠ¨æ›´æ–°\n\nè™½ç„¶è¯´ï¼Œåœ¨é¡µé¢æ¯æ¬¡è¿›å…¥çš„æ—¶å€™æµè§ˆå™¨éƒ½ä¼šæ£€æŸ¥ä¸€é serviceWorker æ˜¯å¦æ›´æ–°ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³è¦æ‰‹åŠ¨æ›´æ–° serviceWorker ä¹Ÿæ²¡æœ‰é—®é¢˜ï¼š\n\n```\nnavigator.serviceWorker.register(\"/sw.js\").then(reg => {\n  reg.update();\n  // æˆ–è€… ä¸€æ®µæ—¶é—´ä¹‹åæ›´æ–°\n});\n```\n\nè¿™ä¸ªæ—¶å€™å¦‚æœ serviceWorker å˜åŒ–äº†ï¼Œé‚£ä¹ˆä¼šé‡æ–°è§¦å‘ install æ‰§è¡Œä¸€é install çš„å›è°ƒå‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰å˜ï¼Œå°±ä¸ä¼šè§¦å‘è¿™ä¸ªç”Ÿå‘½å‘¨æœŸã€‚\n\n#### install ç”Ÿå‘½å‘¨æœŸé’©å­\n\næˆ‘ä»¬ä¸€èˆ¬ä¼šåœ¨ sw.js ä¸­ï¼Œæ·»åŠ `install`çš„å›è°ƒï¼Œä¸€èˆ¬åœ¨å›è°ƒä¸­ï¼Œæˆ‘ä»¬ä¼šè¿›è¡Œç¼“å­˜å¤„ç†æ“ä½œï¼Œåƒè¿™æ ·ï¼š\n\n```\nself.addEventListener('install', function(event) {\n    console.log('[sw2] serviceWorker Installed successfully', event)\n\n    event.waitUntil(\n        caches.open('mysite-static-v1').then(function(cache) {\n            return cache.addAll([\n                '/stylesheets/style.css',\n                '/javascripts/common.39c462651d449a73b5bb.js',\n            ]);\n        })\n    )\n}    \n```\n\nå¦‚æœæˆ‘ä»¬æ–°æ‰“å¼€ä¸€ä¸ªé¡µé¢ï¼Œå¦‚æœä¹‹å‰æœ‰ serviceWorkerï¼Œé‚£ä¹ˆä¼šè§¦å‘`install`ï¼Œå¦‚æœä¹‹å‰æ²¡æœ‰ï¼Œ é‚£ä¹ˆåœ¨ serviceWorker è£…è½½åä¼šè§¦å‘ `install`ã€‚\n\nå¦‚æœæˆ‘ä»¬åˆ·æ–°é¡µé¢ï¼ŒserviceWorker å’Œä¹‹å‰æ²¡æœ‰å˜åŒ–æˆ–è€… serviceWorker å·²ç»å¤„åœ¨ `waiting to activate`ï¼Œä¸ä¼šè§¦å‘`install`ï¼Œå¦‚æœæœ‰å˜åŒ–ï¼Œä¼šè§¦å‘`install`ï¼Œä½†ä¸ä¼šæ¥ç®¡é¡µé¢(ä¸Šæ–‡ä¸­æåˆ°)ã€‚\n\n#### activate ç”Ÿå‘½å‘¨æœŸé’©å­\n\nactivate åœ¨ä»€ä¹ˆæ—¶å€™è¢«è§¦å‘å‘¢ï¼Ÿ\n\nå¦‚æœå½“å‰é¡µé¢æ²¡æœ‰ serviceworker ï¼Œé‚£ä¹ˆä¼šåœ¨ install ä¹‹åè§¦å‘ã€‚\n\nå¦‚æœå½“å‰é¡µé¢æœ‰ serviceWorkerï¼Œå¹¶ä¸”æœ‰ serviceWorkeræ›´æ–°ï¼Œæ–°çš„ serviceWorker åªä¼šè§¦å‘ install ï¼Œä¸ä¼šè§¦å‘ activate\n\næ¢å¥è¯è¯´ï¼Œå½“å‰å˜æˆ active çš„ serviceWorker æ‰ä¼šè¢«è§¦å‘è¿™ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­\n\n\n### serviceWorker ä»£ç†è¯·æ±‚\n\nserviceWorker ä»£ç†è¯·æ±‚ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¥½ç†è§£ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„ä¾‹å­ï¼š\n\n```\nself.addEventListener('install', function(event) {\n    console.log('[sw2] serviceWorker Installed successfully', event)\n\n    event.waitUntil(\n        caches.open('mysite-static-v1').then(function(cache) {\n            return cache.addAll([\n                '/stylesheets/style.css',\n                '/javascripts/common.39c462651d449a73b5bb.js',\n            ]);\n        })\n    );\n});\n\nself.addEventListener('fetch', function(event) {\n    console.log('Handling fetch event for', event.request.url);\n    // console.log('[sw2]fetch but do nothing')\n\n    event.respondWith(\n        // caches.match() will look for a cache entry in all of the caches available to the service worker.\n        // It's an alternative to first opening a specific named cache and then matching on that.\n        caches.match(event.request).then(function(response) {\n            if (response) {\n                console.log('Found response in cache:', response);\n\n                return response;\n            }\n\n            console.log('No response found in cache. About to fetch from network...');\n\n            // event.request will always have the proper mode set ('cors, 'no-cors', etc.) so we don't\n            // have to hardcode 'no-cors' like we do when fetch()ing in the install handler.\n            return fetch(event.request).then(function(response) {\n                console.log('Response from network is:', response);\n\n                return response;\n            }).catch(function(error) {\n                // This catch() will handle exceptions thrown from the fetch() operation.\n                // Note that a HTTP error response (e.g. 404) will NOT trigger an exception.\n                // It will return a normal response object that has the appropriate error code set.\n                console.error('Fetching failed:', error);\n\n                throw error;\n            });\n        })\n    );\n});\n```\n\næœ‰ä¸¤ç‚¹è¦æ³¨æ„çš„ï¼š\n\næˆ‘ä»¬å¦‚æœè¿™æ ·ä»£ç†äº†ï¼Œå“ªæ€•æ²¡æœ‰ cache å‘½ä¸­ï¼Œå®é™…ä¸Šä¹Ÿä¼šåœ¨æ§åˆ¶å°å†™from serviceWorkerï¼Œè€Œé‚£äº›çœŸæ­£ç”±serviceWorkerå‘å‡ºçš„è¯·æ±‚ä¹Ÿä¼šæ˜¾ç¤ºï¼Œæœ‰ä¸€ä¸ªé½¿è½®å›¾æ ‡ï¼Œå¦‚ä¸‹å›¾ï¼š\n\n![](https://www.10000h.top/images/sw_1.png)\n\nç¬¬äºŒç‚¹å°±æ˜¯æˆ‘ä»¬å¦‚æœåœ¨ fetch çš„ listener é‡Œé¢ do nothingï¼Œ ä¹Ÿä¸ä¼šå¯¼è‡´è¿™ä¸ªè¯·æ±‚ç›´æ¥å‡æ­»æ‰çš„ã€‚\n\nå¦å¤–ï¼Œé€šè¿‡ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å‘ç°ï¼Œå®é™…ä¸Šç”±äºç°åœ¨æˆ‘ä»¬ä¹ æƒ¯ç»™æˆ‘ä»¬çš„æ–‡ä»¶èµ„æºåŠ ä¸Š hashï¼Œæ‰€ä»¥æˆ‘ä»¬åŸºæœ¬ä¸Šä¸å¯èƒ½æ‰‹åŠ¨è¾“å…¥éœ€è¦ç¼“å­˜çš„æ–‡ä»¶åˆ—è¡¨ï¼Œç°åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯å€ŸåŠ© webpack æ’ä»¶ï¼Œå®Œæˆè¿™éƒ¨åˆ†å·¥ä½œã€‚\n\n### serviceWorker å’Œ é¡µé¢ä¹‹é—´çš„é€šä¿¡\n\nserviceWorkerå‘é¡µé¢å‘æ¶ˆæ¯ï¼š\n\n```\nsw.js:\n\nself.clients.matchAll().then(clients => {\n    clients.forEach(client => {\n        console.log('%c [sw message]', 'color:#00aa00', client)\n        client.postMessage(\"This message is from serviceWorker\")\n    })\n})\n\nä¸»é¡µé¢:\n\nnavigator.serviceWorker.addEventListener('message', function (event) {\n    console.log('[Main] receive from serviceWorker:', event.data, event)\n});\n```\n\nå½“ç„¶ï¼Œè¿™é‡Œé¢æ˜¯æœ‰å‘çš„ï¼š\n\n* ä¸»ç•Œé¢çš„äº‹ä»¶ç›‘å¬éœ€è¦ç­‰serviceWorkeræ³¨å†Œå®Œæ¯•åï¼Œæ‰€ä»¥ä¸€èˆ¬`navigator.serviceWorker.register`çš„å›è°ƒåˆ°æ¥ä¹‹åå†è¿›è¡Œæ³¨å†Œ(æˆ–è€…å»¶è¿Ÿè¶³å¤Ÿçš„æ—¶é—´)ã€‚\n* å¦‚æœåœ¨ä¸»ç•Œé¢äº‹ä»¶ç›‘å¬è¿˜æ²¡æœ‰æ³¨å†ŒæˆåŠŸçš„æ—¶å€™ serviceWorker å‘é€æ¶ˆæ¯ï¼Œè‡ªç„¶æ˜¯æ”¶ä¸åˆ°çš„ã€‚å¦‚æœæˆ‘ä»¬æŠŠ serviceWorker ç›´æ¥å†™åœ¨ install çš„å›è°ƒä¸­ï¼Œä¹Ÿæ˜¯ä¸èƒ½è¢«æ­£å¸¸æ”¶åˆ°çš„ã€‚\n\nä»é¡µé¢å‘ serviceWorker å‘é€æ¶ˆæ¯ï¼š\n\n```\nä¸»é¡µé¢:\n\nnavigator.serviceWorker.controller && navigator.serviceWorker.controller.postMessage('hello serviceWorker');\n\nsw.js:\nself.addEventListener('message', function (event) {\n    console.log(\"[sw from main]\",event.data); // è¾“å‡ºï¼š'sw.updatedone'\n});\n```\n\nåŒæ ·çš„ï¼Œè¿™ä¹Ÿè¦æ±‚ä¸»ç•Œé¢çš„ä»£ç éœ€è¦ç­‰åˆ°serviceWorkeræ³¨å†Œå®Œæ¯•åè§¦å‘ï¼Œå¦å¤–è¿˜æœ‰ä¸€ç‚¹å€¼å¾—æ³¨æ„ï¼Œ serviceWorker çš„äº‹ä»¶ç»‘å®šä»£ç è¦æ±‚ä¸»ç•Œé¢çš„serviceWorkerå·²ç»æ³¨å†Œå®Œæ¯•åæ‰å¯ä»¥ã€‚\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå½“å‰é¡µé¢æ²¡æœ‰è¯¥serviceWorker ç¬¬ä¸€æ¬¡æ³¨å†Œæ˜¯ä¸ä¼šæ”¶åˆ°ä¸»ç•Œé¢æ¥æ”¶åˆ°çš„æ¶ˆæ¯çš„ã€‚\n\nè®°ä½ï¼Œåªæœ‰å½“å‰å·²ç»åœ¨ active çš„ serviceWorkerï¼Œ æ‰èƒ½å’Œä¸»é¡µé¢æ”¶å‘æ¶ˆæ¯ç­‰ã€‚\n\n**ä»¥ä¸Šå°±æ˜¯å’Œ serviceWorker æœ‰å…³çš„ä¸€äº›å†…å®¹ï¼Œåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä¼šå¯¹PWA æ·»åŠ è‡³ä¸»å±å¹•ç­‰åŠŸèƒ½è¿›è¡Œæ€»ç»“**\n\n","tags":["PWA"]},{"title":"CentOSå®‰è£…node8.xç‰ˆæœ¬","url":"/2017/12/15/CentOSå®‰è£…node8-xç‰ˆæœ¬/","content":"### CentOS å®‰è£… node 8.x ç‰ˆæœ¬\n\nç”±äºä¸€äº›åŸå› éœ€è¦ç»™CentOSæœåŠ¡å™¨å®‰è£…8.0ä»¥ä¸Šç‰ˆæœ¬çš„node, æœ¬æ¥ç›´æ¥é€šè¿‡yumç®¡ç†å®‰è£…ç®¡ç†ï¼Œä½†æ˜¯æ²¡æ‰¾åˆ°å¥½åŠæ³•ï¼Œåœ¨æ­¤è®°å½•ä¸€ä¸‹è‡ªå·±æœ€åä½¿ç”¨çš„ç®€å•è¿‡ç¨‹ï¼š\n\nå®‰è£…ä¹‹å‰åˆ é™¤åŸæ¥çš„nodeå’Œnpm (æˆ‘åŸæ¥æ˜¯ç”¨yumå®‰è£…çš„ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å®‰è£…å¯ä»¥çœç•¥è¿™ä¸€æ­¥):\n\n```\nyum remove nodejs npm -y\n```\n\né¦–å…ˆæˆ‘ä»¬éšä¾¿è¿›å…¥æœåŠ¡å™¨çš„ä¸€ä¸ªç›®å½•ï¼Œç„¶åä»æ·˜å®çš„æºæ‹‰å–å†…å®¹:\n\n```\nwget https://npm.taobao.org/mirrors/node/v8.0.0/node-v8.0.0-linux-x64.tar.xz \n```\n\nè§£å‹ç¼©:\n\n```\nsudo tar -xvf node-v8.0.0-linux-x64.tar.xz \n```\n\nè¿›å…¥è§£å‹ç›®å½•ä¸‹çš„ bin ç›®å½•ï¼Œæ‰§è¡Œ ls å‘½ä»¤\n\n```\ncd node-v8.0.0-linux-x64/bin && ls \n```\n\næˆ‘ä»¬å‘ç°æœ‰node å’Œ npm\n\nè¿™ä¸ªæ—¶å€™æˆ‘ä»¬æµ‹è¯•:\n\n```\n./node -v\n```\n\nè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å‘ç°å®é™…ä¸Šå·²ç»å®‰è£…å¥½äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¦å»ºç«‹é“¾æ¥æ–‡ä»¶ã€‚\n\nè¿™é‡Œè¿˜æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä¹‹å‰å·²ç»å®‰è£…è¿‡äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦å…ˆåˆ é™¤ä¹‹å‰å»ºç«‹çš„é“¾æ¥æ–‡ä»¶ï¼š\n\n```\nsudo rm -rf /usr/bin/node\nsudo rm -rf /usr/bin/npm\n```\n\nç„¶åå»ºç«‹é“¾æ¥æ–‡ä»¶:\n\n```\nsudo ln -s /usr/share/node-v8.0.0-linux-x64/bin/node /usr/bin/node\nsudo ln -s /usr/share/node-v8.0.0-linux-x64/bin/npm /usr/bin/npm\n```\n\næ³¨æ„è¿™é‡Œçš„ç¬¬ä¸€ä¸ªè·¯å¾„ä¸è¦ç›´æ¥å¤åˆ¶ç²˜è´´ï¼Œè¦å†™å½“å‰æ–‡ä»¶çš„çœŸæ­£çš„è·¯å¾„ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡pwdè·å–ã€‚\n\nç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡`node -v`ç­‰æµ‹è¯•å·²ç»å®‰è£…æˆåŠŸã€‚\n","tags":["centOS","Node.js"]},{"title":"æ·±å…¥æµè§ˆå™¨webæ¸²æŸ“ä¸ä¼˜åŒ–-ç»­","url":"/2017/08/31/æ·±å…¥æµè§ˆå™¨webæ¸²æŸ“ä¸ä¼˜åŒ–-ç»­/","content":">æœ¬ç¯‡æ–‡ç« æ¥ä¸Šä¸€ç¯‡ç»§ç»­åˆ†ææµè§ˆå™¨webæ¸²æŸ“ç›¸å…³å†…å®¹ï¼Œä½†æ˜¯æ›´ä¾§é‡ä¼˜åŒ–å·¥ä½œã€‚å½“ç„¶ï¼Œä¸»è¦è¿˜æ˜¯åŸºäºX5æ¥åˆ†æ\n\nä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬ä¸»è¦æ˜¯ä»æµè§ˆå™¨å†…æ ¸çš„çº¿ç¨‹è§’åº¦æ¥åˆ†æç›¸å…³å·¥ä½œçš„ï¼Œå¯¹æ•´ä½“æµç¨‹æ²¡æœ‰å®è§‚æ¸…æ™°çš„åˆ†æï¼Œè¿™æ¬¡æˆ‘ä»¬ä»å®è§‚åˆ°å¾®è§‚ï¼Œä»æ•´ä½“åˆ°å±€éƒ¨ï¼Œæ¥è¿›è¡Œåˆ†æå’Œæ¢ç©¶å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹ã€‚\n\né¦–å…ˆï¼Œä¸€ä¸ªç½‘é¡µçš„åŠ è½½ï¼Œéœ€è¦ä»€ä¹ˆå·¥ä½œå‘¢ï¼Ÿ\n\n![](https://www.10000h.top/images/data_img/webRender2/P1.png)\n\nè¿™ä¸ªå·¥ä½œå¯ä»¥åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šäº‘(äº‘ç«¯)ã€ç®¡(ä¼ è¾“é“¾è·¯)ã€ç«¯(å®¢æˆ·ç«¯)ï¼Œä»äº‘ç»è¿‡ç®¡ä¼ åˆ°ç«¯ï¼Œç„¶åç»è¿‡åŠ è½½è§£ææ’ç‰ˆæ¸²æŸ“ï¼Œä»è€Œå®Œæˆç½‘é¡µä»è¯·æ±‚åˆ°å‘ˆç°çš„å·¥ä½œ(å½“ç„¶ï¼Œæˆ‘ä»¬è¿™é‡Œæ²¡æœ‰æ¶‰åŠåè®®çš„åˆ†æï¼Œå®é™…ä¸Šæ ¹æ®åè®®ä¸åŒï¼Œè¿™ä¸ªä¼ è¾“å¯èƒ½æ˜¯å¤šæ¬¡ä¼ è¾“)ã€‚\n\næ•°æ®åˆ°ç«¯ä¹‹åï¼Œåˆç»è¿‡ä»¥ä¸‹è¿‡ç¨‹ï¼Œæ‰æœ€ç»ˆæ˜¾ç¤ºå‡ºæ¥ï¼š\n\n![](https://www.10000h.top/images/data_img/webRender2/P2.png)\n\nåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ€ä¹ˆè¡¡é‡æ€§èƒ½å‘¢ï¼Ÿ\n\nå›ºç„¶ï¼Œæˆ‘ä»¬æœ‰è¯¸å¤šæµè§ˆå™¨æä¾›çš„APIï¼Œè¿™äº›APIèƒ½è®©æˆ‘ä»¬è·å–åˆ°è¾ƒå¤šä¿¡æ¯å¹¶ä¸”è®°å½•ä¸ŠæŠ¥ï¼š\n\n![](https://www.10000h.top/images/data_img/webRender2/P3.png)\n\nä½†æ˜¯è¿™äº›å…·ä½“æ•°å€¼è¡¨è¾¾çš„å«ä¹‰æœ‰é™ï¼Œå¹¶ä¸”ä»–ä»¬å®é™…ä¸Šä¹Ÿä¸ç­‰äºç”¨æˆ·ä½“éªŒã€‚\n\næ‰€ä»¥ï¼Œæ‰¾åˆ°ä¸€ä¸ªç§‘å­¦å¹¶ä¸”å¯ä»¥æ£€æµ‹çš„æ ‡å‡†ï¼Œå¹¶ä¸”è¿™ä¸ªæ ‡å‡†å¯ä»¥å’Œç”¨æˆ·ä½“éªŒæœ‰æ­£ç›¸å…³å…³ç³»ï¼Œè¿™ä¸ªæ˜¯è‡³å…³é‡è¦çš„ã€‚\n\nç›®å‰è¿™ä¸ªæ ‡å‡†æ˜¯**é¦–å±æ—¶é—´**(å°±ä¹‹å‰è‡ªå·±çš„äº†è§£ï¼Œå…·ä½“çš„è¿˜åŒºåˆ†é¦–å±å±•ç¤ºæ—¶é—´å’Œé¦–å±å¯äº¤äº’æ—¶é—´ï¼Œä½†æ˜¯è¿™é‡Œè®²å¸ˆä¸åšåŒºåˆ†ï¼Œå°±ä¸‹æ–‡æä¾›çš„æµ‹ç®—æ–¹æ³•è€Œè¨€ï¼Œæ˜¾ç„¶è¿™é‡ŒæŒ‡çš„æ˜¯é¦–å±å±•ç¤ºæ—¶é—´ï¼Œ*å¦å¤–ï¼Œå±•ç¤ºååˆ°ç”¨æˆ·çš„ç¬¬ä¸€æ¬¡æ“ä½œéƒ½ä¼šæœ‰ä¸€ä¸ªè‡³å°‘1sçš„å»¶æ—¶ï¼Œæ¯•ç«Ÿç”¨æˆ·æ‰‹æŒ‡æŒ‰ä¸‹çš„åŠ¨ä½œæ˜¯ä¼šæ¯”è¾ƒæ…¢çš„ï¼Œè¿™ä¸ªæ—¶é—´jsçš„äº¤äº’éƒ½èƒ½å®Œæˆäº†ï¼Œæ‰€ä»¥é¦–å±å±•ç¤ºæ—¶é—´æ›´åŠ é‡è¦--from dorsywang*)\n\né‚£ä¹ˆ**é¦–å±æ—¶é—´**æ€ä¹ˆæµ‹é‡å‘¢ï¼Ÿ\n\n**æ‹¿æ‘„åƒæœºå¿«é€Ÿæ‹ç…§æµ‹é‡çš„**ã€‚è¿™ä¸ªç­”æ¡ˆå¯èƒ½æœ‰äº›åƒæƒŠï¼Œä½†æ˜¯ç›®å‰X5å†…æ ¸ä¸šåŠ¡çš„ç›¸å…³å¼€å‘äººå‘˜çš„ç¡®å°±æ˜¯é‡‡ç”¨è¿™ç§æ–¹å¼æµ‹ç®—çš„ï¼Œé€šè¿‡é«˜é€Ÿç›¸æœºä¸æ–­æ‹ç…§ï¼Œç„¶åè¾…åŠ©å›¾åƒè¯†åˆ«ï¼Œåˆ¤æ–­é¦–å±æ˜¯å¦å·²ç»åŠ è½½å®Œæˆï¼Œæœ€ç»ˆå†é€šè¿‡äººå·¥å›å½’æ ¡å¯¹ã€‚  \nå› ä¸ºå¦‚æœé‡‡ç”¨ç¨‹åºæ£€æµ‹çš„è¯ï¼ŒåŸºæœ¬ä¸Šéƒ½ä¼šå¯¹è¿‡ç¨‹æœ¬èº«é€ æˆä¸€å®šçš„å½±å“ï¼Œæ‰€ä»¥æ²¡æœ‰é‡‡ç”¨è¿™ç§æ–¹å¼ã€‚\nå½“ç„¶ï¼Œé€šè¿‡æ‘„åƒ+å›¾åƒè¯†åˆ«çš„è¿™ç§æ–¹å¼ä¹Ÿæ˜¯æœ‰ä¸€å®šçš„å¼Šç«¯ï¼Œæ¯”å¦‚è¯´ï¼Œå‡è®¾é¦–å±æœ‰ä¸€ä¸ªå›¾ç‰‡ï¼Œè€Œå›¾ç‰‡çš„åŠ è½½é€šå¸¸æ¯”è¾ƒæ…¢å¹¶ä¸”ä¸å½±å“cssã€jsçš„åŠ è½½ï¼Œè¿™ä¸ªæ—¶å€™ç›´æ¥é€šè¿‡å›¾ç‰‡è¯†åˆ«çš„è¯å°±å¯èƒ½ä¼šæœ‰ä¸€å®šçš„è¯¯åˆ¤ã€‚\n\nçŸ¥é“äº†æ€ä¹ˆæµ‹ç®—ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥åˆ†æå½±å“è¿™ä¸ªæŒ‡æ ‡çš„ä¸€äº›åŸå› ï¼š\n\n* èµ„æºé˜»å¡å†…æ ¸çº¿ç¨‹\n\næˆ‘ä»¬çŸ¥é“ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œcsså’ŒJSæ˜¯é˜»å¡é¡µé¢çš„ï¼Œå½“ç„¶ä¹Ÿä¼šå¯¹é¦–å±æ—¶é—´é€ æˆå½±å“ã€‚\n\nå¯¹è¿™ä¸ªé—®é¢˜ï¼ŒX5å†…æ ¸æœ‰å…³é”®å­èµ„æº(é˜»å¡èµ„æº)ç¼“å­˜ï¼Œè¿™é‡Œçš„å…³é”®èµ„æºï¼ŒæŒ‡çš„æ˜¯å†…æ ¸ç»è¿‡ç»Ÿè®¡åˆ¤æ–­å¾—å‡ºçš„ä¸šåŠ¡å¸¸ç”¨çš„å…³é”®å­èµ„æºã€‚\n\nå½“ç„¶ï¼Œè¿™ä¸ªç»Ÿè®¡ä¹Ÿå¯èƒ½ç¼ºä¹ä¸€å®šçš„å‡†ç¡®æ€§ï¼Œæ‰€ä»¥ç›¸å…³å›¢é˜Ÿä¹Ÿæ­£åœ¨æ¨è¿›è¿™æ–¹é¢çš„å†…å®¹è§„èŒƒåŒ–(æ¯”å¦‚å†™å…¥Web App Manifest)\n\n* ä¸­æ–‡Layoutçš„æ—¶é—´è¿‡é•¿\n\nè¿™ä¸ªé—®é¢˜æˆ‘ä¹‹å‰æ²¡æœ‰å¬è¯´è¿‡ï¼Œä½†æ˜¯çš„ç¡®æ˜¯è¿™æ ·å­ï¼Œå®é™…ä¸Šï¼Œæµè§ˆå™¨åœ¨ç»˜åˆ¶æ–‡å­—çš„æ—¶å€™ç»å†çš„è¿‡ç¨‹éå¸¸çš„å¤šï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªç¯èŠ‚æ˜¯æ‰¾åˆ°æ–‡å­—çš„å®½åº¦å’Œé«˜åº¦(å› ä¸ºåœ¨è‹±æ–‡çŠ¶æ€ä¸‹ï¼Œæ¯ä¸€ä¸ªå­—ç¬¦çš„å®½åº¦æ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªå­—ç¬¦éƒ½è¦æŸ¥æ‰¾ï¼Œä½†æ˜¯è‹±æ–‡æ€»å…±åªæœ‰26ä¸ªå­—ç¬¦)ï¼Œè€Œä¸­æ–‡ç”±äºå­—ç¬¦æ¯”è¾ƒå¤šï¼Œå¸¸ç”¨å¾—å°±æœ‰6000å¤šä¸ªï¼Œå®Œæ•´çš„æ›´æ˜¯æœ‰2ä¸‡ä¸ªä»¥ä¸Šï¼Œæ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹éœ€è¦èŠ±è´¹æ›´å¤šçš„æ—¶é—´ã€‚\n\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒX5å†…æ ¸è€ƒè™‘åˆ°ä¸­æ–‡æ–‡å­—å‡ ä¹éƒ½æ˜¯ç­‰å®½ç­‰é«˜çš„ï¼Œæ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹å¯¹ä¸€ä¸ªæ–‡å­—ä¸²æ¥è¯´åªéœ€è¦æŸ¥è¯¢ä¸€æ¬¡å³å¯ï¼Œå®é™…ä¸Šæ˜¯èŠ‚çº¦äº†è¿™ä¸ªç¯èŠ‚ã€‚\n\n* é¦–æ¬¡æ¸²æŸ“å¤ªæ…¢\n\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨å…ˆç»˜åˆ¶é¦–å±çš„æ–¹å¼ï¼Œè¿™ä¸ªä¹Ÿå°±æ˜¯åŸºäºç¬¬ä¸€ç¯‡æ–‡ç« ä¸­è®²åˆ°çš„æµè§ˆå™¨çš„åˆ†å—æ¸²æŸ“æœºåˆ¶\n\n* ä¸€æ¬¡è§£æå†…å®¹è¿‡å¤š\n\né‡‡ç”¨é¦–å±æ¢æµ‹æœºåˆ¶ï¼Œä¼˜å…ˆè§£æé¦–å±å†…å®¹ã€‚\n\nå¦å¤–ï¼Œè¿™é‡Œå¯ä»¥å‰ç«¯é…åˆå»åšé¦–å±ä¼˜åŒ–ï¼š\n\n\nåœ¨é¦–å±çš„ä½ç½®æ’å…¥é¦–å±æ ‡ç­¾ï¼Œå†…æ ¸è§£æåˆ°æ ‡ç­¾åç«‹å³ç»ˆæ­¢è§£æå¹¶ä¸”æ’ç‰ˆä¸Šå±\n\n```\n<meta name=â€˜x5-pagetypeâ€™ content=â€˜optpage'>\n```\nç„¶ååœ¨é¦–å±åˆ†ç•Œçš„åœ°æ–¹ï¼š\n\n```\n<first-screen/>\n```\n\næœ‰äº†è¿™ï¼Œå¯ä»¥ä¸“é—¨å»ä¼˜åŒ–é¦–å±æ ‡ç­¾ä¹‹å‰çš„å†…å®¹(è¿™ä¸ªæ ‡ç­¾å‰å°½é‡å±•ç°è€—æ—¶å°‘å’Œä¸éœ€è¦é˜»å¡è§£æçš„èµ„æº)ã€‚\n\nå¦å¤–ï¼ŒX5å†…æ ¸ä¹Ÿæä¾›äº†ä¸»èµ„æºé¢„æ‹‰å–çš„æ¥å£ï¼Œå¹¶ä¸”è€ƒè™‘åˆ°é¢„æ‹‰å–çš„cookieé—®é¢˜ï¼Œè¿˜æä¾›äº†preconnecté¢„é“¾æ¥ã€‚  \n*TIP:ä¸»èµ„æºä¸­å…³è”çš„å­èµ„æºé¢„æ‹‰å–ä¸ç”¨ä¸»åŠ¨è°ƒç”¨*\n\n* é¢„å…ˆæ“ä½œ\n\nå¦å¤–ä¸ºäº†æä¾›æ›´åŠ æè‡´çš„ä¼˜åŒ–ï¼ŒX5å†…æ ¸(QQæµè§ˆå™¨ã€æ‰‹Q Webview)è¿˜æä¾›äº†å¦‚ä¸‹è¯¸å¤šé¢„æ“ä½œï¼š\n\n* åœ¨\"é»è´´å¹¶è½¬åˆ°\"ä¹‹å‰å°±å¼€å§‹è¿›è¡Œç½‘ç»œè¯·æ±‚å’Œé¢„æ¸²æŸ“\n* ç»å¸¸è®¿é—®çš„ç«™ç‚¹å¯ä»¥é¢„è§£æDNS\n* ç‚¹å‡»åœ°å€æ æ—¶è¿›è¡Œæœç´¢é¢„è¿æ¥\n* ç‚¹å‡»é“¾æ¥æ—¶ï¼Œå…ˆé¢„é“¾æ¥ï¼Œå†åšè·³è½¬ã€‚\n* ......\n\n### å…¶ä»–æ–¹å¼ä¼˜åŒ–\n\nå®é™…ä¸Šä¸Šæ–‡ä¸»è¦è®²äº†å®¢æˆ·ç«¯æ–¹é¢çš„ä¼˜åŒ–å·¥ä½œï¼Œå®é™…ä¸Šå¯¹äº\"äº‘\"ã€\"ç®¡\"ä¸¤ç«¯ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šä¼˜åŒ–å·¥ä½œå¯ä»¥è®²çš„ï¼Œä½†æ˜¯ç”±äºè¿™ä¸ªå’Œå‰ç«¯å…³ç³»ä¸æ˜¯ç‰¹åˆ«å¯†åˆ‡ï¼Œæˆ‘æŒ‘ä¸€éƒ¨åˆ†è®²ä¸€è®²ã€‚è¿™äº›åœ¨æˆ‘ä»¬å‰ç«¯åšä¸ªäººé¡¹ç›®çš„åå°æ—¶å€™ä¹Ÿå¯ä»¥å‚è€ƒ\n\n##### åå°æé€Ÿ\n\n* ç›´æ¥ä½¿ç”¨IPï¼ŒèŠ‚çœdnsçš„æŸ¥è¯¢æ—¶é—´\n* ç»´æŒé•¿è¿æ¥\n* HTTP1.1å¯ç”¨åŒ…å¤´èŠ‚çœ\n* æœåŠ¡å™¨ç¼“å­˜\n* æ–‡æœ¬èµ„æºå‹ç¼©ä¼ è¾“GZIP(6)\n* å›¾ç‰‡å°ºå¯¸å‹ç¼©ã€å›¾ç‰‡è´¨é‡å‹ç¼©ã€æ”¯æŒwebpå’Œsharpp/hevcæ ¼å¼ã€‚\n\n##### é™ä½ç½‘ç»œæ—¶å»¶\n\n* å°±å¿«æ¥å…¥å’Œå°±è¿‘æ¥å…¥\n\nåœ¨é€‰æ‹©æ¥å…¥ç‚¹çš„æ—¶å€™ï¼Œå¦‚æœé‡‡ç”¨å°±è¿‘æ¥å…¥ï¼Œå¯ä»¥ä¿æŒè·¯ç”±ç¨³å®šï¼Œæœ‰åˆ©äºè´Ÿè½½å‡è¡¡ï¼Œå¹¶ä¸”å®ç°ç®€å•ï¼Œä¾¿äºç»´æŠ¤ã€‚ä½†æ˜¯ä¹Ÿæœ‰ä¸€å®šçš„ç¼ºç‚¹ï¼šç»éªŒåˆ¤æ–­ï¼Œå‡†ç¡®åº¦ä¸å¤Ÿé«˜ ï¼› æ— æ³•è‡ªåŠ¨åˆ‡æ¢è·¯ç”±ã€‚\n\nç›¸æ¯”è¾ƒè€Œè¨€ï¼Œé€‰æ‹©å°±å¿«æ¥å…¥ï¼Œæ˜¯ä¸€ä¸ªèƒ½å¤Ÿææ•ˆçš„æ–¹å¼ã€‚\n\n##### å†…å®¹é˜²åŠ«æŒ\n\nè¿è¥å•†åŠ«æŒå¯¹æˆ‘ä»¬æ¥è¯´å·²ç»æ˜¯ä¸é™Œç”Ÿçš„è¯é¢˜äº†ï¼Œä½†æ˜¯X5å†…æ ¸æœ‰ä¸€ä¸ªæ¯”è¾ƒæ–°çš„é˜²åŠ«æŒæ‰‹æ®µï¼Œå°±æ˜¯å®¢æˆ·ç«¯å’Œäº‘åŠ é€ŸæœåŠ¡å™¨åŒæ—¶é‡‡ç”¨è½»é‡çº§httpåŠ å¯†ï¼Œè™½ç„¶è¿™ç§æ–¹å¼æ™®é€‚æ€§ä¸å¼ºï¼Œä½†æ˜¯çš„ç¡®å¯ä»¥è§£å†³è…¾è®¯è‡ªèº«ä¸šåŠ¡çš„é˜²åŠ«æŒé—®é¢˜ã€‚\n\n#### QUICå’Œhttp2\n\nQUIC åŸºäºUDPçš„åè®®é€šè®¯æ–¹å¼ï¼Œæœ‰è¿™äº›ä¼˜åŠ¿ï¼š\n\n* å»¶è¿Ÿå°‘\n* å‰å‘çº é”™\n* æ²¡æœ‰**çº¿å¤´é˜»å¡[æ³¨1]**çš„å¤šè·¯å¤ç”¨\n* é€šä¿¡é€šé“çš„å®šä¹‰åŸºäºIDè€Œä¸æ˜¯IP+ç«¯å£ï¼Œä½¿å¾—åˆ‡æ¢ç½‘ç»œåç»§ç»­è½¬å‘é“¾æ¥æˆä¸ºå¯èƒ½\n\nâ€”â€”â€”â€”â€”â€”\n\næ³¨1ï¼šçº¿å¤´é˜»å¡ï¼š\n\n![](https://www.10000h.top/images/data_img/webRender2/P4.png)\n\nâ€”â€”â€”â€”â€”â€”\n\né™„1: å¸¦å®½å’Œå»¶è¿Ÿå¯¹ç½‘é¡µåŠ è½½çš„å½±å“ï¼š\n\n![](https://www.10000h.top/images/data_img/webRender2/X1.png)\n","tags":["æ€§èƒ½ä¼˜åŒ–"]},{"title":"æ·±å…¥æµè§ˆå™¨webæ¸²æŸ“ä¸ä¼˜åŒ–","url":"/2017/08/27/æ·±å…¥æµè§ˆå™¨webæ¸²æŸ“ä¸ä¼˜åŒ–/","content":">æœ¬æ–‡ä¸»è¦åˆ†æå’Œæ€»ç»“webå†…æ ¸æ¸²æŸ“çš„ç›¸å…³å†…å®¹ï¼Œä»¥åŠåœ¨è¿™æ–¹é¢å‰ç«¯å¯ä»¥åšçš„æ€§èƒ½ä¼˜åŒ–å·¥ä½œã€‚\n\næ–‡ç« ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š\n\n* blinkå†…æ ¸çš„æ¸²æŸ“æœºåˆ¶\n* chromeå†…æ ¸æ¶æ„å˜è¿\n* åˆ†å±‚æ¸²æŸ“\n* åŠ¨ç”» & canvas & WebGl\n\n*è¿™é‡Œçš„å‰ä¸¤éƒ¨åˆ†å¯èƒ½ä¼šæœ‰äº›æ¯ç‡¥ï¼Œå¦‚æœæ˜¯å‰ç«¯å·¥ç¨‹å¸ˆå¹¶ä¸”æƒ³ç«‹å³è·å¾—å®é™…é¡¹ç›®çš„å»ºè®®çš„ï¼Œå¯ä»¥ç›´æ¥é˜…è¯»ç¬¬ä¸‰éƒ¨åˆ†å’Œç¬¬å››éƒ¨åˆ†*\n\n### blinkå†…æ ¸çš„æ¸²æŸ“æœºåˆ¶\n\nblinkå†…æ ¸æ˜¯GoogleåŸºäºWebkitå†…æ ¸å¼€å‘çš„æ–°çš„åˆ†æ”¯ï¼Œè€Œå®é™…ä¸Šï¼Œç›®å‰Chromeå·²ç»é‡‡ç”¨äº†blinkå†…æ ¸ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥çš„æœ‰å…³åˆ†æå¤§å¤šåŸºäºblinkå†…æ ¸çš„æµè§ˆå™¨(Chrome)ï¼Œå°±ä¸å†è¯¦ç»†æŒ‡æ˜ï¼Œå½“ç„¶ï¼Œéƒ¨åˆ†å†…å®¹ä¹Ÿä¼šæ¶‰åŠåˆ°è…¾è®¯ç ”å‘çš„X5å†…æ ¸(X5å†…æ ¸åŸºäºå®‰å“çš„WebViewï¼Œç›®å‰å·²ç»åœ¨æ‰‹æœºQQç­‰äº§å“ä¸­ä½¿ç”¨ï¼ŒåŸºäºX5å†…æ ¸çš„é¡¹ç›®ç´¯è®¡æœ‰æ•°äº¿UVï¼Œä¸Šç™¾äº¿PV)ã€‚\n\nä¸€ä¸ªé¡µé¢çš„æ˜¾ç¤ºï¼Œå®é™…ä¸Šä¸»è¦ç»å†äº†ä¸‹é¢çš„å››ä¸ªæµç¨‹ï¼š\n\nåŠ è½½ => è§£æ => æ’ç‰ˆ => æ¸²æŸ“\n\nå®é™…ä¸Šï¼Œè¿™é‡Œçš„æ¸²æŸ“ä¸»è¦æ˜¯æŒ‡æ’ç‰ˆä¹‹ååˆ°æœ€åçš„ä¸Šå±ç»˜åˆ¶(è¿™ä¸ªæ—¶å€™å†…å®¹å·²ç»æ’ç‰ˆå¥½äº†)ï¼Œä¸€éƒ¨åˆ†å‰ç«¯å·¥ç¨‹å¸ˆé€šå¸¸ä¼šæŠŠä¸€éƒ¨åˆ†çš„æ’ç‰ˆå·¥ä½œç†è§£åˆ°â€œæ¸²æŸ“â€çš„æµç¨‹ä¸­(ä¹Ÿå°±æ˜¯ä¸‹å›¾ä¸­å…¨éƒ¨å·¥ä½œ)ï¼Œå®é™…ä¸Šè¿™ä¸ªç†è§£æ˜¯ä¸å‡†ç¡®çš„ã€‚\n\n![](https://www.10000h.top/images/data_img/webRender/P6.PNG)\n\nç›®å‰ï¼Œæµè§ˆå™¨çš„æ¸²æŸ“é‡‡ç”¨çš„æ˜¯åˆ†å—æ¸²æŸ“çš„æœºåˆ¶ï¼Œæ‰€è°“çš„åˆ†å—æ¸²æŸ“çš„æœºåˆ¶ï¼Œå…¶å®åº”è¯¥è¿™ä¹ˆç†è§£ï¼š\n\n* æµè§ˆå™¨é¦–å…ˆæŠŠæ•´ä¸ªç½‘é¡µåˆ†æˆä¸€äº›ä½åˆ†è¾¨ç‡çš„å—ï¼Œå†æŠŠç½‘é¡µåˆ†æˆé«˜åˆ†è¾¨ç‡çš„å—ï¼Œç„¶åç»™è¿™äº›å—æ’åˆ—ä¼˜å…ˆçº§ã€‚\n* å¤„åœ¨å¯è§†åŒºåŸŸå†…çš„ä½åˆ†è¾¨ç‡å—çš„ä¼˜å…ˆçº§ä¼šæ¯”è¾ƒé«˜ï¼Œä¼šè¢«è¾ƒå…ˆç»˜åˆ¶ã€‚\n* ä¹‹åæµè§ˆå™¨ä¼šæŠŠé«˜åˆ†è¾¨ç‡çš„å—è¿›è¡Œç»˜åˆ¶ï¼ŒåŒæ ·ä¹Ÿæ˜¯å…ˆç»˜åˆ¶å¤„äºå¯è§†åŒºåŸŸå†…çš„ï¼Œå†ç»˜åˆ¶å¯è§†åŒºåŸŸå¤–çš„(ç”±è¿‘åˆ°è¿œ)ã€‚\n\nä»¥ä¸Šè®²çš„è¿™äº›ç­–ç•¥å¯ä»¥ä½¿å¯ä»¥ä½¿å¾—æµè§ˆå™¨ä¼˜å…ˆå±•ç¤ºå¯è§†åŒºåŸŸå†…çš„å†…å®¹ï¼Œå¹¶ä¸”å…ˆå±•ç¤ºå¤§è‡´å†…å®¹ï¼Œå†å±•ç¤ºé«˜ç²¾åº¦å†…å®¹(å½“ç„¶ï¼Œç”±äºè¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒå¿«ï¼Œå®é™…ä¸Šæˆ‘ä»¬å¤§å¤šæ—¶å€™æ˜¯æ„Ÿå—ä¸åˆ°çš„)ã€‚\n\nå¦å¤–è¿™é‡Œå€¼å¾—æé†’çš„ä¸€ç‚¹æ˜¯ï¼Œåˆ†å—çš„ä¼˜å…ˆçº§æ˜¯ä¼šæ ¹æ®åˆ°å¯è§†åŒºåŸŸçš„è·ç¦»æ¥å†³å®šçš„ï¼Œæ‰€ä»¥æœ‰äº›æ¨ªç€çš„å†…å®¹(æ¯”å¦‚bannerçš„æ»šåŠ¨å®ç°ï¼Œé€šå¸¸ä¼šè®¾ç½®æ¨ªå‘è¶…å‡ºå±å¹•æ¥è¡¨ç¤ºéšè—)ï¼Œä¹Ÿæ˜¯ä¼šæŒ‰ç…§åˆ°å¯è§†åŒºåŸŸçš„è·ç¦»æ¥å†³å®šä¼˜å…ˆçº§çš„ã€‚\n\nç»˜åˆ¶çš„è¿‡ç¨‹ï¼Œå¯ä»¥è¢«ç¡¬ä»¶åŠ é€Ÿï¼Œè¿™é‡Œç¡¬ä»¶åŠ é€Ÿçš„ä¸»è¦æ‰‹æ®µä¸»è¦æ˜¯æŒ‡ï¼š\n\n* ç¡¬ä»¶åŠ é€Ÿåˆæˆä¸Šå±\n* 2D Canvasã€Videoçš„ç¡¬ä»¶åŠ é€Ÿ\n* GPUå…‰æ …åŒ–\n\t* GPUå…‰æ …åŒ–é€Ÿåº¦æ›´å¿«ï¼Œå†…å­˜å’ŒCPUçš„æ¶ˆè€—æ›´å°‘\n\t* ç›®å‰è¿˜æ²¡æœ‰åŠæ³•å¯¹åŒ…å«å¤æ‚çŸ¢é‡ç»˜åˆ¶çš„é¡µé¢è¿›è¡ŒGPUå…‰æ …åŒ–\n\t* GPUå…‰æ …åŒ–æ˜¯æœªæ¥è¶‹åŠ¿\n\n\n### chromeå†…æ ¸æ¶æ„å˜è¿\n\nåœ¨æ¸²æŸ“æ¶æ„ä¸Šï¼Œchromeä¹Ÿæ˜¯ç»å†äº†è¯¸å¤šå˜è¿ï¼Œæ—©æœŸçš„Chromeæ˜¯è¿™æ ·çš„ï¼š\n\n![](https://www.10000h.top/images/data_img/webRender/P1.PNG)\n\næ—©æœŸçš„chromeçš„æ¶æ„å®é™…ä¸Šæœ‰ä»¥ä¸‹ç¼ºç‚¹ï¼š\n\n* Rendererçº¿ç¨‹ä»»åŠ¡ç¹é‡\n* æ— æ³•å®æ—¶å“åº”ç¼©æ”¾æ»‘åŠ¨æ“ä½œ\n* è„åŒºåŸŸä¸æ»‘åŠ¨é‡ç»˜åŒºåŸŸæœ‰å†²çª\n\t* è¿™é‡Œä¸¾ä¸ªåœºæ™¯ï¼Œå‡è®¾ä¸€ä¸ªgifï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœç”¨æˆ·æ»‘åŠ¨ï¼Œæ»‘åŠ¨æ–°çš„éœ€è¦ç»˜åˆ¶çš„å†…å®¹å’Œgifä¸‹ä¸€å¸§å†…å®¹å°±ä¼šäº§ç”Ÿç»˜åˆ¶å†²çª\n\nå½“ç„¶ï¼Œç»è¿‡ä¸€ç³»åˆ—çš„å‘å±•ï¼ŒChromeç°åœ¨æ˜¯è¿™æ ·çš„ï¼š\n\n![](https://www.10000h.top/images/data_img/webRender/P2.PNG)\n\nåœ¨å®‰å“ä¸Šï¼ŒAndroid 4.4çš„ Blinkå†…æ ¸æ¶æ„å¦‚ä¸‹(4.4ä¹‹å‰å¹¶ä¸æ”¯æŒOpenGL)\n\n![](https://www.10000h.top/images/data_img/webRender/P3.PNG)\n\nå½“ç„¶ï¼Œè¿™ç§æ¶æ„ä¹Ÿæœ‰å¦‚ä¸‹ç¼ºç‚¹ï¼š\n\n* UIçº¿ç¨‹è¿‡äºç¹å¿™\n* æ— æ³•æ”¯æŒCanvasçš„ç¡¬ä»¶åŠ é€Ÿä»¥åŠWebGL\n\næ‰€ä»¥ï¼ŒåæœŸå‘å±•æˆäº†è¿™æ ·ï¼š\n\n![](https://www.10000h.top/images/data_img/webRender/P4.PNG)\n\næ€»ç»“çœ‹æ¥ï¼Œå†…æ ¸å‘å±•çš„è¶‹åŠ¿æ˜¯ï¼š\n\n* å¤šçº¿ç¨‹åŒ–(å¯ä»¥å……åˆ†åˆ©ç”¨å¤šæ ¸å¿ƒCPU)\n* ç¡¬ä»¶åŠ é€Ÿ(å¯ä»¥åˆ©ç”¨GPU)\n\n### åˆ†å±‚æ¸²æŸ“\n\nåœ¨é˜…è¯»è¿™ä¸€ç« ä¹‹å‰ï¼Œæˆ‘å»ºè®®è¯»è€…å…ˆå»äº²è‡ªä½“éªŒä¸€ä¸‹æ‰€è°“çš„â€œåˆ†å±‚æ¸²æŸ“â€ï¼š\n\n>æ‰“å¼€Chromeæµè§ˆå™¨ï¼Œæ‰“å¼€æ§åˆ¶å°ï¼Œæ‰¾åˆ°\"Layers\"ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆåœ¨æ§åˆ¶å°å³ä¸Šè§’æ›´å¤šçš„å›¾æ ‡->More tools æ‰¾åˆ°\"Layers\"ï¼Œç„¶åéšä¾¿æ‰¾ä¸ªç½‘é¡µæ‰“å¼€å³å¯\n\nç½‘é¡µçš„åˆ†å±‚æ¸²æŸ“æµç¨‹ä¸»è¦æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š\n\n![](https://www.10000h.top/images/data_img/webRender/P7.PNG)\n\n(*æ³¨æ„ï¼šå¤šä¸ªRenderObjectå¯èƒ½åˆä¼šå¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªRenderLayer*)\n\næ—¢ç„¶æ‰ç”¨äº†åˆ†å±‚æ¸²æŸ“ï¼Œé‚£ä¹ˆè‚¯å®šå¯ä»¥æ¥åˆ†å±‚å¤„ç†ï¼Œåˆ†å±‚æ¸²æŸ“æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š\n\n* å‡å°‘ä¸å¿…è¦çš„é‡æ–°ç»˜åˆ¶\n* å¯ä»¥å®ç°è¾ƒä¸ºå¤æ‚çš„åŠ¨ç”»\n* èƒ½å¤Ÿæ–¹ä¾¿å®ç°å¤æ‚çš„CSSæ ·å¼\n\nå½“ç„¶ï¼Œåˆ†å±‚æ¸²æŸ“æ˜¯ä¼šå¾ˆå½±å“æ¸²æŸ“æ•ˆç‡çš„ï¼Œå¯ä»¥æœ‰å¥½çš„å½±å“ï¼Œä½¿ç”¨ä¸å½“ä¹Ÿä¼šæœ‰å·®çš„å½±å“ï¼Œæˆ‘ä»¬éœ€è¦åˆç†çš„æ§åˆ¶å’Œä½¿ç”¨åˆ†å±‚ï¼š\n\n* å¦‚æœå°è±†è…å—åˆ†å±‚è¾ƒå¤šï¼Œé¡µé¢æ•´ä½“çš„åˆ†å±‚æ•°é‡è¾ƒå¤§ï¼Œä¼šå¯¼è‡´æ¯å¸§æ¸²æŸ“æ—¶éå†åˆ†å±‚å’Œè®¡ç®—åˆ†å±‚ä½ç½®è€—æ—¶è¾ƒé•¿å•Š(æ¯”è¾ƒå…¸å‹çš„æ˜¯è…¾è®¯ç½‘ç§»åŠ¨ç«¯é¦–é¡µ)ã€‚\n* å¦‚æœå¯è§†åŒºåŸŸå†…åˆ†å±‚å¤ªå¤šä¸”éœ€è¦ç»˜åˆ¶çš„é¢ç§¯å¤ªå¤§ï¼Œæ¸²æŸ“æ€§èƒ½éå¸¸å·®ï¼Œç”šè‡³æ— æ³•è¾¾åˆ°æ­£å¸¸æ˜¾ç¤ºçš„åœ°æ­¥(æ¯”å¦‚æœ‰ä¸€äº›å…¨å±H5)ã€‚\n* å¦‚æœé¡µé¢å‡ ä¹æ²¡æœ‰åˆ†å±‚ï¼Œé¡µé¢å˜åŒ–æ—¶å€™éœ€è¦é‡ç»˜çš„åŒºåŸŸè¾ƒå¤šã€‚å…ƒç´ å†…å®¹æ— å˜åŒ–åªæœ‰ä½ç½®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå¯ä»¥åˆ©ç”¨åˆ†å±‚æ¥é¿å…é‡ç»˜ã€‚\n\né‚£ä¹ˆï¼Œæ˜¯ä»€ä¹ˆåŸå› å¯ä»¥å¯¼è‡´åˆ†å±‚å‘¢ï¼Ÿç›®å‰æ¯ä¸€ä¸ªæµè§ˆå™¨æˆ–è€…ä¸åŒç‰ˆæœ¬çš„æµè§ˆå™¨åˆ†å±‚ç­–ç•¥éƒ½æ˜¯æœ‰äº›ä¸åŒçš„(è™½ç„¶æ€»ä½“å·®ä¸å¤ªå¤š)ï¼Œä½†æœ€å¸¸è§çš„å‡ ä¸ªåˆ†å±‚åŸå› æ˜¯ï¼štransformã€Z-indexï¼›è¿˜æœ‰å¯ä»¥ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿçš„videoã€canvasï¼›fixedå…ƒç´ ï¼›æ··åˆæ’ä»¶(flashç­‰)ã€‚å…³äºå…¶ä»–æ›´å…·ä½“çš„å†…å®¹ï¼Œå¯ä»¥è§ä¸‹æ–‡ã€‚\n\n```\n//æ³¨:Chromeä¸­ç¬¦åˆåˆ›å»ºæ–°å±‚çš„æƒ…å†µï¼š\nLayer has 3D or perspective transform CSS properties(æœ‰3Då…ƒç´ çš„å±æ€§)\nLayer is used by <video> element using accelerated video decoding(videoæ ‡ç­¾å¹¶ä½¿ç”¨åŠ é€Ÿè§†é¢‘è§£ç )\nLayer is used by a <canvas> element with a 3D context or accelerated 2D context(canvaså…ƒç´ å¹¶å¯ç”¨3D)\nLayer is used for a composited plugin(æ’ä»¶ï¼Œæ¯”å¦‚flash)\nLayer uses a CSS animation for its opacity or uses an animated webkit transform(CSSåŠ¨ç”»)\nLayer uses accelerated CSS filters(CSSæ»¤é•œ)\nLayer with a composited descendant has information that needs to be in the composited layer tree, such as a clip or reflection(æœ‰ä¸€ä¸ªåä»£å…ƒç´ æ˜¯ç‹¬ç«‹çš„layer)\nLayer has a sibling with a lower z-index which has a compositing layer (in other words the layer is rendered on top of a composited layer)(å…ƒç´ çš„ç›¸é‚»å…ƒç´ æ˜¯ç‹¬ç«‹layer)\n```\n\næœ€åï¼Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹å¦‚ä½•åˆç†çš„è®¾è®¡åˆ†å±‚ï¼šåˆ†å±‚æ€»çš„åŸåˆ™æ˜¯ï¼Œå‡å°‘æ¸²æŸ“é‡ç»˜é¢ç§¯ä¸å‡å°‘åˆ†å±‚ä¸ªæ•°å’Œåˆ†å±‚æ€»é¢ç§¯ï¼š\n\n* ç›¸å¯¹ä½ç½®ä¼šå‘ç”Ÿå˜åŒ–çš„å…ƒç´ éœ€è¦åˆ†å±‚(æ¯”å¦‚bannerå›¾ã€æ»šåŠ¨æ¡)\n* å…ƒç´ å†…å®¹æ›´æ–°æ¯”è¾ƒé¢‘ç¹çš„éœ€è¦åˆ†å±‚(æ¯”å¦‚é¡µé¢ä¸­å¤¹æ‚çš„å€’è®¡æ—¶ç­‰)\n* è¾ƒé•¿è¾ƒå¤§çš„é¡µé¢æ³¨æ„æ€»çš„åˆ†å±‚ä¸ªæ•°\n* é¿å…æŸä¸€å—åŒºåŸŸåˆ†å±‚è¿‡å¤šï¼Œé¢ç§¯è¿‡å¤§\n\n(*å¦‚æœä½ ç»™ä¸€ä¸ªå…ƒç´ æ·»åŠ ä¸Šäº†-webkit-transform: translateZ(0);æˆ–è€… -webkit-transform: translate3d(0,0,0);å±æ€§ï¼Œé‚£ä¹ˆä½ å°±ç­‰äºå‘Šè¯‰äº†æµè§ˆå™¨ç”¨GPUæ¥æ¸²æŸ“è¯¥å±‚ï¼Œä¸ä¸€èˆ¬çš„CPUæ¸²æŸ“ç›¸æ¯”ï¼Œæå‡äº†é€Ÿåº¦å’Œæ€§èƒ½ã€‚(æˆ‘å¾ˆç¡®å®šè¿™ä¹ˆåšä¼šåœ¨Chromeä¸­å¯ç”¨äº†ç¡¬ä»¶åŠ é€Ÿï¼Œä½†åœ¨å…¶ä»–å¹³å°ä¸åšä¿è¯ã€‚å°±æˆ‘å¾—åˆ°çš„èµ„æ–™è€Œè¨€ï¼Œåœ¨å¤§å¤šæ•°æµè§ˆå™¨æ¯”å¦‚Firefoxã€Safariä¹Ÿæ˜¯é€‚ç”¨çš„)*)\n\nå¦å¤–å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒX5å¯¹åˆ†å±‚æ–¹é¢åšäº†ä¸€å®šçš„ä¼˜åŒ–å·¥ä½œï¼Œå½“å…¶æ£€æµ‹åˆ°åˆ†å±‚è¿‡å¤šå¯èƒ½ä¼šå‡ºç°æ˜¾ç¤ºé—®é¢˜çš„æ—¶å€™ä¼šè¿›è¡Œå±‚åˆå¹¶ï¼Œç‰ºç‰²æ˜¾ç¤ºæ€§èƒ½æ¢å–æ˜¾ç¤ºæ­£ç¡®æ€§ã€‚\n\næœ€åå†æå‡ºä¸€ä¸ªå°é—®é¢˜ï¼š\n\nä»¥ä¸‹å“ªç§æ¸²æŸ“æ–¹å¼æ˜¯æœ€ä¼˜çš„å‘¢ï¼Ÿ\n\n![](https://www.10000h.top/images/data_img/webRender/P8.PNG)\n\nè¿™é‡Œå®é™…ä¸Šåè€…è™½ç„¶åœ¨åˆ†å±‚ä¸Šæ»¡è¶³æ€»ä½“åŸåˆ™ï¼Œä½†æ˜¯ä¹‹å‰è®²åˆ°æµè§ˆå™¨çš„åˆ†å—æ¸²æŸ“æœºåˆ¶ï¼Œæ˜¯æŒ‰ç…§åˆ°å¯è§†åŒºåŸŸçš„è·ç¦»æ’åºçš„ï¼Œè€ƒè™‘åˆ°è¿™ä¸ªå› ç´ ï¼Œå®é™…ä¸Šåè€…è¿™ç§æ–¹å¼å¯èƒ½ä¼šå¯¹åˆ†å—æ¸²æŸ“é€ æˆä¸€å®šçš„å›°æ‰°ï¼Œå¹¶ä¸”ä¹Ÿä¸æ˜¯æœ€ä¼˜çš„ã€‚\n\n### åŠ¨ç”» & canvas & WebGl\n\nè®²æœ€åä¸€éƒ¨åˆ†å¼€å§‹ï¼Œé¦–å…ˆæŠ›å‡ºä¸€ä¸ªé—®é¢˜ï¼šCSSåŠ¨ç”» or JSåŠ¨ç”»?\n\nå¯¹å†…æ ¸æ¥è¯´ï¼Œå®é™…ä¸Šå°±æ˜¯Rendererçº¿ç¨‹åŠ¨ç”»è¿˜æ˜¯Compositorçº¿ç¨‹åŠ¨ç”»ï¼ŒäºŒè€…å®é™…ä¸Šè¿‡ç¨‹å¦‚ä¸‹ï¼š\n\n![](https://www.10000h.top/images/data_img/webRender/P9.PNG)\n\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒRendererçº¿ç¨‹æ˜¯æ¯”Compositorçº¿ç¨‹åŠ¨ç”»æ€§èƒ½å·®çš„(åœ¨ä¸­ä½ç«¯å°¤å…¶æ˜æ˜¾)\n\nå¦å¤–ï¼Œæ— è®ºæ˜¯JSåŠ¨ç”»è¿˜æ˜¯CSSåŠ¨ç”»ï¼ŒåŠ¨ç”»è¿‡ç¨‹ä¸­çš„é‡ç»˜ä»¥åŠæ ·å¼å˜åŒ–éƒ½ä¼šæ‹–æ…¢åŠ¨ç”»æ‰§è¡Œä»¥åŠå¼•èµ·å¡é¡¿\nä»¥ä¸‹æ˜¯ä¸€äº›ä¸ä¼šè§¦å‘é‡ç»˜æˆ–è€…æ’ç‰ˆçš„CSSåŠ¨ç”»å±æ€§ï¼š\n\n* cursor\n* font-variant\n* opacity\n* orphans\n* perspective\n* perspecti-origin\n* pointer-events\n* transform\n* transform-style\n* widows\n\næƒ³è¦äº†è§£æ›´å¤šå†…å®¹ï¼Œå¯ä»¥å‚è€ƒ[è¿™é‡Œ](https://csstriggers.com/)\n\nè¿™æ–¹é¢æœ€ç»ˆçš„å»ºè®®å‚è€ƒå¦‚ä¸‹ï¼š\n\n* å°½é‡ä½¿ç”¨ä¸ä¼šå¼•èµ·é‡ç»˜çš„CSSå±æ€§åŠ¨ç”»ï¼Œä¾‹å¦‚transformã€opacityç­‰\n* åŠ¨ç”»ä¸€å®šè¦é¿å…è§¦å‘å¤§é‡å…ƒç´ é‡æ–°æ’ç‰ˆæˆ–è€…å¤§é¢ç§¯é‡ç»˜\n* åœ¨æœ‰åŠ¨ç”»æ‰§è¡Œæ—¶ï¼Œé¿å…å…¶ä»–åŠ¨ç”»ä¸ç›¸å…³å› ç´ å¼•èµ·æ’ç‰ˆå’Œé‡ç»˜\n\n\n#### requestAnimationFrame\n\nå¦å¤–å½“æˆ‘ä»¬åœ¨ä½¿ç”¨åŠ¨ç”»çš„æ—¶å€™ï¼Œä¸ºäº†é¿å…å‡ºç°æ‰å¸§çš„æƒ…å†µï¼Œæœ€å¥½é‡‡ç”¨requestAnimationFrameè¿™ä¸ªAPIï¼Œè¿™ä¸ªAPIè¿åˆæµè§ˆå™¨çš„æµç¨‹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä¿è¯åœ¨ä¸‹ä¸€å¸§ç»˜åˆ¶çš„æ—¶å€™ä¸Šä¸€å¸§ä¸€å®šå‡ºç°äº†ï¼š\n\n![](https://www.10000h.top/images/data_img/webRender/P11.PNG)\n\n### 3D canvas\n\nè¿˜æœ‰å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæœ‰çš„æ—¶å€™æˆ‘ä»¬éœ€è¦æ¶‰åŠå¤§é‡å…ƒç´ çš„åŠ¨ç”»(æ¯”å¦‚é›ªèŠ±é£˜è½ã€å¤šä¸ªä¸è§„åˆ™å›¾å½¢å˜åŒ–ç­‰)ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœç”¨CSSåŠ¨ç”»ï¼ŒAnimationåŠ¨ç”»çš„å…ƒç´ å¾ˆå¤šã€‚ï¼Œå¯¼è‡´åˆ†å±‚ä¸ªæ•°éå¸¸å¤šï¼Œæµè§ˆå™¨æ¯å¸§éƒ½éœ€è¦éå†è®¡ç®—æ‰€æœ‰åˆ†å±‚ï¼Œå¯¼è‡´æ¯”è¾ƒè€—æ—¶ã€\n\nè¿™ä¸ªæ—¶å€™è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ\n\n2D canvasä¸Šåœºã€‚ \n\nå’ŒCSSåŠ¨ç”»ç›¸æ¯”ï¼Œ2D canvasçš„ä¼˜ç‚¹æ˜¯è¿™æ ·çš„ï¼š\n\n* ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“\n* æ¸²æŸ“æµç¨‹æ›´ä¼˜\n\nå…¶æ¸²æŸ“æµç¨‹å¦‚ä¸‹ï¼š\n\n![](https://www.10000h.top/images/data_img/webRender/P10.PNG)\n\nå®é™…ä¸Šä»¥ä¸Šæµç¨‹æ¯”è¾ƒè€—æ—¶çš„æ˜¯JS Callè¿™ä¸€éƒ¨åˆ†ï¼Œæ‰§è¡Œopenglçš„è¿™ä¸€éƒ¨åˆ†è¿˜æ˜¯æŒºå¿«çš„ã€‚\n\nHTML 2D canvas ä¸»è¦ç»˜åˆ¶å¦‚ä¸‹ä¸‰ç§å…ƒç´ ï¼š\n\n* å›¾ç‰‡\n* æ–‡å­—\n* çŸ¢é‡\n\nè¿™ä¸ªè¿‡ç¨‹å¯ä»¥é‡‡ç”¨ç¡¬ä»¶åŠ é€Ÿï¼Œç¡¬ä»¶åŠ é€Ÿå›¾ç‰‡ç»˜åˆ¶çš„ä¸»è¦æµç¨‹ï¼š\n\n![](https://www.10000h.top/images/data_img/webRender/P12.PNG)\n\nç¡¬ä»¶åŠ é€Ÿæ–‡å­—ç»˜åˆ¶çš„ä¸»è¦æµç¨‹ï¼š\n\n![](https://www.10000h.top/images/data_img/webRender/P13.PNG)\n\nä½†å¯¹äºçŸ¢é‡ç»˜åˆ¶è€Œè¨€ï¼Œç®€å•çš„å›¾å½¢ï¼Œæ¯”å¦‚ç‚¹ã€ç›´çº¿ç­‰å¯ä»¥ç›´æ¥ä½¿ç”¨OpenGLæ¸²æŸ“ï¼Œå¤æ‚çš„å›¾å½¢ï¼Œå¦‚æ›²çº¿ç­‰ï¼Œæ— æ³•é‡‡ç”¨OpenGLç»˜åˆ¶ã€‚\n\nå¯¹äºç»˜åˆ¶æ•ˆç‡æ¥è¯´ï¼Œ2D Canvaså¯¹ç»˜åˆ¶å›¾ç‰‡æ•ˆç‡è¾ƒé«˜ï¼Œç»˜åˆ¶æ–‡å­—å’ŒçŸ¢é‡æ•ˆç‡è¾ƒä½(**æ‰€ä»¥å»ºè®®æ˜¯ï¼Œæˆ‘ä»¬å¦‚æœèƒ½ä½¿ç”¨è´´å›¾å°±å°½é‡ä½¿ç”¨è´´å›¾äº†**)\n\nè¿˜æœ‰ï¼Œæœ‰çš„æ—¶å€™æˆ‘ä»¬éœ€è¦å…ˆç»˜åˆ¶åˆ°ç¦»å±canvasä¸Šé¢ï¼Œç„¶åå†ä¸Šå±ï¼Œè¿™ä¸ªå¯ä»¥å……åˆ†åˆ©ç”¨ç¼“å­˜ã€‚\n\n### 3D canvas(WebGL)\n\nç›®å‰ï¼Œ3D canvas(WebGL)çš„åº”ç”¨ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œå¯¹äºè¿™ç±»åº”ç”¨ï¼Œç°åœ¨å·²ç»æœ‰äº†ä¸å°‘å·²ç»æˆå‹çš„åº«:\n\n\n* é€šç”¨å¼•æ“ï¼šthreeJSã€Pixi\n* VRè§†é¢‘çš„ä¸“ä¸šå¼•æ“ï¼škrpanoã€UtoVR\n* H5æ¸¸æˆå¼•æ“ï¼šEgretã€Layaboxã€Cocos\n\nWebGLè™½ç„¶åŒ…å«Webï¼Œä½†æœ¬èº«å¯¹å‰ç«¯çš„è¦æ±‚æœ€ä½ï¼Œä½†æ˜¯å¯¹OpenGLã€æ•°å­¦ç›¸å…³çš„çŸ¥è¯†è¦æ±‚è¾ƒé«˜ï¼Œæ‰€ä»¥å¦‚æœå‰ç«¯å·¥ç¨‹å¸ˆæ²¡æœ‰ä¸€å®šçš„åŸºç¡€ï¼Œè¿˜æ˜¯é‡‡ç”¨ç°åœ¨çš„æµè¡Œåº«ã€‚\n\nX5å†…æ ¸å¯¹äºWebGlè¿›è¡Œäº†æ€§èƒ½ä¸Šå’Œè€—ç”µä¸Šçš„ä¼˜åŒ–ï¼Œå¹¶ä¸”ä¹Ÿå¯¹å…¼å®¹æ€§é”™è¯¯ä¸ŠæŠ¥å’Œä¿®å¤åšäº†ä¸€å®šçš„å·¥ä½œã€‚\n\n___\n\næœ¬æ–‡å‚è€ƒè…¾è®¯å†…éƒ¨è®²åº§èµ„æ–™æ•´ç†è€Œæˆï¼Œå¹¶èå…¥ä¸€éƒ¨åˆ†ç¬”è€…çš„è¡¥å……ï¼Œè°¢ç»ä»»ä½•å½¢å¼çš„è½¬è½½ã€‚\n\nå…¶ä»–ä¼˜è´¨å¥½æ–‡ï¼š\n\n[Javascripté«˜æ€§èƒ½åŠ¨ç”»ä¸é¡µé¢æ¸²æŸ“](http://qingbob.com/javascript-high-performance-animation-and-page-rendering/)\n\n\n","tags":["æ€§èƒ½ä¼˜åŒ–"]},{"title":"JSçš„é™æ€ä½œç”¨åŸŸã€å­ç¨‹åºå¼•ç”¨ç¯å¢ƒä¸å‚æ•°ä¼ é€’ç±»å‹","url":"/2017/01/11/JSçš„é™æ€ä½œç”¨åŸŸã€å­ç¨‹åºå¼•ç”¨ç¯å¢ƒä¸å‚æ•°ä¼ é€’ç±»å‹/","content":"#### é™æ€ä½œç”¨åŸŸ\n\næˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹é¢è¿™ä¸ªå°ç¨‹åºï¼š\n\n```\n //JSç‰ˆæœ¬ï¼š\n function sub1() {\n        var x;\n        function sub2() { alert(x); }\n        function sub3() { var x; x=3; sub4(sub2); }\n        function sub4(subx) { var x; x=4; subx(); }\n        x = 1;\n        sub3();\n    }\n\n    sub1();\n    \n #Pythonç‰ˆæœ¬\ndef sub1():\n    def sub2():\n        print x\n    def sub3():\n        x=3\n        sub4(sub2)\n    def sub4(subx):\n        x=4\n        subx()\n    x = 1\n    sub3()\n\nsub1()   \n```\n\nä¸ç”¨äº²è‡ªè¿è¡Œï¼Œå®é™…ä¸Šè¾“å‡ºç»“æœéƒ½æ˜¯1ï¼Œè¿™å¯èƒ½ä¸éš¾çŒœåˆ°ï¼Œä½†æ˜¯éœ€è¦è§£é‡Šä¸€ç•ªï¼Œé‰´äºPythonå’ŒJSåœ¨è¿™ä¸€ç‚¹ä¸Šè¡¨ç°çš„ç±»ä¼¼ï¼Œæˆ‘å°±ä»¥JSæ¥åˆ†æã€‚\n\næˆ‘ä»¬çŸ¥é“ï¼ŒJSæ˜¯é™æ€ä½œç”¨åŸŸçš„ï¼Œæ‰€è°“é™æ€ä½œç”¨åŸŸå°±æ˜¯ä½œç”¨åŸŸåœ¨ç¼–è¯‘æ—¶ç¡®å®šï¼Œæ‰€ä»¥sub2ä¸­å¼•ç”¨çš„xï¼Œå®é™…ä¸Šå’Œx=3ä»¥åŠx=4çš„xæ²¡æœ‰ä»»ä½•å…³ç³»ï¼ŒæŒ‡å‘ç¬¬äºŒè¡Œçš„var x;\n\n#### å­ç¨‹åºçš„å¼•ç”¨ç¯å¢ƒ\n\nå®é™…ä¸Šè¿™é‡Œé¢è¿˜æœ‰ä¸€ä¸ªå­ç¨‹åº(æ³¨ï¼šå­ç¨‹åºå’Œå‡½æ•°ä¸æ˜¯å¾ˆä¸€æ ·ï¼Œä½†æˆ‘ä»¬å¯ä»¥è®¤ä¸ºå­ç¨‹åºåŒ…æ‹¬å‡½æ•°ï¼Œä¹Ÿçº¦ç­‰äºå‡½æ•°)çš„æ¦‚å¿µï¼Œsub2ã€sub3ã€sub4éƒ½æ˜¯å­ç¨‹åºï¼Œå¯¹äºå…è®¸åµŒå¥—å­ç¨‹åºçš„è¯­è¨€ï¼Œåº”è¯¥å¦‚ä½•ä½¿ç”¨æ‰§è¡Œä¼ é€’çš„å­ç¨‹åºçš„å¼•ç”¨ç¯å¢ƒï¼Ÿ\n\n* æµ…ç»‘å®šï¼šå¦‚æœè¿™æ ·çš„è¯ï¼Œåº”è¯¥è¾“å‡º4ï¼Œè¿™å¯¹åŠ¨æ€ä½œç”¨åŸŸçš„è¯­è¨€æ¥è¯´æ¯”è¾ƒè‡ªç„¶ã€‚\n* æ·±ç»‘å®šï¼šä¹Ÿå°±æ˜¯è¾“å‡º1çš„æƒ…å†µï¼Œè¿™å¯¹é™æ€ä½œç”¨åŸŸçš„è¯­è¨€æ¥è¯´æ¯”è¾ƒè‡ªç„¶ã€‚\n* Ad hoc binding: è¿™æ˜¯ç¬¬ä¸‰ç§ï¼Œå°†å­ç¨‹åºä½œä¸ºå®é™…å‚æ•°ä¼ é€’åˆ°è°ƒç”¨è¯­å¥çš„ç¯å¢ƒã€‚\n\n#### å‚æ•°ä¼ é€’ç±»å‹\n\nå‚æ•°ä¼ é€’ç±»å‹æˆ‘ä»¬æ™®éè®¤ä¸ºæœ‰æŒ‰å€¼ä¼ é€’å’ŒæŒ‰å¼•ç”¨ä¼ é€’ä¸¤ç§ï¼Œå®é™…ä¸Šä¸æ­¢ã€‚\n\nä¸‹é¢æ˜¯ä¸€å¼ å›¾ï¼š\n\n![](https://www.10000h.top/images/call.png)\n\nè¿™å¼ å›¾å¯¹åº”çš„ç¬¬ä¸€ç§ä¼ é€’æ–¹å¼ï¼Œå«åšPass-by-Value(In mode)ï¼Œç¬¬äºŒç§æ˜¯Pass-by-Result(Out mode)ï¼Œç¬¬ä¸‰ç§æ˜¯Pass-by-Value-Result(Inout mode),å›¾ä¸Šè¯´çš„æ¯”è¾ƒæ˜ç™½ï¼Œå®é™…ä¸Šå¦‚æœæœ‰resultå°±æ˜¯è¯´æ˜æœ€åæŠŠç»“æœå†èµ‹å€¼ç»™å‚æ•°ã€‚\n\nç¬¬äºŒç§å’Œç¬¬ä¸‰ç§ç¼–ç¨‹è¯­è¨€ç”¨çš„å°‘ï¼ŒåŸå› å¦‚ä¸‹ï¼š\n>Potential problem: sub(p1, p1)   \nWith the two corresponding formal parameters having different names, whichever formal parameter is copied back last will represent current value of p1\n\n","tags":["javascript"]},{"title":"CentOS7ä¸‹å®‰è£…å’Œé…ç½®redis","url":"/2016/10/04/CentOS7ä¸‹å®‰è£…å’Œé…ç½®redis/","content":"Redisæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ï¼Œå¼€æºkey-valueå‹æ•°æ®åº“ã€‚æ˜¯æ„å»ºé«˜æ€§èƒ½ï¼Œå¯æ‰©å±•çš„Webåº”ç”¨çš„å®Œç¾è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥å†…å­˜å­˜å‚¨äº¦å¯æŒä¹…åŒ–å­˜å‚¨ã€‚å› ä¸ºè¦ä½¿ç”¨è·¨è¿›ç¨‹ï¼Œè·¨æœåŠ¡çº§åˆ«çš„æ•°æ®ç¼“å­˜ï¼Œåœ¨å¯¹æ¯”å¤šä¸ªæ–¹æ¡ˆåï¼Œå†³å®šä½¿ç”¨Redisã€‚é¡ºä¾¿æ•´ç†ä¸‹Redisçš„å®‰è£…è¿‡ç¨‹ï¼Œä»¥ä¾¿æŸ¥é˜…ã€‚\n\n\n 1 . ä¸‹è½½Redis\nç›®å‰ï¼Œæœ€æ–°çš„Redistç‰ˆæœ¬ä¸º3.0ï¼Œä½¿ç”¨wgetä¸‹è½½ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š\n```\n\n# wget http://download.redis.io/releases/redis-3.0.4.tar.gz\n\n```\n 2 . è§£å‹Redis\nä¸‹è½½å®Œæˆåï¼Œä½¿ç”¨tarå‘½ä»¤è§£å‹ä¸‹è½½æ–‡ä»¶ï¼š\n```\n\n# tar -xzvf redis-3.0.4.tar.gz\n```\n3 . ç¼–è¯‘å®‰è£…Redis\nåˆ‡æ¢è‡³ç¨‹åºç›®å½•ï¼Œå¹¶æ‰§è¡Œmakeå‘½ä»¤ç¼–è¯‘ï¼š\n```\n# cd redis-3.0.4\n# make\n```\næ‰§è¡Œå®‰è£…å‘½ä»¤\n```\n# make install\n```\nmake installå®‰è£…å®Œæˆåï¼Œä¼šåœ¨/usr/local/binç›®å½•ä¸‹ç”Ÿæˆä¸‹é¢å‡ ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå®ƒä»¬çš„ä½œç”¨åˆ†åˆ«æ˜¯ï¼š\n\n* redis-serverï¼šRedisæœåŠ¡å™¨ç«¯å¯åŠ¨ç¨‹åº\n* redis-cliï¼šRediså®¢æˆ·ç«¯æ“ä½œå·¥å…·ã€‚ä¹Ÿå¯ä»¥ç”¨telnetæ ¹æ®å…¶çº¯æ–‡æœ¬åè®®æ¥æ“ä½œ\n* redis-benchmarkï¼šRedisæ€§èƒ½æµ‹è¯•å·¥å…·\n* redis-check-aofï¼šæ•°æ®ä¿®å¤å·¥å…·\n* redis-check-dumpï¼šæ£€æŸ¥å¯¼å‡ºå·¥å…·\n\nå¤‡æ³¨\n\næœ‰çš„æœºå™¨ä¼šå‡ºç°ç±»ä¼¼ä»¥ä¸‹é”™è¯¯ï¼š\n```\nmake[1]: Entering directory `/root/redis/src'\nYou need tcl 8.5 or newer in order to run the Redis test\nâ€¦â€¦\n```\nè¿™æ˜¯å› ä¸ºæ²¡æœ‰å®‰è£…tclå¯¼è‡´ï¼Œyumå®‰è£…å³å¯ï¼š\n```\nyum install tcl\n```\n4 . é…ç½®Redis\nå¤åˆ¶é…ç½®æ–‡ä»¶åˆ°/etc/ç›®å½•ï¼š\n```\n# cp redis.conf /etc/\n```\nä¸ºäº†è®©Redisåå°è¿è¡Œï¼Œä¸€èˆ¬è¿˜éœ€è¦ä¿®æ”¹redis.confæ–‡ä»¶ï¼š\n```\nvi /etc/redis.conf\n```\nä¿®æ”¹daemonizeé…ç½®é¡¹ä¸ºyesï¼Œä½¿Redisè¿›ç¨‹åœ¨åå°è¿è¡Œï¼š\n```\ndaemonize yes\n```\n5 . å¯åŠ¨Redis\né…ç½®å®Œæˆåï¼Œå¯åŠ¨Redisï¼š\n```\n# cd /usr/local/bin\n# ./redis-server /etc/redis.conf\n```\næ£€æŸ¥å¯åŠ¨æƒ…å†µï¼š\n```\n# ps -ef | grep redis\n```\nçœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„ä¸€è¡Œï¼Œè¡¨ç¤ºå¯åŠ¨æˆåŠŸï¼š\n```\nroot     18443     1  0 13:05 ?        00:00:00 ./redis-server *:6379 \n```\n6 . æ·»åŠ å¼€æœºå¯åŠ¨é¡¹\nè®©Rediså¼€æœºè¿è¡Œå¯ä»¥å°†å…¶æ·»åŠ åˆ°rc.localæ–‡ä»¶ï¼Œä¹Ÿå¯å°†æ·»åŠ ä¸ºç³»ç»ŸæœåŠ¡serviceã€‚æœ¬æ–‡ä½¿ç”¨rc.localçš„æ–¹å¼ï¼Œæ·»åŠ serviceè¯·å‚è€ƒï¼šRedis é…ç½®ä¸º Service ç³»ç»ŸæœåŠ¡ ã€‚\n\nä¸ºäº†èƒ½è®©Redisåœ¨æœåŠ¡å™¨é‡å¯åè‡ªåŠ¨å¯åŠ¨ï¼Œéœ€è¦å°†å¯åŠ¨å‘½ä»¤å†™å…¥å¼€æœºå¯åŠ¨é¡¹ï¼š\n```\necho \"/usr/local/bin/redis-server /etc/redis.conf\" >>/etc/rc.local\n```\n7 . Redisé…ç½®å‚æ•°\nåœ¨ å‰é¢çš„æ“ä½œä¸­ï¼Œæˆ‘ä»¬ç”¨åˆ°äº†ä½¿Redisè¿›ç¨‹åœ¨åå°è¿è¡Œçš„å‚æ•°ï¼Œä¸‹é¢ä»‹ç»å…¶å®ƒä¸€äº›å¸¸ç”¨çš„Rediså¯åŠ¨å‚æ•°ï¼š\n```\ndaemonizeï¼šæ˜¯å¦ä»¥åå°daemonæ–¹å¼è¿è¡Œ\npidfileï¼špidæ–‡ä»¶ä½ç½®\nportï¼šç›‘å¬çš„ç«¯å£å·\ntimeoutï¼šè¯·æ±‚è¶…æ—¶æ—¶é—´\nloglevelï¼šlogä¿¡æ¯çº§åˆ«\nlogfileï¼šlogæ–‡ä»¶ä½ç½®\ndatabasesï¼šå¼€å¯æ•°æ®åº“çš„æ•°é‡\nsave * *ï¼šä¿å­˜å¿«ç…§çš„é¢‘ç‡ï¼Œç¬¬ä¸€ä¸ª*è¡¨ç¤ºå¤šé•¿æ—¶é—´ï¼Œç¬¬ä¸‰ä¸ª*è¡¨ç¤ºæ‰§è¡Œå¤šå°‘æ¬¡å†™æ“ä½œã€‚åœ¨ä¸€å®šæ—¶é—´å†…æ‰§è¡Œä¸€å®šæ•°é‡çš„å†™æ“ä½œæ—¶ï¼Œè‡ªåŠ¨ä¿å­˜å¿«ç…§ã€‚å¯è®¾ç½®å¤šä¸ªæ¡ä»¶ã€‚\nrdbcompressionï¼šæ˜¯å¦ä½¿ç”¨å‹ç¼©\ndbfilenameï¼šæ•°æ®å¿«ç…§æ–‡ä»¶åï¼ˆåªæ˜¯æ–‡ä»¶åï¼‰\ndirï¼šæ•°æ®å¿«ç…§çš„ä¿å­˜ç›®å½•ï¼ˆä»…ç›®å½•ï¼‰\nappendonlyï¼šæ˜¯å¦å¼€å¯appendonlylogï¼Œå¼€å¯çš„è¯æ¯æ¬¡å†™æ“ä½œä¼šè®°ä¸€æ¡logï¼Œè¿™ä¼šæé«˜æ•°æ®æŠ—é£é™©èƒ½åŠ›ï¼Œä½†å½±å“æ•ˆç‡ã€‚\nappendfsyncï¼šappendonlylogå¦‚ä½•åŒæ­¥åˆ°ç£ç›˜ã€‚ä¸‰ä¸ªé€‰é¡¹ï¼Œåˆ†åˆ«æ˜¯æ¯æ¬¡å†™éƒ½å¼ºåˆ¶è°ƒç”¨fsyncã€æ¯ç§’å¯ç”¨ä¸€æ¬¡fsyncã€ä¸è°ƒç”¨fsyncç­‰å¾…ç³»ç»Ÿè‡ªå·±åŒæ­¥\n```\n","tags":["centOS","redis"]},{"title":"è…¾è®¯äº‘åŒ—ç¾æœåŠ¡å™¨æ­å»ºShadowSocksä»£ç†","url":"/2016/08/08/è…¾è®¯äº‘åŒ—ç¾æœåŠ¡å™¨æ­å»ºShadowSocksä»£ç†/","content":"\næ³¨ï¼šæœ¬æ•™ç¨‹é€‚åˆcentosç³»åˆ—å’Œred hatç³»åˆ—\n\nç™»é™†SSH \næ–°çš„VPSå¯ä»¥å…ˆå‡çº§\n\n```\nyum -y update\n```\n\næœ‰äº›VPS æ²¡æœ‰wget \nè¿™ç§è¦å…ˆè£…\n\n```\nyum -y install wget\n```\n\nè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼šï¼ˆå¯ä»¥å¤åˆ¶ï¼‰\n\n```\nwget --no-check-certificate https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks.sh\nchmod +x shadowsocks.sh\n./shadowsocks.sh 2>&1 | tee shadowsocks.log\n```\n\nç¬¬ä¸€è¡Œæ˜¯ä¸‹è½½å‘½ä»¤ï¼Œä¸‹è½½ä¸œè¥¿ï¼Œç¬¬äºŒè¡Œæ˜¯ä¿®æ”¹æƒé™ï¼Œç¬¬ä¸‰è¡Œæ˜¯å®‰è£…å‘½ä»¤\n\nä¸‹é¢æ˜¯æŒ‰ç…§é…ç½®å›¾\n\n```\né…ç½®ï¼š\nå¯†ç ï¼šï¼ˆé»˜è®¤æ˜¯teddysun.comï¼‰\nç«¯å£ï¼šé»˜è®¤æ˜¯8989\nç„¶åæŒ‰ä»»æ„é”®å®‰è£…ï¼Œé€€å‡ºæŒ‰ Ctrl+c\n```\n\nå®‰è£…å®Œæˆä¼šæœ‰ä¸€ä¸ªé…ç½®\n\n```\nCongratulations, shadowsocks install completed!Your Server IP:  ***** VPSçš„IPåœ°å€Your Server Port:  *****  ä½ åˆšæ‰è®¾ç½®çš„ç«¯å£Your Password:  ****  ä½ åˆšæ‰è®¾ç½®çš„å¯†ç Your Local IP:  127.0.0.1 Your Local Port:  1080 Your Encryption Method:  aes-256-cfb Welcome to visit:https://teddysun.com/342.htmlEnjoy it!\n```\n\nç„¶åå³å¯ä»¥ä½¿ç”¨\n\nå¸è½½æ–¹æ³•ï¼š\n\nä½¿ç”¨ root ç”¨æˆ·ç™»å½•ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n\n```\n./shadowsocksR.sh uninstall\n```\n\nå®‰è£…å®Œæˆåå³å·²åå°å¯åŠ¨ ShadowsocksR ï¼Œè¿è¡Œï¼š\n\n```\n/etc/init.d/shadowsocks status\n```\n","tags":["ShadowSocks"]},{"title":"centOS7.2æ­å»ºnginxç¯å¢ƒä»¥åŠè´Ÿè½½å‡è¡¡","url":"/2016/08/03/centOS7-2æ­å»ºnginxç¯å¢ƒä»¥åŠè´Ÿè½½å‡è¡¡/","content":" ä¹‹æ‰€ä»¥è¦æ•´ç†å‡ºè¿™ç¯‡æ–‡ç« ï¼Œæ˜¯å› ä¸º1æ˜¯æ­å»ºç¯å¢ƒçš„è¿‡ç¨‹ä¸­ä¼šé‡åˆ°å¤§å¤§å°å°å„ç§é—®é¢˜ï¼Œ2æ˜¯ç½‘ä¸Šç›®å‰ä¹Ÿæ²¡æœ‰å…³äºcentos7.2æ­å»ºnginxç¯å¢ƒçš„é—®é¢˜æ•´ç†ï¼Œå› æ­¤åœ¨è¿™é‡Œè®°å½•ã€‚\n\nå‰ç½®å·¥ä½œå°±ä¸èµ˜è¿°äº†ï¼Œé¦–å…ˆ`ssh root@115.29.102.81` (æ¢æˆä½ ä»¬è‡ªå·±çš„å…¬ç½‘IP)ç™»é™†è¿›å…¥åˆ°è‡ªå·±çš„æœåŠ¡å™¨å‘½ä»¤è¡Œï¼Œä¹‹åå¼€å§‹åŸºæœ¬çš„å®‰è£…ï¼š\n\n**1.æ·»åŠ èµ„æº**\n\næ·»åŠ CentOS 7 Nginx yumèµ„æºåº“,æ‰“å¼€ç»ˆç«¯,ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤(æ²¡æœ‰æ¢è¡Œ):\n\n```\nsudo rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm\n\n```\n\n**2.å®‰è£…Nginx**\n\nåœ¨ä½ çš„CentOS 7 æœåŠ¡å™¨ä¸­ä½¿ç”¨yumå‘½ä»¤ä»NginxæºæœåŠ¡å™¨ä¸­è·å–æ¥å®‰è£…Nginxï¼š\n>*è¿™é‡Œæœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œå°½é‡ä¸è¦ç”¨ç½‘ä¸Šçš„ä¸‹è½½æºç åŒ…ç„¶åå†ä¼ åˆ°æœåŠ¡å™¨ä¸Šçš„æ–¹å¼è¿›è¡Œå®‰è£…ï¼Œå› ä¸ºnginxå·²ç»ä¸ç®—æ˜¯ç®€å•çš„Linuxäº†ï¼Œåšäº†å¾ˆå¤šæ‰©å±•ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœä½ ç”¨æºç åŒ…å®‰è£…ä¼šå‡ºç°å„ç§å„æ ·çš„é—®é¢˜ï¼Œå°½é‡ç”¨å·²ç»å°è£…å¥½çš„rpm\\yumè¿›è¡Œå®‰è£…*\n```\nsudo yum install -y nginx\n```\nNginxå°†å®Œæˆå®‰è£…åœ¨ä½ çš„CentOS 7 æœåŠ¡å™¨ä¸­ã€‚\n\n**3.å¯åŠ¨Nginx**\n\nåˆšå®‰è£…çš„Nginxä¸ä¼šè‡ªè¡Œå¯åŠ¨ã€‚è¿è¡ŒNginx:\n```\nsudo systemctl start nginx.service\n```\nå¦‚æœä¸€åˆ‡è¿›å±•é¡ºåˆ©çš„è¯ï¼Œç°åœ¨ä½ å¯ä»¥é€šè¿‡ä½ çš„åŸŸåæˆ–IPæ¥è®¿é—®ä½ çš„Webé¡µé¢æ¥é¢„è§ˆä¸€ä¸‹Nginxçš„é»˜è®¤é¡µé¢\n\n>å½“ç„¶ï¼Œè¿™é‡Œä¸€èˆ¬å¾ˆå¯èƒ½ä¼šæ— æ³•è®¿é—®çš„ã€‚\n\næˆ‘ä»¬å…ˆä¸æ€¥äºè§£å†³æˆ‘ä»¬çš„é—®é¢˜ï¼Œå…ˆçœ‹çœ‹nginxçš„åŸºæœ¬é…ç½®ï¼š\n\n\nNginxé…ç½®ä¿¡æ¯\n```\nç½‘ç«™æ–‡ä»¶å­˜æ”¾é»˜è®¤ç›®å½•\n\n/usr/share/nginx/html\nç½‘ç«™é»˜è®¤ç«™ç‚¹é…ç½®\n\n/etc/nginx/conf.d/default.conf\nè‡ªå®šä¹‰Nginxç«™ç‚¹é…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•,è‡ªå·±åœ¨è¿™é‡Œä¹Ÿå¯ä»¥å®šä¹‰åˆ«çš„åå­—çš„.confï¼Œè¿™ä¸ªçš„ä½œç”¨ä»¥åå†è¯´ã€‚\n\n/etc/nginx/conf.d/\nNginxå…¨å±€é…ç½®\n\n/etc/nginx/nginx.conf\nåœ¨è¿™é‡Œä½ å¯ä»¥æ”¹å˜è®¾ç½®ç”¨æˆ·è¿è¡ŒNginxå®ˆæŠ¤ç¨‹åºè¿›ç¨‹ä¸€æ ·,å’Œå·¥ä½œè¿›ç¨‹çš„æ•°é‡å¾—åˆ°äº†Nginxæ­£åœ¨è¿è¡Œ,ç­‰ç­‰ã€‚\n```\nLinuxæŸ¥çœ‹å…¬ç½‘IP\n\næ‚¨å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ˜¾ç¤ºä½ çš„æœåŠ¡å™¨çš„å…¬å…±IPåœ°å€:(è¿™ä¸ªå…¶å®æ²¡ç”¨ï¼Œä¸æ˜¯å…¬ç½‘IP)\n```\nip addr show eth0 | grep inet | awk '{ print $2; }' | sed 's/\\/.*$//'\n```\n___\nå¥½äº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å†æ¥çœ‹çœ‹å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼šæ— æ³•åœ¨å…¬ç½‘è®¿é—®ã€‚\n\nè¿™ä¸ªæ—¶å€™é¦–å…ˆçœ‹çœ‹é…ç½®æ–‡ä»¶default.confå¯¹ä¸å¯¹ï¼Œä¸€ä¸ªæ­£ç¡®çš„ä¾‹å­ï¼š\n(åŸŸåè¦å…ˆè¿›è¡Œè§£æåˆ°å“åº”çš„IP)\n```\nserver {\n    listen       80;\n    server_name  nginx.310058.cn;\n\n    #charset koi8-r;\n    #access_log  /var/log/nginx/log/host.access.log  main;\n\n    location / {\n        root   /usr/share/nginx/html;\n        index  index.html index.htm;\n    }\n\n    #error_page  404              /404.html;\n\n    # redirect server error pages to the static page /50x.html\n    #\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   /usr/share/nginx/html;\n    }\n\n    # proxy the PHP scripts to Apache listening on 127.0.0.1:80\n    #\n    #location ~ \\.php$ {\n    #    proxy_pass   http://127.0.0.1;\n    #}\n\n    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000\n    #\n    #location ~ \\.php$ {\n    #    root           html;\n    #    fastcgi_pass   127.0.0.1:9000;\n    #    fastcgi_index  index.php;\n    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\n    #    include        fastcgi_params;\n    #}\n\n    # deny access to .htaccess files, if Apache's document root\n    # concurs with nginx's one\n    #\n    #location ~ /\\.ht {\n    #    deny  all;\n    #}\n}\n```\n\nç¡®å®šæ–‡ä»¶æ²¡é—®é¢˜äº†ï¼Œçœ‹çœ‹è¿™ä¸ªæ—¶å€™æ˜¯ä¸æ˜¯å¼€å¯äº†nginxè¿›ç¨‹ï¼š\n\n```\n ps -ef | grep nginx\n```\n\nåº”è¯¥ä¼šè¾“å‡ºä¸€ä¸ªæˆ–è€…å¤šä¸ªè¿›ç¨‹ï¼Œå¦‚æœæ²¡æœ‰çš„è¯å°±å¼€å¯æˆ–è€…é‡å¯è¯•è¯•çœ‹ã€‚\n\nè¿™ä¸ªæ—¶å€™æ¥ä¸‹æ¥å†è¯•è¯•åœ¨æœåŠ¡å™¨ä¸Šï¼š\n```\nping  115.29.102.81\ntelnet 115.29.102.81 80\nwget nginx.310058.cn\n```\nå¦‚æœæœ‰çš„å‘½ä»¤æ²¡æœ‰å°±ç›´æ¥yumå®‰è£…ä¸‹:\n```\nyum -y install telnet\n```\nå¦‚æœéƒ½å¯ä»¥çš„è¯ï¼Œä¹‹ååœ¨æœ¬æœºå°è¯•ä»¥ä¸Šä¸‰è¡Œã€‚å¦‚æœæ²¡æœ‰å‘½ä»¤ä¹Ÿè¦å®‰è£…ä¸‹ï¼š\n```\nbrew install wget\n```\n\nå‘ç°å¾ˆå¯èƒ½æœ¬æœºtelnetä¸é€šï¼Œè€ŒæœåŠ¡å™¨telneté€šã€‚\nè¿™ä¸ªæ—¶å€™å°±æ˜¯**é˜²ç«å¢™**çš„é—®é¢˜ã€‚\n\n####centos7.2é˜²ç«å¢™\n\nç”±äºcentos 7ç‰ˆæœ¬ä»¥åé»˜è®¤ä½¿ç”¨firewalldåï¼Œç½‘ä¸Šå…³äºiptablesçš„è®¾ç½®æ–¹æ³•å·²ç»ä¸ç®¡ç”¨äº†ï¼Œæ‰€ä»¥æ ¹æœ¬å°±åˆ«æƒ³ç”¨é…ç½®iptablesåšå•¥ï¼Œæ ¹æœ¬æ²¡ç”¨ã€‚\n\næŸ¥çœ‹ä¸‹é˜²ç«å¢™çŠ¶æ€ï¼š\n```\n[root@iZ28dcsp7egZ conf.d]# systemctl status firewalld  \nâ— firewalld.service - firewalld - dynamic firewall daemon\n   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled; vendor preset: enabled)\n   Active: active (running) since Wed 2016-08-03 12:06:44 CST; 2h 49min ago\n Main PID: 424 (firewalld)\n   CGroup: /system.slice/firewalld.service\n           â””â”€424 /usr/bin/python -Es /usr/sbin/firewalld --nofork --nopid\n\nAug 03 12:06:41 iZ28dcsp7egZ systemd[1]: Starting firewalld - dynamic firewall daemon...\nAug 03 12:06:44 iZ28dcsp7egZ systemd[1]: Started firewalld - dynamic firewall daemon.\n```\n\nå¢åŠ 80ç«¯å£çš„æƒé™ï¼š\n```\nfirewall-cmd --zone=public --add-port=80/tcp --permanent  \n```\n \n åˆ«å¿˜äº†æ›´æ–°é˜²ç«å¢™çš„é…ç½®ï¼š\n```\nfirewall-cmd --reload\n```\nè¿™ä¸ªæ—¶å€™å†`restart  nginx.service` ä¸€ä¸‹å°±ä¼šå‘ç°åº”è¯¥å¥½äº†ã€‚\n\n\nnginx åœæ­¢ï¼š\n\n```\nservice nginx restart\nä¹Ÿå¯ä»¥é‡å¯nginx\n\nkill -QUIT è¿›ç¨‹å·  \n#ä»å®¹åœæ­¢\n\nkill -TERM è¿›ç¨‹å·\n#æˆ–è€…\nkill -INT è¿›ç¨‹å·\n#å¿«é€Ÿåœæ­¢\n\np-kill -9 nginx\nå¼ºåˆ¶åœæ­¢\n\nnginx -t \n#éªŒè¯é…ç½®æ–‡ä»¶ å‰ææ˜¯è¿›å…¥ç›¸åº”çš„é…ç½®çš„ç›®å½•ï¼ˆè‡ªå·±å®é™…æµ‹è¯•çš„æ—¶å€™å‘ç°æ²¡æœ‰è¿›å…¥ç›¸åº”çš„é…ç½®ç›®å½•ä¹Ÿæ˜¯å¯ä»¥çš„ï¼‰\n\nnginx -s reload\n#é‡å¯\n\nkill -HUP è¿›ç¨‹å·\n#é‡å¯çš„å¦å¤–ä¸€ç§æ–¹å¼\n```\n\nå®˜æ–¹æ–‡æ¡£åœ°å€ï¼š\nhttps://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/sec-Using_Firewalls.html#sec-Introduction_to_firewalld\n\né™„1:ä¸€ä¸ªç®€å•çš„è´Ÿè½½å‡è¡¡çš„å®ç°:\nweighté»˜è®¤æ˜¯1ï¼Œè‡ªå·±ä¹Ÿå¯ä»¥æ›´æ”¹ã€‚\n```\nupstream mypro {\n\t\t\t\tip_hash;\n                server 111.13.100.92 weight=2;\n                server 183.232.41.1;\n                server 42.156.140.7;\n                }\n\n        server {\n                listen 8090;\n                location / {\n                proxy_pass http://mypro;\n                }\n        }\n\n```\n\n\né™„2:é˜²ç«å¢™åŸºæœ¬å­¦ä¹ ï¼š\n\n``` \n\n1ã€firewalldç®€ä»‹\nfirewalldæ˜¯centos7çš„ä¸€å¤§ç‰¹æ€§ï¼Œæœ€å¤§çš„å¥½å¤„æœ‰ä¸¤ä¸ªï¼šæ”¯æŒåŠ¨æ€æ›´æ–°ï¼Œä¸ç”¨é‡å¯æœåŠ¡ï¼›ç¬¬äºŒä¸ªå°±æ˜¯åŠ å…¥äº†é˜²ç«å¢™çš„â€œzoneâ€æ¦‚å¿µ\n \nfirewalldæœ‰å›¾å½¢ç•Œé¢å’Œå·¥å…·ç•Œé¢ï¼Œç”±äºæˆ‘åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨ï¼Œå›¾å½¢ç•Œé¢è¯·å‚ç…§å®˜æ–¹æ–‡æ¡£ï¼Œæœ¬æ–‡ä»¥å­—ç¬¦ç•Œé¢åšä»‹ç»\n \nfirewalldçš„å­—ç¬¦ç•Œé¢ç®¡ç†å·¥å…·æ˜¯ firewall-cmd \n \nfirewalldé»˜è®¤é…ç½®æ–‡ä»¶æœ‰ä¸¤ä¸ªï¼š/usr/lib/firewalld/ ï¼ˆç³»ç»Ÿé…ç½®ï¼Œå°½é‡ä¸è¦ä¿®æ”¹ï¼‰å’Œ /etc/firewalld/ ï¼ˆç”¨æˆ·é…ç½®åœ°å€ï¼‰\n \nzoneæ¦‚å¿µï¼š\nç¡¬ä»¶é˜²ç«å¢™é»˜è®¤ä¸€èˆ¬æœ‰ä¸‰ä¸ªåŒºï¼Œfirewalldå¼•å…¥è¿™ä¸€æ¦‚å¿µç³»ç»Ÿé»˜è®¤å­˜åœ¨ä»¥ä¸‹åŒºåŸŸï¼ˆæ ¹æ®æ–‡æ¡£è‡ªå·±ç†è§£ï¼Œå¦‚æœæœ‰è¯¯è¯·æŒ‡æ­£ï¼‰ï¼š\ndropï¼šé»˜è®¤ä¸¢å¼ƒæ‰€æœ‰åŒ…\nblockï¼šæ‹’ç»æ‰€æœ‰å¤–éƒ¨è¿æ¥ï¼Œå…è®¸å†…éƒ¨å‘èµ·çš„è¿æ¥\npublicï¼šæŒ‡å®šå¤–éƒ¨è¿æ¥å¯ä»¥è¿›å…¥\nexternalï¼šè¿™ä¸ªä¸å¤ªæ˜ç™½ï¼ŒåŠŸèƒ½ä¸Šå’Œä¸Šé¢ç›¸åŒï¼Œå…è®¸æŒ‡å®šçš„å¤–éƒ¨è¿æ¥\ndmzï¼šå’Œç¡¬ä»¶é˜²ç«å¢™ä¸€æ ·ï¼Œå—é™åˆ¶çš„å…¬å…±è¿æ¥å¯ä»¥è¿›å…¥\nworkï¼šå·¥ä½œåŒºï¼Œæ¦‚å¿µå’Œworkgoupä¸€æ ·ï¼Œä¹Ÿæ˜¯æŒ‡å®šçš„å¤–éƒ¨è¿æ¥å…è®¸\nhomeï¼šç±»ä¼¼å®¶åº­ç»„\ninternalï¼šä¿¡ä»»æ‰€æœ‰è¿æ¥\nå¯¹é˜²ç«å¢™ä¸ç®—å¤ªç†Ÿæ‚‰ï¼Œè¿˜æ²¡æƒ³æ˜ç™½publicã€externalã€dmzã€workã€homeä»åŠŸèƒ½ä¸Šéƒ½éœ€è¦è‡ªå®šä¹‰å…è®¸è¿æ¥ï¼Œå…·ä½“ä½¿ç”¨ä¸Šçš„åŒºåˆ«è¿˜éœ€é«˜äººæŒ‡ç‚¹\n \n2ã€å®‰è£…firewalld\nrootæ‰§è¡Œ # yum install firewalld firewall-config\n \n3ã€è¿è¡Œã€åœæ­¢ã€ç¦ç”¨firewalld\nå¯åŠ¨ï¼š# systemctl start  firewalld\næŸ¥çœ‹çŠ¶æ€ï¼š# systemctl status firewalld æˆ–è€… firewall-cmd --state\nåœæ­¢ï¼š# systemctl disable firewalld\nç¦ç”¨ï¼š# systemctl stop firewalld\n \n4ã€é…ç½®firewalld\næŸ¥çœ‹ç‰ˆæœ¬ï¼š$ firewall-cmd --version\næŸ¥çœ‹å¸®åŠ©ï¼š$ firewall-cmd --help\næŸ¥çœ‹è®¾ç½®ï¼š\n                æ˜¾ç¤ºçŠ¶æ€ï¼š$ firewall-cmd --state\n                æŸ¥çœ‹åŒºåŸŸä¿¡æ¯: $ firewall-cmd --get-active-zones\n                æŸ¥çœ‹æŒ‡å®šæ¥å£æ‰€å±åŒºåŸŸï¼š$ firewall-cmd --get-zone-of-interface=eth0\næ‹’ç»æ‰€æœ‰åŒ…ï¼š# firewall-cmd --panic-on\nå–æ¶ˆæ‹’ç»çŠ¶æ€ï¼š# firewall-cmd --panic-off\næŸ¥çœ‹æ˜¯å¦æ‹’ç»ï¼š$ firewall-cmd --query-panic\n \næ›´æ–°é˜²ç«å¢™è§„åˆ™ï¼š# firewall-cmd --reload\n                            # firewall-cmd --complete-reload\n    ä¸¤è€…çš„åŒºåˆ«å°±æ˜¯ç¬¬ä¸€ä¸ªæ— éœ€æ–­å¼€è¿æ¥ï¼Œå°±æ˜¯firewalldç‰¹æ€§ä¹‹ä¸€åŠ¨æ€æ·»åŠ è§„åˆ™ï¼Œç¬¬äºŒä¸ªéœ€è¦æ–­å¼€è¿æ¥ï¼Œç±»ä¼¼é‡å¯æœåŠ¡\n \nå°†æ¥å£æ·»åŠ åˆ°åŒºåŸŸï¼Œé»˜è®¤æ¥å£éƒ½åœ¨public\n# firewall-cmd --zone=public --add-interface=eth0\næ°¸ä¹…ç”Ÿæ•ˆå†åŠ ä¸Š --permanent ç„¶åreloadé˜²ç«å¢™\n \nè®¾ç½®é»˜è®¤æ¥å£åŒºåŸŸ\n# firewall-cmd --set-default-zone=public\nç«‹å³ç”Ÿæ•ˆæ— éœ€é‡å¯\n \næ‰“å¼€ç«¯å£ï¼ˆè²Œä¼¼è¿™ä¸ªæ‰æœ€å¸¸ç”¨ï¼‰\næŸ¥çœ‹æ‰€æœ‰æ‰“å¼€çš„ç«¯å£ï¼š\n# firewall-cmd --zone=dmz --list-ports\nåŠ å…¥ä¸€ä¸ªç«¯å£åˆ°åŒºåŸŸï¼š\n# firewall-cmd --zone=dmz --add-port=8080/tcp\nè‹¥è¦æ°¸ä¹…ç”Ÿæ•ˆæ–¹æ³•åŒä¸Š\n \næ‰“å¼€ä¸€ä¸ªæœåŠ¡ï¼Œç±»ä¼¼äºå°†ç«¯å£å¯è§†åŒ–ï¼ŒæœåŠ¡éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼Œ/etc/firewalld ç›®å½•ä¸‹æœ‰servicesæ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªä¸è¯¦ç»†è¯´äº†ï¼Œè¯¦æƒ…å‚è€ƒæ–‡æ¡£\n# firewall-cmd --zone=work --add-service=smtp\n \nç§»é™¤æœåŠ¡\n# firewall-cmd --zone=work --remove-service=smtp\n \nè¿˜æœ‰ç«¯å£è½¬å‘åŠŸèƒ½ã€è‡ªå®šä¹‰å¤æ‚è§„åˆ™åŠŸèƒ½ã€lockdownï¼Œç”±äºè¿˜æ²¡ç”¨åˆ°ï¼Œä»¥åå†å­¦ä¹ \n\n```\n","tags":["centOS","nginx"]}]